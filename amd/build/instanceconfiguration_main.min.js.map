{"version":3,"sources":["../src/instanceconfiguration_main.js"],"names":["define","$","bootstrap","datatables","swal","init","self","instance_id","get_id_instance","load_cohorts_assigned","idnumber","val","description","document","on","unassign_cohort","object_function","assign_cohort_instance","update_info_instance","get_cohorts_without_assignment","ajax","type","data","function","instance","url","success","msg","status","options","cohorts_array","length","each","key","id","name","html","error_msg","dataType","cache","async","error","DataTable","idnumber_cohort","parent","siblings","innerHTML","urlParameters","location","search","split","x","indexOf","intanceparameter","obj","cohort_id","cohort","title"],"mappings":"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","sourcesContent":["// Standard license block omitted.\n/*\n * @package    block_ases/instanceconfiguration_main\n * @copyright  ASES\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n /**\n  * @module block_ases/instanceconfiguration_main\n  */\n\ndefine(['jquery', 'block_ases/bootstrap', 'block_ases/jquery.dataTables','block_ases/sweetalert'],\n        function($, bootstrap, datatables, swal) {\n\n    return {\n\n        init: function() {\n\n            var self = this;\n            var instance_id = self.get_id_instance();\n\n            self.load_cohorts_assigned();\n\n            var idnumber = $('#input_idnumber').val();\n            var description = $('#input_description').val();\n            \n            //$('span.unassigned_cohort').on('click', {object_function: self}, self.unassign_cohort);\n            \n            $(document).on(\"click\", \"span.unassigned_cohort\", self.unassign_cohort );\n            \n            $('#button_assign_cohort').on('click', {object_function: self}, self.assign_cohort_instance);\n            $('#button_update_instance').on('click', function(){\n                var idnumber = $('#input_idnumber').val();\n                var description = $('#input_description').val();\n                self.update_info_instance(instance_id, idnumber, description);\n            });\n\n        },\n        get_cohorts_without_assignment: function(instance_id){\n\n            if(instance_id == undefined){\n                var instance_id = this.get_id_instance();\n            }\n\n            $.ajax({\n                type: \"POST\",\n                data: {\n                       function: 'load_cohorts_without_assignment',\n                       instance: instance_id},\n                url: \"../managers/instance_management/instance_configuration_serverproc.php\",\n                success: function(msg) {\n                    if(msg.status == 0){\n                        swal(\n                            'Error',\n                            msg.msg,\n                            'error'\n                        );\n                    }else if(msg.status == 1){\n\n                        var options = \"\";\n                        var cohorts_array = msg.msg;\n\n                        if(cohorts_array.length == 0){\n                            options += \"<option>No hay cohortes disponibles para asignar</option>\";\n                        }else{\n                            $.each(cohorts_array, function(key){\n                                options += \"<option value='\"+cohorts_array[key].id+\"'>\";\n                                options += cohorts_array[key].idnumber+\" \"+cohorts_array[key].name+\"</option>\";\n                            });\n                        }\n\n                        $('#select_cohorts').html(options);\n\n                    }else{\n                        var error_msg = \"Error al cargar las cohortes no asignadas. Por favor recargue la página.\";\n                        error_msg += \"Si el problema persiste contacte al área de sistemas.\";\n                        swal(\n                            'Error',\n                            error_msg,\n                            'error'\n                        );\n                    }\n                },\n                dataType: \"json\",\n                cache: false,\n                async: false,\n                error: function() {\n                    swal(\n                        'Error',\n                        'Error al cargar las cohortes sin asignación',\n                        'error'\n                    );\n                },\n            });\n        },\n        load_cohorts_assigned: function(instance_id){\n\n            if(instance_id == undefined){\n                var instance_id = this.get_id_instance();\n            }\n\n            $.ajax({\n                type: \"POST\",\n                data: {\n                       function: 'load_cohorts',\n                       instance: instance_id},\n                url: \"../managers/instance_management/instance_configuration_serverproc.php\",\n                success: function(msg) {\n                    if(msg.status == 0){\n                        $('#div_cohorts_table').html(\"<center><span>La instancia no tiene cohortes asignadas</span></center>\");\n                    }else{\n                        var html = \"\";\n                        html += \"<h4>Cohortes asignadas a la instancia</h4><hr/>\";\n                        html += \"<table id='cohorts_table' class='col-sm-12' style='width:100%'></table>\";\n                        $('#div_cohorts_table').html(html);\n                        $('#cohorts_table').DataTable(msg.msg);\n                    }\n                },\n                dataType: \"json\",\n                cache: false,\n                async: false,\n                error: function() {\n                    swal(\n                        'Error',\n                        'Error al cargar las cohortes asignadas',\n                        'error'\n                    );\n                },\n            });\n        },\n        unassign_cohort: function(obj){\n            \n            var idnumber_cohort = $(this).parent().siblings()[0].innerHTML;\n            var instance_id = $(\"#instance-id\").data(\"instance-id\");\n\n            $.ajax({\n                type: \"POST\",\n                data: {\n                    function: 'unassign_cohort',\n                    instance_id: instance_id,\n                    idnumber_cohort: idnumber_cohort},\n                url: \"../managers/instance_management/instance_configuration_serverproc.php\",\n                success: function(msg){\n                    if(msg.status == 1){\n                        swal(\n                            'Éxito',\n                            msg.msg + \" La lista de cohortes se actualizarán en la siguiente recarga del sitio.\",\n                            'success'\n                        );\n                    }else{\n                        swal(\n                            'Error',\n                            msg.msg,\n                            'error'\n                        );\n                    }\n                },\n                error: function(msg){\n                    swal(\n                        'Error',\n                        'Error al conctarse con el servidor.',\n                        'error'\n                    );\n                },\n                dataType: \"json\",\n                cache: false,\n                async: false\n            });\n            /*obj.data.object_function.get_cohorts_without_assignment();\n            obj.data.object_function.load_cohorts_assigned();\n            $('span.unassigned_cohort').on('click', {object_function: obj.data.object_function}, obj.data.object_function.unassign_cohort);*/\n        },\n        get_id_instance: function(){\n            var urlParameters = location.search.split('&');\n            for (var x in urlParameters) {\n                if (urlParameters[x].indexOf('instanceid') >= 0) {\n                    var intanceparameter = urlParameters[x].split('=');\n                    return intanceparameter[1];\n                }\n            }\n            return 0;\n        },\n        assign_cohort_instance: function(obj){\n\n            var cohort_id = $('#select_cohorts').val();\n            var instance_id = obj.data.object_function.get_id_instance();\n\n            $.ajax({\n                type: \"POST\",\n                data: { function: 'insert_cohort',\n                        cohort: cohort_id,\n                        instance: instance_id},\n                url: \"../managers/instance_management/instance_configuration_serverproc.php\",\n                success: function(msg) {\n                    if(msg.status == 0){\n                        var title = 'Error';\n                        var type = 'error';\n                    }else{\n                        var title = 'Éxito';\n                        var type = 'success';\n                    }\n                    swal(\n                        title,\n                        msg.msg,\n                        type\n                    );\n\n                    obj.data.object_function.get_cohorts_without_assignment();\n                    obj.data.object_function.load_cohorts_assigned();\n                    $('span.unassigned_cohort').on('click', {object_function: obj.data.object_function}, obj.data.object_function.unassign_cohort);\n                },\n                dataType: \"json\",\n                cache: false,\n                async: false,\n                error: function(){\n                    swal(\n                        'Error',\n                        'Error al comunicarse con el servidor.',\n                        'error'\n                    );\n                },\n            });\n        },\n        update_info_instance: function(instance_id, idnumber, description){\n\n\n            data = {\n                function: 'update_info_instance',\n                instance_id: instance_id,\n                idnumber: idnumber,\n                description: description\n            }\n\n            $.ajax({\n                type: \"POST\",\n                data: data,\n                url: \"../managers/instance_management/instance_configuration_serverproc.php\",\n                success: function(msg) {\n                    if(msg){\n                        swal(\n                            'Éxito',\n                            msg.msg,\n                            'success'\n                        );\n                    }else{\n                        swal(\n                            'Error',\n                            msg.msg,\n                            'error'\n                        );\n                    }\n                },\n                dataType: \"json\",\n                cache: false,\n                async: false,\n                error: function() {\n                    swal(\n                        'Error',\n                        'Error al actualizar la instancia',\n                        'error'\n                    );\n                },\n            });\n\n        }\n    };\n});"],"file":"instanceconfiguration_main.min.js"}