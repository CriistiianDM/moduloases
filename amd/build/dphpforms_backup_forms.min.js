define(["jquery","block_ases/jszip","block_ases/jquery.dataTables","block_ases/dataTables.autoFill","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2","block_ases/loading_indicator","block_ases/_general_modal_manager"],function(a,e,s,t,o,r,d,l,p,n,c,u,_,h){return{init:function(){function e(e,s){_.show(),a.ajax({type:"POST",data:{loadF:e,params:s},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",dataType:"json",cache:!1,async:!0,success:function(t){if(_.hide(),""!=t[s].datos_previos){let a=JSON.parse(t[s].datos_previos);if("get_form"==e&&(t[s].datos_previos=a),"get_form_general_logs"==e)if(Array.isArray(a))t[s].datos_previos=a;else{let e=Array();for(data in a){let s={};s[data]=a[data],e.push(s)}t[s].datos_previos=e}}""!=t[s].datos_enviados&&(t[s].datos_enviados=JSON.parse(t[s].datos_enviados)),""!=t[s].datos_almacenados&&(t[s].datos_almacenados=JSON.parse(t[s].datos_almacenados)),function(e){a("#div_JSONform").empty();var s=JSON.stringify(e);a("#div_JSONform").append(s),a("#div_JSONform").beautifyJSON({type:"flexible",hoverable:!0,collapsible:!0,color:!0});let t=Object.keys(e)[0],o=e[t];a("#json_record_dwarehouse_selected").attr("value",JSON.stringify(o)),-1!=o.id_registro_respuesta_form?"DELETE"==o.accion?(a(".dphpforms-peer-record").attr("data-record-id",o.id_registro_respuesta_form),a(".dphpforms-restore").attr("data-record-id",t),a(".dphpforms-restore").attr("data-estado",1),a(".dphpforms-peer-record").attr("disabled",!1),a(".dphpforms-restore").attr("disabled",!1),a(".dphpforms-compare").attr("disabled",!1),a(".dphpforms-peer-record").hide(),a(".dphpforms-restore").show(),a(".dphpforms-compare").show()):"INSERT"==o.accion||"UPDATE"==o.accion||"RESTORE"==o.accion?(a(".dphpforms-peer-record").attr("data-record-id",o.id_registro_respuesta_form),a(".dphpforms-peer-record").attr("disabled",!1),a(".dphpforms-restore").attr("disabled",!0),a(".dphpforms-compare").attr("disabled",!1),a(".dphpforms-peer-record").hide(),a(".dphpforms-restore").show(),a(".dphpforms-compare").show()):(a(".dphpforms-peer-record").attr("disabled",!0),a(".dphpforms-restore").attr("disabled",!0),a(".dphpforms-compare").attr("disabled",!0),a(".dphpforms-peer-record").hide(),a(".dphpforms-restore").hide(),a(".dphpforms-compare").hide()):(a(".dphpforms-peer-record").attr("disabled",!0),a(".dphpforms-restore").attr("disabled",!0),a(".dphpforms-compare").attr("disabled",!0),a(".dphpforms-peer-record").hide(),a(".dphpforms-restore").hide(),a(".dphpforms-compare").hide());a("#modal_JSON").fadeIn(300)}(t)},failure:function(a){_.hide()}})}function s(a){let e="";for(campo in a)e+='<div class="contenedor" >',e+="<div data-id-pregunta="+a[campo].id_pregunta+" data-id-relacion-form-pregunta="+a[campo].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div >Alias: No registra en esta versión</div> ',e+="<div>Respuesta: No registra en esta versión</div> </div>",e+="<div data-id-pregunta="+a[campo].id_pregunta+" data-id-relacion-form-pregunta="+a[campo].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_similar" style="border: 1px solid green !important;">  <div>Alias: '+a[campo].local_alias+"  </div> ",e+="<div>Respuesta: "+a[campo].respuesta+"  </div> </div>",e+="</div>";return e}a(document).on("mousedown",".slider.round",function(e){"off"==a(this).data("status")?(a(this).data("status","on"),a("#busqueda-simplificada").hide(),a("#busqueda-avanzada").show()):(a(this).data("status","off"),a("#busqueda-avanzada").hide(),a("#busqueda-simplificada").show())}),a(document).on("click","#generarFiltroSimplificado",function(){let e=a("#simple_cod_user").val(),s=a("#simple_criteria_select option:selected").val();_.show(),a.ajax({type:"POST",data:{loadF:"get_records_simple",username:e,is_student:s},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",cache:!1,async:!0,success:function(e){if(_.hide(),0===e.length)swal("ATTRIBUTE NOT FOUND","Oooops! Zero results","warning");else{a("#div_table_forms").empty(),a("#div_table_forms").append('<table id="tableBackupForms" class="display" cellspacing="0" width="100%"><thead><thead></table>');a("#tableBackupForms").DataTable(e);a("#div_table_forms").css("cursor","pointer")}},failure:function(a){_.hide(),alert("No encontrado")}})}),a(document).ready(function(){_.show(),a.ajax({type:"POST",data:{loadF:"loadForms"},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",success:function(e){_.hide(),a("#div_table_forms").empty(),a("#div_table_forms").append('<table id="tableBackupForms" class="display" cellspacing="0" width="100%"><thead><thead></table>');a("#tableBackupForms").DataTable(e);a("#div_table_forms").css("cursor","pointer")},dataType:"json",cache:!1,async:!0,failure:function(a){_.hide()}}),a.ajax({type:"POST",data:{loadF:"loadGeneralLogs"},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",success:function(e){a("#div_table_general_logs").empty(),a("#div_table_general_logs").append('<table id="tableBackupGeneralLogs" class="display" cellspacing="0" width="100%"><thead><thead></table>');a("#tableBackupGeneralLogs").DataTable(e);a("#div_table_general_logs").css("cursor","pointer")},dataType:"json",cache:!1,async:!0,failure:function(a){}})}),a(document).on("click","#tableBackupForms tbody tr td",function(){let s="";e("get_form",s=a(this).parents("tr").find("td:first").html())}),a(document).on("click","#tableBackupGeneralLogs tbody tr td",function(){let s="";e("get_form_general_logs",s=a(this).parents("tr").find("td:first").html())}),a("#generarFiltro").on("click",function(){!function(e,s){let t=[];t.push(e),t.push(s),_.show(),a.ajax({type:"POST",data:{loadF:"get_id_user",params:t},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",success:function(e){_.hide(),0===e.length?swal("USER NOT FOUND","Oooops! Incorrect code","warning"):(a("#div_code_user").empty(),a("#div_code_user").append("<strong>Usuario: </strong>"+e[0].cod_user),a("#div_name_user").empty(),a("#div_name_user").append(e[0].name_user+" "+e[0].last_name_user))},cache:!1,async:!0,failure:function(a){_.hide(),alert("No encontrado")}})}(document.getElementById("filtroCodigoUsuario").value,document.getElementById("selectTable").value)}),a("#load_like").on("click",function(){var e,s,t=document.getElementById("typecolumn_select").value,o=document.getElementById("filtroLike").value;e=o,s=t,_.show(),a.ajax({type:"POST",data:{loadF:"get_like",cadena:e,atributo:s},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",success:function(e){_.hide(),0===e.length?swal("ATTRIBUTE NOT FOUND","Oooops! Zero results","warning"):(a("#div_table_forms").empty(),a("#div_table_forms").append('<table id="tableBackupForms" class="display" cellspacing="0" width="100%"><thead><thead></table>'),a("#tableBackupForms").DataTable(e),a("#div_table_forms").css("cursor","pointer"))},cache:!1,async:!0,failure:function(a){_.hide(),alert("No encontrado")}})}),a("#typecolumn_select").on("click",function(){"datos_previos"==a("#typecolumn_select").val()||"datos_enviados"==a("#typecolumn_select").val()||"datos_almacenados"==a("#typecolumn_select").val()?a("#typekey_select").parent().parent().show():a("#typekey_select").parent().parent().hide()}),a("#typekey_select").on("click",function(){if("datos_enviados"==a("#typecolumn_select").val()){let e='"id":"'+a(this).val()+'","valor":"MODIFIQUE ESTE VALOR"';a("#filtroLike").val(e)}var e;"datos_previos"!=a("#typecolumn_select").val()&&"datos_almacenados"!=a("#typecolumn_select").val()||(e=a(this).val(),_.show(),a.ajax({type:"POST",data:{loadF:"get_values",params:e},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",success:function(e){if(_.hide(),0===e.length)swal("QUESTION NOT FOUND","Oooops! Incorrect code","warning");else{opciones=e[0].options_c,tipo_campo=e[0].tipo_campo;let s='"respuesta":"MODIFIQUE ESTE VALOR","opciones":"'+opciones+'","tipo_campo":"'+tipo_campo+'","id_pregunta":"'+a("#typekey_select").val()+'"';a("#filtroLike").val(s)}},cache:!1,async:!0,failure:function(a){_.hide(),alert("No encontrado")}}))}),a(".dphpforms-restore").on("click",function(){if(!a(this).attr("disabled")&&1==a(this).attr("data-estado")){let s=a(this).attr("data-record-id");e=s,_.show(),a.ajax({type:"POST",data:{loadF:"restore_dwarehouse_record",params:e},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",success:function(a){_.hide(),a?swal("RESTORED SUCCESSFULLY","SUCCESS","success"):swal("NOT RESTORED SUCCESSFULLY","Oooops! Error","warning")},cache:!1,async:!0,error:function(a){_.hide(),swal("SYSTEM ERROR","Report to Systems office","error")}})}var e}),a(".dphpforms-compare").on("click",function(){if(!a(this).attr("disabled")){let e,t,o,r,i,d,l;r=(o=JSON.parse(a("#json_record_dwarehouse_selected").val())).id_usuario_moodle,i=o.accion,d=o.fecha_hora_registro,l=o.url_request;let p,n,c="";if(c+='<div class="contenedor" >'+(p=""==(e=o.datos_previos)||null==e?'<div class = "data_estado_json text_json"> No hay datos previos </div>':'<div class="data_estado_json text_json"> Alias formulario:        '+(e=e.record).alias+"</div>")+(n=""==(t=o.datos_almacenados)||null==t?'<div class = "data_estado_json text_json"> No hay datos almacenados </div>':'<div class="data_estado_json text_json"> Alias formulario:        '+(t=t.record).alias+"</div>")+"</div>",""!=e&&null!=e&&""!=t&&null!=t){c+=function(a,e){let s,t,o,r,i;for(campo_b in i="",o=a.length,s="",t="",e){for(campo_a in r=0,a){if(r++,e[campo_b].local_alias==a[campo_a].local_alias){e[campo_b].respuesta==a[campo_a].respuesta?(t+="<div data-id-pregunta="+a[campo_a].id_pregunta+" data-id-relacion-form-pregunta="+a[campo_a].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_similar" style="border: 1px solid green !important;">  <div class = "text_json">Alias: '+a[campo_a].local_alias+"  </div> ",t+='<div class = "text_json">Respuesta: '+a[campo_a].respuesta+"  </div> </div>",s+="<div data-id-pregunta="+e[campo_b].id_pregunta+" data-id-relacion-form-pregunta="+e[campo_b].id_relacion_form_pregunta+' class="data_estado_json data_estado_json_similar" style="border: 1px solid green !important;">  <div class = "text_json">Alias: '+e[campo_b].local_alias+"  </div> ",s+='<div class = "text_json">Respuesta: '+e[campo_b].respuesta+"  </div> </div>"):(t+="<div data-id-pregunta="+a[campo_a].id_pregunta+" data-id-relacion-form-pregunta="+a[campo_a].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div class = "text_json" >Alias: '+a[campo_a].local_alias+"  </div> ",t+='<div class = "text_json data_estado_json_different" >Respuesta: '+a[campo_a].respuesta+"  </div> </div>",s+="<div  data-id-pregunta="+e[campo_b].id_pregunta+" data-id-relacion-form-pregunta="+e[campo_b].id_relacion_form_pregunta+' class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div class = "text_json" >Alias: '+e[campo_b].local_alias+"  </div> ",s+='<div class = "text_json data_estado_json_different">Respuesta: '+e[campo_b].respuesta+"  </div> </div>");break}r==o&&(t+="<div data-id-pregunta="+e[campo_b].id_pregunta+" data-id-relacion-form-pregunta="+e[campo_b].id_relacion_form_pregunta+'  class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div class = "text_json" >Alias: No registra en esta versión</div> ',t+='<div  class = "text_json">Respuesta: No registra en esta versión</div> </div>',s+="<div  data-id-pregunta="+e[campo_b].id_pregunta+" data-id-relacion-form-pregunta="+e[campo_b].id_relacion_form_pregunta+' class="data_estado_json data_estado_json_different" style="border: 1px solid red !important;">  <div class = "text_json">Alias: '+e[campo_b].local_alias+"  </div> ",s+='<div  class = "text_json">Respuesta: '+e[campo_b].respuesta+"  </div> </div>")}i+='<div class="contenedor" >'+t+s+"</div>",t="",s=""}return i}(e.campos,t.campos)}else""!=e&&null!=e?c+=s(e.campos):""!=t&&null!=t&&(c+=s(t.campos));let u='<div class="grid_dphpforms_compare">';u+='<div class="general_info_record_dwarehouse"> ',u+='<div class= "title_data">Información del registro </div>',u+='<div class="data_general text_json">  Realizado por:        '+r+"</div>",u+='<div class="data_general text_json">  Acción del registro: <strong style= "font-size: 18px;"> '+i+"</strong></div>",u+='<div class="data_general text_json">  Fecha:                '+d+"</div>",u+='<div class="url_students data_general text_json"> </div>',u+="                            </div>",u+='<div class = "json_data_compare">',u+='<div class="contenedor" >',u+='<div class="title_data text_json"> Datos previos</div>',u+='<div class="title_data text_json"> Datos almacenados</div>',u+="</div>",u+=c,u+="                                    </div>",u+="</div>",u+='<hr style="background-color: red; height: 1px; border: 0">',h.generate_modal("modal_to_compare","Comparación de estados",u,null,function(){h.show_modal(".modal_to_compare")}),function(e,s,t){let o=[];o.push(e),o.push(s),o.push(JSON.stringify(t)),a.ajax({type:"POST",data:{loadF:"get_student_code_to_url",params:o},url:"../managers/dphpforms/dphpforms_dwarehouse_api.php",cache:!1,success:function(e){let s,t,o,r,i,d,l="";if(0===e.length)l="<strong>Enlace(s) no disponible(s)</strong>",a(".url_students").empty(),a(".url_students").append(l);else{for(student_data in e){let a;o=e[student_data],d=Object.keys(o)[0],s=o[d].username,t=o[d].firstname+" "+o[d].lastname,r=o[d].courseid,i=o[d].instanceid,l+='<div> Estudiante: <a href="'+(a="student_profile.php?courseid="+r+"&instanceid="+i+"&student_code="+s)+'"  target="_blank" ><strong>'+t+" "+s+"</strong></a></div>"}a(".url_students").empty(),a(".url_students").append(l)}},error:function(a){swal("TYPE FORM NOT FOUND","Oooops! Is not a valid form to create url","warning")}})}(o.id_registro_respuesta_form,i,o)}}),a(".outside").click(function(){var e=a(this);swal({title:"Confirmación de salida",text:"",type:"warning",showCancelButton:!0,confirmButtonText:"Salir"},function(s){s&&(a(e).parent(".mymodal").fadeOut(300),console.log(a(this).parent(".mymodal")))})}),function(a){a.fn.beautifyJSON=function(e){var s=jQuery.extend({},{type:"strict",hoverable:!0,collapsible:!0,color:!0},e);this.each(function(){if("plain"==s.type){var e="&ensp;&ensp;&ensp;",t=[],o="",r=((p=this.innerHTML).split('"').map(function(a,e){return e%2?a:a.replace(/\s/g,"")}).join('"'),"");function d(a){var e=a.pop();return a.push(e),e}for(i=0;i<p.length;i++)"{"==p.charAt(i)?(t.push(p.charAt(i)),r+=p.charAt(i)+"<br>",r+=o+=e):'"'==p.charAt(i)&&'"'!=d(t)?(r+=p.charAt(i),t.push(p.charAt(i))):"["==p.charAt(i)&&"]"==p.charAt(i+1)?(t.push(p.charAt(i)),r+=p.charAt(i),o+=e):"["==p.charAt(i)?(t.push(p.charAt(i)),r+=p.charAt(i)+"<br>",r+=o+=e):"]"==p.charAt(i)?(o=o.substring(0,o.length-18),r+="<br>"+o,r+=p.charAt(i),t.pop()):"}"==p.charAt(i)?(o=o.substring(0,o.length-18),r+="<br>"+o+p.charAt(i),t.pop(),0!=t.length&&"["!=d(t)&&"{"!=d(t)&&(r+=o)):'"'==p.charAt(i)&&'"'==d(t)?(r+=p.charAt(i),t.pop()):","==p.charAt(i)&&'"'!=d(t)?(r+=p.charAt(i)+"<br>",r+=o):"\n"==p.charAt(i)||" "==p.charAt(i)&&'"'!=d(t)||(r+=p.charAt(i));this.innerHTML=r}else if("flexible"==s.type){t=[];var l=[],p=this.innerHTML;r="";if(s.collapsible)var n="<span class='ellipsis'></span><div class='collapser'></div><ul class='array collapsible'>";else n="<div></div><ul class='array'>";if(s.hoverable)var c="<div class='hoverable'>";else c="<div>";function d(a){var e=a.pop();return a.push(e),e}for(r+="<div id='json'>",l.push("</div>"),i=0;i<p.length;i++)"{"==p.charAt(i)?(t.push(p.charAt(i)),r+=p.charAt(i),r+=n,l.push("</ul>"),r+="<li>"+c,l.push("</div></li>")):'"'==p.charAt(i)&&'"'!=d(t)?(r+=p.charAt(i),t.push(p.charAt(i))):"["==p.charAt(i)&&"]"==p.charAt(i+1)?(t.push(p.charAt(i)),r+=p.charAt(i),r+=n,l.push("</ul>"),r+="<li>"+c,l.push("</div></li>")):"["==p.charAt(i)?(t.push(p.charAt(i)),r+=p.charAt(i),r+=n,l.push("</ul>"),r+="<li>"+c,l.push("</div></li>")):"]"==p.charAt(i)?(r+=l.pop()+l.pop(),r+=p.charAt(i),t.pop()):"}"==p.charAt(i)?(r+=l.pop()+l.pop(),r+=p.charAt(i),t.pop(),0!=t.length&&"["!=d(t)&&"{"!=d(t)&&(r+=l.pop())):'"'==p.charAt(i)&&'"'==d(t)?(r+=p.charAt(i),t.pop()):","==p.charAt(i)&&'"'!=d(t)?(r+=p.charAt(i),r+=l.pop(),r+="<li>"+c,l.push("</div></li>")):"\n"==p.charAt(i)||" "==p.charAt(i)&&'"'!=d(t)||(r+=p.charAt(i));this.innerHTML=r}else{r="",l=[];if(s.collapsible){n="<span class='ellipsis'></span><div class='collapser'></div><ul class='array collapsible'>";var u="<span class='ellipsis'></span><div class='collapser'></div><ul class='obj collapsible'>"}else n="<div></div><ul class='array'>",u="<div></div><ul class='obj'>";if(s.hoverable)c="<div class='hoverable'>";else c="<div>";function d(a){var e=a.pop();return a.push(e),e}function _(e){a.each(e,function(e,s){null==s?r+="<li>"+c+"<span class='property'>"+e+"</span>: <span class='type-null'>"+s+"</span></div></li>":s instanceof Array?(r+="<li>"+c+"<span class='property'>"+e+"</span>: ["+n,l.push("</li>"),l.push("</div>"),l.push("</ul>"),function e(s){a.each(s,function(a,s){null==s?r+="<li>"+c+"<span class='property'>"+a+"</span>: <span class='type-null'>"+s+"</span></div></li>":s instanceof Array?(r+="<li>"+c+"["+n,l.push("</li>"),l.push("</div>"),l.push("</ul>"),e(s)):"object"==typeof s?(r+="<li>"+c+"{"+u,l.push("</li>"),l.push("</div>"),l.push("</ul>"),_(s)):r+="number"==typeof s?"<li>"+c+"<span class='property'>"+a+"</span>: <span class='type-number'>"+s+"</span></div></li>":"string"==typeof s?"<li>"+c+"<span class='property'>"+a+"</span>: <span class='type-string'>\""+s+'"</span></div></li>':"boolean"==typeof s?"<li>"+c+"<span class='property'>"+a+"</span>: <span class='type-boolean'>"+s+"</span></div></li>":"<li>"+c+"<span class='property'>"+a+"</span>: "+s+"</div></li>"});r+=l.pop()+"]"+l.pop()+l.pop()}(s)):"object"==typeof s?(r+="<li>"+c+"<span class='property'>"+e+"</span>: {"+u,l.push("</li>"),l.push("</div>"),l.push("</ul>"),_(s)):r+="number"==typeof s?"<li>"+c+"<span class='property'>"+e+"</span>: <span class='type-number'>"+s+"</span></div></li>":"string"==typeof s?"<li>"+c+"<span class='property'>"+e+"</span>: <span class='type-string'>\""+s+'"</span></div></li>':"boolean"==typeof s?"<li>"+c+"<span class='property'>"+e+"</span>: <span class='type-boolean'>"+s+"</span></div></li>":"<li>"+c+"<span class='property'>"+e+"</span>: "+s+"</div></li>"}),r+=l.pop()+"}"+l.pop()+l.pop()}p=this.innerHTML;var h=jQuery.parseJSON(p);r="",r+="<div id='json'>",r+=c+"{"+u,l.push(""),l.push("</div>"),l.push("</ul>"),_(h),r+="</ul></div></div>",this.innerHTML=r}a(".hoverable").hover(function(e){e.stopPropagation(),a(".hoverable").removeClass("hovered"),a(this).addClass("hovered")},function(e){e.stopPropagation(),a(this).addClass("hovered")}),a(".collapser").off().click(function(e){a(this).parent(".hoverable").toggleClass("collapsed")})})}}(jQuery),a(".mymodal-close").click(function(){a("#modal_JSON").hide()}),a(".btn-danger-close").click(function(){a("#modal_JSON").hide()})}}});