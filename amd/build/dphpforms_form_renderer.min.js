'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a){return{init:function init(){function g(){var l=location.search.split('&');for(var m in l)if(0<=l[m].indexOf('student_code')){var n=l[m].split('=');return n[1].split('-')[0]}return 0}function h(){var m=j('.puntuacion_riesgo_individual'),n=a('.comentarios_individual').find('textarea').val();var o=j('.puntuacion_riesgo_familiar'),p=a('.comentarios_familiar').find('textarea').val(),q=j('.puntuacion_riesgo_academico'),r=a('.comentarios_academico').find('textarea').val(),s=j('.puntuacion_riesgo_economico'),t=a('.comentarios_economico').find('textarea').val(),u=j('.puntuacion_vida_uni'),v=a('.comentarios_vida_uni').find('textarea').val();if('3'==m||'3'==o||'3'==q||'3'==s||'3'==u){var w={'function':'send_email_dphpforms',student_code:g(),risks:[{name:'Individual',risk_lvl:m,observation:n},{name:'Familiar',risk_lvl:o,observation:p},{name:'Acad\xE9mico',risk_lvl:q,observation:r},{name:'Econ\xF3mico',risk_lvl:s,observation:t},{name:'Vida Universitaria',risk_lvl:u,observation:v}],date:a('.fecha').find('input').val(),url:window.location.href};a.ajax({type:'POST',data:JSON.stringify(w),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(y){console.log(y)},dataType:'text',cache:'false',error:function error(y){console.log(y)}})}}function j(l){var m=0;return a(l).find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').is(':checked')&&(m=a(this).find('label').find('input').val())}),m}function k(l,m){a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id='+l+'&record_id='+m,function(n){a('#body_editor').html(''),a('#body_editor').append(n),a('#permissions_informationr').html('');var o=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),p=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');(o||p)&&a('.dphpforms-record').find('.btn-dphpforms-delete-record').remove();for(var q=JSON.parse(a('#permissions_information').text()),r=0;r<q.behaviors_permissions.length;r++){for(var v,s=q.behaviors_permissions[r].behaviors[0],t=s.behaviors_accessibility,u=0;u<t.length;u++)v=t[u].disabled,'true'==v?v=!0:'false'==v&&(v=!1),a('.dphpforms-record').find('#'+t[u].id).prop('disabled',v),a('.dphpforms-record').find('.'+t[u]['class']).prop('disabled',v);for(var w=s.behaviors_fields_to_remove,u=0;u<w.length;u++)a('.dphpforms-record').find('#'+w[u].id).remove(),a('.dphpforms-record').find('.'+w[u]['class']).remove();for(var y=s.limpiar_to_eliminate,u=0;u<y.length;u++)a('.dphpforms-record').find('.'+y[u]['class']+'.limpiar ').remove()}a('#permissions_informationr').html('')})}a('.btn.btn-danger.btn-univalle.btn-card').click(function(){var l=a(this).attr('data-container'),m=a('#'+l).height();if(0==m)a(this).find('span').removeClass('glyphicon-chevron-left'),a(this).find('span').addClass('glyphicon-chevron-down');else{for(;0>m;)m=a('#'+l).height();a(this).find('span').removeClass('glyphicon-chevron-down'),a(this).find('span').addClass('glyphicon-chevron-left')}}),a('#button_add_v2_track').on('click',function(){a('#modal_v2_peer_tracking').fadeIn(300),a('.id_estudiante').find('input').val(g());var l=a('#current_user_id').val();a('.id_creado_por').find('input').val(l)}),a('.mymodal-close').click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),a('.dphpforms-peer-record').on('click',function(){var l=a(this).attr('data-record-id');k('seguimiento_pares',l),a('#modal_v2_edit_peer_tracking').fadeIn(300)}),a('.limpiar').click(function(){a(this).parent().find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').prop('checked',!1)})}),a(document).on('click','.limpiar',function(){a(this).parent().find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').prop('checked',!1)})}),a(document).on('submit','.dphpforms',function(l){l.preventDefault();var m=new FormData(this),n=a(this),o=n.attr('action');'procesador.php'==n.attr('action')&&(o='../managers/dphpforms/procesador.php'),a.ajax({type:'POST',url:o,data:m,cache:!1,contentType:!1,processData:!1,success:function success(p){var q=JSON.parse(p);if(console.log(p),0==q.status){var r='';'Stored'==q.message?r='Almacenado':'Updated'==q.message&&(r='Actualizado'),h(),swal({title:'Informaci\xF3n',text:r,type:'success'},function(){'Updated'==q.message&&a('#dphpforms-peer-record-'+a('#dphpforms_record_id').val()).stop().animate({backgroundColor:'rgb(175, 255, 173)'},400).animate({backgroundColor:'#f5f5f5'},4e3)}),a('.dphpforms-response').trigger('reset'),a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300)}else if(-2==q.status){var r='';'Without changes'==q.message?r='No hay cambios que registrar':'Unfulfilled rules'==q.message&&(r='Revise los valores ingresados'),swal('Alerta',r,'warning')}else-1==q.status&&(console.log(p),swal('ERROR!','Oops!, informe de este error','error'))},error:function error(p){console.log(p),swal('Error!','Oops!, informe de este error','error')}})}),a(document).on('click','.btn-dphpforms-delete-record',function(){swal({title:'Confirmaci\xF3n',text:'Est\xE1 eliminando este registro, \xBFdesea continuar?',type:'warning',showCancelButton:!0,confirmButtonText:'S\xED, Eliminar!'},function(l){if(l){var m=a('.btn-dphpforms-delete-record').attr('data-record-id');a.get('../managers/dphpforms/dphpforms_delete_record.php?record_id='+m,function(n){var o=n;0==o.status?swal({title:'Informaci\xF3n',text:'Eliminado',type:'success'},function(){a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#dphpforms-peer-record-'+m).remove()}):-1==o.status&&swal('Error!',o.message,'error')})}})})}}});