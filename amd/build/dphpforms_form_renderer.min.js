define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2"],function(a,b,c,d,e){return{init:function(){function b(){return a("#dphpforms_ases_student_code").attr("data-info")}function c(){return a("#dphpforms_block_instance").attr("data-info")}function d(c){var d=f(".seg_geo_nivel_riesgo"),e=a(".seg_geo_observaciones").find("textarea").val();if("3"==d){var g={"function":"send_email_dphpforms",student_code:b(),risks:[{name:"Geográfico",risk_lvl:d,observation:e}],date:a(".fecha").find("input").val(),url:window.location.href};console.log(JSON.stringify(g)),a.ajax({type:"POST",data:JSON.stringify(g),url:"../managers/pilos_tracking/send_risk_email.php",success:function(a){console.log(a)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}}function e(c){var d=f(".puntuacion_riesgo_individual"),e=a(".comentarios_individual").find("textarea").val(),g=f(".puntuacion_riesgo_familiar"),h=a(".comentarios_familiar").find("textarea").val(),i=f(".puntuacion_riesgo_academico"),j=a(".comentarios_academico").find("textarea").val(),k=f(".puntuacion_riesgo_economico"),l=a(".comentarios_economico").find("textarea").val(),m=f(".puntuacion_vida_uni"),n=a(".comentarios_vida_uni").find("textarea").val();if("3"==d||"3"==g||"3"==i||"3"==k||"3"==m){var o={"function":"send_email_dphpforms",student_code:b(),risks:[{name:"Individual",risk_lvl:d,observation:e},{name:"Familiar",risk_lvl:g,observation:h},{name:"Académico",risk_lvl:i,observation:j},{name:"Económico",risk_lvl:k,observation:l},{name:"Vida Universitaria",risk_lvl:m,observation:n}],date:a(".fecha").find("input").val(),url:window.location.href};console.log(JSON.stringify(o)),a.ajax({type:"POST",data:JSON.stringify(o),url:"../managers/pilos_tracking/send_risk_email.php",success:function(a){console.log(a)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}}function f(b){var c=0;return a(b).find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").is(":checked")&&(c=a(this).find("label").find("input").val())}),c}function g(b,c){if("primer_acercamiento"==b&&"insert"==c);else if("primer_acercamiento"==b&&"update"==c);else if("seguimiento_pares"==b&&"insert"==c);else if("seguimiento_pares"==b&&"update"==c){var d=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),e=(a(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked"),a("#dphpforms_role_support").attr("data-info"));d&&"sistemas"!=e&&(a(".btn-dphpforms-delete-record").remove(),a(".btn-dphpforms-update").remove()),"dir_socioeducativo"==e&&(a(".btn-dphpforms-delete-record").remove(),a(".btn-dphpforms-update").remove());var f=a(".dphpforms-record .btn-dphpforms-univalle").length;1==f?a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-a(".dphpforms-record .btn-dphpforms-close").outerWidth()/2+"px"}):2==f?a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-72+"px"}):3==f&&a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-72-30+"px"})}else if("seguimiento_geografico_"==b&&"insert"==c)a(".seg_geo_origen").find("input").prop("disabled",!1);else if("seguimiento_geografico_"==b&&"update"==c);else if("seguimiento_grupal_"==b&&"insert"==c){var g=(a("modal_v2_edit_groupal_tracking").find("input:checked").length,""),h="";a("#modal_v2_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(""),a("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(""),a("#modal_v2_edit_groupal_tracking").find("input:checked").each(function(b){var c=a(this).parent().parent().find(">:first-child").text(),d=c.split("-");g+=d[0]+","}),a("#modal_v2_groupal_tracking").find("input:checked").each(function(b){var c=a(this).parent().parent().find(">:first-child").text(),d=c.split("-");h+=d[0]+","}),a("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(g.slice(0,-1)),a("#modal_v2_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(h.slice(0,-1))}}function h(b){students_code=b.split(","),console.log(".id_estudiante :"+students_code);var c=[];a("#list_students_attendance_1 > tbody  > tr").each(function(b){var d=a(this).children("td").first().html().split("-");c.push(d[0])}),console.log("lista total de id_estudiantes :"+c),console.log("lista de estudiantes seleccin : "+students_code),a.each(students_code,function(b,d){var e=c.indexOf(d);if(e!=-1){var f=a("#list_students_attendance_1 tbody>tr:eq('"+e+"')"),g=f.find("td").eq(3).children("input");a("input[type=checkbox][value='"+g.val()+"']").prop("checked",!0)}})}function i(b,c){a(".div").removeClass("regla_incumplida"),a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+b+"&record_id="+c,function(b){a("#body_editor").html(""),a("#body_editor").append(b);var c=a("#list_grupal_seg_consult").clone().prop("id","list_grupal_seg_consult_1");a("#modal_v2_edit_groupal_tracking").find("form").find("h1").after(c),a("#list_grupal_seg_consult_1 > #list_students_attendance").prop("id","list_students_attendance_1"),a("#list_grupal_seg_consult_1  input[type=checkbox]").prop("checked",!1);var d=a("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input");void 0!=d.val()&&h(d.val()),a("#permissions_informationr").html("");var e=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),f=a(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(e||f)&&a(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var i=JSON.parse(a("#permissions_information").text()),j=0;j<i.behaviors_permissions.length;j++){for(var k=i.behaviors_permissions[j].behaviors[0],l=k.behaviors_accessibility,m=0;m<l.length;m++){var n=l[m].disabled;"true"==n?n=!0:"false"==n&&(n=!1),a(".dphpforms-record").find("#"+l[m].id).prop("disabled",n),a(".dphpforms-record").find("."+l[m]["class"]).prop("disabled",n)}for(var o=k.behaviors_fields_to_remove,m=0;m<o.length;m++)a(".dphpforms-record").find("#"+o[m].id).remove(),a(".dphpforms-record").find("."+o[m]["class"]).remove();for(var p=k.limpiar_to_eliminate,m=0;m<p.length;m++)a(".dphpforms-record").find("."+p[m]["class"]+".limpiar ").remove()}a("#permissions_informationr").html("");var q=b.indexOf("primer_acercamiento_");q!=-1&&g("primer_acercamiento","update");var r=b.indexOf("seguimiento_de_pares_");r!=-1&&g("seguimiento_pares","update")})}a(document).on("click",".btn-dphpforms-close",function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a(".outside").click(function(){var b=a(this);swal({title:"Confirmación de salida",text:"",type:"warning",showCancelButton:!0,confirmButtonText:"Salir"},function(c){c&&(a(b).parent(".mymodal").fadeOut(300),console.log(a(this).parent(".mymodal")))})}),a(document).ready(function(){a(".seg_geo_origen").find("input").prop("disabled",!0)}),a(document).on("change",a(".seg_geo_vive_zona_riesgo").find("label").find("input"),function(){a(".seg_geo_vive_zona_riesgo").find("label").find("input").prop("checked")?a(".seg_geo_origen").find("input").prop("disabled",!1):(a(".seg_geo_origen").find("input").prop("disabled",!0),a(".seg_geo_origen").find("input").prop("checked",!1))}),a(".seg_geo_vive_zona_riesgo").find("label").find("input").change(function(){a(".seg_geo_vive_zona_riesgo").find("label").find("input").prop("checked")?a(".seg_geo_origen").find("input").prop("disabled",!1):(a(".seg_geo_origen").find("input").prop("disabled",!0),a(".seg_geo_origen").find("input").prop("checked",!1))}),a("#button_actualizar_primer_acercamiento").click(function(){a("div").removeClass("regla_incumplida"),a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id=primer_acercamiento&record_id="+a(this).attr("data-record-id"),function(b){a("#primer_acercamiento_form").html(""),a("#primer_acercamiento_form").append(b),a("#modal_primer_acercamiento").fadeIn(300);var c=a("#modal_primer_acercamiento").find(".pa_id_creado_por").find("input").val();a.get("../managers/user_management/api_user.php?function=get_user_information&arg="+c,function(b){var c=b.firstname+" "+b.lastname;a("#modal_primer_acercamiento").find("h1").after('<hr style="border-color:#444;"><h3>Registrado por: <strong>'+c+"</strong></h3>");var d=a(".dphpforms-record .btn-dphpforms-univalle").length;2==d?a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-72+"px"}):3==d&&a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-72-30+"px"})})})}),a("#button_update_geographic_track").click(function(){a("div").removeClass("regla_incumplida"),a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id=seguimiento_geografico&record_id="+a(this).attr("data-record-id"),function(b){a("#seguimiento_geografico_form").html(""),a("#seguimiento_geografico_form").append(b),a("#modal_seguimiento_geografico").fadeIn(300),a(".seg_geo_vive_zona_riesgo").find("label").find("input").prop("checked")?a(".seg_geo_origen").find("input").prop("disabled",!1):(a(".seg_geo_origen").find("input").prop("disabled",!0),a(".seg_geo_origen").find("input").prop("checked",!1));var c=a(".dphpforms-record .btn-dphpforms-univalle").length;2==c&&a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-72+"px"}),3==c&&a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-72-30+"px"})})}),a(".btn.btn-danger.btn-univalle.btn-card").click(function(){var b=a(this).attr("data-container"),c=a("#"+b).height();if(0==c)a(this).find("span").removeClass("glyphicon-chevron-left"),a(this).find("span").addClass("glyphicon-chevron-down");else{for(;c<0;)c=a("#"+b).height();a(this).find("span").removeClass("glyphicon-chevron-down"),a(this).find("span").addClass("glyphicon-chevron-left")}}),a("#button_add_v2_track").on("click",function(){a("div").removeClass("regla_incumplida"),a("#modal_v2_peer_tracking").fadeIn(300),a(".id_estudiante").find("input").val(b());var d=a("#current_user_id").val();a(".id_creado_por").find("input").val(d),a(".id_instancia").find("input").val(c()),a(".dphpforms-response .btn-dphpforms-sendform").css({"margin-left":a(".dphpforms-response").width()/2-a(".dphpforms-response .btn-dphpforms-univalle").outerWidth()/2-a(".dphpforms-response .btn-dphpforms-close").outerWidth()/2+"px"})}),a(".btn-inasistencia").on("click",function(){var d=a(this).attr("data-info");if("inasistencia"==d){a("#modal_inasistencia").fadeOut(300),a("#modal_v2_peer_tracking").fadeIn(300),a(".id_estudiante").find("input").val(b());var e=a("#current_user_id").val();a(".id_creado_por").find("input").val(e),a(".id_instancia").find("input").val(c()),a(".dphpforms-response .btn-dphpforms-sendform").css({"margin-left":a(".dphpforms-response").width()/2-a(".dphpforms-response .btn-dphpforms-univalle").outerWidth()/2-a(".dphpforms-response .btn-dphpforms-close").outerWidth()/2+"px"})}else{a("#modal_v2_peer_tracking").fadeOut(300),a("#modal_inasistencia").fadeIn(300),a(".in_id_estudiante").find("input").val(b());var e=a("#current_user_id").val();a(".in_id_creado_por").find("input").val(e),a(".in_id_instancia").find("input").val(c())}}),a("#button_add_groupal_track").on("click",function(){a("div").removeClass("regla_incumplida"),a("#modal_v2_groupal_tracking").fadeIn(300);var b=a("#current_user_id").val();a(".id_creado_por").find("input").val(b),a(".id_estudiante").find("input").val("-"),a("#list_grupal_seg_consult  input[type=checkbox]").prop("checked",!1)}),a("#button_primer_acercamiento").on("click",function(){a("div").removeClass("regla_incumplida"),a("#modal_primer_acercamiento").fadeIn(300),a(".primer_acerca_id_estudiante_field").find("input").val(b());var c=a("#current_user_id").val();a(".primer_acerca_id_creado_por_field").find("input").val(c),a("#primer_acercamiento_form").find(".dphpforms-response .btn-dphpforms-sendform").css({"margin-left":a("#primer_acercamiento_form").find(".dphpforms-response").width()/2-a("#primer_acercamiento_form").find(".dphpforms-response .btn-dphpforms-univalle").outerWidth()/2-a("#primer_acercamiento_form").find(".btn-dphpforms-close").outerWidth()/2+"px"})}),a("#button_add_geographic_track").on("click",function(){a("div").removeClass("regla_incumplida"),a("#modal_seguimiento_geografico").fadeIn(300),a(".seg_geo_id_estudiante").find("input").val(b());var c=a("#current_user_id").val();a(".seg_geo_id_creado_por").find("input").val(c),a(".seg_geo_vive_zona_riesgo").find("label").find("input").prop("checked")?a(".seg_geo_origen").find("input").prop("disabled",!1):(a(".seg_geo_origen").find("input").prop("disabled",!0),a(".seg_geo_origen").find("input").prop("checked",!1)),a("#seguimiento_geografico_form").find(".dphpforms-response .btn-dphpforms-sendform").css({"margin-left":a("#seguimiento_geografico_form").find(".dphpforms-response").width()/2-a("#seguimiento_geografico_form").find(".dphpforms-response .btn-dphpforms-univalle").outerWidth()/2-a("#seguimiento_geografico_form").find(".btn-dphpforms-close").outerWidth()/2+"px"})}),a(".mymodal-close").click(function(){a(this).parent().parent().parent().parent().fadeOut(300),a("#list_grupal_seg_consult_1").remove()}),a(".dphpforms-peer-record").on("click",function(){var b=a(this).attr("data-record-id");i("seguimiento_pares",b),a("#modal_v2_edit_peer_tracking").fadeIn(300)}),a(".dphpforms-groupal-record").on("click",function(){var b=a(this).attr("data-record-id");i("seguimiento_grupal",b),a("#modal_v2_edit_groupal_tracking").fadeIn(300)}),a(".limpiar").click(function(){a(this).parent().find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").prop("checked",!1)})}),a(document).on("click",".limpiar",function(){a(this).parent().find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").prop("checked",!1)})}),a(document).on("submit",".dphpforms",function(c){c.preventDefault();var f=a(this).attr("id").indexOf("seguimiento_geografico_"),h=a(this).attr("id").indexOf("seguimiento_grupal_");f!=-1&&g("seguimiento_geografico_","insert"),h!=-1&&(a("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(""),g("seguimiento_grupal_","insert")),a(".seg_geo_origen").find("input").prop("disabled",!1),a(":disabled").prop("disabled",!1);var i=new FormData(this),j=a(this),k=j.attr("action");"procesador.php"==j.attr("action")&&(k="../managers/dphpforms/procesador.php"),a(j).find("button").prop("disabled",!0),a(j).find("a").attr("disabled",!0),console.log(j),a.ajax({type:"POST",url:k,data:i,cache:!1,contentType:!1,processData:!1,success:function(c){console.log(c);var f=JSON.parse(c);if(0==f.status){a.get("../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg="+b()+"&rid=-1",function(a){console.log(a)});var g="";"Stored"==f.message?g="Almacenado":"Updated"==f.message&&(g="Actualizado"),e(),d(),swal({title:"Información",text:g,type:"success"},function(){"Updated"==f.message?(a("#dphpforms-peer-record-"+a("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3),location.reload()):(a(".dphpforms-response").trigger("reset"),location.reload())}),a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300),a("#modal_primer_acercamiento").fadeOut(300),a("#modal_seguimiento_geografico").fadeOut(300),a(j).find("button").prop("disabled",!1),a(j).find("a").attr("disabled",!1)}else if(f.status==-2){a(j).find("button").prop("disabled",!1),a(j).find("a").attr("disabled",!1);var g="";if("Without changes"==f.message)g="No hay cambios que registrar",a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300),a("#modal_primer_acercamiento").fadeOut(300),a("#modal_seguimiento_geografico").fadeOut(300);else if("Unfulfilled rules"==f.message){var h=f.data.id_form_pregunta_a,i=f.data.id_form_pregunta_b;a("div").removeClass("regla_incumplida"),a(".div-"+h).addClass("regla_incumplida"),a(".div-"+i).addClass("regla_incumplida"),g="Ups, revise los campos que se acaban de colorear en rojo."}swal("Alerta",g,"warning")}else f.status==-1&&(console.log(c),swal("ERROR!","Oops!, informe de este error","error"))},error:function(b){console.log(b),swal("Error!","Oops!, informe de este error","error"),a(j).find("button").prop("disabled",!1),a(j).find("a").attr("disabled",!1)}})}),a(document).on("click",".btn-dphpforms-delete-record",function(){swal({title:"Confirmación",text:"Está eliminando este registro, ¿desea continuar?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, Eliminar!"},function(c){if(c){var d=a(".btn-dphpforms-delete-record").attr("data-record-id");a.get("../managers/dphpforms/dphpforms_delete_record.php?record_id="+d,function(c){var e=c;0==e.status?(console.log(e),a.get("../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg="+b()+"&rid="+d,function(a){console.log(a)}),setTimeout(function(){swal({title:"Información",text:"Eliminado",type:"success"},function(){location.reload()})},500)):e.status==-1&&setTimeout(function(){swal("Error!",e.message,"error")},500)})}})})}}});