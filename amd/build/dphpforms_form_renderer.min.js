define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2"],function(e,r,i,o,n){return{init:function(){function r(){for(var e=function(e){for(var r="",i=e.indexOf("?");i<e.length;i++)r+=e[i];return r.replace(/#[a-zA-z]+_[a-zA-z]+/i,"")}(window.location.href),r=e.indexOf("student_code=")+13,i="",o=r;o<e.length&&"-"!=r[o];o++)i+=e[o];return i}function i(r){var i=0;return e(r).find(".opcionesRadio").find("div").each(function(){e(this).find("label").find("input").is(":checked")&&(i=e(this).find("label").find("input").val())}),i}e(".btn.btn-danger.btn-univalle.btn-card").click(function(){var r=e(this).attr("data-container"),i=e("#"+r).height();if(0==i)e(this).find("span").removeClass("glyphicon-chevron-left"),e(this).find("span").addClass("glyphicon-chevron-down");else{for(;i<0;)i=e("#"+r).height();e(this).find("span").removeClass("glyphicon-chevron-down"),e(this).find("span").addClass("glyphicon-chevron-left")}}),e("#button_add_v2_track").on("click",function(){e("#modal_v2_peer_tracking").fadeIn(300),e(".id_estudiante").find("input").val(r());var i=e("#current_user_id").val();e(".id_creado_por").find("input").val(i)}),e(".mymodal-close").click(function(){e(this).parent().parent().parent().parent().fadeOut(300)}),e(".dphpforms-peer-record").on("click",function(){var r,i,o=e(this).attr("data-record-id");r="seguimiento_pares",i=o,e.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+r+"&record_id="+i,function(r){e("#body_editor").html(""),e("#body_editor").append(r),e("#permissions_informationr").html("");var i=e(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),o=e(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(i||o)&&e(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var n=JSON.parse(e("#permissions_information").text()),a=0;a<n.behaviors_permissions.length;a++){for(var t=n.behaviors_permissions[a].behaviors[0],s=t.behaviors_accessibility,d=0;d<s.length;d++){var c=s[d].disabled;"true"==c?c=!0:"false"==c&&(c=!1),e(".dphpforms-record").find("#"+s[d].id).prop("disabled",c),e(".dphpforms-record").find("."+s[d].class).prop("disabled",c)}for(var l=t.behaviors_fields_to_remove,d=0;d<l.length;d++)e(".dphpforms-record").find("#"+l[d].id).remove(),e(".dphpforms-record").find("."+l[d].class).remove();for(var p=t.limpiar_to_eliminate,d=0;d<p.length;d++)e(".dphpforms-record").find("."+p[d].class+".limpiar ").remove()}e("#permissions_informationr").html("")}),e("#modal_v2_edit_peer_tracking").fadeIn(300)}),e(".limpiar").click(function(){e(this).parent().find(".opcionesRadio").find("div").each(function(){e(this).find("label").find("input").prop("checked",!1)})}),e(document).on("click",".limpiar",function(){e(this).parent().find(".opcionesRadio").find("div").each(function(){e(this).find("label").find("input").prop("checked",!1)})}),e(document).on("submit",".dphpforms",function(o){o.preventDefault();var n=new FormData(this),a=e(this),t=a.attr("action");"procesador.php"==a.attr("action")&&(t="../managers/dphpforms/procesador.php"),e.ajax({type:"POST",url:t,data:n,cache:!1,contentType:!1,processData:!1,success:function(o){var n=JSON.parse(o);if(console.log(o),0==n.status){var a="";"Stored"==n.message?a="Almacenado":"Updated"==n.message&&(a="Actualizado"),function(o){var n=i(".puntuacion_riesgo_individual"),a=e(".comentarios_individual").find("textarea").val(),t=i(".puntuacion_riesgo_familiar"),s=e(".comentarios_familiar").find("textarea").val(),d=i(".puntuacion_riesgo_academico"),c=e(".comentarios_academico").find("textarea").val(),l=i(".puntuacion_riesgo_economico"),p=e(".comentarios_economico").find("textarea").val(),f=i(".puntuacion_vida_uni"),m=e(".comentarios_vida_uni").find("textarea").val();if("3"==n||"3"==t||"3"==d||"3"==l||"3"==f){console.log("flag");var u={function:"send_email_dphpforms",student_code:r(),risks:[{name:"Individual",risk_lvl:n,observation:a},{name:"Familiar",risk_lvl:t,observation:s},{name:"Académico",risk_lvl:d,observation:c},{name:"Económico",risk_lvl:l,observation:p},{name:"Vida Universitaria",risk_lvl:f,observation:m}],date:e(".fecha").find("input").val(),url:window.location.href};e.ajax({type:"POST",data:JSON.stringify(u),url:"../managers/pilos_tracking/send_risk.php",success:function(e){console.log(e)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}}(),swal({title:"Información",text:a,type:"success"},function(){"Updated"==n.message&&e("#dphpforms-peer-record-"+e("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3)}),e(".dphpforms-response").trigger("reset"),e("#modal_v2_edit_peer_tracking").fadeOut(300),e("#modal_v2_peer_tracking").fadeOut(300)}else if(-2==n.status){a="";"Without changes"==n.message?a="No hay cambios que registrar":"Unfulfilled rules"==n.message&&(a="Revise los valores ingresados"),swal("Alerta",a,"warning")}else-1==n.status&&(console.log(o),swal("ERROR!","Oops!, informe de este error","error"))},error:function(e){console.log(e),swal("Error!","Oops!, informe de este error","error")}})}),e(document).on("click",".btn-dphpforms-delete-record",function(){swal({title:"Confirmación",text:"Está eliminando este registro, ¿desea continuar?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, Eliminar!"},function(r){if(r){var i=e(".btn-dphpforms-delete-record").attr("data-record-id");e.get("../managers/dphpforms/dphpforms_delete_record.php?record_id="+i,function(r){var o=r;0==o.status?swal({title:"Información",text:"Eliminado",type:"success"},function(){e("#modal_v2_edit_peer_tracking").fadeOut(300),e("#dphpforms-peer-record-"+i).remove()}):-1==o.status&&swal("Error!",o.message,"error")})}})})}}});