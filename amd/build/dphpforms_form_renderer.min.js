define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2"],function(a,b,c,d,e){return{init:function(){function b(){var a=location.search.split("&");for(var b in a)if(a[b].indexOf("student_code")>=0){var c=a[b].split("=");return c[1].split("-")[0]}return 0}function c(c){var e=d(".puntuacion_riesgo_individual"),f=a(".comentarios_individual").find("textarea").val(),g=d(".puntuacion_riesgo_familiar"),h=a(".comentarios_familiar").find("textarea").val(),i=d(".puntuacion_riesgo_academico"),j=a(".comentarios_academico").find("textarea").val(),k=d(".puntuacion_riesgo_economico"),l=a(".comentarios_economico").find("textarea").val(),m=d(".puntuacion_vida_uni"),n=a(".comentarios_vida_uni").find("textarea").val();if("3"==e||"3"==g||"3"==i||"3"==k||"3"==m){var o={"function":"send_email_dphpforms",student_code:b(),risks:[{name:"Individual",risk_lvl:e,observation:f},{name:"Familiar",risk_lvl:g,observation:h},{name:"Académico",risk_lvl:i,observation:j},{name:"Económico",risk_lvl:k,observation:l},{name:"Vida Universitaria",risk_lvl:m,observation:n}],date:a(".fecha").find("input").val(),url:window.location.href};console.log(JSON.stringify(o)),a.ajax({type:"POST",data:JSON.stringify(o),url:"../managers/pilos_tracking/send_risk_email.php",success:function(a){console.log(a)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}}function d(b){var c=0;return a(b).find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").is(":checked")&&(c=a(this).find("label").find("input").val())}),c}function e(a){}function f(b,c){a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+b+"&record_id="+c,function(b){a("#body_editor").html(""),a("#body_editor").append(b),a("#permissions_informationr").html("");var c=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),d=a(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(c||d)&&a(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var f=JSON.parse(a("#permissions_information").text()),g=0;g<f.behaviors_permissions.length;g++){for(var h=f.behaviors_permissions[g].behaviors[0],i=h.behaviors_accessibility,j=0;j<i.length;j++){var k=i[j].disabled;"true"==k?k=!0:"false"==k&&(k=!1),a(".dphpforms-record").find("#"+i[j].id).prop("disabled",k),a(".dphpforms-record").find("."+i[j]["class"]).prop("disabled",k)}for(var l=h.behaviors_fields_to_remove,j=0;j<l.length;j++)a(".dphpforms-record").find("#"+l[j].id).remove(),a(".dphpforms-record").find("."+l[j]["class"]).remove();for(var m=h.limpiar_to_eliminate,j=0;j<m.length;j++)a(".dphpforms-record").find("."+m[j]["class"]+".limpiar ").remove()}a("#permissions_informationr").html("");var n=b.indexOf("primer_acercamiento_");n!=-1&&e("primer_acercamiento");var o=b.indexOf("seguimiento_de_pares_");o!=-1&&e("seguimiento_pares")})}a("#button_actualizar_primer_acercamiento").click(function(){a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id=primer_acercamiento&record_id="+a(this).attr("data-record-id"),function(b){a("#primer_acercamiento_form").html(""),a("#primer_acercamiento_form").append(b),a("#modal_primer_acercamiento").fadeIn(300);var c=a("#modal_primer_acercamiento").find(".pa_id_creado_por").find("input").val();a.get("../managers/user_management/api_user.php?function=get_user_information&arg="+c,function(b){var c=b.firstname+" "+b.lastname;a("#modal_primer_acercamiento").find("h1").after('<hr style="border-color:#444;"><h3>Registrado por: <strong>'+c+"</strong></h3>")})})}),a(".btn.btn-danger.btn-univalle.btn-card").click(function(){var b=a(this).attr("data-container"),c=a("#"+b).height();if(0==c)a(this).find("span").removeClass("glyphicon-chevron-left"),a(this).find("span").addClass("glyphicon-chevron-down");else{for(;c<0;)c=a("#"+b).height();a(this).find("span").removeClass("glyphicon-chevron-down"),a(this).find("span").addClass("glyphicon-chevron-left")}}),a("#button_add_v2_track").on("click",function(){a("#modal_v2_peer_tracking").fadeIn(300),a(".id_estudiante").find("input").val(b());var c=a("#current_user_id").val();a(".id_creado_por").find("input").val(c)}),a("#button_primer_acercamiento").on("click",function(){a("#modal_primer_acercamiento").fadeIn(300),a(".primer_acerca_id_estudiante_field").find("input").val(b());var c=a("#current_user_id").val();a(".primer_acerca_id_creado_por_field").find("input").val(c)}),a("#button_add_geographic_track").on("click",function(){a("#modal_seguimiento_geografico").fadeIn(300)}),a(".mymodal-close").click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),a(".dphpforms-peer-record").on("click",function(){var b=a(this).attr("data-record-id");f("seguimiento_pares",b),a("#modal_v2_edit_peer_tracking").fadeIn(300)}),a(".limpiar").click(function(){a(this).parent().find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").prop("checked",!1)})}),a(document).on("click",".limpiar",function(){a(this).parent().find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").prop("checked",!1)})}),a(document).on("submit",".dphpforms",function(d){d.preventDefault();var e=new FormData(this),f=a(this),g=f.attr("action");"procesador.php"==f.attr("action")&&(g="../managers/dphpforms/procesador.php"),a(f).find("button").prop("disabled",!0),a(f).find("a").attr("disabled",!0),a.ajax({type:"POST",url:g,data:e,cache:!1,contentType:!1,processData:!1,success:function(d){var e=JSON.parse(d);if(console.log(d),0==e.status){var g="";"Stored"==e.message?g="Almacenado":"Updated"==e.message&&(g="Actualizado"),c(),swal({title:"Información",text:g,type:"success"},function(){"Updated"==e.message?a("#dphpforms-peer-record-"+a("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3):(a(".dphpforms-response").trigger("reset"),location.reload())}),a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300),a("#modal_primer_acercamiento").fadeOut(300),a("#modal_seguimiento_geografico").fadeOut(300),a(f).find("button").prop("disabled",!1),a(f).find("a").attr("disabled",!1),a.get("../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg="+b(),function(a){console.log(a)})}else if(e.status==-2){a(f).find("button").prop("disabled",!1),a(f).find("a").attr("disabled",!1);var g="";"Without changes"==e.message?g="No hay cambios que registrar":"Unfulfilled rules"==e.message&&(g="Revise los valores ingresados"),swal("Alerta",g,"warning")}else e.status==-1&&(console.log(d),swal("ERROR!","Oops!, informe de este error","error"))},error:function(b){console.log(b),swal("Error!","Oops!, informe de este error","error"),a(f).find("button").prop("disabled",!1),a(f).find("a").attr("disabled",!1)}})}),a(document).on("click",".btn-dphpforms-delete-record",function(){swal({title:"Confirmación",text:"Está eliminando este registro, ¿desea continuar?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, Eliminar!"},function(b){if(b){var c=a(".btn-dphpforms-delete-record").attr("data-record-id");a.get("../managers/dphpforms/dphpforms_delete_record.php?record_id="+c,function(b){var c=b;0==c.status?swal({title:"Información",text:"Eliminado",type:"success"},function(){a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_primer_acercamiento").fadeOut(300),location.reload()}):c.status==-1&&swal("Error!",c.message,"error")})}})})}}});