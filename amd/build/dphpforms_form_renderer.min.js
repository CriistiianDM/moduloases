define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2"],function(e,i,n,o,r){return{init:function(){function i(){var e=location.search.split("&");for(var i in e){if(e[i].indexOf("student_code")>=0)return e[i].split("=")[1].split("-")[0]}return 0}function n(i){var n=0;return e(i).find(".opcionesRadio").find("div").each(function(){e(this).find("label").find("input").is(":checked")&&(n=e(this).find("label").find("input").val())}),n}function o(i){if("primer_acercamiento"==i);else if("seguimiento_pares"==i);else if("seguimiento_geografico_"==i)e(".seg_geo_origen").find("input").prop("disabled",!1);else if("seguimiento_grupal_"==i){var n=e("input:checked").length,o="";e("#modal_v2_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(""),e("input:checked").each(function(i){var r=e(this).parent().parent().find(">:first-child").text().split("-");o+=i===n-1?r[0]:r[0]+","}),e("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(o),e("#modal_v2_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(o)}}function r(i,n){e.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+i+"&record_id="+n,function(i){e("#body_editor").html(""),e("#body_editor").append(i);var n=e("#list_grupal_seg_consult").clone().prop("id","list_grupal_seg_consult_1");e("#modal_v2_edit_groupal_tracking").find("form").find("h1").after(n),e("#list_grupal_seg_consult_1 > #list_students_attendance").prop("id","list_students_attendance_1"),e("#list_grupal_seg_consult_1  input[type=checkbox]").prop("checked",!1);var r=e("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input");null!=r.val()&&function(i){students_code=i.split(",");var n=[];e("#list_students_attendance_1 > tbody  > tr").each(function(i){var o=e(this).children("td").first().html().split("-");n.push(o[0])}),e.each(students_code,function(i,o){var r=n.indexOf(o);if(-1!=r){var a=e("#list_students_attendance_1 tbody>tr:eq('"+r+"')").find("td").eq(3).children("input");e("#list_grupal_seg_consult_1 input[type=checkbox][value='"+a.val()+"']").prop("checked",!0)}})}(r.val()),e("#permissions_informationr").html("");var a=e(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),t=e(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(a||t)&&e(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var d=JSON.parse(e("#permissions_information").text()),s=0;s<d.behaviors_permissions.length;s++){for(var c=d.behaviors_permissions[s].behaviors[0],p=c.behaviors_accessibility,_=0;_<p.length;_++){var l=p[_].disabled;"true"==l?l=!0:"false"==l&&(l=!1),e(".dphpforms-record").find("#"+p[_].id).prop("disabled",l),e(".dphpforms-record").find("."+p[_].class).prop("disabled",l)}var f=c.behaviors_fields_to_remove;for(_=0;_<f.length;_++)e(".dphpforms-record").find("#"+f[_].id).remove(),e(".dphpforms-record").find("."+f[_].class).remove();var u=c.limpiar_to_eliminate;for(_=0;_<u.length;_++)e(".dphpforms-record").find("."+u[_].class+".limpiar ").remove()}e("#permissions_informationr").html(""),-1!=i.indexOf("primer_acercamiento_")&&o("primer_acercamiento"),-1!=i.indexOf("seguimiento_de_pares_")&&o("seguimiento_pares")})}e(".outside").click(function(){var i=e(this);swal({title:"Confirmación de salida",text:"",type:"warning",showCancelButton:!0,confirmButtonText:"Salir"},function(n){n&&(e(i).parent(".mymodal").fadeOut(300),console.log(e(this).parent(".mymodal")))})}),e(document).ready(function(){e(".seg_geo_origen").find("input").prop("disabled",!0)}),e(document).on("change",e(".seg_geo_vive_zona_riesgo").find("label").find("input"),function(){e(".seg_geo_vive_zona_riesgo").find("label").find("input").prop("checked")?e(".seg_geo_origen").find("input").prop("disabled",!1):(e(".seg_geo_origen").find("input").prop("disabled",!0),e(".seg_geo_origen").find("input").prop("checked",!1))}),e(".seg_geo_vive_zona_riesgo").find("label").find("input").change(function(){e(".seg_geo_vive_zona_riesgo").find("label").find("input").prop("checked")?e(".seg_geo_origen").find("input").prop("disabled",!1):(e(".seg_geo_origen").find("input").prop("disabled",!0),e(".seg_geo_origen").find("input").prop("checked",!1))}),e("#button_actualizar_primer_acercamiento").click(function(){e.get("../managers/dphpforms/dphpforms_forms_core.php?form_id=primer_acercamiento&record_id="+e(this).attr("data-record-id"),function(i){e("#primer_acercamiento_form").html(""),e("#primer_acercamiento_form").append(i),e("#modal_primer_acercamiento").fadeIn(300);var n=e("#modal_primer_acercamiento").find(".pa_id_creado_por").find("input").val();e.get("../managers/user_management/api_user.php?function=get_user_information&arg="+n,function(i){var n=i.firstname+" "+i.lastname;e("#modal_primer_acercamiento").find("h1").after('<hr style="border-color:#444;"><h3>Registrado por: <strong>'+n+"</strong></h3>")})})}),e("#button_update_geographic_track").click(function(){e.get("../managers/dphpforms/dphpforms_forms_core.php?form_id=seguimiento_geografico&record_id="+e(this).attr("data-record-id"),function(i){e("#seguimiento_geografico_form").html(""),e("#seguimiento_geografico_form").append(i),e("#modal_seguimiento_geografico").fadeIn(300),e(".seg_geo_vive_zona_riesgo").find("label").find("input").prop("checked")?e(".seg_geo_origen").find("input").prop("disabled",!1):(e(".seg_geo_origen").find("input").prop("disabled",!0),e(".seg_geo_origen").find("input").prop("checked",!1))})}),e(".btn.btn-danger.btn-univalle.btn-card").click(function(){var i=e(this).attr("data-container"),n=e("#"+i).height();if(0==n)e(this).find("span").removeClass("glyphicon-chevron-left"),e(this).find("span").addClass("glyphicon-chevron-down");else{for(;n<0;)n=e("#"+i).height();e(this).find("span").removeClass("glyphicon-chevron-down"),e(this).find("span").addClass("glyphicon-chevron-left")}}),e("#button_add_v2_track").on("click",function(){e("#modal_v2_peer_tracking").fadeIn(300),e(".id_estudiante").find("input").val(i());var n=e("#current_user_id").val();e(".id_creado_por").find("input").val(n)}),e("#button_add_groupal_track").on("click",function(){e("#modal_v2_groupal_tracking").fadeIn(300);var i=e("#current_user_id").val();e(".id_creado_por").find("input").val(i),e(".id_estudiante").find("input").val("-"),e("#list_grupal_seg_consult  input[type=checkbox]").prop("checked",!1)}),e("#button_primer_acercamiento").on("click",function(){e("#modal_primer_acercamiento").fadeIn(300),e(".primer_acerca_id_estudiante_field").find("input").val(i());var n=e("#current_user_id").val();e(".primer_acerca_id_creado_por_field").find("input").val(n)}),e("#button_add_geographic_track").on("click",function(){e("#modal_seguimiento_geografico").fadeIn(300),e(".seg_geo_id_estudiante").find("input").val(i());var n=e("#current_user_id").val();e(".seg_geo_id_creado_por").find("input").val(n),e(".seg_geo_vive_zona_riesgo").find("label").find("input").prop("checked")?e(".seg_geo_origen").find("input").prop("disabled",!1):(e(".seg_geo_origen").find("input").prop("disabled",!0),e(".seg_geo_origen").find("input").prop("checked",!1))}),e(".mymodal-close").click(function(){e(this).parent().parent().parent().parent().fadeOut(300),e("#list_grupal_seg_consult_1").remove()}),e(".dphpforms-peer-record").on("click",function(){r("seguimiento_pares",e(this).attr("data-record-id")),e("#modal_v2_edit_peer_tracking").fadeIn(300)}),e(".dphpforms-groupal-record").on("click",function(){r("seguimiento_grupal",e(this).attr("data-record-id")),e("#modal_v2_edit_groupal_tracking").fadeIn(300)}),e(".limpiar").click(function(){e(this).parent().find(".opcionesRadio").find("div").each(function(){e(this).find("label").find("input").prop("checked",!1)})}),e(document).on("click",".limpiar",function(){e(this).parent().find(".opcionesRadio").find("div").each(function(){e(this).find("label").find("input").prop("checked",!1)})}),e(document).on("submit",".dphpforms",function(r){r.preventDefault();var a=e(this).attr("id").indexOf("seguimiento_geografico_"),t=e(this).attr("id").indexOf("seguimiento_grupal_");-1!=a&&o("seguimiento_geografico_"),-1!=t&&(e("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val(""),o("seguimiento_grupal_")),e(".seg_geo_origen").find("input").prop("disabled",!1);var d=new FormData(this),s=e(this),c=s.attr("action");"procesador.php"==s.attr("action")&&(c="../managers/dphpforms/procesador.php"),e(s).find("button").prop("disabled",!0),e(s).find("a").attr("disabled",!0),e.ajax({type:"POST",url:c,data:d,cache:!1,contentType:!1,processData:!1,success:function(o){console.log(o);var r=JSON.parse(o);if(0==r.status){var a="";"Stored"==r.message?a="Almacenado":"Updated"==r.message&&(a="Actualizado"),function(o){var r=n(".puntuacion_riesgo_individual"),a=e(".comentarios_individual").find("textarea").val(),t=n(".puntuacion_riesgo_familiar"),d=e(".comentarios_familiar").find("textarea").val(),s=n(".puntuacion_riesgo_academico"),c=e(".comentarios_academico").find("textarea").val(),p=n(".puntuacion_riesgo_economico"),_=e(".comentarios_economico").find("textarea").val(),l=n(".puntuacion_vida_uni"),f=e(".comentarios_vida_uni").find("textarea").val();if("3"==r||"3"==t||"3"==s||"3"==p||"3"==l){var u={function:"send_email_dphpforms",student_code:i(),risks:[{name:"Individual",risk_lvl:r,observation:a},{name:"Familiar",risk_lvl:t,observation:d},{name:"Académico",risk_lvl:s,observation:c},{name:"Económico",risk_lvl:p,observation:_},{name:"Vida Universitaria",risk_lvl:l,observation:f}],date:e(".fecha").find("input").val(),url:window.location.href};console.log(JSON.stringify(u)),e.ajax({type:"POST",data:JSON.stringify(u),url:"../managers/pilos_tracking/send_risk_email.php",success:function(e){console.log(e)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}}(),function(o){var r=n(".seg_geo_nivel_riesgo"),a=e(".seg_geo_observaciones").find("textarea").val();if("3"==r){var t={function:"send_email_dphpforms",student_code:i(),risks:[{name:"Geográfico",risk_lvl:r,observation:a}],date:e(".fecha").find("input").val(),url:window.location.href};console.log(JSON.stringify(t)),e.ajax({type:"POST",data:JSON.stringify(t),url:"../managers/pilos_tracking/send_risk_email.php",success:function(e){console.log(e)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}}(),swal({title:"Información",text:a,type:"success"},function(){"Updated"==r.message?e("#dphpforms-peer-record-"+e("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3):(e(".dphpforms-response").trigger("reset"),location.reload())}),e("#modal_v2_edit_peer_tracking").fadeOut(300),e("#modal_v2_peer_tracking").fadeOut(300),e("#modal_primer_acercamiento").fadeOut(300),e("#modal_seguimiento_geografico").fadeOut(300),e.get("../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg="+i(),function(e){console.log(e)}),e(s).find("button").prop("disabled",!1),e(s).find("a").attr("disabled",!1)}else if(-2==r.status){e(s).find("button").prop("disabled",!1),e(s).find("a").attr("disabled",!1);a="";"Without changes"==r.message?a="No hay cambios que registrar":"Unfulfilled rules"==r.message&&(a="Revise los valores ingresados"),swal("Alerta",a,"warning")}else-1==r.status&&(console.log(o),swal("ERROR!","Oops!, informe de este error","error"))},error:function(i){console.log(i),swal("Error!","Oops!, informe de este error","error"),e(s).find("button").prop("disabled",!1),e(s).find("a").attr("disabled",!1)}})}),e(document).on("click",".btn-dphpforms-delete-record",function(){swal({title:"Confirmación",text:"Está eliminando este registro, ¿desea continuar?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, Eliminar!"},function(i){if(i){var n=e(".btn-dphpforms-delete-record").attr("data-record-id");e.get("../managers/dphpforms/dphpforms_delete_record.php?record_id="+n,function(i){var n=i;console.log(i),0==n.status?swal({title:"Información",text:"Eliminado",type:"success"},function(){e("#modal_v2_edit_peer_tracking").fadeOut(300),e("#modal_primer_acercamiento").fadeOut(300),location.reload()}):-1==n.status&&swal("Error!",n.message,"error")})}})})}}});