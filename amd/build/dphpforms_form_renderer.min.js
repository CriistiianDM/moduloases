define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2"],function(a,b,c,d,e){return{init:function(){function b(){var a=location.search.split("&");for(var b in a)if(a[b].indexOf("student_code")>=0){var c=a[b].split("=");return c[1].split("-")[0]}return 0}function c(c){var e=d(".puntuacion_riesgo_individual"),f=a(".comentarios_individual").find("textarea").val(),g=d(".puntuacion_riesgo_familiar"),h=a(".comentarios_familiar").find("textarea").val(),i=d(".puntuacion_riesgo_academico"),j=a(".comentarios_academico").find("textarea").val(),k=d(".puntuacion_riesgo_economico"),l=a(".comentarios_economico").find("textarea").val(),m=d(".puntuacion_vida_uni"),n=a(".comentarios_vida_uni").find("textarea").val();if("3"==e||"3"==g||"3"==i||"3"==k||"3"==m){var o={"function":"send_email_dphpforms",student_code:b(),risks:[{name:"Individual",risk_lvl:e,observation:f},{name:"Familiar",risk_lvl:g,observation:h},{name:"Académico",risk_lvl:i,observation:j},{name:"Económico",risk_lvl:k,observation:l},{name:"Vida Universitaria",risk_lvl:m,observation:n}],date:a(".fecha").find("input").val(),url:window.location.href};a.ajax({type:"POST",data:JSON.stringify(o),url:"../managers/pilos_tracking/send_risk_email.php",success:function(a){console.log(a)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}}function d(b){var c=0;return a(b).find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").is(":checked")&&(c=a(this).find("label").find("input").val())}),c}function e(b,c){a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+b+"&record_id="+c,function(b){a("#body_editor").html(""),a("#body_editor").append(b),a("#permissions_informationr").html("");var c=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),d=a(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(c||d)&&a(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var e=JSON.parse(a("#permissions_information").text()),f=0;f<e.behaviors_permissions.length;f++){for(var g=e.behaviors_permissions[f].behaviors[0],h=g.behaviors_accessibility,i=0;i<h.length;i++){var j=h[i].disabled;"true"==j?j=!0:"false"==j&&(j=!1),a(".dphpforms-record").find("#"+h[i].id).prop("disabled",j),a(".dphpforms-record").find("."+h[i]["class"]).prop("disabled",j)}for(var k=g.behaviors_fields_to_remove,i=0;i<k.length;i++)a(".dphpforms-record").find("#"+k[i].id).remove(),a(".dphpforms-record").find("."+k[i]["class"]).remove();for(var l=g.limpiar_to_eliminate,i=0;i<l.length;i++)a(".dphpforms-record").find("."+l[i]["class"]+".limpiar ").remove()}a("#permissions_informationr").html("")})}a(".btn.btn-danger.btn-univalle.btn-card").click(function(){var b=a(this).attr("data-container"),c=a("#"+b).height();if(0==c)a(this).find("span").removeClass("glyphicon-chevron-left"),a(this).find("span").addClass("glyphicon-chevron-down");else{for(;c<0;)c=a("#"+b).height();a(this).find("span").removeClass("glyphicon-chevron-down"),a(this).find("span").addClass("glyphicon-chevron-left")}}),a("#button_add_v2_track").on("click",function(){a("#modal_v2_peer_tracking").fadeIn(300),a(".id_estudiante").find("input").val(b());var c=a("#current_user_id").val();a(".id_creado_por").find("input").val(c)}),a(".mymodal-close").click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),a(".dphpforms-peer-record").on("click",function(){var b=a(this).attr("data-record-id");e("seguimiento_pares",b),a("#modal_v2_edit_peer_tracking").fadeIn(300)}),a(".limpiar").click(function(){a(this).parent().find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").prop("checked",!1)})}),a(document).on("click",".limpiar",function(){a(this).parent().find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").prop("checked",!1)})}),a(document).on("submit",".dphpforms",function(b){b.preventDefault();var d=new FormData(this),e=a(this),f=e.attr("action");"procesador.php"==e.attr("action")&&(f="../managers/dphpforms/procesador.php"),a.ajax({type:"POST",url:f,data:d,cache:!1,contentType:!1,processData:!1,success:function(b){var d=JSON.parse(b);if(console.log(b),0==d.status){var e="";"Stored"==d.message?e="Almacenado":"Updated"==d.message&&(e="Actualizado"),c(),swal({title:"Información",text:e,type:"success"},function(){"Updated"==d.message&&a("#dphpforms-peer-record-"+a("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3)}),a(".dphpforms-response").trigger("reset"),a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300)}else if(d.status==-2){var e="";"Without changes"==d.message?e="No hay cambios que registrar":"Unfulfilled rules"==d.message&&(e="Revise los valores ingresados"),swal("Alerta",e,"warning")}else d.status==-1&&(console.log(b),swal("ERROR!","Oops!, informe de este error","error"))},error:function(a){console.log(a),swal("Error!","Oops!, informe de este error","error")}})}),a(document).on("click",".btn-dphpforms-delete-record",function(){swal({title:"Confirmación",text:"Está eliminando este registro, ¿desea continuar?",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, Eliminar!"},function(b){if(b){var c=a(".btn-dphpforms-delete-record").attr("data-record-id");a.get("../managers/dphpforms/dphpforms_delete_record.php?record_id="+c,function(b){var d=b;0==d.status?swal({title:"Información",text:"Eliminado",type:"success"},function(){a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#dphpforms-peer-record-"+c).remove()}):d.status==-1&&swal("Error!",d.message,"error")})}})})}}});