'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2','block_ases/loading_indicator'],function(b,c,d,e,f,g){return{init:function init(){function j(){return b('#dphpforms_ases_student_code').attr('data-info')}function k(){return b('#dphpforms_block_instance').attr('data-info')}function l(){var s=n('.seg_geo_nivel_riesgo'),t=b('.seg_geo_observaciones').find('textarea').val();if('3'==s){var u={'function':'send_email_dphpforms',student_code:j(),risks:[{name:'Geogr\xE1fico',risk_lvl:s,observation:t}],date:b('.fecha').find('input').val(),url:window.location.href};console.log(JSON.stringify(u)),b.ajax({type:'POST',data:JSON.stringify(u),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(v){console.log(v)},dataType:'text',cache:'false',error:function error(v){console.log(v)}})}}function m(){var s=n('.puntuacion_riesgo_individual'),t=b('.comentarios_individual').find('textarea').val();var u=n('.puntuacion_riesgo_familiar'),v=b('.comentarios_familiar').find('textarea').val(),w=n('.puntuacion_riesgo_academico'),y=b('.comentarios_academico').find('textarea').val(),A=n('.puntuacion_riesgo_economico'),B=b('.comentarios_economico').find('textarea').val(),C=n('.puntuacion_vida_uni'),D=b('.comentarios_vida_uni').find('textarea').val();if('3'==s||'3'==u||'3'==w||'3'==A||'3'==C){var E={'function':'send_email_dphpforms',student_code:j(),risks:[{name:'Individual',risk_lvl:s,observation:t},{name:'Familiar',risk_lvl:u,observation:v},{name:'Acad\xE9mico',risk_lvl:w,observation:y},{name:'Econ\xF3mico',risk_lvl:A,observation:B},{name:'Vida Universitaria',risk_lvl:C,observation:D}],date:b('.fecha').find('input').val(),url:window.location.href};console.log(JSON.stringify(E)),b.ajax({type:'POST',data:JSON.stringify(E),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(F){console.log(F)},dataType:'text',cache:'false',error:function error(F){console.log(F)}})}}function n(r){var s=0;return b(r).find('.opcionesRadio').find('div').each(function(){b(this).find('label').find('input').is(':checked')&&(s=b(this).find('label').find('input').val())}),s}function o(r,s){if('primer_acercamiento'==r&&'insert'==s);else if('primer_acercamiento'==r&&'update'==s);else if('inasistencia'==r&&'insert'==s);else if('inasistencia'==r&&'update'==s){var t=b('.dphpforms-record').find('.in_revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),u=b('.dphpforms-record').find('.in_revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked'),v=b('#dphpforms_role_support').attr('data-info');t&&'sistemas'!=v&&(b('.btn-dphpforms-delete-record').remove(),b('.btn-dphpforms-update').remove()),'dir_socioeducativo'==v&&(b('.btn-dphpforms-delete-record').remove(),b('.btn-dphpforms-update').remove())}else if('seguimiento_pares'==r&&'insert'==s);else if('seguimiento_pares'==r&&'update'==s){var t=b('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),u=b('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked'),v=b('#dphpforms_role_support').attr('data-info');t&&'sistemas'!=v&&(b('.btn-dphpforms-delete-record').remove(),b('.btn-dphpforms-update').remove()),'dir_socioeducativo'==v&&(b('.btn-dphpforms-delete-record').remove(),b('.btn-dphpforms-update').remove())}else if('seguimiento_geografico_'==r&&'insert'==s)b('.seg_geo_origen').find('input').prop('disabled',!1);else if('seguimiento_geografico_'==r&&'update'==s);else if('seguimiento_grupal_'==r&&'insert'==s){var w=b('modal_v2_edit_groupal_tracking').find('input:checked').length,y='',A='';b('#modal_v2_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),b('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),b('#modal_v2_edit_groupal_tracking').find('input:checked').each(function(){var C=b(this).parent().parent().find('>:first-child').text(),D=C.split('-');y+=D[0]+','}),b('#modal_v2_groupal_tracking').find('input:checked').each(function(){var C=b(this).parent().parent().find('>:first-child').text(),D=C.split('-');A+=D[0]+','}),b('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(y.slice(0,-1)),b('#modal_v2_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(A.slice(0,-1))}else if('seguimiento_grupal_'==r&&'update'==s);}function p(r){students_code=r.split(','),console.log('.id_estudiante :'+students_code);var s=[];b('#list_students_attendance_1 > tbody  > tr').each(function(){var u=b(this).children('td').first().html().split('-');s.push(u[0])}),console.log('lista total de id_estudiantes :'+s),console.log('lista de estudiantes seleccin : '+students_code),b.each(students_code,function(t,u){var v=s.indexOf(u);if(-1!=v){var w=b('#list_students_attendance_1 tbody>tr:eq(\''+v+'\')'),y=w.find('td').eq(3).children('input');b('input[type=checkbox][value=\''+y.val()+'\']').prop('checked',!0)}})}function q(r,s){b('.div').removeClass('regla_incumplida'),b('#body_editor').html(''),g.show(),b.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=&record_id='+s,function(t){g.hide(),b('#body_editor').append(t);var u=b('#list_grupal_seg_consult').clone().prop('id','list_grupal_seg_consult_1');b('#modal_v2_edit_groupal_tracking').find('form').find('h1').after(u),b('#list_grupal_seg_consult_1 > #list_students_attendance').prop('id','list_students_attendance_1'),b('#list_grupal_seg_consult_1  input[type=checkbox]').prop('checked',!1);var v=b('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input');v.val()!=void 0&&p(v.val()),b('#permissions_informationr').html('');var w=b('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),y=b('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');(w||y)&&b('.dphpforms-record').find('.btn-dphpforms-delete-record').remove();for(var A=JSON.parse(b('#permissions_information').text()),B=0;B<A.behaviors_permissions.length;B++){for(var F,C=A.behaviors_permissions[B].behaviors[0],D=C.behaviors_accessibility,E=0;E<D.length;E++)F=D[E].disabled,'true'==F?F=!0:'false'==F&&(F=!1),b('.dphpforms-record').find('#'+D[E].id).prop('disabled',F),b('.dphpforms-record').find('.'+D[E]['class']).prop('disabled',F);for(var G=C.behaviors_fields_to_remove,E=0;E<G.length;E++)b('.dphpforms-record').find('#'+G[E].id).remove(),b('.dphpforms-record').find('.'+G[E]['class']).remove();for(var H=C.limpiar_to_eliminate,E=0;E<H.length;E++)b('.dphpforms-record').find('.'+H[E]['class']+'.limpiar ').remove()}b('#permissions_informationr').html('');var I=t.indexOf('primer_acercamiento_');-1!=I&&o('primer_acercamiento','update');var J=t.indexOf('seguimiento_de_pares_');-1!=J&&o('seguimiento_pares','update');var K=t.indexOf('inasistencia');-1!=K&&o('inasistencia','update')})}b(document).on('click','.btn-dphpforms-close',function(){b(this).closest('div[class="mymodal"]').fadeOut(300)}),b('.outside').click(function(){var r=b(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(s){s&&(b(r).parent('.mymodal').fadeOut(300),console.log(b(this).parent('.mymodal')))})}),b(document).ready(function(){b('.seg_geo_origen').find('input').prop('disabled',!0)}),b(document).on('change',b('.seg_geo_vive_zona_riesgo').find('label').find('input'),function(){b('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?b('.seg_geo_origen').find('input').prop('disabled',!1):(b('.seg_geo_origen').find('input').prop('disabled',!0),b('.seg_geo_origen').find('input').prop('checked',!1))}),b('.seg_geo_vive_zona_riesgo').find('label').find('input').change(function(){b('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?b('.seg_geo_origen').find('input').prop('disabled',!1):(b('.seg_geo_origen').find('input').prop('disabled',!0),b('.seg_geo_origen').find('input').prop('checked',!1))}),b('#button_actualizar_primer_acercamiento').click(function(){b('div').removeClass('regla_incumplida'),b.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=primer_acercamiento&record_id='+b(this).attr('data-record-id'),function(r){b('#primer_acercamiento_form').html(''),b('#primer_acercamiento_form').append(r),b('#modal_primer_acercamiento').fadeIn(300);var s=b('#modal_primer_acercamiento').find('.pa_id_creado_por').find('input').val();b.get('../managers/user_management/api_user.php?function=get_user_information&arg='+s,function(t){var u=t.firstname+' '+t.lastname;b('#modal_primer_acercamiento').find('h1').after('<hr style="border-color:#444;"><h3>Registrado por: <strong>'+u+'</strong></h3>');var v=b('.dphpforms-record .btn-dphpforms-univalle').length;2==v?b('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':b('.dphpforms-updater').width()/2-72+'px'}):3==v&&b('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':b('.dphpforms-updater').width()/2-72-30+'px'})})})}),b('#button_update_geographic_track').click(function(){b('div').removeClass('regla_incumplida'),b.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=seguimiento_geografico&record_id='+b(this).attr('data-record-id'),function(r){b('#seguimiento_geografico_form').html(''),b('#seguimiento_geografico_form').append(r),b('#modal_seguimiento_geografico').fadeIn(300),b('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?b('.seg_geo_origen').find('input').prop('disabled',!1):(b('.seg_geo_origen').find('input').prop('disabled',!0),b('.seg_geo_origen').find('input').prop('checked',!1));var s=b('.dphpforms-record .btn-dphpforms-univalle').length;2==s&&b('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':b('.dphpforms-updater').width()/2-72+'px'}),3==s&&b('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':b('.dphpforms-updater').width()/2-72-30+'px'})})});b(document).on('click','.btn.btn-danger.btn-univalle.btn-card',function(){var r=b(this).attr('data-container'),s=b('#'+r).height();if(0==s)b(this).find('span').not('.protected').removeClass('glyphicon-chevron-left'),b(this).find('span').not('.protected').addClass('glyphicon-chevron-down'),b(this).find('.open-close-icon').removeClass('glyphicon-chevron-left'),b(this).find('.open-close-icon').addClass('glyphicon-chevron-down');else{for(;0>s;)s=b('#'+r).height();b(this).find('span').not('.protected').removeClass('glyphicon-chevron-down'),b(this).find('span').not('.protected').addClass('glyphicon-chevron-left'),b(this).find('.open-close-icon').removeClass('glyphicon-chevron-down'),b(this).find('.open-close-icon').addClass('glyphicon-chevron-left')}}),b('#button_add_v2_track').on('click',function(){b('div').removeClass('regla_incumplida'),b('#modal_v2_peer_tracking').fadeIn(300),b('.id_estudiante').find('input').val(j());var r=b('#current_user_id').val();b('.id_creado_por').find('input').val(r),b('.id_instancia').find('input').val(k()),b('.id_monitor').find('input').val(b('#dphpforms_monitor_id').data('info')),b('.id_practicante').find('input').val(b('#dphpforms_practicing_id').data('info')),b('.id_profesional').find('input').val(b('#dphpforms_professional_id').data('info')),b('.username').find('input').val(b('#dphpforms_username').data('info'))}),b('.btn-inasistencia').on('click',function(){var r=b(this).attr('data-info');if('inasistencia'==r){b('#modal_inasistencia').fadeOut(300),b('#modal_v2_peer_tracking').fadeIn(300),b('.id_estudiante').find('input').val(j());var s=b('#current_user_id').val();b('.id_creado_por').find('input').val(s),b('.id_instancia').find('input').val(k()),b('.id_monitor').find('input').val(b('#dphpforms_monitor_id').data('info')),b('.id_practicante').find('input').val(b('#dphpforms_practicing_id').data('info')),b('.id_profesional').find('input').val(b('#dphpforms_professional_id').data('info')),b('.username').find('input').val(b('#dphpforms_username').data('info'))}else{b('#modal_v2_peer_tracking').fadeOut(300),b('#modal_inasistencia').fadeIn(300),b('.in_id_estudiante').find('input').val(j());var s=b('#current_user_id').val();b('.in_id_creado_por').find('input').val(s),b('.in_id_instancia').find('input').val(k()),b('.in_id_monitor').find('input').val(b('#dphpforms_monitor_id').data('info')),b('.in_id_practicante').find('input').val(b('#dphpforms_practicing_id').data('info')),b('.in_id_profesional').find('input').val(b('#dphpforms_professional_id').data('info')),b('.in_username').find('input').val(b('#dphpforms_username').data('info'))}}),b('#button_add_groupal_track').on('click',function(){b('div').removeClass('regla_incumplida'),b('#modal_v2_groupal_tracking').fadeIn(300);var r=b('#current_user_id').val();b('.id_creado_por').find('input').val(r),b('.id_estudiante').find('input').val('-'),b('#list_grupal_seg_consult  input[type=checkbox]').prop('checked',!1)}),b('#button_primer_acercamiento').on('click',function(){b('div').removeClass('regla_incumplida'),b('#modal_primer_acercamiento').fadeIn(300),b('.primer_acerca_id_estudiante_field').find('input').val(j());var r=b('#current_user_id').val();b('.primer_acerca_id_creado_por_field').find('input').val(r)}),b('#button_add_geographic_track').on('click',function(){b('div').removeClass('regla_incumplida'),b('#modal_seguimiento_geografico').fadeIn(300),b('.seg_geo_id_estudiante').find('input').val(j());var r=b('#current_user_id').val();b('.seg_geo_id_creado_por').find('input').val(r),b('.seg_geo_vive_zona_riesgo').find('label').find('input').prop('checked')?b('.seg_geo_origen').find('input').prop('disabled',!1):(b('.seg_geo_origen').find('input').prop('disabled',!0),b('.seg_geo_origen').find('input').prop('checked',!1))}),b('.mymodal-close').click(function(){b(this).parent().parent().parent().parent().fadeOut(300),b('#list_grupal_seg_consult_1').remove()}),b('.dphpforms-peer-record').on('click',function(){var r=b(this).attr('data-record-id');q('seguimiento_pares',r),b('#modal_v2_edit_peer_tracking').fadeIn(300)}),b('.dphpforms-groupal-record').on('click',function(){var r=b(this).attr('data-record-id');q('seguimiento_grupal',r),b('#modal_v2_edit_groupal_tracking').fadeIn(300)}),b('.limpiar').click(function(){b(this).parent().find('.opcionesRadio').find('div').each(function(){b(this).find('label').find('input').prop('checked',!1)})}),b(document).on('click','.limpiar',function(){b(this).parent().find('.opcionesRadio').find('div').each(function(){b(this).find('label').find('input').prop('checked',!1)})}),b(document).on('submit','.dphpforms',function(r){r.preventDefault();var s=b(this).attr('id').indexOf('seguimiento_geografico_'),t=b(this).attr('id').indexOf('seguimiento_grupal_');-1!=s&&o('seguimiento_geografico_','insert'),-1!=t&&(b('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val(''),o('seguimiento_grupal_','insert')),b('.seg_geo_origen').find('input').prop('disabled',!1),b(':disabled').prop('disabled',!1);var u=new FormData(this),v=b(this),w=v.attr('action');'procesador.php'==v.attr('action')&&(w='../managers/dphpforms/procesador.php'),b(v).find('button').prop('disabled',!0),b(v).find('a').attr('disabled',!0),console.log(v),g.show(),b.ajax({type:'POST',url:w,data:u,cache:!1,contentType:!1,processData:!1,success:function success(y){g.hide(),console.log(y);var A=JSON.parse(y);if(0==A.status){b.get('../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg='+j()+'&rid=-1',function(M){console.log(M)});var B='';if('Stored'==A.message){B='Almacenado, se va a descargar una copia de seguridad, por favor cons\xE9rvela, informar si no se genera la copia.';var I=A.data,J=null,K=null;b.ajax({url:'../managers/dphpforms/dphpforms_get_record.php?record_id='+I,dataType:'json',async:!1,success:function success(M){K=M,J=JSON.stringify(M)}});var L=b('#dphpforms_fullname').data('info')+' - '+K.record.alias+' - Fecha '+K.record.fecha_hora_registro+'.json',C=new Blob([J],{type:'.json'});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(C,L);else{var D=document.createElement('a'),E=URL.createObjectURL(C);D.href=E,D.download=L,document.body.appendChild(D),D.click(),setTimeout(function(){document.body.removeChild(D),window.URL.revokeObjectURL(E)},0)}}else'Updated'==A.message&&(B='Actualizado, las fechas e \xEDconos se actualizar\xE1n al recargar la p\xE1gina. ');m(),l(),swal({title:'Informaci\xF3n',text:B,type:'success'},function(){'Updated'==A.message?(b('#dphpforms-peer-record-'+b('#dphpforms_record_id').val()).stop().animate({backgroundColor:'rgb(175, 255, 173)'},400).animate({backgroundColor:'#f5f5f5'},4e3),b('#body_editor').html('')):(b('.dphpforms-response').trigger('reset'),b('#body_editor').html(''))}),b('#modal_v2_edit_peer_tracking').fadeOut(300),b('#modal_v2_peer_tracking').fadeOut(300),b('#modal_primer_acercamiento').fadeOut(300),b('#modal_seguimiento_geografico').fadeOut(300),b(v).find('button').prop('disabled',!1),b(v).find('a').attr('disabled',!1)}else if(-5==A.status){b(v).find('button').prop('disabled',!1),b(v).find('a').attr('disabled',!1);var B='';if('The field is static and can not be changed'==A.message){var F=A.data;b('div').removeClass('regla_incumplida'),b('.div-'+F).addClass('regla_incumplida'),B='Ups!, el campo marcado en rojo est\xE1 definido como est\xE1tico y por lo tanto debe mantener el mismo valor, si no logra ver el campo marcado en rojo informe de este incidente.'}swal('Alerta',B,'warning')}else if(-4==A.status){b(v).find('button').prop('disabled',!1),b(v).find('a').attr('disabled',!1);var B='';if('Field does not match with the regular expression'==A.message){var F=A.data.id;b('div').removeClass('regla_incumplida'),b('.div-'+F).addClass('regla_incumplida'),B='Ups!, el campo marcado en rojo no cumple con el patr\xF3n esperado('+A.data.human_readable+'). Ejemplo: '+A.data.example}swal('Alerta',B,'warning')}else if(-3==A.status){b(v).find('button').prop('disabled',!1),b(v).find('a').attr('disabled',!1);var B='';if('Field cannot be null'==A.message){var F=A.data;b('div').removeClass('regla_incumplida'),b('.div-'+F).addClass('regla_incumplida'),B='Ups!, los campos que se acaban de colorear en rojo no pueden estar vac\xEDos, si no logra ver ning\xFAn campo, informe de este incidente.'}swal('Alerta',B,'warning')}else if(-2==A.status){b(v).find('button').prop('disabled',!1),b(v).find('a').attr('disabled',!1);var B='';if('Without changes'==A.message)B='No hay cambios que registrar',b('#modal_v2_edit_peer_tracking').fadeOut(300),b('#modal_v2_peer_tracking').fadeOut(300),b('#modal_primer_acercamiento').fadeOut(300),b('#modal_seguimiento_geografico').fadeOut(300);else if('Unfulfilled rules'==A.message){var G=A.data.id_form_pregunta_a,H=A.data.id_form_pregunta_b;b('div').removeClass('regla_incumplida'),b('.div-'+G).addClass('regla_incumplida'),b('.div-'+H).addClass('regla_incumplida'),B='Ups!, revise los campos que se acaban de colorear en rojo.'}swal('Alerta',B,'warning')}else-1==A.status&&(console.log(y),swal('ERROR!','Ups!, informe de este error','error'))},error:function error(y){g.hide(),console.log(y),swal('Error!','Ups!, informe de este error','error'),b(v).find('button').prop('disabled',!1),b(v).find('a').attr('disabled',!1)}})}),b(document).on('click','.btn-dphpforms-delete-record',function(){swal({title:'Confirmaci\xF3n',text:'Est\xE1 eliminando este registro, \xBFdesea continuar?',type:'warning',showCancelButton:!0,confirmButtonText:'S\xED, Eliminar!'},function(r){if(r){var s=b('.btn-dphpforms-delete-record').attr('data-record-id');g.show(),b.get('../managers/dphpforms/dphpforms_delete_record.php?record_id='+s,function(t){g.hide();var u=t;0==u.status?(console.log(u),b.get('../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg='+j()+'&rid='+s,function(v){console.log(v)}),setTimeout(function(){swal({title:'Informaci\xF3n',text:'Eliminado',type:'success'},function(){b('.mymodal').fadeOut(300),b('#dphpforms-peer-record-'+s).stop().animate({backgroundColor:'rgb(175, 255, 173)'},400).animate({backgroundColor:'#e32423'},4e3,function(){b('#dphpforms-peer-record-'+s).remove()})})},500)):-1==u.status&&setTimeout(function(){swal('Error!',u.message,'error')},500)})}})})}}});