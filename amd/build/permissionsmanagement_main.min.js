define(["jquery","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert","block_ases/select2"],function(e,t,n,o,a){return{init:function(){function t(){e("#profiles_user").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},width:"36%",dropdownAutoWidth:!0,placeholder:"Seleccionar perfil"})}var n;function o(t=!1){var n=e("#nombre_perfil").val().trim(),o=e("#descripcion_perfil").val().trim(),a="";0==n.length&&(a="Nombre del perfil no puede ser nulo"),0==o.length&&(a+="<br>Descripcion del perfil no puede ser nulo"),0==n.length||0==o.length?swal({title:"Error al crear Funcionalidad.",text:a,html:!0,type:"warning",confirmButtonColor:"#d51b23"}):e.ajax({type:"POST",data:{nombre_perfil:n,descripcion_perfil:o,security:t},url:"../managers/ActionCreateAction.php",async:!1,success:function(t){e("#formPerfil")[0].reset(),swal({title:"",text:t,type:"info",showCancelButton:!1,showConfirmButton:!0},function(){location.reload()})}})}function a(){e.ajax({type:"POST",url:"../managers/permissions_management/load_function.php",success:function(t){e("#div_functions").empty(),e("#div_functions").append('<table id="tableFunctions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');e("#tableFunctions").DataTable(t);e("#div_functions #modify_function").css("cursor","pointer")},dataType:"json",cache:"false",error:function(e){swal({title:"Error al cargar Funcionalidades.",text:e,type:"error",confirmButtonColor:"#d51b23"})}})}function r(){e.ajax({type:"POST",url:"../managers/permissions_management/load_actions.php",success:function(t){e("#div_actions").empty(),e("#div_actions").append('<table id="tableActions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');e("#tableActions").DataTable(t);e("#div_actions #delete_action").css("cursor","pointer")},dataType:"json",cache:"false",error:function(e){swal({title:"Error al cargar acciones.",text:e,type:"error",confirmButtonColor:"#d51b23"})}})}function i(){e.ajax({type:"POST",url:"../managers/permissions_management/load_profiles.php",success:function(t){e("#div_profiles").empty(),e("#div_profiles").append('<table id="tableProfiles"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');e("#tableProfiles").DataTable(t);e("#div_profiles #delete_profiles").css("cursor","pointer")},dataType:"json",cache:"false",error:function(e){swal({title:"Error al cargar roles.",text:e,type:"error",confirmButtonColor:"#d51b23"})}})}function s(){e.ajax({type:"POST",data:{source:"update_functionality_select"},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(t){e("#funct1").html(t[0]),e("#funct2").html(t[1])},error:function(e){swal({title:"Error al actualizar Funcionalidad.",text:e,type:"error",confirmButtonColor:"#d51b23"})}})}function c(t){e.ajax({type:"POST",data:{source:"update_general_table",instance:t},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(t){e("#lista_funcionalidades").html(t)},error:function(e){swal({title:"Error al actualizar la asignacion de roles y permisos.",text:e,type:"error",confirmButtonColor:"#d51b23"})}})}function l(){e.ajax({type:"POST",data:{source:"update_role_select"},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(n){e("#profiles_user").html(n),t()},error:function(e){swal({title:"Error al actualizar roles.",text:e,type:"error",confirmButtonColor:"#d51b23"})}})}t(),e("#functions").select2({placeholder:"Select a Program",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},width:"36%",dropdownAutoWidth:!0}),e(document).ready(function(){for(var t=window.location.search.split("&"),u=0;u<t.length;u++){var d=t[u].split("=");"?instanceid"!=d[0]&&"instanceid"!=d[0]||(n=d[1])}r(),a(),i(),e("#add_accion").on("click",function(){!function(){var t=e("#nombre_accion").val().trim(),n=e("#descripcion").val().trim(),o=e("#functions").val(),a="",r=!1;0==t.length&&(a="Nombre no puede ser nulo",r=!0);0==n.length&&(a+="<br>Descripcion no puede ser nulo",r=!0);0==o&&(a+="<br>Funcionalidad no puede ser nulo",r=!0);r?swal({title:"Error al crear Acción.",text:a,html:!0,type:"warning",confirmButtonColor:"#d51b23"}):e.ajax({type:"POST",data:{nombre:t,descripcion:n,id_funcionalidad:o},url:"../managers/ActionCreateAction.php",async:!1,success:function(t){e("#formAction")[0].reset(),swal({title:"",text:t,type:"info",showCancelButton:!1,showConfirmButton:!0},function(){location.reload()})}})}(),r(),c(n)}),e("#add_function").on("click",function(){!function(){var t=e("#nombre_funcionalidad").val().trim(),n=e("#descripcion_funcionalidad").val().trim(),o="";0==t.length&&(o="Nombre no puede ser nulo");0==n.length&&(o+="\nDescripcion no puede ser nulo");0==t.length||0==n.length?swal({title:"Error al crear Funcionalidad.",text:o,html:!0,type:"warning",confirmButtonColor:"#d51b23"}):e.ajax({type:"POST",data:{nombre_funcionalidad:t,descripcion_funcionalidad:n},url:"../managers/ActionCreateAction.php",success:function(t){e("#formFuncion")[0].reset(),swal({title:"",text:t,type:"info",showCancelButton:!1,showConfirmButton:!0},function(){location.reload()})}})}(),a(),c(n),s()}),e("#add_profile").on("click",function(){o(),i(),l()}),e("#add-security").on("click",function(){o(!0)}),e("#assign_user_profile").on("click",function(){!function(t){var n=e("#profiles_user").val(),o=[],a=(e("input[name='actions[]']:checked").each(function(){o.push(e(this).val())}),JSON.stringify(o));""==n?swal({title:"Error",text:"Seleccione el rol del usuario",type:"error",confirmButtonColor:"#d51b23"}):e.ajax({type:"POST",data:{profile:n,actions:a,function:"assign_role",instance:t},url:"../managers/ActionCreateAction.php",async:!1,success:function(e){swal({title:"",text:e,type:"info",showCancelButton:!1,showConfirmButton:!0})}})}(n)})}),e("input[name='actions[]']").change(function(){e(this).attr("checked",!0)}),e("#profiles_user").change(function(){var t=e("#profiles_user").val();e.ajax({type:"POST",data:{user:t,source:"permissions_management"},url:"../managers/permissions_management/permissions_report.php",success:function(t){e("input[name='actions[]'").prop("checked",!1),e.each(t,function(t,n){e("input[value='"+n+"']").prop("checked",!0)})},dataType:"json",cache:"false",error:function(e){swal({title:"Error al crear Funcionalidad.",text:"Error al cargar gestion de permisos y roles",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})}),e("body").on("click","tbody tr td .red.glyphicon.glyphicon-pencil",function(){var t=e(this).parents().eq(3).attr("id"),n=e("#"+t).DataTable(),o=n.cell(n.row(e(this).parent()).index(),0).data(),a=n.cell(n.row(e(this).parent()).index(),1).data(),r=n.cell(n.row(e(this).parent()).index(),2).data();e("#nombre_editar").prop("disabled",!1),e("#nombre_editar").val(o),e("#descripcion_editar").val(a),"tableActions"==t?(e(".form-pilos.func").removeClass("hide"),e("#save_seg").attr("name",this.id+"_accion"),e("#functions_table option").filter(function(){return e(this).text()==r}).prop("selected",!0)):"tableFunctions"==t?(e("#save_seg").attr("name",this.id+"_funcionalidad"),e(".form-pilos.func").addClass("hide")):(e("#save_seg").attr("name",this.id+"_rol"),e("#nombre_editar").prop("disabled",!0),e(".form-pilos.func").addClass("hide"))}),e(document).on("click","#save_seg",function(){var t=this.name.split("_"),o=t[0],u=t[1],d=e("#nombre_editar").val(),p=e("#descripcion_editar").val(),f="";"accion"==u&&(f=e("#functions_table").val()),e.ajax({type:"POST",data:{id:o,table:u,source:"modify_register",nombre:d,descripcion:p,funcionalidad:f},url:"../managers/permissions_management/permissions_report.php",success:function(e){swal({title:e.title,html:!0,text:e.text,type:e.type,confirmButtonColor:"#d51b23"}),r(),a(),i(),s(),c(n),l()},dataType:"json",cache:"false",error:function(e){swal({title:"Error",html:!0,text:"Se presento un inconveniente al modificar registro <br>"+e,type:"error",confirmButtonColor:"#d51b23"})}})}),e("#div_actions").on("click","#delete_action",function(){var t=e("#div_actions #tableActions").DataTable(),o=e(this).parent(),a=e(this).children("span").attr("id"),i=(t.cell(o).index().column,t.cell(t.row(o).index(),0).data());t.cell(t.row(o).index(),1).data();swal({title:"Estas seguro/a?",text:"La acción <strong>"+i+"</strong> se eliminará",type:"warning",html:!0,showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(t){var o,i;t&&(o=a,i="accion",e.ajax({type:"POST",data:{id:o,source:"delete_record",type:i},url:"../managers/permissions_management/permissions_report.php",success:function(e){swal({title:e.title,html:!0,text:e.text,type:e.type,confirmButtonColor:"#d51b23"}),s(),c(n)},dataType:"json",cache:"false",error:function(e){swal({title:"Error",text:"Error al eliminar registro",type:"error",confirmButtonColor:"#d51b23"})}}),r())})})}}});