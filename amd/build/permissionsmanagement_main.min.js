define(["jquery","block_ases/bootstrap","block_ases/datatables","block_ases/sweetalert","block_ases/select2"],function(e,n,a,t,i){return{init:function(){function n(){e("#profiles_user").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},width:"36%",dropdownAutoWidth:!0,placeholder:"Seleccionar perfil"})}var a;function t(){e.ajax({type:"POST",url:"../managers/permissions_management/load_function.php",success:function(n){e("#div_functions").empty(),e("#div_functions").append('<table id="tableFunctions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');e("#tableFunctions").DataTable(n);e("#div_functions #modify_function").css("cursor","pointer")},dataType:"json",cache:"false",error:function(e){alert("Error al cargar funcionalidades")}})}function i(){e.ajax({type:"POST",url:"../managers/permissions_management/load_actions.php",success:function(n){e("#div_actions").empty(),e("#div_actions").append('<table id="tableActions"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');e("#tableActions").DataTable(n);e("#div_actions #delete_action").css("cursor","pointer")},dataType:"json",cache:"false",error:function(e){alert("Error al cargar acciones")}})}function o(){e.ajax({type:"POST",url:"../managers/permissions_management/load_profiles.php",success:function(n){e("#div_profiles").empty(),e("#div_profiles").append('<table id="tableProfiles"  class="display" cellspacing="0" width="100%" ><thead><thead></table>');e("#tableProfiles").DataTable(n);e("#div_profiles #delete_profiles").css("cursor","pointer")},dataType:"json",cache:"false",error:function(e){alert("Error al cargar roles")}})}function r(){e.ajax({type:"POST",data:{source:"update_functionality_select"},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(n){e("#funct1").html(n[0]),e("#funct2").html(n[1])},error:function(e){alert("Error actualizar las funcionalidades")}})}function s(n){e.ajax({type:"POST",data:{source:"update_general_table",instance:n},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(n){e("#lista_funcionalidades").html(n)},error:function(e){alert("Error actualizar tabla de asignación de permisos y roles")}})}function c(){e.ajax({type:"POST",data:{source:"update_role_select"},url:"../managers/permissions_management/permissions_report.php",dataType:"json",cache:"false",success:function(a){e("#profiles_user").html(a),n()},error:function(e){alert("Error actualizar roles")}})}n(),e("#profiles_prof").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},width:"40%",dropdownAutoWidth:!0}),e("#actions").select2({dropdownAutoWidth:!0,width:"100%",multiple:!0,language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},dropdownAutoWidth:!0}),e(document).ready(function(){for(var n=window.location.search.split("&"),l=0;l<n.length;l++){var u=n[l].split("=");"?instanceid"!=u[0]&&"instanceid"!=u[0]||(a=u[1])}i(),t(),o(),e("#add_accion").on("click",function(){!function(){var n=e("#nombre").val().trim(),a=e("#descripcion").val().trim(),t=e("#functions").val(),i="";0==n.length&&(i="Nombre no puede ser nulo");0==a.length&&(i+="\nDescripcion no puede ser nulo");0==t.length&&(i+="\nFuncionalidad no puede ser nulo");0==n.length||0==a.length?alert(i):e.ajax({type:"POST",data:{nombre:n,descripcion:a,id_funcionalidad:t},url:"../managers/ActionCreateAction.php",async:!1,success:function(n){e("#formAction")[0].reset(),alert(n)}})}(),i(),s(a)}),e("#add_function").on("click",function(){!function(){var n=e("#nombre_funcionalidad").val().trim(),a=e("#descripcion_funcionalidad").val().trim(),t="";0==n.length&&(t="Nombre no puede ser nulo");0==a.length&&(t+="\nDescripcion no puede ser nulo");0==n.length||0==a.length?alert(t):e.ajax({type:"POST",data:{nombre_funcionalidad:n,descripcion_funcionalidad:a},url:"../managers/ActionCreateAction.php",success:function(n){e("#formFuncion")[0].reset(),alert(n)}})}(),t(),s(a),r()}),e("#add_profile").on("click",function(){!function(){var n=e("#nombre_perfil").val().trim(),a=e("#descripcion_perfil").val().trim(),t="";0==n.length&&(t="Nombre del perfil no puede ser nulo");0==a.length&&(t+="\nDescripcion del perfil no puede ser nulo");0==n.length||0==a.length?alert(t):e.ajax({type:"POST",data:{nombre_perfil:n,descripcion_perfil:a},url:"../managers/ActionCreateAction.php",async:!1,success:function(n){e("#formPerfil")[0].reset(),alert(n)}})}(),o(),c()}),e("#assign_user_profile").on("click",function(){var n,t,i,o;n=a,t=e("#profiles_user").val(),i=[],e("input[name='actions[]']:checked").each(function(){i.push(e(this).val())}),o=JSON.stringify(i),""==t?swal({title:"Error",text:"Seleccione el rol del usuario",type:"error",confirmButtonColor:"#d51b23"}):e.ajax({type:"POST",data:{profile:t,actions:o,function:"assign_role",instance:n},url:"../managers/ActionCreateAction.php",async:!1,success:function(e){alert(e)}})})}),e("input[name='actions[]']").change(function(){e(this).attr("checked",!0)}),e("#profiles_user").change(function(){var n=e("#profiles_user").val();e.ajax({type:"POST",data:{user:n,source:"permissions_management"},url:"../managers/permissions_management/permissions_report.php",success:function(n){e("input[name='actions[]'").prop("checked",!1),e.each(n,function(n,a){e("input[value='"+a+"']").prop("checked",!0)})},dataType:"json",cache:"false",error:function(e){alert("Error al cargar gestion de permisos y roles")}})}),e("body").on("click","tbody tr td .red.glyphicon.glyphicon-pencil",function(){var n=e(this).parents().eq(3).attr("id"),a=e("#"+n).DataTable(),t=a.cell(a.row(e(this).parent()).index(),0).data(),i=a.cell(a.row(e(this).parent()).index(),1).data(),o=a.cell(a.row(e(this).parent()).index(),2).data();e("#nombre_editar").val(t),e("#descripcion_editar").val(i),"tableActions"==n?(e(".form-pilos.func").removeClass("hide"),e("#save_seg").attr("name",this.id+"_accion"),e("#functions_table option").filter(function(){return e(this).text()==o}).prop("selected",!0)):"tableFunctions"==n?(e("#save_seg").attr("name",this.id+"_funcionalidad"),e(".form-pilos.func").addClass("hide")):(e("#save_seg").attr("name",this.id+"_rol"),e(".form-pilos.func").addClass("hide"))}),e(document).on("click","#save_seg",function(){var n=this.name.split("_"),l=n[0],u=n[1],d=e("#nombre_editar").val(),p=e("#descripcion_editar").val(),f="";"accion"==u&&(f=e("#functions_table").val()),e.ajax({type:"POST",data:{id:l,table:u,source:"modify_register",nombre:d,descripcion:p,funcionalidad:f},url:"../managers/permissions_management/permissions_report.php",success:function(e){swal({title:e.title,html:!0,text:e.text,type:e.type,confirmButtonColor:"#d51b23"}),i(),t(),o(),r(),s(a),c()},dataType:"json",cache:"false",error:function(e){swal({title:"Error",html:!0,text:"Se presento un inconveniente al modificar registro",type:"error",confirmButtonColor:"#d51b23"})}})}),e("#div_actions").on("click","#delete_action",function(){var n=e("#div_actions #tableActions").DataTable(),t=e(this).parent(),o=e(this).children("span").attr("id"),c=(n.cell(t).index().column,n.cell(n.row(t).index(),0).data());n.cell(n.row(t).index(),1).data();swal({title:"Estas seguro/a?",text:"La acción <strong>"+c+"</strong> se eliminará",type:"warning",html:!0,showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(n){var t,c;n&&(t=o,c="accion",e.ajax({type:"POST",data:{id:t,source:"delete_record",type:c},url:"../managers/permissions_management/permissions_report.php",success:function(e){swal({title:e.title,html:!0,text:e.text,type:e.type,confirmButtonColor:"#d51b23"}),r(),s(a)},dataType:"json",cache:"false",error:function(e){alert("Error al eliminar registro")}}),i())})})}}});