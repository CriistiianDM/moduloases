define ("block_ases/usermanagement_main",["jquery","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert","block_ases/select2"],function(a){var b;return{init:function init(){a("#collapse_div").removeClass("hidden");a("#users").select2({language:{noResults:function noResults(){return"No hay resultado"},searching:function searching(){return"Buscando.."}},dropdownAutoWidth:!0});a(document).ready(function(){a("#academic_program_li").css({display:"none"});a(".assignment_li").css({display:"none"});a("#form_mon_student").css({display:"none"});a("#search_button").on("click",function(){a("#search_button").prop("disabled",!0);c();d();a("#users").prop("disabled",!0);a(".assignment_li").show()});a("#ok-button").on("click",function(){var b=a("#role_select").val();d(null,function(c){if("monitor_ps"==c.rol&&c.rol!=b){var d=[];d.id=a("#user_id").val();d.username=a("#users").val();l(d,!1)}else{e();k()}})});a("#cancel-button").on("click",function(){a(".assignment_li").addClass("hidden");a("#boss_li").fadeOut();a("#form_mon_student").fadeOut();a("#users").val("").trigger("change.select2");a("#users").prop("disabled",!1);a("#search_button").prop("disabled",!1);a("#name_lastname").val(" ");a("#form_prof_type").fadeOut()});a("#form_mon_estudiante").css({display:"none"});a("#form_prof_type").css({display:"none"});a("#role_select").on("change",function(){if("monitor_ps"==a("#role_select").val()){a("#form_prof_type").fadeOut();a("#form_mon_student").fadeIn();i(4);a("#boss_li").fadeIn();a("#academic_program_li").fadeOut()}else if("profesional_ps"==a("#role_select").val()){a("#form_prof_type").fadeIn();a("#boss_li").fadeOut();a("#form_mon_student").fadeOut();a("#academic_program_li").fadeOut()}else if("practicante_ps"==a("#role_select").val()){a("#form_prof_type").fadeOut();a("#form_mon_student").fadeOut();i(7);a("#boss_li").fadeIn();a("#academic_program_li").fadeOut()}else if("director_prog"==a("#role_select").val()){a("#form_prof_type").fadeOut();a("#form_mon_student").fadeOut();a("#boss_li").fadeOut();a("#academic_program_li").fadeIn()}else{a("#boss_li").fadeOut();a("#form_mon_student").fadeOut();a("#form_prof_type").fadeOut();a("#academic_program_li").fadeOut()}});a("#list-users-panel").on("click",function(){k()});a("#div_users").on("click","#delete_user",function(){var b=a("#div_users #tableUsers").DataTable(),c=a(this).parent(),e=a(this).children("span").attr("id"),f=b.cell(c).index().column,g=b.cell(b.row(c).index(),0).data(),h=b.cell(b.row(c).index(),1).data(),i=b.cell(b.row(c).index(),2).data(),j=b.cell(b.row(c).index(),3).data(),k=[];k.id=e;k.username=g;swal({title:"Estas seguro/a?",text:"Al usuario <strong>"+h+" "+i+"</strong> con c\xF3digo <strong>"+g+"</strong> se le inhabilitar\xE1 los permisos del rol <strong>"+j+"</strong>.<br><strong>\xBFEst\xE1s de acuerdo con los cambios que se efectuar\xE1n?</strong>",type:"warning",html:!0,showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(a){if(a){d(g,function(a){k.rol=a.rol;var b=a.rol;switch(b){case"monitor_ps":l(k,!0);break;case"profesional_ps":p(k);break;default:q(k);}})}})})});a("body").on("click",".eliminar_add_fields",function(){var b=a("#contenedor_add_fields div").length+1,c=a(this).parent("div").children("input").val(),d=a(this).parent("div");if(c){swal({title:"Estas seguro/a?",text:"Se desvincular\xE1 el prensente monitor del estudiante con codigo "+c,type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(a){if(a){j(c);d.remove();b--}})}});a("#agregarCampo").click(function(){a.ajax({type:"POST",data:{function:"students_consult",instancia:r()},url:"../managers/user_management/usermanagement_report.php",success:function success(a){b=a;g(b)},dataType:"json",cache:"false",error:function error(){alert("error al consultar estudiantes")}})});function c(){a.ajax({type:"POST",url:"../managers/user_management/load_role.php",async:!1,success:function success(b){a("#role_select").empty();for(role in b){var c="<option value=\""+b[role].nombre_rol+"\">"+b[role].nombre_rol+"</option>";a("#role_select").append(c)}roleLoaded=!0},dataType:"json",error:function error(){alert("error al cargar roles")}})}function d(b,c){var d=b;if(!d){d=a("#users").val()}a.ajax({type:"POST",data:{dat:d,idinstancia:r()},url:"../managers/user_management/search_user.php",success:function success(b){if(c){c(b)}else{if(!b.error){a("#contenedor_add_fields").html("");if(""==b.firstname){swal("Error","El usuario no existe en la base de datos","error");a("#users").prop("disabled",!1)}else{a(".assignment_li").removeClass("hidden");a("#name_lastname").val(b.firstname+" "+b.lastname);a("#user_id").val(b.id);if(""==b.rol){a("#role_select").val("no_asignado")}else{if("profesional_ps"==b.rol){a("#select_prof_type").val(b.profesion);a("#form_prof_type").fadeIn();a("#boss_li").fadeOut();a("#form_mon_student").fadeOut();a("#academic_program_li").fadeOut()}else if("monitor_ps"==b.rol){h();i(4,b.boss);a("#form_mon_student").fadeIn();a("#form_prof_type").fadeOut();a("#academic_program_li").fadeOut()}else if("practicante_ps"==b.rol){i(7,b.boss);a("#form_mon_student").fadeOut();a("#form_prof_type").fadeOut();a("#academic_program_li").fadeOut()}else if("director_prog"==b.rol){a("#form_mon_student").fadeOut();a("#form_prof_type").fadeOut();a("#boss_li").fadeOut();a("#academic_program_li").fadeIn()}else{a("#boss_li").fadeOut();a("#form_mon_student").fadeOut();a("#form_prof_type").fadeOut()}a("#role_select").val(b.rol)}}}else{swal("Error",b.error,"error");a(".assignment_li").addClass("hidden");a("#form_mon_student").css({display:"none"});a("#users").val("").trigger("change.select2");a("#users").prop("disabled",!1);a("#name_lastname").val(" ");a("#search_button").prop("disabled",!1)}}},dataType:"json",error:function error(){swal("Error","El usuario no existe en la base de datos","error");a(".assignment_li").addClass("hidden");a("#form_mon_student").css({display:"none"});a("#users").val("").trigger("change.select2");a("#users").prop("disabled",!1);a("#name_lastname").val(" ");a("#search_button").prop("disabled",!1)}})}function e(){var b=a("#role_select").val(),c=a("#users").val(),e=[];a("input[name=\"array_students[]\"]").each(function(){e.push(a(this).val().split(" - ")[0])});a("select[name=\"array_students[]\"]").each(function(){e.push(a(this).val().split(" - ")[0])});if("profesional_ps"==b){var f=a("#select_prof_type").val();if("no_asignado"==f){swal("Error","El usuario no tiene un \"tipo de profesional\" asignado, debe asignar un \"tipo de profesional\".","error")}else{var g={role:b,username:c,professional:f,idinstancia:r()};a.ajax({type:"POST",data:g,url:"../managers/user_management/update_role_user.php",success:function success(a){swal("Informaci\xF3n!",a,"info");d(c)},dataType:"text",cache:"false",error:function error(){swal("Error","Ha ocurrido un error asignando profesional","error")}})}}else if("monitor_ps"==b){var h=a("#boss_select").val();a.ajax({type:"POST",data:{role:b,username:c,students:e,boss:h,idinstancia:r()},url:"../managers/user_management/update_role_user.php",success:function success(a){swal({title:"Informaci\xF3n!",text:a,type:"info",html:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Ok!",closeOnConfirm:!0});d(c)},dataType:"text",cache:"false",error:function error(){swal("Error","Ha ocurrido un error","error")}})}else if("practicante_ps"==b){var h=a("#boss_select").val();a.ajax({type:"POST",data:{role:b,username:c,boss:h,idinstancia:r()},url:"../managers/user_management/update_role_user.php",success:function success(a){swal({title:"Informaci\xF3n!",text:a,type:"info",html:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Ok!",closeOnConfirm:!0});d(c)},dataType:"text",cache:"false",error:function error(){swal("Error","Ha ocurrido un error","error")}})}else if("director_prog"==b){var i=a("#academic_program_select").val();a.ajax({type:"POST",data:{role:b,username:c,academic_program:i,idinstancia:r()},url:"../managers/user_management/update_role_user.php",success:function success(a){swal({title:"Informaci\xF3n!",text:a,type:"info",html:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Ok!",closeOnConfirm:!0});d(c)},dataType:"text",cache:"false",error:function error(){swal("Error","Ha ocurrido un error","error")}})}else{a.ajax({type:"POST",data:{role:b,username:c,idinstancia:r()},url:"../managers/user_management/update_role_user.php",success:function success(a){swal("Informaci\xF3n!",a,"info")},dataType:"text",cache:"false",error:function error(){swal("Error","Ha ocurrido un error","error")}})}}function f(b){a("#"+b).select2({language:{noResults:function noResults(){return"No hay resultado"},searching:function searching(){return"Buscando.."}},dropdownAutoWidth:!0})}function g(b){var c=a("#contenedor_add_fields"),d=a(".inputs_students").length+1,e=d;e++;var g="<option value=\"-1\">-----------------------</option>";for(var h in b){g+="<option value=\""+b[h].username+"\">"+b[h].username+" - "+b[h].firstname+" "+b[h].lastname+"</option>"}a("#contenedor_add_fields").append("<div class=\"select-pilos\"><select class=\"inputs_students\" name=\"array_students[]\" id=\"campo_"+e+"\"\">"+g+"</select></div>");f("campo_"+e);d++}function h(){var c=[],d=a("#user_id").val();c.push({name:"function",value:"load_grupal"});c.push({name:"user_management",value:d});c.push({name:"idinstancia",value:r()});a.ajax({type:"POST",data:c,url:"../managers/user_management/usermanagement_report.php",success:function success(c){a("#contenedor_add_fields").html("");if(0!=c.rows){for(var d in b){"<option value=\""+b[d].username+"\">"+b[d].username+" - "+b[d].firstname+" "+b[d].lastname+"</option>"}var e=c.content;for(x in e){a("#contenedor_add_fields").append("<div id=\"contenedor_add_fields\"> <div class=\"added_add_fields\"> <input type=\"text\"  class=\"inputs_students\" name=\"array_students[]\" id=\"campo_1\" value=\""+e[x].username+" - "+e[x].firstname+" "+e[x].lastname+"\" readonly/> <a href=\"#\" class=\"eliminar_add_fields\"><img src=\"../icon/ico_wrong.png\"></a> </div> </div>")}}},dataType:"json",cache:"false",error:function error(){alert("error al cargar estudiantes")}})}function i(b,c){var d=[];d.push({name:"function",value:"cargar"});d.push({name:"role",value:b});d.push({name:"idinstancia",value:r()});a.ajax({type:"POST",data:d,url:"../managers/user_management/search_user.php",success:function success(b){a("#boss_select").html("");a("#boss_select").append("<option value=\"ninguno\">Ninguno</option>");for(x in b){var d=b[x].firstname.split(" "),e=b[x].lastname.split(" ");if(c==b[x].id){a("#boss_select").append("<option value=\""+b[x].id+"\" selected>"+b[x].username+"-"+d[0]+" "+e[0]+"</option>");b[x].id}else{a("#boss_select").append("<option value=\""+b[x].id+"\" >"+b[x].username+"-"+d[0]+" "+e[0]+"</option>")}}a("#boss_li").removeClass("hide")},dataType:"json",cache:"false",error:function error(){alert("error al cargar profesionales")}})}function j(b){var c=[],d=a("#user_id").val(),e=a("#users").val();c.push({name:"deleteStudent",value:"delete"});c.push({name:"student",value:b.split(" - ")[0]});c.push({name:"username",value:e});c.push({name:"idinstancia",value:r()});a.ajax({type:"POST",data:c,url:"../managers/user_management/update_role_user.php",success:function success(){},dataType:"json",cache:"false",error:function error(){alert("Error al eliminar estudiante")}})}function k(){a.ajax({type:"POST",data:{idinstancia:r()},url:"../managers/user_management/load_role_users.php",success:function success(b){a("#div_users").empty();a("#div_users").append("<table id=\"tableUsers\" class=\"display\" cellspacing=\"0\" width=\"100%\"><thead><thead></table>");a("#tableUsers").DataTable(b);a("#div_users #delete_user").css("cursor","pointer")},dataType:"json",cache:"false",error:function error(){alert("Error al cargar usuarios")}})}function l(b,c){var f=[];f.push({name:"function",value:"load_grupal"});f.push({name:"user_management",value:b.id});f.push({name:"idinstancia",value:r()});a.ajax({type:"POST",data:f,url:"../managers/user_management/usermanagement_report.php",success:function success(a){if(0!=a.rows){var f=a.content,g="<p align=justify\">Se ha encontrado que el usuario tiene asignado el rol MONITOR y tiene a cargo los siguientes estudiantes:</p><br><br> ";g+="<div class=\"pre-scrollable\" style=\"max-height:200px\"><table id=\"tableStudent\" class=\"table table-striped\"> <thead> <tr> <th>C\xF3digo</th> <th>Nombre</th> <th>Apellido</th></tr> </thead><tbody>";for(x in f){g+="<tr> <td>"+f[x].username+"</td> <td>"+f[x].firstname+"</td> <td>"+f[x].lastname+"</td> </tr>"}g+="</tbody></table></div><br><br><p align=justify\">Para continuar se crear\xE1 un nuevo usuario con rol monitor quien se har\xE1 a cargo de los anteriores estudiante(s).<br> Por favor escribe el c\xF3digo del nuevo usuario:</p>";var h="";if(c){h="Antes de eliminar!"}else{h="Antes de Actualizar!"}swal({title:h,html:!0,text:g,type:"input",showCancelButton:!0,closeOnConfirm:!1,confirmButtonColor:"#d51b23",confirmButtonText:"Continuar",cancelButtonText:"Cancelar!",animation:"slide-from-top",inputPlaceholder:"C\xF3digo"},function(a){if(!1===a)return!1;if(""===a){swal.showInputError("Escibe el c\xF3digo del nuevo monitor!");return!1}d(a,function(a){if(a.error){swal.showInputError(a.error)}else{m(a,b,c)}return!1})})}else{n(b,r());e();k()}},dataType:"json",cache:"false",error:function error(){alert("error al validar monitor")}})}function m(a,b,c){var d="";if("ninguno"==a.rol){d="El usuario <strong>"+a.firstname+" "+a.lastname+"</strong> con c\xF3digo <strong>"+a.username+"</strong> se le asiganara el rol monitor y tendr\xE1 a cargo los estudiantes del anterior monitor<br>\xBFEst\xE1 de acuerdo con los cambios que se efectuar\xE1n?"}else{d="El usuario <strong>"+a.firstname+" "+a.lastname+"</strong> con c\xF3digo <strong>"+a.username+"</strong> ya tiene el rol <strong>"+a.rol+"</strong>  en el sistema.<br>Perder\xE1 el presente rol y se le asiganar\xE1 el rol monitor.<br> Tendr\xE1 a cargo los estudiantes del anterior monitor.<br><br><strong>\xBFEst\xE1s de acuerdo con los cambios que se efectuar\xE1n?</strong>"}swal({title:"Est\xE1s seguro/a?",text:d,type:"warning",html:!0,showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"Atras!",closeOnConfirm:!1,closeOnCancel:!1,animation:"slide-from-top"},function(d){if(d){o(a,b,c)}else{l(b,c)}})}function n(b){var c=[];c.push({name:"deleteMonitorWithoutStudents",value:"deleteMonitorWithoutStudents"});c.push({name:"oldUser",value:JSON.stringify([b.id,b.username])});c.push({name:"idinstancia",value:r()});a.ajax({type:"POST",data:c,url:"../managers/user_management/update_role_user.php",success:function success(a){if(1==a){swal("Hecho!","El usuario ha sido eliminado satisfactoriamente.","success");e();k()}else{swal("Error!",a,"error")}},dataType:"text",cache:"false",error:function error(){alert("Error al eliminar monitor sin estudiantes asignados")}})}function o(b,c,d){var f=[];f.push({name:"changeMonitor",value:"changeMonitor"});f.push({name:"oldUser",value:JSON.stringify([c.id,c.username])});f.push({name:"newUser",value:JSON.stringify([b.id,b.username])});f.push({name:"isdelete",value:d});f.push({name:"idinstancia",value:r()});a.ajax({type:"POST",data:f,url:"../managers/user_management/update_role_user.php",success:function success(a){if(1==a){if(d){swal("Eliminado!","El proceso se eliminaci\xF3n de complet\xF3 satisfactoriamente.","success")}else{swal("Hecho!","El proceso de reasignaci\xF3n de estudiantes se complet\xF3 satisfactoriamente. Por favor actualiza y guarda el nuevo rol","success");e();k()}k()}else{swal("Error!",a,"error")}},dataType:"text",cache:"false",error:function error(){alert("Error al cambiar monitor")}})}function p(b){var c=[];c.push({name:"deleteProfesional",value:"deleteProfesional"});c.push({name:"user",value:JSON.stringify([b.id,b.username])});c.push({name:"idinstancia",value:r()});a.ajax({type:"POST",data:c,url:"../managers/user_management/update_role_user.php",success:function success(a){if(1==a){swal("Eliminado!","El proceso se eliminaci\xF3n de complet\xF3 satisfactoriamente.","success");k()}else{swal("Error!",a,"error")}},dataType:"json",cache:"false",error:function error(){alert("Error al eliminar profesional")}})}function q(b){var c=[];c.push({name:"deleteOtheruser",value:"deleteOtheruser"});c.push({name:"user",value:JSON.stringify([b.id,b.username,b.rol])});c.push({name:"idinstancia",value:r()});a.ajax({type:"POST",data:c,url:"../managers/user_management/update_role_user.php",success:function success(a){if(1==a){swal("Eliminado!","El proceso se eliminaci\xF3n de complet\xF3 satisfactoriamente.","success");k()}else{swal("Error!",a,"error")}},dataType:"json",cache:"false",error:function error(){alert("Error al eliminar otros usuarios")}})}function r(){var a=location.search.split("&");for(x in a){if(0<=a[x].indexOf("instanceid")){var b=a[x].split("=");return b[1]}}return 0}}}});
//# sourceMappingURL=usermanagement_main.min.js.map
