define(["jquery","block_ases/sweetalert","block_ases/jqueryui","block_ases/loading_indicator","block_ases/_general_modal_manager"],function(e,n,t,a,i){return e(document).on("click","#new-incident",function(){i.generate_modal("modal-new-incident","Registro de incidencia interna",'                <div id="incident_box" style="padding:1em; margin-bottom:1.2em;" >                    <input id="new_inc_title" class="form-control" placeholder="Título corto" type="text">                    <textarea id="new_inc_detail" class="form-control" name="" placeholder="Descripción detallada de la incidencia" rows="5"></textarea>                    <a id="new_inc_registrar" class="btn btn-info" style="float:right; margin-top:0.5em;" href="javascript:void(0)">Registrar</a>                </div>            ',"modal-body-new-incident",function(){i.show_modal(".modal-new-incident",300)})}),e(document).on("click","#new_inc_registrar",function(){let n={title:e("#new_inc_title").val(),commentary:e("#new_inc_detail").val()};""!=n.title&&""!=n.commentary?(a.show(),e.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"create_incident",params:[n,"<h1>Incidencia interna</h1>"]}),success:function(e){a.hide(),0===e.status_code?swal({title:"Éxito",text:"Se ha registrado correctamente la incidencia, ticket #"+e.data_response,type:"success"},function(){location.reload()}):swal("Error!","Oops!: "+e.data_response,"error")},error:function(e,n,t){a.hide(),console.log("some error "+n+" "+t),console.log(e)}})):swal("Oops!","Verifica que tanto el título como la descripción no estén vacíos.","warning")}),console.log("ases_incident_manager loaded"),{init:function(){e(document).on("click",".inc_item",function(){!function(n){a.show(),e.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"get_incident",params:[n]}),async:!1,success:function(t){a.hide();let i=e("#extras").data("url-base"),o=JSON.parse(JSON.parse(t.data_response).comentarios),r=JSON.parse(t.data_response).usuario_registra,c=JSON.parse(t.data_response).usuario_cierra,s=o[0].message.title,l=o[0].message.commentary,d=JSON.parse(t.data_response).cerrada,m=function(e){let n=e.getDate(),t=e.getMonth(),a=e.getFullYear(),i=e.getHours(),o=e.getMinutes(),r=e.getSeconds();return n+"-"+["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][t]+"-"+a+", "+i+":"+o+":"+r}(new Date(1e3*JSON.parse(t.data_response).fecha_hora_registro));e(".inc_detail").html("<strong>Detalle: </strong>"+l),e(".opened_by").html("<strong>Abierta por:</strong> "+r.firstname+" "+r.lastname+" - "+r.username),e(".inc_preview").find("a").attr("href","ases_incidents_preview.php?incident_id="+n),e(".record_datetime").html("<strong>Fecha y hora:</strong> "+m),e("#close_incident").attr("data-id",n),e(".send_message").html('<strong>Mensajes: </strong> [ <a target="_blank" rel="noopener noreferrer" href="'+i+"/message/index.php?id="+r.id+'">Ir al chat con el usuario</a> ].'),e(".inc_preview").show(),1!=d?(e(".inc_title").html("<h2>Ticket #"+n+" - "+s+"</h2>"),e(".inc_opc").show()):(e(".inc_opc").hide(),e(".inc_title").html("<h2>Ticket #"+n+" [Cerrada] - "+s+"</h2>"),e(".closed_by").html("<strong>Cerrada por:</strong> "+c.firstname+" "+c.lastname))},error:function(e,n,t){a.hide(),console.log("some error "+n+" "+t),console.log(e)}})}(e(this).data("id"))}),e(document).on("click","#close_incident",function(){!function(n){swal({html:!0,title:"Confirmación",text:"<strong>Nota importante!</strong>: Está cerrando una incidencia.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar!"},function(t){t&&(a.show(),e.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"close_logged_user_incident",params:[n]}),success:function(e){a.hide(),0===e.status_code?swal({title:"Éxito",text:"Se ha cerrado correctamente la incidencia",type:"success"},function(){location.reload()}):swal("Error!","Oops!: Al parece no existe la incidencia","error")},error:function(e,n,t){a.hide(),console.log("some error "+n+" "+t),console.log(e)}}))})}(e(this).data("id"))})}}});