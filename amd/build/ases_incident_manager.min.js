define ("block_ases/ases_incident_manager",["jquery","block_ases/sweetalert","block_ases/jqueryui","block_ases/loading_indicator","block_ases/_general_modal_manager"],function(a,b,c,d,e){a(document).on("click","#new-incident",function(){e.generate_modal("modal-new-incident","Registro de incidencia interna","                <div id=\"incident_box\" style=\"padding:1em; margin-bottom:1.2em;\" >                    <input id=\"new_inc_title\" class=\"form-control\" placeholder=\"T\xEDtulo corto\" type=\"text\">                    <textarea id=\"new_inc_detail\" class=\"form-control\" name=\"\" placeholder=\"Descripci\xF3n detallada de la incidencia\" rows=\"5\"></textarea>                    <a id=\"new_inc_registrar\" class=\"btn btn-info\" style=\"float:right; margin-top:0.5em;\" href=\"javascript:void(0)\">Registrar</a>                </div>            ","modal-body-new-incident",function(){e.show_modal(".modal-new-incident",300)})});a(document).on("click","#new_inc_registrar",function(){var b={title:a("#new_inc_title").val(),commentary:a("#new_inc_detail").val()};if(""!=b.title&&""!=b.commentary){d.show();a.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"create_incident",params:[b,"<h1>Incidencia interna</h1>"]}),success:function success(a){d.hide();if(0===a.status_code){swal({title:"\xC9xito",text:"Se ha registrado correctamente la incidencia, ticket #"+a.data_response,type:"success"},function(){location.reload()})}else{swal("Error!","Oops!: "+a.data_response,"error")}},error:function error(a,b,c){d.hide();console.log("some error "+b+" "+c);console.log(a)}})}else{swal("Oops!","Verifica que tanto el t\xEDtulo como la descripci\xF3n no est\xE9n vac\xEDos.","warning")}});function f(a){var b=a.getDate(),c=a.getMonth(),d=a.getFullYear(),e=a.getHours(),f=a.getMinutes(),g=a.getSeconds();return b+"-"+["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][c]+"-"+d+", "+e+":"+f+":"+g}console.log("ases_incident_manager loaded");return{init:function init(){a(document).on("click",".inc_item",function(){var c=a(this).data("id");b(c)});a(document).on("click","#close_incident",function(){var b=a(this).data("id");c(b)});function b(b){d.show();a.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"get_incident",params:[b]}),async:!1,success:function success(c){d.hide();var e=a("#extras").data("url-base"),g=JSON.parse(JSON.parse(c.data_response).comentarios),h=JSON.parse(c.data_response).usuario_registra,i=JSON.parse(c.data_response).usuario_cierra,j=g[0].message.title,k=g[0].message.commentary,l=JSON.parse(c.data_response).cerrada,m=f(new Date(1e3*JSON.parse(c.data_response).fecha_hora_registro));a(".inc_detail").html("<strong>Detalle: </strong>"+k);a(".opened_by").html("<strong>Abierta por:</strong> "+h.firstname+" "+h.lastname+" - "+h.username);a(".inc_preview").find("a").attr("href","ases_incidents_preview.php?incident_id="+b);a(".record_datetime").html("<strong>Fecha y hora:</strong> "+m);a("#close_incident").attr("data-id",b);a(".send_message").html("<strong>Mensajes: </strong> [ <a target=\"_blank\" rel=\"noopener noreferrer\" href=\""+e+"/message/index.php?id="+h.id+"\">Ir al chat con el usuario</a> ].");a(".inc_preview").show();if(1!=l){a(".inc_title").html("<h2>Ticket #"+b+" - "+j+"</h2>");a(".inc_opc").show()}else{a(".inc_opc").hide();a(".inc_title").html("<h2>Ticket #"+b+" [Cerrada] - "+j+"</h2>");a(".closed_by").html("<strong>Cerrada por:</strong> "+i.firstname+" "+i.lastname)}},error:function error(a,b,c){d.hide();console.log("some error "+b+" "+c);console.log(a)}})}function c(b){swal({html:!0,title:"Confirmaci\xF3n",text:"<strong>Nota importante!</strong>: Est\xE1 cerrando una incidencia.",type:"warning",showCancelButton:!0,confirmButtonText:"S\xED, cerrar!"},function(c){if(c){d.show();a.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"close_logged_user_incident",params:[b]}),success:function success(a){d.hide();if(0===a.status_code){swal({title:"\xC9xito",text:"Se ha cerrado correctamente la incidencia",type:"success"},function(){location.reload()})}else{swal("Error!","Oops!: Al parece no existe la incidencia","error")}},error:function error(a,b,c){d.hide();console.log("some error "+b+" "+c);console.log(a)}})}})}}}});
//# sourceMappingURL=ases_incident_manager.min.js.map
