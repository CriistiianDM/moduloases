{"version":3,"sources":["../src/ases_geographic_reports.js"],"names":["define","$","jszip","init","window","JSZip","getDataMap","on","heatmap","setMap","getMap","map","mapaCalor","markers","x","marcadoresMapa","ajax","type","data","cohort","val","instance_id","getIdinstancia","url","success","msg","crearActualizarMapa","dataType","cache","async","failure","latLng_Cali","google","maps","LatLng","Map","document","getElementById","center","zoom","puntosMapa","cohortes","latitud","longitud","latitude","longitude","push","cohorte","is","visualization","HeatmapLayer","opacity","maxIntensity","icon","color","scaledSize","Size","Marker","position","title","urlParameters","location","search","split","indexOf","intanceparameter"],"mappings":"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","sourcesContent":["// Standard license block omitted.\r\n/*\r\n * @package    block_ases\r\n * @copyright  ASES\r\n * @author     Joan Manuel Tovar Guzman\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n/**\r\n * @module block_ases/ases_geographic_reports\r\n */\r\ndefine(['jquery',\r\n        'block_ases/jszip'\r\n    ],\r\n\r\n    function ($, jszip) {\r\n\r\n        return {\r\n            init: function () {\r\n                window.JSZip = jszip;\r\n                getDataMap();\r\n\r\n                //Evento para controlar el checkbox de mapa de calor\r\n                $('#heat_map').on('change', function () {\r\n\r\n                    if (window.heatmap){\r\n                        window.heatmap.setMap(heatmap.getMap() ? null : window.map);\r\n                    }else{\r\n                        mapaCalor();\r\n                    }\r\n                });\r\n\r\n                //Evento para controlar el checkbox de mapa de marcadores\r\n                $('#markers_map').on('change', function () {\r\n\r\n                    if (window.markers){\r\n                        for (var x in window.markers){\r\n                            window.markers[x].setMap(window.markers[x].getMap() ? null : window.map);\r\n                        }\r\n                    }else{\r\n                        marcadoresMapa();\r\n                    }\r\n\r\n                });\r\n\r\n                //Evento para actualizar el mapa cuando cambie la seleccion de cohorte\r\n                $('#conditions').on('change', function () {\r\n                    getDataMap();\r\n                });\r\n            }\r\n        }\r\n\r\n\r\n        /**\r\n         * Funcion getDataMap\r\n         *\r\n         * Funcion que se encarga de hacer el llamado para obtener los datos de las coordenadas en la base de datos\r\n         */\r\n\r\n        function getDataMap(){\r\n\r\n            $.ajax({\r\n\r\n                type: \"POST\",\r\n                data: { type: 'mapa', cohort: $('#conditions').val(), instance_id: getIdinstancia() },\r\n                url: \"../managers/ases_report/asesreport_graphics_processing.php\",\r\n                success: function (msg) {\r\n                    crearActualizarMapa(msg);\r\n                },\r\n                dataType: \"json\",\r\n                cache: false,\r\n                async: true,\r\n\r\n                failure: function (msg) { }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Funcion crearActualizarMapa\r\n         *\r\n         * Funcion que recibe la informacion de las coordenadas y se encarga de crear o actualizar el mapa, segun corresponda\r\n         *\r\n         * @param data\r\n         */\r\n\r\n        function crearActualizarMapa(data) {\r\n\r\n            //Si no existe el mapa, se crea desde cero\r\n            if(!window.map){\r\n                var latLng_Cali = new google.maps.LatLng(3.4247198, -76.5259052);\r\n\r\n                window.map = new google.maps.Map(document.getElementById('map-canvas'), {\r\n                    center: latLng_Cali,\r\n                    zoom: 12\r\n                });\r\n            }\r\n\r\n            //Se prepara la informacion de las coordenadas\r\n\r\n            var puntosMapa = [], cohortes = [];\r\n            var latitud, longitud;\r\n\r\n            for (var x in data){\r\n                latitud = Number(data[x].latitude);\r\n                longitud = Number(data[x].longitude);\r\n                puntosMapa.push(new google.maps.LatLng(latitud,longitud));\r\n                cohortes.push(data[x].cohorte);\r\n            };\r\n\r\n            //Se asignan los atributos pertenecientes al mapa\r\n\r\n            window.puntosMapa = puntosMapa;\r\n            window.cohortes = cohortes;\r\n\r\n            mapaCalor(puntosMapa);\r\n            marcadoresMapa(puntosMapa);\r\n\r\n        };\r\n\r\n\r\n        /**\r\n         * Funcion mapaCalor\r\n         *\r\n         * Funcion que se encarga de superponer el mapa de calor sobre el mapa existente\r\n         *\r\n         */\r\n\r\n        function mapaCalor(){\r\n\r\n            if(window.heatmap){\r\n                window.heatmap.setMap(null);\r\n            }\r\n\r\n            if($(\"#heat_map\").is(\":checked\")){\r\n\r\n                window.heatmap = new google.maps.visualization.HeatmapLayer({\r\n                    data: window.puntosMapa,\r\n                    map: map,\r\n                    opacity: 1,\r\n                    maxIntensity: 10\r\n                });\r\n            }\r\n\r\n        };\r\n\r\n        /**\r\n         * Funcion marcadoresMapa\r\n         *\r\n         * Funcion que se encarga de dibujar los marcadores en el mapa existente segun las coordenadas\r\n         */\r\n\r\n\r\n        function marcadoresMapa(){\r\n\r\n            if (window.markers){\r\n                for (var x in window.markers){\r\n                    window.markers[x].setMap(null);\r\n                }\r\n            }\r\n\r\n            if($(\"#markers_map\").is(\":checked\")) {\r\n\r\n                window.markers = [];\r\n                var icon, color;\r\n\r\n                for (var x in window.puntosMapa) {\r\n\r\n                    switch (window.cohortes[x]) {\r\n\r\n                        case 'SPP':\r\n                            color = 'blue';\r\n                            break;\r\n                        case 'SPE':\r\n                            color = 'green';\r\n                            break;\r\n                        case 'SPT':\r\n                            color = 'red';\r\n                            break;\r\n                        case '3740':\r\n                            color = 'purple';\r\n                            break;\r\n                        case 'Otros':\r\n                            color = 'orange';\r\n                            break;\r\n                    };\r\n\r\n\r\n                    icon = {\r\n                        url: \"https://raw.githubusercontent.com/Concept211/Google-Maps-Markers/master/images/marker_\"+ color +\".png\", // url\r\n                        scaledSize: new google.maps.Size(11, 20) // scaled size\r\n                    };\r\n\r\n                    window.markers.push(new google.maps.Marker({\r\n                        position: window.puntosMapa[x],\r\n                        map: map,\r\n                        icon: icon,\r\n                        title: window.cohortes[x]\r\n                    }));\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        /**\r\n         * Funcion getIdInstancia\r\n         *\r\n         * Funcion que retorna la instancia actual\r\n         * @returns {*}\r\n         */\r\n\r\n        function getIdinstancia() {\r\n            var urlParameters = location.search.split('&');\r\n\r\n            for (x in urlParameters) {\r\n                if (urlParameters[x].indexOf('instanceid') >= 0) {\r\n                    var intanceparameter = urlParameters[x].split('=');\r\n                    return intanceparameter[1];\r\n                }\r\n            }\r\n            return 0;\r\n        };\r\n    });\r\n"],"file":"ases_geographic_reports.min.js"}