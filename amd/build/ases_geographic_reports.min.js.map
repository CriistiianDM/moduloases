{"version":3,"sources":["../src/ases_geographic_reports.js"],"names":["define","$","jszip","init","window","JSZip","getDataMap","on","heatmap","setMap","getMap","map","mapaCalor","markers","x","marcadoresMapa","ajax","type","data","cohort","val","instance_id","getIdinstancia","url","success","msg","crearActualizarMapa","dataType","cache","async","failure","latLng_Cali","google","maps","LatLng","Map","document","getElementById","center","zoom","puntosMapa","cohortes","latitud","longitud","latitude","longitude","push","cohorte","is","visualization","HeatmapLayer","opacity","maxIntensity","icon","color","scaledSize","Size","Marker","position","title","urlParameters","location","search","split","indexOf","intanceparameter"],"mappings":"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","sourcesContent":["// Standard license block omitted.\n/*\n * @package    block_ases\n * @copyright  ASES\n * @author     Joan Manuel Tovar Guzman\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/**\n * @module block_ases/ases_geographic_reports\n */\ndefine(['jquery',\n        'block_ases/jszip'\n    ],\n\n    function ($, jszip) {\n\n        return {\n            init: function () {\n                window.JSZip = jszip;\n                getDataMap();\n\n                //Evento para controlar el checkbox de mapa de calor\n                $('#heat_map').on('change', function () {\n\n                    if (window.heatmap){\n                        window.heatmap.setMap(heatmap.getMap() ? null : window.map);\n                    }else{\n                        mapaCalor();\n                    }\n                });\n\n                //Evento para controlar el checkbox de mapa de marcadores\n                $('#markers_map').on('change', function () {\n\n                    if (window.markers){\n                        for (var x in window.markers){\n                            window.markers[x].setMap(window.markers[x].getMap() ? null : window.map);\n                        }\n                    }else{\n                        marcadoresMapa();\n                    }\n\n                });\n\n                //Evento para actualizar el mapa cuando cambie la seleccion de cohorte\n                $('#conditions').on('change', function () {\n                    getDataMap();\n                });\n            }\n        }\n\n\n        /**\n         * Funcion getDataMap\n         *\n         * Funcion que se encarga de hacer el llamado para obtener los datos de las coordenadas en la base de datos\n         */\n\n        function getDataMap(){\n\n            $.ajax({\n\n                type: \"POST\",\n                data: { type: 'mapa', cohort: $('#conditions').val(), instance_id: getIdinstancia() },\n                url: \"../managers/ases_report/asesreport_graphics_processing.php\",\n                success: function (msg) {\n                    crearActualizarMapa(msg);\n                },\n                dataType: \"json\",\n                cache: false,\n                async: true,\n\n                failure: function (msg) { }\n            });\n        }\n\n        /**\n         * Funcion crearActualizarMapa\n         *\n         * Funcion que recibe la informacion de las coordenadas y se encarga de crear o actualizar el mapa, segun corresponda\n         *\n         * @param data\n         */\n\n        function crearActualizarMapa(data) {\n\n            //Si no existe el mapa, se crea desde cero\n            if(!window.map){\n                var latLng_Cali = new google.maps.LatLng(3.4247198, -76.5259052);\n\n                window.map = new google.maps.Map(document.getElementById('map-canvas'), {\n                    center: latLng_Cali,\n                    zoom: 12\n                });\n            }\n\n            //Se prepara la informacion de las coordenadas\n\n            var puntosMapa = [], cohortes = [];\n            var latitud, longitud;\n\n            for (var x in data){\n                latitud = Number(data[x].latitude);\n                longitud = Number(data[x].longitude);\n                puntosMapa.push(new google.maps.LatLng(latitud,longitud));\n                cohortes.push(data[x].cohorte);\n            };\n\n            //Se asignan los atributos pertenecientes al mapa\n\n            window.puntosMapa = puntosMapa;\n            window.cohortes = cohortes;\n\n            mapaCalor(puntosMapa);\n            marcadoresMapa(puntosMapa);\n\n        };\n\n\n        /**\n         * Funcion mapaCalor\n         *\n         * Funcion que se encarga de superponer el mapa de calor sobre el mapa existente\n         *\n         */\n\n        function mapaCalor(){\n\n            if(window.heatmap){\n                window.heatmap.setMap(null);\n            }\n\n            if($(\"#heat_map\").is(\":checked\")){\n\n                window.heatmap = new google.maps.visualization.HeatmapLayer({\n                    data: window.puntosMapa,\n                    map: map,\n                    opacity: 1,\n                    maxIntensity: 10\n                });\n            }\n\n        };\n\n        /**\n         * Funcion marcadoresMapa\n         *\n         * Funcion que se encarga de dibujar los marcadores en el mapa existente segun las coordenadas\n         */\n\n\n        function marcadoresMapa(){\n\n            if (window.markers){\n                for (var x in window.markers){\n                    window.markers[x].setMap(null);\n                }\n            }\n\n            if($(\"#markers_map\").is(\":checked\")) {\n\n                window.markers = [];\n                var icon, color;\n\n                for (var x in window.puntosMapa) {\n\n                    switch (window.cohortes[x]) {\n\n                        case 'SPP':\n                            color = 'blue';\n                            break;\n                        case 'SPE':\n                            color = 'green';\n                            break;\n                        case 'SPT':\n                            color = 'red';\n                            break;\n                        case '3740':\n                            color = 'purple';\n                            break;\n                        case 'Otros':\n                            color = 'orange';\n                            break;\n                    };\n\n\n                    icon = {\n                        url: \"https://raw.githubusercontent.com/Concept211/Google-Maps-Markers/master/images/marker_\"+ color +\".png\", // url\n                        scaledSize: new google.maps.Size(11, 20) // scaled size\n                    };\n\n                    window.markers.push(new google.maps.Marker({\n                        position: window.puntosMapa[x],\n                        map: map,\n                        icon: icon,\n                        title: window.cohortes[x]\n                    }));\n                }\n            }\n\n        };\n\n        /**\n         * Funcion getIdInstancia\n         *\n         * Funcion que retorna la instancia actual\n         * @returns {*}\n         */\n\n        function getIdinstancia() {\n            var urlParameters = location.search.split('&');\n\n            for (x in urlParameters) {\n                if (urlParameters[x].indexOf('instanceid') >= 0) {\n                    var intanceparameter = urlParameters[x].split('=');\n                    return intanceparameter[1];\n                }\n            }\n            return 0;\n        };\n    });\n"],"file":"ases_geographic_reports.min.js"}