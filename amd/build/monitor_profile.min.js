define(["jquery","block_ases/select2","block_ases/bootstrap","block_ases/sweetalert","block_ases/mustache","block_ases/mon_trackings"],function(e,o,n,a,t,r){return{init:function(o){e("#select-monitores").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando..."}}});e("#select-monitores").on("change",function(){!function(o){e.ajax({type:"POST",data:JSON.stringify({function:"is_monitor_ps",params:[o]}),url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",success:function(e){var n=e;if(0===n.status_code){var a=c(document.location.search),t=String(document.location),r=t.split("?"),i=r[0]+"?courseid="+a.courseid+"&instanceid="+a.instanceid+"&monitor_code="+o;location.href=i}else swal("Error","No se encuentra un monitor ASES asociado al código ingresado","error")},error:function(e){console.log(e),swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(e("#select-monitores").val().split(" ")[0])}),e("#trackings_li").one("click",{tab_name:"trackings"},i),e("#boss_history_li").one("click",{tab_name:"history_boss"},i),this.editProfile(this)},editProfile:function(o){var n=e("#ficha_monitor").serializeArray();e("#span-icon-edit").on("click",function(){e(this).hide(),e("#span-icon-save").show(),e("#span-icon-cancel").show(),e("#input_num_doc").prop("readonly",!1),e("#input_email").prop("readonly",!1),e("#input_phone1").prop("readonly",!1),e("#input_phone2").prop("readonly",!1),e("#input_acuerdo").prop("readonly",!1),e("#link_acuerdo").removeAttr("href"),e("#input_d10").prop("readonly",!1),e("#link_d10").removeAttr("href"),e("#input_doc").prop("readonly",!1),e("#link_doc").removeAttr("href"),e("#input_banco").prop("readonly",!1),e("#link_banco").attr("href","")}),e("#span-icon-save").on("click",function(){var a=e("#ficha_monitor").serializeArray(),t=o.validateForm(a);if("error"==t.status)swal(t.title,t.msg,t.status);else{let e=[];a.slice(1,11).forEach((o,a)=>{o.value!=n.slice(1,11)[a].value&&e.push(o)}),e.push(a[0]),o.saveForm(e)}}),e("#span-icon-cancel").on("click",{form:n},function(e){swal({title:"¿Desea cancelar la edición?",text:"Los cambios no guardados se perderán",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Sí",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(n){n&&(o.cancelEdition(),o.revertChanges(e.data.form))})})},validateForm:function(e){for(n in e){var o=new Object,n=e[n];switch(o.title="Éxito",o.msg="El formulario fue validado con éxito",o.status="success",n.name){case"email":let e=/((?:[a-z]+\.)*[a-z]+(?:@correounivalle\.edu\.co))/.exec(n.value);if(null===e)return o.title="Error",o.status="error",o.msg=`El campo ${n.name} no cumple con el formato institucional.`,o;console.log(e);break;case"num_doc":(isNaN(n.name)||isNaN(parseFloat(n.name)))&&(o.title="Error",o.status="error",o.msg=`El campo ${n.name} no es válido.`);break;case"pdf_acuerdo_conf":case"pdf_doc":case"pdf_d10":case"pdf_cuenta_banco":null==/^(http|https):\/\//.exec(n.value)&&(o.title="Error",o.status="error",o.msg=`El campo ${n.name} no es un enlace válido. Recuerde incluir https://.`)}}return o},cancelEdition:function(){e("#span-icon-edit").show(),e("#span-icon-save").hide(),e("#span-icon-cancel").hide(),e("#input_num_doc").prop("readonly",!0),e("#input_email").prop("readonly",!0),e("#input_phone1").prop("readonly",!0),e("#input_phone2").prop("readonly",!0),e("#input_acuerdo").prop("readonly",!0),e("#input_d10").prop("readonly",!0),e("#input_doc").prop("readonly",!0),e("#input_banco").prop("readonly",!0)},revertChanges:function(o){o.forEach(o=>e("[name="+o.name+"]").val(o.value)),e("#link_acuerdo").attr("href",e("#input_acuerdo")[0].value),e("#link_banco").attr("href",e("#input_banco")[0].value),e("#link_d10").attr("href",e("#input_d10")[0].value),e("#link_doc").attr("href",e("#input_doc")[0].value),location.reload(!0)},saveForm:function(o){e("#span-icon-cancel").hide(),e.ajax({type:"POST",data:JSON.stringify({function:"save_profile",params:[o]}),url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",error:function(e){swal(e.title,e.msg,e.type)},success:()=>{swal("Éxito","Información guardada con éxito.","success")}})}};function i(o){var n=o.data.tab_name,a=c(document.location.search),i=e("#id_moodle")[0].value;e.ajax({type:"POST",url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",data:JSON.stringify({function:"load_tabs",params:[i,a.instanceid,n]}),success:function(o){0==o.status_code?e.ajax({url:"../templates/monitor_view_"+n+"_tab.mustache",data:null,dataType:"text",success:function(c){let s=e(t.render(c,o.data_response));switch(e(".tab-content").append(s),e("#general_tab").removeClass("active"),e("#"+n+"_tab").addClass("active"),n){case"trackings":r.init([i,a.instanceid])}},error:function(){console.log(`../templates/monitor_view_${n}_tab.mustache cannot be reached.`)}}):console.log("error:",o)},error:function(e){console.log(e)}})}function c(e){for(var o=[],n=document.location.search.substring(1).split("&"),a=0;a<n.length;a++){var t=n[a].split("=");o[t[0]]=t[1]}return o}});