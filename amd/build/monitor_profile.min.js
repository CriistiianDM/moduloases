define(["jquery","block_ases/select2","block_ases/bootstrap","block_ases/sweetalert","block_ases/mustache","block_ases/history_boss"],function(o,e,n,a,t,r){return{init:function(e){o("#select-monitores").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando..."}}});o("#select-monitores").on("change",function(){!function(e){o.ajax({type:"POST",data:JSON.stringify({function:"is_monitor_ps",params:[e]}),url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",success:function(o){var n=o;if(0===n.status_code){var a=c(document.location.search),t=String(document.location),r=t.split("?"),i=r[0]+"?courseid="+a.courseid+"&instanceid="+a.instanceid+"&monitor_code="+e;location.href=i}else swal("Error","No se encuentra un monitor ASES asociado al código ingresado","error")},error:function(o){console.log(o),swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(o("#select-monitores").val().split(" ")[0])}),o("#trackings_li").one("click",{tab_name:"trackings"},i),o("#boss_history_li").one("click",{tab_name:"history_boss"},i),o('[data-toggle="tooltip"]').tooltip({container:"body"}),this.editProfile(this)},editProfile:function(e){var n=o("#ficha_monitor").serializeArray();o("#span-icon-edit").on("click",function(){o(this).hide(),o("#span-icon-save").show(),o("#span-icon-cancel").show(),o("#input_num_doc").prop("readonly",!1),o("#input_email").prop("readonly",!1),o("#input_phone1").prop("readonly",!1),o("#input_phone2").prop("readonly",!1),o("#input_acuerdo").prop("readonly",!1),o("#link_acuerdo").removeAttr("href"),o("#input_d10").prop("readonly",!1),o("#link_d10").removeAttr("href"),o("#input_doc").prop("readonly",!1),o("#link_doc").removeAttr("href"),o("#input_banco").prop("readonly",!1),o("#link_banco").attr("href","")}),o("#span-icon-save").on("click",function(){var a=o("#ficha_monitor").serializeArray(),t=e.validateForm(a);if("error"==t.status)swal(t.title,t.msg,t.status);else{let o=[];a.slice(1,11).forEach((e,a)=>{e.value!=n.slice(1,11)[a].value&&o.push(e)}),o.push(a[0]),e.saveForm(o)}}),o("#span-icon-cancel").on("click",{form:n},function(o){swal({title:"¿Desea cancelar la edición?",text:"Los cambios no guardados se perderán",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Sí",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(n){n&&(e.cancelEdition(),e.revertChanges(o.data.form))})})},validateForm:function(o){for(n in o){var e=new Object,n=o[n];switch(e.title="Éxito",e.msg="El formulario fue validado con éxito",e.status="success",n.name){case"email":let o=/((?:[a-z]+\.)*[a-z]+(?:@correounivalle\.edu\.co))/.exec(n.value);if(null===o)return e.title="Error",e.status="error",e.msg=`El campo ${n.name} no cumple con el formato institucional.`,e;console.log(o);break;case"num_doc":(isNaN(n.name)||isNaN(parseFloat(n.name)))&&(e.title="Error",e.status="error",e.msg=`El campo ${n.name} no es válido.`);break;case"pdf_acuerdo_conf":case"pdf_doc":case"pdf_d10":case"pdf_cuenta_banco":null==/^(http|https):\/\//.exec(n.value)&&(e.title="Error",e.status="error",e.msg=`El campo ${n.name} no es un enlace válido. Recuerde incluir https://.`)}}return e},cancelEdition:function(){o("#span-icon-edit").show(),o("#span-icon-save").hide(),o("#span-icon-cancel").hide(),o("#input_num_doc").prop("readonly",!0),o("#input_email").prop("readonly",!0),o("#input_phone1").prop("readonly",!0),o("#input_phone2").prop("readonly",!0),o("#input_acuerdo").prop("readonly",!0),o("#input_d10").prop("readonly",!0),o("#input_doc").prop("readonly",!0),o("#input_banco").prop("readonly",!0)},revertChanges:function(e){e.forEach(e=>o("[name="+e.name+"]").val(e.value)),o("#link_acuerdo").attr("href",o("#input_acuerdo")[0].value),o("#link_banco").attr("href",o("#input_banco")[0].value),o("#link_d10").attr("href",o("#input_d10")[0].value),o("#link_doc").attr("href",o("#input_doc")[0].value),location.reload(!0)},saveForm:function(e){o("#span-icon-cancel").hide(),o.ajax({type:"POST",data:JSON.stringify({function:"save_profile",params:[e]}),url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",error:function(o){swal(o.title,o.msg,o.type)},success:()=>{swal("Éxito","Información guardada con éxito.","success")}})}};function i(e){var n=e.data.tab_name,a=c(document.location.search),r=o("#id_moodle")[0].value;o.ajax({type:"POST",url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",data:JSON.stringify({function:"load_tabs",params:[r,a.instanceid,n]}),success:function(e){0==e.status_code?o.ajax({url:"../templates/monitor_view_"+n+"_tab.mustache",data:null,dataType:"text",success:function(a){let r=o(t.render(a,e.data_response));console.log(r),o(".tab-content").append(r),o("#general_tab").removeClass("active"),o("#"+n+"_tab").addClass("active")},error:function(){console.log(`../templates/monitor_view_${n}_tab.mustache cannot be reached.`)}}):console.log("error:",e)},error:function(o){console.log(o)}})}function c(o){for(var e=[],n=document.location.search.substring(1).split("&"),a=0;a<n.length;a++){var t=n[a].split("=");e[t[0]]=t[1]}return e}});