define ("block_ases/monitor_profile",["jquery","block_ases/select2","block_ases/bootstrap","block_ases/sweetalert","block_ases/mustache","block_ases/mon_trackings","block_ases/aaspect"],function(a,b,c,d,e,f){return{init:function init(){a("#select-monitores").select2({language:{noResults:function noResults(){return"No hay resultado"},searching:function searching(){return"Buscando..."}}});var b=this;a("#select-monitores").on("change",function(){var b=a("#select-monitores").val(),c=b.split(" ")[0];g(c)});var c=i(document.location.search),d=a("#id_moodle")[0].value;a("#boss_history_li").one("click",{tab_name:"history_boss"},h);a("#trackings_li").one("click",f.init([d,c.instanceid]));a("[data-toggle=\"tooltip\"]").tooltip();this.editProfile(b)},editProfile:function editProfile(b){var c=a("#ficha_monitor").serializeArray();a("#span-icon-edit").on("click",function(){a(this).hide();a("#span-icon-save").show();a("#span-icon-cancel").show();a("#input_num_doc").prop("readonly",!1);a("#input_email").prop("readonly",!1);a("#input_phone1").prop("readonly",!1);a("#input_phone2").prop("readonly",!1);a("#input_acuerdo").prop("readonly",!1);a("#link_acuerdo").removeAttr("href");a("#input_d10").prop("readonly",!1);a("#link_d10").removeAttr("href");a("#input_doc").prop("readonly",!1);a("#link_doc").removeAttr("href");a("#input_banco").prop("readonly",!1);a("#link_banco").attr("href","")});a("#span-icon-save").on("click",function(){var d=a("#ficha_monitor").serializeArray(),e=b.validateForm(d);if("error"==e.status){swal(e.title,e.msg,e.status)}else{var f=[];d.slice(1,11).forEach(function(a,b){if(a.value!=c.slice(1,11)[b].value){f.push(a)}});f.push(d[0]);b.saveForm(f,b,e)}});a("#span-icon-cancel").on("click",{form:c},function(a){swal({title:"\xBFDesea cancelar la edici\xF3n?",text:"Los cambios no guardados se perder\xE1n",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"S\xED",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(c){if(c){b.cancelEdition();b.revertChanges(a.data.form)}})})},validateForm:function validateForm(a){for(c in a){var b={},c=a[c];b.title="\xC9xito";b.msg="El formulario fue validado con \xE9xito";b.status="success";switch(c.name){case"email_alternativo":var d=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/,e=d.exec(c.value);if(null!==e){console.log("email valido: ",e)}else{console.log("error");b.title="Error";b.status="error";b.msg="El campo ".concat(c.name," no tiene formato v\xE1lido.");return b}break;case"num_doc":if(isNaN(c.name)||isNaN(parseFloat(c.name))){b.title="Error";b.status="error";b.msg="El campo ".concat(c.name," no es v\xE1lido.")}break;case"pdf_acuerdo_conf":case"pdf_doc":case"pdf_d10":case"pdf_cuenta_banco":var f=/^(http|https):\/\//,g=f.exec(c.value);if(null==g){b.title="Error";b.status="error";b.msg="El campo ".concat(c.name," no es un enlace v\xE1lido. Recuerde incluir https://.")}break;}}return b},cancelEdition:function cancelEdition(){a("#span-icon-edit").show();a("#span-icon-save").hide();a("#span-icon-cancel").hide();a("#input_num_doc").prop("readonly",!0);a("#input_email").prop("readonly",!0);a("#input_phone1").prop("readonly",!0);a("#input_phone2").prop("readonly",!0);a("#input_acuerdo").prop("readonly",!0);a("#input_d10").prop("readonly",!0);a("#input_doc").prop("readonly",!0);a("#input_banco").prop("readonly",!0);a("#link_acuerdo").attr("href",a("#input_acuerdo")[0].value);a("#link_banco").attr("href",a("#input_banco")[0].value);a("#link_d10").attr("href",a("#input_d10")[0].value);a("#link_doc").attr("href",a("#input_doc")[0].value)},revertChanges:function revertChanges(b){b.forEach(function(b){return a("[name="+b.name+"]").val(b.value)});a("#link_acuerdo").attr("href",a("#input_acuerdo")[0].value);a("#link_banco").attr("href",a("#input_banco")[0].value);a("#link_d10").attr("href",a("#input_d10")[0].value);a("#link_doc").attr("href",a("#input_doc")[0].value);location.reload(!0)},saveForm:function saveForm(b,c,d){a("#span-icon-cancel").hide();a.ajax({type:"POST",data:JSON.stringify({function:"save_profile",params:[b]}),url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",error:function error(a){swal(a.title,a.msg,a.type)},success:function success(a){swal(d.title,a.message,"success")}});c.cancelEdition()}};function g(b){a.ajax({type:"POST",data:JSON.stringify({function:"is_monitor_ps",params:[b]}),url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",success:function success(a){if(0===a.status_code){var c=i(document.location.search),d=document.location+"",e=d.split("?"),f=e[0]+"?courseid="+c.courseid+"&instanceid="+c.instanceid+"&monitor_code="+b;location.href=f}else{swal("Error","No se encuentra un monitor ASES asociado al c\xF3digo ingresado","error")}},error:function error(a){console.log(a);swal("Error","Error al comunicarse con el servidor, por favor int\xE9ntelo nuevamente.","error")}})}function h(b){var c=b.data.tab_name,d=i(document.location.search),f=a("#id_moodle")[0].value;a.ajax({type:"POST",url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",data:JSON.stringify({function:"load_tabs",params:[f,d.instanceid,c]}),success:function success(b){if(0==b.status_code){a.ajax({url:"../templates/monitor_view_"+c+"_tab.mustache",data:null,dataType:"text",success:function success(d){var f=a(e.render(d,b.data_response));a(".ases-tab-content").append(f);console.log(c);switch(c){case"history_boss":a("#general_tab").removeClass("ases-tab-active");a("#"+c+"_tab").addClass("ases-tab-active");break;}},error:function error(){console.log("../templates/monitor_view_".concat(c,"_tab.mustache cannot be reached."))}})}else{console.log("error:",b)}},error:function error(a){console.log(a)}})}function i(){for(var a=[],b=document.location.search.substring(1),c=b.split("&"),d=0,e;d<c.length;d++){e=c[d].split("=");a[e[0]]=e[1]}return a}});
//# sourceMappingURL=monitor_profile.min.js.map
