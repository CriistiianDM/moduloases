define(["jquery","block_ases/select2","block_ases/bootstrap","block_ases/sweetalert","block_ases/mustache","block_ases/mon_trackings","block_ases/aaspect"],function(e,o,a,n,t,r,i){return{init:function(o){e("#select-monitores").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando..."}}});e("#select-monitores").on("change",function(){!function(o){e.ajax({type:"POST",data:JSON.stringify({function:"is_monitor_ps",params:[o]}),url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",success:function(e){var a=e;if(0===a.status_code){var n=s(document.location.search),t=String(document.location),r=t.split("?"),i=r[0]+"?courseid="+n.courseid+"&instanceid="+n.instanceid+"&monitor_code="+o;location.href=i}else swal("Error","No se encuentra un monitor ASES asociado al código ingresado","error")},error:function(e){console.log(e),swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(e("#select-monitores").val().split(" ")[0])});s(document.location.search),e("#id_moodle")[0].value;e("#boss_history_li").one("click",{tab_name:"history_boss"},c),e('[data-toggle="tooltip"]').tooltip(),this.editProfile(this)},editProfile:function(o){var a=e("#ficha_monitor").serializeArray();e("#span-icon-edit").on("click",function(){e(this).hide(),e("#span-icon-save").show(),e("#span-icon-cancel").show(),e("#input_num_doc").prop("readonly",!1),e("#input_email").prop("readonly",!1),e("#input_phone1").prop("readonly",!1),e("#input_phone2").prop("readonly",!1),e("#input_acuerdo").prop("readonly",!1),e("#link_acuerdo").removeAttr("href"),e("#input_d10").prop("readonly",!1),e("#link_d10").removeAttr("href"),e("#input_doc").prop("readonly",!1),e("#link_doc").removeAttr("href"),e("#input_banco").prop("readonly",!1),e("#link_banco").attr("href","")}),e("#span-icon-save").on("click",function(){var n=e("#ficha_monitor").serializeArray(),t=o.validateForm(n);if("error"==t.status)swal(t.title,t.msg,t.status);else{let e=[];n.slice(1,11).forEach((o,n)=>{o.value!=a.slice(1,11)[n].value&&e.push(o)}),e.push(n[0]),o.saveForm(e,o,t)}}),e("#span-icon-cancel").on("click",{form:a},function(e){swal({title:"¿Desea cancelar la edición?",text:"Los cambios no guardados se perderán",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Sí",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(a){a&&(o.cancelEdition(),o.revertChanges(e.data.form))})})},validateForm:function(e){for(a in e){var o=new Object,a=e[a];switch(o.title="Éxito",o.msg="El formulario fue validado con éxito",o.status="success",a.name){case"email_alternativo":let e=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.exec(a.value);if(null===e)return console.log("error"),o.title="Error",o.status="error",o.msg=`El campo ${a.name} no tiene formato válido.`,o;console.log("email valido: ",e);break;case"num_doc":(isNaN(a.name)||isNaN(parseFloat(a.name)))&&(o.title="Error",o.status="error",o.msg=`El campo ${a.name} no es válido.`);break;case"pdf_acuerdo_conf":case"pdf_doc":case"pdf_d10":case"pdf_cuenta_banco":null==/^(http|https):\/\//.exec(a.value)&&(o.title="Error",o.status="error",o.msg=`El campo ${a.name} no es un enlace válido. Recuerde incluir https://.`)}}return o},cancelEdition:function(){e("#span-icon-edit").show(),e("#span-icon-save").hide(),e("#span-icon-cancel").hide(),e("#input_num_doc").prop("readonly",!0),e("#input_email").prop("readonly",!0),e("#input_phone1").prop("readonly",!0),e("#input_phone2").prop("readonly",!0),e("#input_acuerdo").prop("readonly",!0),e("#input_d10").prop("readonly",!0),e("#input_doc").prop("readonly",!0),e("#input_banco").prop("readonly",!0),e("#link_acuerdo").attr("href",e("#input_acuerdo")[0].value),e("#link_banco").attr("href",e("#input_banco")[0].value),e("#link_d10").attr("href",e("#input_d10")[0].value),e("#link_doc").attr("href",e("#input_doc")[0].value)},revertChanges:function(o){o.forEach(o=>e("[name="+o.name+"]").val(o.value)),e("#link_acuerdo").attr("href",e("#input_acuerdo")[0].value),e("#link_banco").attr("href",e("#input_banco")[0].value),e("#link_d10").attr("href",e("#input_d10")[0].value),e("#link_doc").attr("href",e("#input_doc")[0].value),location.reload(!0)},saveForm:function(o,a,n){e("#span-icon-cancel").hide(),e.ajax({type:"POST",data:JSON.stringify({function:"save_profile",params:[o]}),url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",error:function(e){swal(e.title,e.msg,e.type)},success:function(e){swal(n.title,e.message,"success")}}),a.cancelEdition()}};function c(o){var a=o.data.tab_name,n=s(document.location.search),i=e("#id_moodle")[0].value;e.ajax({type:"POST",url:"../managers/monitor_profile/monitor_profile_api.php",dataType:"json",cache:"false",data:JSON.stringify({function:"load_tabs",params:[i,n.instanceid,a]}),success:function(o){0==o.status_code?e.ajax({url:"../templates/monitor_view_"+a+"_tab.mustache",data:null,dataType:"text",success:function(c){let s=e(t.render(c,o.data_response));switch(e(".ases-tab-content").append(s),console.log(a),a){case"history_boss":e("#general_tab").removeClass("ases-tab-active"),e("#"+a+"_tab").addClass("ases-tab-active"),r.init([i,n.instanceid])}},error:function(){console.log(`../templates/monitor_view_${a}_tab.mustache cannot be reached.`)}}):console.log("error:",o)},error:function(e){console.log(e)}})}function s(e){for(var o=[],a=document.location.search.substring(1).split("&"),n=0;n<a.length;n++){var t=a[n].split("=");o[t[0]]=t[1]}return o}});