'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a){return{init:function init(){function f(j,k){for(var l=0;l<j.length;l++)if(j[l]==k)return!0;return!1}function g(j){var k,l,m,n,o,p;return(p=j.data||null,null==p||!p.length)?null:(n=j.columnDelimiter||',',o=j.lineDelimiter||'\n',m=Object.keys(p[0]),k='',k+=m.join(n),k+=o,p.forEach(function(q){l=0,m.forEach(function(r){0<l&&(k+=n),k+='"'+q[r].respuesra+'"',l++}),k+=o}),k)}function h(j){var k,l,m,n=g({data:j});null==n||(l='export.csv',!n.match(/^data:text\/csv/i)&&(n='data:text/csv;charset=utf-8,'+n),k=encodeURI(n),m=document.createElement('a'),m.setAttribute('href',k),m.setAttribute('download',l),m.click())}a('#btn-generar-reporte').click(function(){var j=a('#start_date').val(),k=a('#end_date').val();j>=k?swal({title:'Informaci\xF3n',text:'Intervalo de fechas inv\xE1lido',type:'warning'},function(){}):(a('#progress_group').css('display','block'),a('#progress').text('Espere, puede tardar un par de minutos ...'),a.get('../managers/dphpforms/dphpforms_reverse_filter.php?id_pregunta=seguimiento_pares_fecha&cast=date&criterio={"criteria":[{"operator":">=","value":"'+j+'"},{"operator":"<=","value":"'+k+'"}]}',function(l){var m=Object.keys(l.results).length;console.log(m);var o=[],p=0,q=[];a.each(l.results,function(){a.get('../managers/dphpforms/dphpforms_reverse_finder.php?respuesta_id='+this.id,function(r){a.get('../managers/dphpforms/dphpforms_get_record.php?record_id='+r.result.id_registro,function(s){var t=[];console.log(s.record.campos);for(var u=0;u<Object.keys(s.record.campos).length;u++)t[parseInt(s.record.campos[u].id_pregunta)]={enunciado:s.record.campos[u].enunciado,respuesra:s.record.campos[u].respuesta},o.push(t),f(q,parseInt(s.record.campos[u].id_pregunta))||q.push(parseInt(s.record.campos[u].id_pregunta));p++,a('#progress').text((100/m*p).toFixed(2)+'%'),console.log('Procesado'),console.log(t),console.log(q),console.log(p+' === '+m),p==m&&(console.log('CSV!!!!!!!!'),h(o))})}),a('#progress').text(Math.round(p))}),0==m&&a('#progress').text(100)}))})}}});