'use strict';define(['jquery','core/config','block_ases/loading_indicator','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2','block_ases/jquery.dataTables'],function(a,b,c){var n=function(){return b.wwwroot+'/blocks/ases/managers/monitor_assignments/monitor_assignments_api.php'},o=function(s,t){var v=JSON.stringify({function:'get_monitor_practicing_and_students_report',params:{instance_id:s,semester_name:t}});return a.ajax({url:n(),contentType:'application/csv',method:'POST',data:v})},p=function(){return a('#monitor_assignments_instance_id').data('instance-id')},q=function(){return a('#monitor_assignments_instance_id').data('semester-name')},r=function(s,t){c.show(),o(s,t).then(function(u){var w=encodeURI('data:text/csv;charset=utf-8,'+u),x=document.createElement('a');x.setAttribute('href',w),x.setAttribute('download','asignaciones_monitor_con_practicantes.csv'),document.body.appendChild(x),x.click(),c.hide()}).catch(function(u){c.hide(),console.log(u)})};return{init:function init(){function s(u,v){a('#student_assigned').addClass('items_assigned_empty'),a('#student_assigned').html('Consultando <span>.</span><span>.</span><span>.</span>'),a('.student_item').removeClass('oculto-asignado'),a('#student_column').animate({scrollTop:a('#student_column').scrollTop()+a('#student_assigned').position().top},0),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'get_monitors_students_relationship_by_instance',params:[u]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(w){if(0==w.status_code){var x=w.data_response;a('.monitor_item').removeClass('active'),a('.monitor_item[data-id=\''+v+'\']').addClass('active'),a('.student_item').find('.add').removeClass('oculto-asignar'),a('.student_item').removeClass('assigned'),a('.student_item').removeClass('not-assigned'),a('.student_item').addClass('not-assigned'),a('#student_assigned').removeClass('items_assigned_empty'),a('#student_assigned').text('');for(var y=!1,z=0;z<x.length;z++)x[z].id_monitor==v?(y||(y=!0,a('#student_assigned').removeClass('items_assigned_empty')),a('.student_item[data-id=\''+x[z].id_estudiante+'\']').removeClass('not-assigned'),a('.student_item[data-id=\''+x[z].id_estudiante+'\']').addClass('assigned'),a('.student_item[data-id=\''+x[z].id_estudiante+'\']').find('.add').addClass('oculto-asignar'),a('.student_item[data-id=\''+x[z].id_estudiante+'\']').clone().appendTo('#student_assigned'),a('.student_item[data-id=\''+x[z].id_estudiante+'\']').not('#student_assigned .student_item').addClass('oculto-asignado')):(a('.student_item[data-id=\''+x[z].id_estudiante+'\']').find('.add').addClass('oculto-asignar'),a('.student_item[data-id=\''+x[z].id_estudiante+'\']').find('.delete').addClass('oculto-eliminar'),a('.student_item[data-id=\''+x[z].id_estudiante+'\']').addClass('oculto-asignado'));a('#student_assigned').find('.student_item').find('.add').addClass('oculto-asignar'),a('#student_assigned').find('.student_item').find('.delete').removeClass('oculto-eliminar'),y||(a('#student_assigned').addClass('items_assigned_empty'),a('#student_assigned').text('No tiene estudiantes asignados.'))}else console.log(w)},failure:function failure(w){console.log(w)}})}function t(u,v){a('#monitor_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').html('Consultando <span>.</span><span>.</span><span>.</span>'),a('.monitor_item').removeClass('oculto-asignado'),a('#monitor_column').animate({scrollTop:a('#monitor_column').scrollTop()+a('#monitor_assigned').position().top},0),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'get_practicant_monitor_relationship_by_instance',params:[u]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(w){if(0==w.status_code){var x=w.data_response;a('.practicant_item').removeClass('active'),a('.practicant_item[data-id=\''+v+'\']').addClass('active'),a('.monitor_item').find('.add').removeClass('oculto-asignar'),a('.monitor_item').find('.transfer').removeClass('oculto-tranferir'),a('.monitor_item').removeClass('assigned'),a('.monitor_item').removeClass('not-assigned'),a('.monitor_item').addClass('not-assigned'),a('.student_item').removeClass('assigned'),a('.student_item').removeClass('not-assigned'),a('.student_item').addClass('not-assigned'),a('#student_assigned').text('No ha seleccionado un monitor.'),a('#student_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').text('');for(var y=!1,z=0;z<x.length;z++)x[z].id_practicante==v?(y||(y=!0,a('#monitor_assigned').removeClass('items_assigned_empty')),a('.monitor_item[data-id=\''+x[z].id_monitor+'\']').removeClass('not-assigned'),a('.monitor_item[data-id=\''+x[z].id_monitor+'\']').addClass('assigned'),a('.monitor_item[data-id=\''+x[z].id_monitor+'\']').find('.add').addClass('oculto-asignar'),a('.monitor_item[data-id=\''+x[z].id_monitor+'\']').clone().appendTo('#monitor_assigned'),a('.monitor_item[data-id=\''+x[z].id_monitor+'\']').not('#monitor_assigned .monitor_item').addClass('oculto-asignado')):(a('.monitor_item[data-id=\''+x[z].id_monitor+'\']').find('.add').addClass('oculto-asignar'),a('.monitor_item[data-id=\''+x[z].id_monitor+'\']').find('.delete').addClass('oculto-eliminar'),a('.monitor_item[data-id=\''+x[z].id_monitor+'\']').addClass('oculto-asignado'));a('#monitor_assigned').find('.monitor_item').find('.add').addClass('oculto-asignar'),a('#monitor_assigned').find('.monitor_item').find('.delete').removeClass('oculto-eliminar'),a('.monitor_item').not('#monitor_assigned .monitor_item').find('.transfer').addClass('oculto-tranferir'),y||(a('#monitor_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').text('No tiene monitores asignados.'))}else console.log(w)},failure:function failure(w){console.log(w)}})}a('#button-get-complete-report').click(function(){r(p(),q())});a('#student-name-filter').keyup(function(){a('.student_item').removeClass('oculto-filtro-nombre');var u=a(this).val();''==u?a(this).removeClass('filter-active'):(/\d/.test(u)?a('.student_item').not('.item-general-list.student_item[data-username*="'+u.toUpperCase()+'"]').addClass('oculto-filtro-nombre'):a('.student_item').not('.item-general-list.student_item[data-name*="'+u.toUpperCase()+'"]').addClass('oculto-filtro-nombre'),a(this).addClass('filter-active'))}),a('#monitor-name-filter').keyup(function(){a('.monitor_item').removeClass('oculto-filtro-nombre');var u=a(this).val();''==u?a(this).removeClass('filter-active'):(/\d/.test(u)?a('.monitor_item').not('.item-general-list.monitor_item[data-username*="'+u.toUpperCase()+'"]').addClass('oculto-filtro-nombre'):a('.monitor_item').not('.item-general-list.monitor_item[data-name*="'+u.toUpperCase()+'"]').addClass('oculto-filtro-nombre'),a(this).addClass('filter-active'))}),a('#btn-student-name-filter').click(function(){a('#student-name-filter').val(''),a('.student_item').removeClass('oculto-filtro-nombre'),a('#student-name-filter').removeClass('filter-active')}),a('#btn-monitor-name-filter').click(function(){a('#monitor-name-filter').val(''),a('.monitor_item').removeClass('oculto-filtro-nombre'),a('#monitor-name-filter').removeClass('filter-active')}),a(document).ready(function(){a('select').trigger('change')}),a(document).on('click','.practicant_item',function(){t(a('#monitor_assignments_instance_id').data('instance-id'),a(this).attr('data-id'))}),a(document).on('click','.monitor_item',function(){s(a('#monitor_assignments_instance_id').data('instance-id'),a(this).attr('data-id'))}),a(document).on('click','.student_item',function(){var u=a(this).attr('data-id');a('.student_item').removeClass('active'),a(this).addClass('active'),a('.student_item[data-id=\''+u+'\']').addClass('active')}),a(document).on('click','.add',function(u){u.stopImmediatePropagation();var v=a(this),w=a('#monitor_assignments_instance_id').data('instance-id'),x=a(this).parent(),y=-1,z=x.attr('data-id'),A=x.attr('data-item'),B='';'student'==A?(B='create_monitor_student_relationship',y=a('.monitor_item.active').attr('data-id')):'monitor'==A&&(B='create_practicant_monitor_relationship',y=a('.practicant_item.active').attr('data-id')),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':B,params:[w,y,z]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(C){0===C.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Asignaci\xF3n registrada correctamente.',type:'success'},function(){'student'==A?(s(w,y),x.find('.add').addClass('oculto-asignar')):'monitor'==A&&(t(w,y),x.find('.add').addClass('oculto-asignar'))})},0):-5===C.status_code?'student'==A?setTimeout(function(){swal({title:'Informaci\xF3n',text:'La asignaci\xF3n ya existe en el periodo actual, si tiene problemas con esto, puede probar de nuevo recargando la pesta\xF1a.',type:'info'},function(){})},0):'monitor'==A&&setTimeout(function(){swal({title:'Informaci\xF3n',text:'Este monitor ya se encuentra asignado.',type:'info'},function(){})},0):setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){})},0)},failure:function failure(C){console.log(C)}})}),a(document).on('click','.delete',function(u){u.stopImmediatePropagation();var v=a(this),w=a('#monitor_assignments_instance_id').data('instance-id'),x=a(this).parent(),y=-1,z=x.attr('data-id'),A=x.attr('data-item'),B='';'student'==A?(B='delete_monitor_student_relationship',y=a('.monitor_item.active').attr('data-id')):'monitor'==A&&(B='delete_practicant_monitor_relationship',y=a('.practicant_item.active').attr('data-id')),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':B,params:[w,y,z]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(C){0===C.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Asignaci\xF3n eliminada correctamente',type:'success'},function(){'student'==A?(s(w,y),x.find('.add').removeClass('oculto-asignar')):'monitor'==A&&(t(w,y),x.find('.add').addClass('oculto-asignar'))})},0):1===C.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Est\xE1 intentando eliminar una asignaci\xF3n que ya no existe, si tiene problemas con esto, puede probar de nuevo recargando la pesta\xF1a.',type:'info'},function(){})},0):(setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){})},0),console.log(C))},failure:function failure(C){console.log(C)}})}),a(document).on('click','.transfer',function(u){u.stopImmediatePropagation();var v=a(this).parent().data('name'),w=a(this).parent().data('id');a('#modalTransfer').modal('show'),a('#old_monitor_name').text(v);var x='<option value="" disabled selected>Seleccione un monitor</option>\n';a('#monitor_assigned > .monitor_item').each(function(){var y=a(this).data('name'),z=a(this).data('id');x+='<option data-old="'+w+'" data-new="'+z+'">'+y+'</option>\n'}),a('#transfer-monitor-list').html(''),a('#transfer-monitor-list').append(x)}),a(document).on('click','#btn-execute-transfer',function(){a('#modalTransfer').modal('hide');var v=a('#monitor_assignments_instance_id').data('instance-id'),x=a('#transfer-monitor-list').find(':selected').data('old'),y=a('#transfer-monitor-list').find(':selected').data('new');a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'transfer',params:[v,x,y]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(z){0===z.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Estudiantes transferidos correctamente.',type:'success'},function(){s(v,y)})},0):1===z.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'El monitor no tiene estudiantes para transferir.',type:'info'},function(){})},0):(setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){}),swal.close()},0),console.log(z))},failure:function failure(z){console.log(z)}})}),a('select').change(function(){var u=a(this).attr('data-id').split('_')[0],v=a(this).attr('data-id').split('_')[1];if('monitor'==u&&'faculty'==v){var w=a(this).find(':selected').attr('data-id-facultad');'-1'==w?(a(this).removeClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-facultad')):(a(this).addClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-facultad'),a('.item-general-list.monitor_item').not('.item-general-list.monitor_item[data-id-facultad=\''+w+'\']').addClass('oculto-facultad'))}else if('monitor'==u&&'program'==v){var x=a(this).find(':selected').attr('data-cod-programa');'-1'==x?(a(this).removeClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-programa')):(a(this).addClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-programa'),a('.item-general-list.monitor_item').not('.item-general-list.monitor_item[data-cod-programa=\''+x+'\']').addClass('oculto-programa'))}else if('student'==u&&'faculty'==v){var w=a(this).find(':selected').attr('data-id-facultad');'-1'==w?(a(this).removeClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-facultad')):(a(this).addClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-facultad'),a('.item-general-list.student_item').not('.item-general-list.student_item[data-id-facultad=\''+w+'\']').addClass('oculto-facultad'))}else if('student'==u&&'program'==v){var x=a(this).find(':selected').attr('data-cod-programa');'-1'==x?(a(this).removeClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-programa')):(a(this).addClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-programa'),a('.item-general-list.student_item').not('.item-general-list.student_item[data-cod-programa=\''+x+'\']').addClass('oculto-programa'))}else if('professional'==u){var y=a(this).find(':selected').attr('data-id');'-1'==y?(a(this).removeClass('filter-active'),a('.item-general-list.practicant_item').removeClass('oculto-jefe')):(a(this).addClass('filter-active'),a('.item-general-list.practicant_item').removeClass('oculto-jefe'),a('.item-general-list.practicant_item').not('.item-general-list.practicant_item[data-id-jefe=\''+y+'\']').addClass('oculto-jefe'))}})}}});