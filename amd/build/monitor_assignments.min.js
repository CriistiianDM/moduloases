'use strict';define(['jquery','core/config','block_ases/loading_indicator','block_ases/csv','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2','block_ases/jquery.dataTables'],function(a,b,c,d){var o=function(){return b.wwwroot+'/blocks/ases/managers/monitor_assignments/monitor_assignments_api.php'},p=function(t,u){var w=JSON.stringify({function:'get_monitor_practicing_and_students_report',params:{instance_id:t,semester_name:u}});return a.ajax({url:o(),contentType:'application/csv',method:'POST',data:w})},q=function(){return a('#monitor_assignments_instance_id').data('instance-id')},r=function(){return a('#monitor_assignments_instance_id').data('semester-name')},s=function(t,u){c.show(),p(t,u).then(function(v){d.csv_string_to_file_for_download(v,'asignaciones_monitor_con_practicantes.csv'),c.hide()}).catch(function(v){c.hide(),console.log(v)})};return{init:function init(){function t(v,w){a('#student_assigned').addClass('items_assigned_empty'),a('#student_assigned').html('Consultando <span>.</span><span>.</span><span>.</span>'),a('.student_item').removeClass('oculto-asignado'),a('#student_column').animate({scrollTop:a('#student_column').scrollTop()+a('#student_assigned').position().top},0),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'get_monitors_students_relationship_by_instance',params:[v]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(x){if(0==x.status_code){var y=x.data_response;a('.monitor_item').removeClass('active'),a('.monitor_item[data-id=\''+w+'\']').addClass('active'),a('.student_item').find('.add').removeClass('oculto-asignar'),a('.student_item').removeClass('assigned'),a('.student_item').removeClass('not-assigned'),a('.student_item').addClass('not-assigned'),a('#student_assigned').removeClass('items_assigned_empty'),a('#student_assigned').text('');for(var z=!1,A=0;A<y.length;A++)y[A].id_monitor==w?(z||(z=!0,a('#student_assigned').removeClass('items_assigned_empty')),a('.student_item[data-id=\''+y[A].id_estudiante+'\']').removeClass('not-assigned'),a('.student_item[data-id=\''+y[A].id_estudiante+'\']').addClass('assigned'),a('.student_item[data-id=\''+y[A].id_estudiante+'\']').find('.add').addClass('oculto-asignar'),a('.student_item[data-id=\''+y[A].id_estudiante+'\']').clone().appendTo('#student_assigned'),a('.student_item[data-id=\''+y[A].id_estudiante+'\']').not('#student_assigned .student_item').addClass('oculto-asignado')):(a('.student_item[data-id=\''+y[A].id_estudiante+'\']').find('.add').addClass('oculto-asignar'),a('.student_item[data-id=\''+y[A].id_estudiante+'\']').find('.delete').addClass('oculto-eliminar'),a('.student_item[data-id=\''+y[A].id_estudiante+'\']').addClass('oculto-asignado'));a('#student_assigned').find('.student_item').find('.add').addClass('oculto-asignar'),a('#student_assigned').find('.student_item').find('.delete').removeClass('oculto-eliminar'),z||(a('#student_assigned').addClass('items_assigned_empty'),a('#student_assigned').text('No tiene estudiantes asignados.'))}else console.log(x)},failure:function failure(x){console.log(x)}})}function u(v,w){a('#monitor_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').html('Consultando <span>.</span><span>.</span><span>.</span>'),a('.monitor_item').removeClass('oculto-asignado'),a('#monitor_column').animate({scrollTop:a('#monitor_column').scrollTop()+a('#monitor_assigned').position().top},0),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'get_practicant_monitor_relationship_by_instance',params:[v]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(x){if(0==x.status_code){var y=x.data_response;a('.practicant_item').removeClass('active'),a('.practicant_item[data-id=\''+w+'\']').addClass('active'),a('.monitor_item').find('.add').removeClass('oculto-asignar'),a('.monitor_item').find('.transfer').removeClass('oculto-tranferir'),a('.monitor_item').removeClass('assigned'),a('.monitor_item').removeClass('not-assigned'),a('.monitor_item').addClass('not-assigned'),a('.student_item').removeClass('assigned'),a('.student_item').removeClass('not-assigned'),a('.student_item').addClass('not-assigned'),a('#student_assigned').text('No ha seleccionado un monitor.'),a('#student_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').text('');for(var z=!1,A=0;A<y.length;A++)y[A].id_practicante==w?(z||(z=!0,a('#monitor_assigned').removeClass('items_assigned_empty')),a('.monitor_item[data-id=\''+y[A].id_monitor+'\']').removeClass('not-assigned'),a('.monitor_item[data-id=\''+y[A].id_monitor+'\']').addClass('assigned'),a('.monitor_item[data-id=\''+y[A].id_monitor+'\']').find('.add').addClass('oculto-asignar'),a('.monitor_item[data-id=\''+y[A].id_monitor+'\']').clone().appendTo('#monitor_assigned'),a('.monitor_item[data-id=\''+y[A].id_monitor+'\']').not('#monitor_assigned .monitor_item').addClass('oculto-asignado')):(a('.monitor_item[data-id=\''+y[A].id_monitor+'\']').find('.add').addClass('oculto-asignar'),a('.monitor_item[data-id=\''+y[A].id_monitor+'\']').find('.delete').addClass('oculto-eliminar'),a('.monitor_item[data-id=\''+y[A].id_monitor+'\']').addClass('oculto-asignado'));a('#monitor_assigned').find('.monitor_item').find('.add').addClass('oculto-asignar'),a('#monitor_assigned').find('.monitor_item').find('.delete').removeClass('oculto-eliminar'),a('.monitor_item').not('#monitor_assigned .monitor_item').find('.transfer').addClass('oculto-tranferir'),z||(a('#monitor_assigned').addClass('items_assigned_empty'),a('#monitor_assigned').text('No tiene monitores asignados.'))}else console.log(x)},failure:function failure(x){console.log(x)}})}a('#button-get-complete-report').click(function(){s(q(),r())});a('#student-name-filter').keyup(function(){a('.student_item').removeClass('oculto-filtro-nombre');var v=a(this).val();''==v?a(this).removeClass('filter-active'):(/\d/.test(v)?a('.student_item').not('.item-general-list.student_item[data-username*="'+v.toUpperCase()+'"]').addClass('oculto-filtro-nombre'):a('.student_item').not('.item-general-list.student_item[data-name*="'+v.toUpperCase()+'"]').addClass('oculto-filtro-nombre'),a(this).addClass('filter-active'))}),a('#monitor-name-filter').keyup(function(){a('.monitor_item').removeClass('oculto-filtro-nombre');var v=a(this).val();''==v?a(this).removeClass('filter-active'):(/\d/.test(v)?a('.monitor_item').not('.item-general-list.monitor_item[data-username*="'+v.toUpperCase()+'"]').addClass('oculto-filtro-nombre'):a('.monitor_item').not('.item-general-list.monitor_item[data-name*="'+v.toUpperCase()+'"]').addClass('oculto-filtro-nombre'),a(this).addClass('filter-active'))}),a('#btn-student-name-filter').click(function(){a('#student-name-filter').val(''),a('.student_item').removeClass('oculto-filtro-nombre'),a('#student-name-filter').removeClass('filter-active')}),a('#btn-monitor-name-filter').click(function(){a('#monitor-name-filter').val(''),a('.monitor_item').removeClass('oculto-filtro-nombre'),a('#monitor-name-filter').removeClass('filter-active')}),a(document).ready(function(){a('select').trigger('change')}),a(document).on('click','.practicant_item',function(){u(a('#monitor_assignments_instance_id').data('instance-id'),a(this).attr('data-id'))}),a(document).on('click','.monitor_item',function(){t(a('#monitor_assignments_instance_id').data('instance-id'),a(this).attr('data-id'))}),a(document).on('click','.student_item',function(){var v=a(this).attr('data-id');a('.student_item').removeClass('active'),a(this).addClass('active'),a('.student_item[data-id=\''+v+'\']').addClass('active')}),a(document).on('click','.add',function(v){v.stopImmediatePropagation();var w=a(this),x=a('#monitor_assignments_instance_id').data('instance-id'),y=a(this).parent(),z=-1,A=y.attr('data-id'),B=y.attr('data-item'),C='';'student'==B?(C='create_monitor_student_relationship',z=a('.monitor_item.active').attr('data-id')):'monitor'==B&&(C='create_practicant_monitor_relationship',z=a('.practicant_item.active').attr('data-id')),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':C,params:[x,z,A]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(D){0===D.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Asignaci\xF3n registrada correctamente.',type:'success'},function(){'student'==B?(t(x,z),y.find('.add').addClass('oculto-asignar')):'monitor'==B&&(u(x,z),y.find('.add').addClass('oculto-asignar'))})},0):-5===D.status_code?'student'==B?setTimeout(function(){swal({title:'Informaci\xF3n',text:'La asignaci\xF3n ya existe en el periodo actual, si tiene problemas con esto, puede probar de nuevo recargando la pesta\xF1a.',type:'info'},function(){})},0):'monitor'==B&&setTimeout(function(){swal({title:'Informaci\xF3n',text:'Este monitor ya se encuentra asignado.',type:'info'},function(){})},0):setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){})},0)},failure:function failure(D){console.log(D)}})}),a(document).on('click','.delete',function(v){v.stopImmediatePropagation();var w=a(this),x=a('#monitor_assignments_instance_id').data('instance-id'),y=a(this).parent(),z=-1,A=y.attr('data-id'),B=y.attr('data-item'),C='';'student'==B?(C='delete_monitor_student_relationship',z=a('.monitor_item.active').attr('data-id')):'monitor'==B&&(C='delete_practicant_monitor_relationship',z=a('.practicant_item.active').attr('data-id')),a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':C,params:[x,z,A]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(D){0===D.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Asignaci\xF3n eliminada correctamente',type:'success'},function(){'student'==B?(t(x,z),y.find('.add').removeClass('oculto-asignar')):'monitor'==B&&(u(x,z),y.find('.add').addClass('oculto-asignar'))})},0):1===D.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Est\xE1 intentando eliminar una asignaci\xF3n que ya no existe, si tiene problemas con esto, puede probar de nuevo recargando la pesta\xF1a.',type:'info'},function(){})},0):(setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){})},0),console.log(D))},failure:function failure(D){console.log(D)}})}),a(document).on('click','.transfer',function(v){v.stopImmediatePropagation();var w=a(this).parent().data('name'),x=a(this).parent().data('id');a('#modalTransfer').modal('show'),a('#old_monitor_name').text(w);var y='<option value="" disabled selected>Seleccione un monitor</option>\n';a('#monitor_assigned > .monitor_item').each(function(){var z=a(this).data('name'),A=a(this).data('id');y+='<option data-old="'+x+'" data-new="'+A+'">'+z+'</option>\n'}),a('#transfer-monitor-list').html(''),a('#transfer-monitor-list').append(y)}),a(document).on('click','#btn-execute-transfer',function(){a('#modalTransfer').modal('hide');var w=a('#monitor_assignments_instance_id').data('instance-id'),y=a('#transfer-monitor-list').find(':selected').data('old'),z=a('#transfer-monitor-list').find(':selected').data('new');a.ajax({type:'POST',url:'../managers/monitor_assignments/monitor_assignments_api.php',data:JSON.stringify({'function':'transfer',params:[w,y,z]}),contentType:'application/json; charset=utf-8',dataType:'json',success:function success(A){0===A.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'Estudiantes transferidos correctamente.',type:'success'},function(){t(w,z)})},0):1===A.status_code?setTimeout(function(){swal({title:'Informaci\xF3n',text:'El monitor no tiene estudiantes para transferir.',type:'info'},function(){})},0):(setTimeout(function(){swal({title:'Error',text:'Reporte este error.',type:'error'},function(){}),swal.close()},0),console.log(A))},failure:function failure(A){console.log(A)}})}),a('select').change(function(){var v=a(this).attr('data-id').split('_')[0],w=a(this).attr('data-id').split('_')[1];if('monitor'==v&&'faculty'==w){var x=a(this).find(':selected').attr('data-id-facultad');'-1'==x?(a(this).removeClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-facultad')):(a(this).addClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-facultad'),a('.item-general-list.monitor_item').not('.item-general-list.monitor_item[data-id-facultad=\''+x+'\']').addClass('oculto-facultad'))}else if('monitor'==v&&'program'==w){var y=a(this).find(':selected').attr('data-cod-programa');'-1'==y?(a(this).removeClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-programa')):(a(this).addClass('filter-active'),a('.item-general-list.monitor_item').removeClass('oculto-programa'),a('.item-general-list.monitor_item').not('.item-general-list.monitor_item[data-cod-programa=\''+y+'\']').addClass('oculto-programa'))}else if('student'==v&&'faculty'==w){var x=a(this).find(':selected').attr('data-id-facultad');'-1'==x?(a(this).removeClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-facultad')):(a(this).addClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-facultad'),a('.item-general-list.student_item').not('.item-general-list.student_item[data-id-facultad=\''+x+'\']').addClass('oculto-facultad'))}else if('student'==v&&'program'==w){var y=a(this).find(':selected').attr('data-cod-programa');'-1'==y?(a(this).removeClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-programa')):(a(this).addClass('filter-active'),a('.item-general-list.student_item').removeClass('oculto-programa'),a('.item-general-list.student_item').not('.item-general-list.student_item[data-cod-programa=\''+y+'\']').addClass('oculto-programa'))}else if('professional'==v){var z=a(this).find(':selected').attr('data-id');'-1'==z?(a(this).removeClass('filter-active'),a('.item-general-list.practicant_item').removeClass('oculto-jefe')):(a(this).addClass('filter-active'),a('.item-general-list.practicant_item').removeClass('oculto-jefe'),a('.item-general-list.practicant_item').not('.item-general-list.practicant_item[data-id-jefe=\''+z+'\']').addClass('oculto-jefe'))}})}}});