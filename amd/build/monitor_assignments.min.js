define ("block_ases/monitor_assignments",["jquery","core/config","block_ases/loading_indicator","block_ases/csv","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2","block_ases/jquery.dataTables"],function(a,b,c,d){var e=[],f=function(){return b.wwwroot+"/blocks/ases/managers/monitor_assignments/monitor_assignments_api.php"},g=function(b,c){var d=JSON.stringify({function:"get_monitor_practicing_and_students_report",params:{instance_id:b,semester_name:c}});return a.ajax({url:f(),contentType:"application/csv",method:"POST",data:d})},h=function(){return a("#monitor_assignments_instance_id").data("instance-id")},i=function(){return a("#monitor_assignments_instance_id").data("semester-name")},j=function(a,b){c.show();g(a,b).then(function(a){d.csv_string_to_file_for_download(a,"asignaciones_monitor_con_practicantes.csv");c.hide()}).catch(function(a){c.hide();console.log(a)})};return{init:function init(){a("#button-get-complete-report").click(function(){j(h(),i())});function b(e,g,h){if("monitor"===e){c.show();a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:"get_current_practicant_by_monitor",params:[g,h]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(a){c.hide();if(0==a.status_code){if(a.data_response){f(g,a.data_response,!0)}else{setTimeout(function(){swal({title:"Informaci\xF3n",text:"El monitor seleccionado no tiene asignado un practicante.",type:"info"},function(){})},0)}}else{console.log(a)}},failure:function failure(a){c.hide();console.log(a)}})}else if("student"===e){c.show();a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:"get_current_monitor_by_student",params:[g,h]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(a){c.hide();if(0==a.status_code){if(a.data_response){b("monitor",g,a.data_response);d(g,a.data_response)}else{setTimeout(function(){swal({title:"Informaci\xF3n",text:"El estudiante seleccionado no tiene asignado un monitor.",type:"info"},function(){})},0)}}else{console.log(a)}},failure:function failure(a){c.hide();console.log(a)}})}}function d(b,d){a("#student_assigned").addClass("items_assigned_empty");a("#student_assigned").html("Consultando <span>.</span><span>.</span><span>.</span>");a(".student_item").removeClass("oculto-asignado");a("#student_column").animate({scrollTop:a("#student_column").scrollTop()+a("#student_assigned").position().top},0);c.show();a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:"get_monitors_students_relationship_by_instance",params:[b]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(b){c.hide();if(0==b.status_code){var e=b.data_response;a(".monitor_item").removeClass("active");a(".monitor_item[data-id='"+d+"']").addClass("active");a(".student_item").find(".add").removeClass("oculto-asignar");a(".student_item").removeClass("assigned");a(".student_item").removeClass("not-assigned");a(".student_item").addClass("not-assigned");a("#student_assigned").removeClass("items_assigned_empty");a("#student_assigned").text("");for(var f=!1,g=0;g<e.length;g++){if(e[g].id_monitor==d){if(!f){f=!0;a("#student_assigned").removeClass("items_assigned_empty")}a(".student_item[data-id='"+e[g].id_estudiante+"']").removeClass("not-assigned");a(".student_item[data-id='"+e[g].id_estudiante+"']").addClass("assigned");a(".student_item[data-id='"+e[g].id_estudiante+"']").find(".add").addClass("oculto-asignar");a(".student_item[data-id='"+e[g].id_estudiante+"']").clone().appendTo("#student_assigned");a(".student_item[data-id='"+e[g].id_estudiante+"']").not("#student_assigned .student_item").addClass("oculto-asignado")}else{a(".student_item[data-id='"+e[g].id_estudiante+"']").find(".add").addClass("oculto-asignar");a(".student_item[data-id='"+e[g].id_estudiante+"']").find(".delete").addClass("oculto-eliminar");a(".student_item[data-id='"+e[g].id_estudiante+"']").addClass("oculto-asignado")}}a("#student_assigned").find(".student_item").find(".add").addClass("oculto-asignar");a("#student_assigned").find(".student_item").find(".delete").removeClass("oculto-eliminar");if(!f){a("#student_assigned").addClass("items_assigned_empty");a("#student_assigned").text("No tiene estudiantes asignados.")}}else{console.log(b)}},failure:function failure(a){c.hide();console.log(a)}})}function f(b,d){var e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1;c.show();a("#monitor_assigned").addClass("items_assigned_empty");a("#monitor_assigned").html("Consultando <span>.</span><span>.</span><span>.</span>");a(".monitor_item").removeClass("oculto-asignado");a("#monitor_column").animate({scrollTop:a("#monitor_column").scrollTop()+a("#monitor_assigned").position().top},0);a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:"get_practicant_monitor_relationship_by_instance",params:[b]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(b){c.hide();if(0==b.status_code){var f=b.data_response;a(".practicant_item").removeClass("active");a(".practicant_item[data-id='"+d+"']").addClass("active");a(".monitor_item").find(".add").removeClass("oculto-asignar");a(".monitor_item").find(".transfer").removeClass("oculto-tranferir");a(".monitor_item").removeClass("assigned");a(".monitor_item").removeClass("not-assigned");a(".monitor_item").addClass("not-assigned");a(".student_item").removeClass("assigned");a(".student_item").removeClass("not-assigned");a(".student_item").addClass("not-assigned");if(!e){a("#student_assigned").text("No ha seleccionado un monitor.");a("#student_assigned").addClass("items_assigned_empty")}a("#monitor_assigned").text("");for(var g=!1,h=0;h<f.length;h++){if(f[h].id_practicante==d){if(!g){g=!0;a("#monitor_assigned").removeClass("items_assigned_empty")}a(".monitor_item[data-id='"+f[h].id_monitor+"']").removeClass("not-assigned");a(".monitor_item[data-id='"+f[h].id_monitor+"']").addClass("assigned");a(".monitor_item[data-id='"+f[h].id_monitor+"']").find(".add").addClass("oculto-asignar");a(".monitor_item[data-id='"+f[h].id_monitor+"']").clone().appendTo("#monitor_assigned");a(".monitor_item[data-id='"+f[h].id_monitor+"']").not("#monitor_assigned .monitor_item").addClass("oculto-asignado")}else{a(".monitor_item[data-id='"+f[h].id_monitor+"']").find(".add").addClass("oculto-asignar");a(".monitor_item[data-id='"+f[h].id_monitor+"']").find(".delete").addClass("oculto-eliminar");a(".monitor_item[data-id='"+f[h].id_monitor+"']").addClass("oculto-asignado")}}a("#monitor_assigned").find(".monitor_item").find(".add").addClass("oculto-asignar");a("#monitor_assigned").find(".monitor_item").find(".delete").removeClass("oculto-eliminar");a(".monitor_item").not("#monitor_assigned .monitor_item").find(".transfer").addClass("oculto-tranferir");if(!g){a("#monitor_assigned").addClass("items_assigned_empty");a("#monitor_assigned").text("No tiene monitores asignados.")}}else{console.log(b)}},failure:function failure(a){c.hide();console.log(a)}})}a("#student-name-filter").keyup(function(){a(".student_item").removeClass("oculto-filtro-nombre");var b=a(this).val();if(""!=b){if(/\d/.test(b)){a(".student_item").not(".item-general-list.student_item[data-username*=\""+b.toUpperCase()+"\"]").addClass("oculto-filtro-nombre")}else{a(".student_item").not(".item-general-list.student_item[data-name*=\""+b.toUpperCase()+"\"]").addClass("oculto-filtro-nombre")}a(this).addClass("filter-active")}else{a(this).removeClass("filter-active")}});a("#monitor-name-filter").keyup(function(){a(".monitor_item").removeClass("oculto-filtro-nombre");var b=a(this).val();if(""!=b){if(/\d/.test(b)){a(".monitor_item").not(".item-general-list.monitor_item[data-username*=\""+b.toUpperCase()+"\"]").addClass("oculto-filtro-nombre")}else{a(".monitor_item").not(".item-general-list.monitor_item[data-name*=\""+b.toUpperCase()+"\"]").addClass("oculto-filtro-nombre")}a(this).addClass("filter-active")}else{a(this).removeClass("filter-active")}});a("#btn-student-name-filter").click(function(){a("#student-name-filter").val("");a(".student_item").removeClass("oculto-filtro-nombre");a("#student-name-filter").removeClass("filter-active")});a("#btn-monitor-name-filter").click(function(){a("#monitor-name-filter").val("");a(".monitor_item").removeClass("oculto-filtro-nombre");a("#monitor-name-filter").removeClass("filter-active")});a(document).ready(function(){g();a("select").trigger("change")});a(document).on("click",".practicant_item",function(){a(".monitor_item").removeClass("active");f(a("#monitor_assignments_instance_id").data("instance-id"),a(this).attr("data-id"))});a(document).on("click",".monitor_item",function(){var b=a("#monitor_assignments_instance_id").data("instance-id"),e=a(this).attr("data-id");d(b,e);c.show();a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:"get_current_practicant_by_monitor",params:[b,e]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(a){c.hide();if(0==a.status_code){if(a.data_response){f(b,a.data_response,!0)}else{setTimeout(function(){swal({title:"Informaci\xF3n",text:"El monitor seleccionado no tiene asignado un practicante.",type:"info"},function(){})},0)}}else{console.log(a)}},failure:function failure(a){c.hide();console.log(a)}})});a(document).on("click",".student_item",function(){var c=a(this).attr("data-id");a(".student_item").removeClass("active");a(this).addClass("active");a(".student_item[data-id='"+c+"']").addClass("active");b("student",a("#monitor_assignments_instance_id").data("instance-id"),c)});a(document).on("click",".add",function(b){b.stopImmediatePropagation();var c=a(this),e=a("#monitor_assignments_instance_id").data("instance-id"),h=a(this).parent(),i=-1,j=h.attr("data-id"),k=h.attr("data-item"),l="";if("student"==k){l="create_monitor_student_relationship";i=a(".monitor_item.active").attr("data-id");if(null==i){setTimeout(function(){swal({title:"Error",text:"Debe seleccionar primero a un monitor.",type:"error"},function(){})},0);return}}else if("monitor"==k){l="create_practicant_monitor_relationship";i=a(".practicant_item.active").attr("data-id");if(null==i){setTimeout(function(){swal({title:"Error",text:"Debe seleccionar primero a un practicante.",type:"error"},function(){})},0);return}}a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:l,params:[e,i,j]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(a){if(0===a.status_code){setTimeout(function(){swal({title:"Informaci\xF3n",text:"Asignaci\xF3n registrada correctamente.",type:"success"},function(){if("student"==k){d(e,i);h.find(".add").addClass("oculto-asignar")}else if("monitor"==k){f(e,i);h.find(".add").addClass("oculto-asignar")}})},0)}else if(-5===a.status_code){if("student"==k){setTimeout(function(){swal({title:"Informaci\xF3n",text:"La asignaci\xF3n ya existe en el periodo actual, si tiene problemas con esto, puede probar de nuevo recargando la pesta\xF1a.",type:"info"},function(){})},0)}else if("monitor"==k){setTimeout(function(){swal({title:"Informaci\xF3n",text:"Este monitor ya se encuentra asignado.",type:"info"},function(){})},0)}}else{setTimeout(function(){swal({title:"Error",text:"Reporte este error.",type:"error"},function(){})},0)}g()},failure:function failure(a){console.log(a)}})});a(document).on("click",".delete",function(b){b.stopImmediatePropagation();var c=a(this),e=a("#monitor_assignments_instance_id").data("instance-id"),h=a(this).parent(),i=-1,j=h.attr("data-id"),k=h.attr("data-item"),l="";if("student"==k){l="delete_monitor_student_relationship";i=a(".monitor_item.active").attr("data-id")}else if("monitor"==k){l="delete_practicant_monitor_relationship";i=a(".practicant_item.active").attr("data-id")}a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:l,params:[e,i,j]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(a){if(0===a.status_code){setTimeout(function(){swal({title:"Informaci\xF3n",text:"Asignaci\xF3n eliminada correctamente",type:"success"},function(){if("student"==k){d(e,i);h.find(".add").removeClass("oculto-asignar")}else if("monitor"==k){f(e,i);h.find(".add").addClass("oculto-asignar")}})},0)}else if(1===a.status_code){setTimeout(function(){swal({title:"Informaci\xF3n",text:"Est\xE1 intentando eliminar una asignaci\xF3n que ya no existe, si tiene problemas con esto, puede probar de nuevo recargando la pesta\xF1a.",type:"info"},function(){})},0)}else{setTimeout(function(){swal({title:"Error",text:"Reporte este error.",type:"error"},function(){})},0);console.log(a)}g()},failure:function failure(a){console.log(a)}})});a(document).on("click",".transfer",function(b){b.stopImmediatePropagation();var c=a(this).parent().data("name"),d=a(this).parent().data("id");a("#modalTransfer").modal("show");a("#old_monitor_name").text(c);var e="<option value=\"\" disabled selected>Seleccione un monitor</option>\n";a("#monitor_assigned > .monitor_item").each(function(){var b=a(this).data("name"),c=a(this).data("id");e+="<option data-old=\""+d+"\" data-new=\""+c+"\">"+b+"</option>\n"});a("#transfer-monitor-list").html("");a("#transfer-monitor-list").append(e)});a(document).on("click","#btn-execute-transfer",function(){a("#modalTransfer").modal("hide");var b=a("#monitor_assignments_instance_id").data("instance-id"),c=a("#transfer-monitor-list").find(":selected").data("old"),e=a("#transfer-monitor-list").find(":selected").data("new");a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:"transfer",params:[b,c,e]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(a){if(0===a.status_code){setTimeout(function(){swal({title:"Informaci\xF3n",text:"Estudiantes transferidos correctamente.",type:"success"},function(){d(b,e)})},0)}else if(1===a.status_code){setTimeout(function(){swal({title:"Informaci\xF3n",text:"El monitor no tiene estudiantes para transferir.",type:"info"},function(){})},0)}else{setTimeout(function(){swal({title:"Error",text:"Reporte este error.",type:"error"},function(){});swal.close()},0);console.log(a)}g()},failure:function failure(a){console.log(a)}})});a("select").change(function(){var b=a(this).attr("data-id").split("_")[0],c=a(this).attr("data-id").split("_")[1];if("monitor"==b&&"faculty"==c){var d=a(this).find(":selected").attr("data-id-facultad");if("-1"!=d){a(this).addClass("filter-active");a(".item-general-list.monitor_item").removeClass("oculto-facultad");a(".item-general-list.monitor_item").not(".item-general-list.monitor_item[data-id-facultad='"+d+"']").addClass("oculto-facultad")}else{a(this).removeClass("filter-active");a(".item-general-list.monitor_item").removeClass("oculto-facultad")}}else if("monitor"==b&&"program"==c){var e=a(this).find(":selected").attr("data-cod-programa");if("-1"!=e){a(this).addClass("filter-active");a(".item-general-list.monitor_item").removeClass("oculto-programa");a(".item-general-list.monitor_item").not(".item-general-list.monitor_item[data-cod-programa='"+e+"']").addClass("oculto-programa")}else{a(this).removeClass("filter-active");a(".item-general-list.monitor_item").removeClass("oculto-programa")}}else if("student"==b&&"faculty"==c){var d=a(this).find(":selected").attr("data-id-facultad");if("-1"!=d){a(this).addClass("filter-active");a(".item-general-list.student_item").removeClass("oculto-facultad");a(".item-general-list.student_item").not(".item-general-list.student_item[data-id-facultad='"+d+"']").addClass("oculto-facultad")}else{a(this).removeClass("filter-active");a(".item-general-list.student_item").removeClass("oculto-facultad")}}else if("student"==b&&"program"==c){var e=a(this).find(":selected").attr("data-cod-programa");if("-1"!=e){a(this).addClass("filter-active");a(".item-general-list.student_item").removeClass("oculto-programa");a(".item-general-list.student_item").not(".item-general-list.student_item[data-cod-programa='"+e+"']").addClass("oculto-programa")}else{a(this).removeClass("filter-active");a(".item-general-list.student_item").removeClass("oculto-programa")}}else if("professional"==b){var f=a(this).find(":selected").attr("data-id");if("-1"!=f){a(this).addClass("filter-active");a(".item-general-list.practicant_item").removeClass("oculto-jefe");a(".item-general-list.practicant_item").not(".item-general-list.practicant_item[data-id-jefe='"+f+"']").addClass("oculto-jefe")}else{a(this).removeClass("filter-active");a(".item-general-list.practicant_item").removeClass("oculto-jefe")}}});function g(){e=[];var b=a("#monitor_assignments_instance_id").data("instance-id"),c=i();a.ajax({type:"POST",url:"../managers/monitor_assignments/monitor_assignments_api.php",data:JSON.stringify({function:"get_practicants_monitors_and_students",params:[b,c]}),contentType:"application/json; charset=utf-8",dataType:"json",success:function success(b){total=0;b.data_response.forEach(function(a){if(e[a.nombre_usuario_moodle__profesional]==void 0){e[a.nombre_usuario_moodle__profesional]=1}else{e[a.nombre_usuario_moodle__profesional]++}if(e[a.codigo_practicante]==void 0){e[a.codigo_practicante]=1}else{e[a.codigo_practicante]++}if(e[a.codigo_monitor]==void 0){e[a.codigo_monitor]=1}else{e[a.codigo_monitor]++}if(e.TODOS==void 0){e.TODOS=1}else{e.TODOS++}});a(".item-general-list").each(function(){var b=a(this).data("username");a(this).find(".item-text").find(".asignation_counter").text(e[b])});a(".total_counter").text(e.TODOS);var c=a("#select-professional").find(":selected").attr("data-username");a(".asignation_counter_prof").text(e[c]);a("#select-professional").find("option").each(function(){var b=a(this).data("username"),c=a(this).data("fullname");a(this).text(c+" - ( "+e[b]+" )")})},failure:function failure(a){console.log(a)}})}}}});
//# sourceMappingURL=monitor_assignments.min.js.map
