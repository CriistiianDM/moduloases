define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui"],function(e,o,t,a){return{init:function(){var o,t=e("#id_ases").val();function a(){var t=new google.maps.Geocoder,a=document.getElementById("geographic_ciudad"),r=e("#geographic_direccion").val()+" "+a.options[a.selectedIndex].text+" Colombia";t.geocode({address:r},function(e){if(e[0]){var t=e[0].geometry.location.lat(),a=e[0].geometry.location.lng();o=i(t,a),document.getElementById("latitude").value=t,document.getElementById("longitude").value=a}else console.log("No se encontraron resultados")})}function i(e,o){var t;document.getElementById("mapa").innerHTML="";var a=new google.maps.LatLng(3.3759493,-76.5355789),i={center:a,zoom:14},r=new google.maps.Map(document.getElementById("mapa"),i),n=new google.maps.Marker({position:a,map:r,title:"Universidad del Valle"}),d=new google.maps.InfoWindow;d.setContent("Universidad del Valle"),d.open(r,n);var l=new google.maps.Marker({position:{lat:parseFloat(e),lng:parseFloat(o)},map:r});t=new google.maps.Geocoder;var c=new google.maps.InfoWindow;return c.setContent("Residencia Estudiante"),c.open(r,l),google.maps.event.addListener(r,"click",function(e){t.geocode({latLng:e.latLng},function(o,t){t==google.maps.GeocoderStatus.OK?o[0]?(l?l.setPosition(e.latLng):l=new google.maps.Marker({position:e.latLng,map:r}),c.setContent(o[0].formatted_address+"<br/> Coordenadas: "+o[0].geometry.location),c.open(r,l)):console.log("No se encontraron resultados"):console.log("Geocodificación ha fallado debido a: "+t)})}),l}e("#geographic_direccion").focusout(function(){a()}),e("#geographic_direccion").keypress(function(e){"13"==(e.keyCode?e.keyCode:e.which)&&a()}),e("#select_neighborhood").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},dropdownAutoWidth:!0}),e("#geographic_ciudad").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},dropdownAutoWidth:!0}),e("#button_edit_geographic").on("click",function(){e("#button_edit_geographic").attr("hidden",!0),e("#div_save_buttons").removeAttr("hidden"),e("#select_neighborhood").removeAttr("disabled"),e("#latitude").removeAttr("disabled"),e("#longitude").removeAttr("disabled"),e("#geographic_direccion").removeAttr("disabled"),e("#geographic_ciudad").removeAttr("disabled"),e("#geographic_checkbox_vive_lejos").removeAttr("disabled"),e("#geographic_checkbox_zona_riesgo").removeAttr("disabled"),e("#nivel_bajo").removeAttr("disabled"),e("#nivel_medio").removeAttr("disabled"),e("#nivel_alto").removeAttr("disabled"),e("#geographic_text_area").removeAttr("disabled"),e("#nativo").removeAttr("disabled"),e("#geographic_checkbox_zona_riesgo").prop("checked")&&e("#nativo").removeAttr("disabled");var t=e("#latitude").val(),a=e("#longitude").val();o=i(t,a)}),e("#button_cancel_geographic").on("click",function(){e("#button_edit_geographic").removeAttr("hidden"),e("#div_save_buttons").attr("hidden",!0),e("#select_neighborhood").attr("disabled",!0),e("#latitude").attr("disabled",!0),e("#longitude").attr("disabled",!0),e("#geographic_direccion").attr("disabled",!0),e("#geographic_ciudad").attr("disabled",!0),e("#geographic_checkbox_vive_lejos").attr("disabled",!0),e("#geographic_checkbox_zona_riesgo").attr("disabled",!0),e("#nivel_bajo").attr("disabled",!0),e("#nivel_medio").attr("disabled",!0),e("#nivel_alto").attr("disabled",!0),e("#inmigrante").attr("disabled",!0),e("#geographic_text_area").attr("disabled",!0),e("#nativo").attr("disabled",!0);var o=document.getElementById("geographic_ciudad").value,t=e("#latitude").val(),a=e("#longitude").val();document.getElementById("mapa").innerHTML=1079==o?"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+t+","+a+"&destination=3.3759493,-76.5355789&mode=transit'></iframe>":"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+t+","+a+"&destination=3.3759493,-76.5355789&mode=driving'></iframe>"}),e("#button_save_geographic").on("click",function(){swal({title:"Atención",text:"¿Está seguro que la ubicación del marcador en el mapa coincide con la dirección del estudiante?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Sí",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i,r=e("#latitude").val(),n=e("#longitude").val(),d=e("#geographic_direccion").val(),l=e("#geographic_ciudad").val(),c=0,s=0,g=document.getElementById("geographic_ciudad"),u=g.options[g.selectedIndex].text,m=d+" "+u+" Colombia";document.getElementById("direccion_res").value=d,document.getElementById("municipio_act").value=u;var p,v={query:m,fields:["photos","formatted_address","name","rating","opening_hours","geometry"]},_=document.getElementById("mapa"),h=new google.maps.DirectionsService;service=new google.maps.places.PlacesService(_),service.findPlaceFromQuery(v,function(e){null!=e&&(p=e[0])}),null!=p?(r=p.geometry.location.lat(),n=p.geometry.location.lng()):(r=o.getPosition().lat(),n=o.getPosition().lng()),document.getElementById("latitude").value=r,document.getElementById("longitude").value=n;var b=new google.maps.LatLng(r,n),f=new google.maps.LatLng(3.3759493,-76.5355789);if(1079==l){var y=document.getElementById("mapa").outerHTML;document.getElementById("geographic_map").innerHTML=y,document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+r+","+n+"&destination=3.3759493,-76.5355789&mode=transit'></iframe>",i="TRANSIT"}else{y=document.getElementById("mapa").outerHTML;document.getElementById("geographic_map").innerHTML=y,document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+r+","+n+"&destination=3.3759493,-76.5355789&mode=driving' allowfullscreen></iframe>",i="DRIVING"}var w={origin:b,destination:f,travelMode:i};h.route(w,function(o,a){var i=e("input[name=geographic_nivel_riesgo]:checked").val(),g=e("#select_neighborhood").val();if(1==l)swal("Error","Debe definir la ciudad del estudiante antes de guardar","error");else if(1079==l&&"No registra"==g)swal("Error","Debe definir un barrio de residencia antes de guardar","error");else if(null==i)swal("Error","Debe definir un nivel de riesgo antes de guardar","error");else if(""==d.trim())swal("Error","Debe definir una dirección antes de guardar","error");else{var u=o.routes[0].legs[0];s=u.distance.value,c=u.duration.value,function(o,t,a,i,r,n,d,l,c){var s=e("#geographic_text_area").val(),g=e("#geographic_checkbox_vive_lejos").prop("checked"),u=e("#geographic_checkbox_zona_riesgo").prop("checked"),m=e("#nativo").prop("checked");e.ajax({type:"POST",data:JSON.stringify({func:"save_geographic_info",params:[o,t,a,d,i,r,n,l,s,g,u,m,c]}),url:"../managers/student_profile/geographic_api.php",success:function(o){0==o.status_code?swal(o.title,o.message,o.type):console.log(o),e("#button_edit_geographic").removeAttr("hidden"),e("#div_save_buttons").attr("hidden",!0),e("#select_neighborhood").attr("disabled",!0),e("#latitude").attr("disabled",!0),e("#longitude").attr("disabled",!0),e("#geographic_direccion").attr("disabled",!0),e("#geographic_ciudad").attr("disabled",!0),e("#geographic_checkbox_vive_lejos").attr("disabled",!0),e("#geographic_checkbox_zona_riesgo").attr("disabled",!0),e("#nivel_bajo").attr("disabled",!0),e("#nivel_medio").attr("disabled",!0),e("#nivel_alto").attr("disabled",!0),e("#geographic_text_area").attr("disabled",!0),e("#nativo").attr("disabled",!0)},dataType:"json",cache:"false",error:function(e){console.log(e)}})}(t,r,n,c,s,d,g,l,i)}})}})})}}});