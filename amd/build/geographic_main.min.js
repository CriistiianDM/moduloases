define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/student_profile_main"],function(e,t,o,a,i){return{init:function(){var t,o=e("#id_ases").val();function a(){var o=new google.maps.Geocoder,a=document.getElementById("geographic_ciudad"),r=(e("#geographic_direccion").val(),e("#geographic_direccion").val()+" "+a.options[a.selectedIndex].text+" Colombia");o.geocode({address:r},function(e){if(e[0]){var o=e[0].geometry.location.lat(),a=e[0].geometry.location.lng();t=i.edit_map(o,a),document.getElementById("latitude").value=o,document.getElementById("longitude").value=a,console.log("Dirección: "+e[0].formatted_address+" Coordenadas: "+e[0].geometry.location)}else console.log("No se encontraron resultados")})}e("#geographic_direccion").focusout(function(){a()}),e("#geographic_direccion").keypress(function(e){"13"==(e.keyCode?e.keyCode:e.which)&&a()}),e("#button_edit_geographic").on("click",function(){e("#button_edit_geographic").attr("hidden",!0),e("#div_save_buttons").removeAttr("hidden"),e("#select_neighborhood").removeAttr("disabled"),e("#latitude").removeAttr("disabled"),e("#longitude").removeAttr("disabled"),e("#geographic_direccion").removeAttr("disabled"),e("#geographic_ciudad").removeAttr("disabled"),e("#geographic_checkbox_vive_lejos").removeAttr("disabled"),e("#geographic_checkbox_zona_riesgo").removeAttr("disabled"),e("#nivel_bajo").removeAttr("disabled"),e("#nivel_medio").removeAttr("disabled"),e("#nivel_alto").removeAttr("disabled"),e("#geographic_text_area").removeAttr("disabled"),e("#nativo").removeAttr("disabled"),e("#geographic_checkbox_zona_riesgo").prop("checked")&&e("#nativo").removeAttr("disabled");var o=e("#latitude").val(),a=e("#longitude").val();t=i.edit_map(o,a)}),e("#button_cancel_geographic").on("click",function(){e("#button_edit_geographic").removeAttr("hidden"),e("#div_save_buttons").attr("hidden",!0),e("#select_neighborhood").attr("disabled",!0),e("#latitude").attr("disabled",!0),e("#longitude").attr("disabled",!0),e("#geographic_direccion").attr("disabled",!0),e("#geographic_ciudad").attr("disabled",!0),e("#geographic_checkbox_vive_lejos").attr("disabled",!0),e("#geographic_checkbox_zona_riesgo").attr("disabled",!0),e("#nivel_bajo").attr("disabled",!0),e("#nivel_medio").attr("disabled",!0),e("#nivel_alto").attr("disabled",!0),e("#inmigrante").attr("disabled",!0),e("#geographic_text_area").attr("disabled",!0),e("#nativo").attr("disabled",!0);var t=document.getElementById("geographic_ciudad").value,o=e("#latitude").val(),a=e("#longitude").val();document.getElementById("mapa").innerHTML=1079==t?"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+o+","+a+"&destination=3.3759493,-76.5355789&mode=transit'></iframe>":"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+o+","+a+"&destination=3.3759493,-76.5355789&mode=driving'></iframe>"}),e("#button_save_geographic").on("click",function(){swal({title:"Atención",text:"¿Confirmó que la ubicación del marcador en el mapa coincidiera con la dirección dada por el estudiante?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Sí",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i,r=e("#latitude").val(),d=e("#longitude").val(),n=e("#geographic_direccion").val(),l=e("#geographic_ciudad").val(),c=0,s=0,g=document.getElementById("geographic_ciudad"),m=g.options[g.selectedIndex].text,u=n+" "+m+" Colombia";document.getElementById("direccion_res").value=n,document.getElementById("municipio_act").value=m;var _,p={query:u,fields:["photos","formatted_address","name","rating","opening_hours","geometry"]},v=document.getElementById("mapa"),b=new google.maps.DirectionsService;service=new google.maps.places.PlacesService(v),service.findPlaceFromQuery(p,function(e){null!=e&&(_=e[0])}),null!=_?(r=_.geometry.location.lat(),d=_.geometry.location.lng()):(r=t.getPosition().lat(),d=t.getPosition().lng()),document.getElementById("latitude").value=r,document.getElementById("longitude").value=d;var h=new google.maps.LatLng(r,d),f=new google.maps.LatLng(3.3759493,-76.5355789);if(1079==l){var y=document.getElementById("mapa").outerHTML;document.getElementById("geographic_map").innerHTML=y,document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+r+","+d+"&destination=3.3759493,-76.5355789&mode=transit'></iframe>",i="TRANSIT"}else{y=document.getElementById("mapa").outerHTML;document.getElementById("geographic_map").innerHTML=y,document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+r+","+d+"&destination=3.3759493,-76.5355789&mode=driving' allowfullscreen></iframe>",i="DRIVING"}var w={origin:h,destination:f,travelMode:i};b.route(w,function(t,a){var i=e("input[name=geographic_nivel_riesgo]:checked").val(),g=e("#select_neighborhood").val();if(1==l)swal("Error","Debe definir la ciudad del estudiante antes de guardar","error");else if(1079==l&&"No registra"==g)swal("Error","Debe definir un barrio de residencia antes de guardar","error");else if(null==i)swal("Error","Debe definir un nivel de riesgo antes de guardar","error");else{var m=t.routes[0].legs[0];s=m.distance.value,c=m.duration.value,function(t,o,a,i,r,d,n,l,c){var s=e("#geographic_text_area").val(),g=e("#geographic_checkbox_vive_lejos").prop("checked"),m=e("#geographic_checkbox_zona_riesgo").prop("checked"),u=e("#nativo").prop("checked");e.ajax({type:"POST",data:JSON.stringify({func:"save_geographic_info",params:[t,o,a,n,i,r,d,l,s,g,m,u,c]}),url:"../managers/student_profile/geographic_api.php",success:function(t){0==t.status_code?swal(t.title,t.message,t.type):console.log(t),e("#button_edit_geographic").removeAttr("hidden"),e("#div_save_buttons").attr("hidden",!0),e("#select_neighborhood").attr("disabled",!0),e("#latitude").attr("disabled",!0),e("#longitude").attr("disabled",!0),e("#geographic_direccion").attr("disabled",!0),e("#geographic_ciudad").attr("disabled",!0),e("#geographic_checkbox_vive_lejos").attr("disabled",!0),e("#geographic_checkbox_zona_riesgo").attr("disabled",!0),e("#nivel_bajo").attr("disabled",!0),e("#nivel_medio").attr("disabled",!0),e("#nivel_alto").attr("disabled",!0),e("#geographic_text_area").attr("disabled",!0),e("#nativo").attr("disabled",!0)},dataType:"json",cache:"false",error:function(e){console.log(e)}})}(o,r,d,c,s,n,g,l,i)}})}})})}}});