define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui"],function(e,o,t,a){return{init:function(){const o=e("#id_ases").val();var t;const a=new google.maps.LatLng(3.3741569,-76.5355235),i=new google.maps.LatLng(3.431626,-76.546822);var n=document.querySelector("#cod_programa_activo").dataset.info[1],r="6"===n||"8"===n?i:a;function d(){var o=new google.maps.Geocoder,a=document.getElementById("geographic_ciudad"),i=e("#geographic_direccion").val()+" "+a.options[a.selectedIndex].text+" Colombia";o.geocode({address:i},function(e){if(e[0]){var o=e[0].geometry.location.lat(),a=e[0].geometry.location.lng();t=l(o,a),document.getElementById("latitude").value=o,document.getElementById("longitude").value=a}else console.log("No se encontraron resultados")})}function l(e,o){var t;document.getElementById("mapa").innerHTML="";var a={center:r,zoom:14},i=new google.maps.Map(document.getElementById("mapa"),a),n=new google.maps.Marker({position:r,map:i,title:"Universidad del Valle"}),d=new google.maps.InfoWindow;d.setContent("Universidad del Valle"),d.open(i,n);var l=new google.maps.Marker({position:{lat:parseFloat(e),lng:parseFloat(o)},map:i});t=new google.maps.Geocoder;var c=new google.maps.InfoWindow;return c.setContent("Residencia Estudiante"),c.open(i,l),google.maps.event.addListener(i,"click",function(e){t.geocode({latLng:e.latLng},function(o,t){t==google.maps.GeocoderStatus.OK?o[0]?(l?l.setPosition(e.latLng):l=new google.maps.Marker({position:e.latLng,map:i}),c.setContent(o[0].formatted_address+"<br/> Coordenadas: "+o[0].geometry.location),c.open(i,l)):console.log("No se encontraron resultados"):console.log("Geocodificación ha fallado debido a: "+t)})}),l}e("#geographic_direccion").focusout(function(){d()}),e("#geographic_direccion").keypress(function(e){"13"==(e.keyCode?e.keyCode:e.which)&&d()}),e("#geographic_ciudad").on("change",function(){d()}),e("#select_neighborhood").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},dropdownAutoWidth:!0}),e("#geographic_ciudad").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},dropdownAutoWidth:!0}),e("#button_edit_geographic").on("click",function(){e("#button_edit_geographic").attr("hidden",!0),e("#div_save_buttons").removeAttr("hidden"),e("#select_neighborhood").removeAttr("disabled"),e("#latitude").removeAttr("disabled"),e("#longitude").removeAttr("disabled"),e("#geographic_direccion").removeAttr("disabled"),e("#geographic_ciudad").removeAttr("disabled"),e("#geographic_checkbox_vive_lejos").removeAttr("disabled"),e("#geographic_checkbox_zona_riesgo").removeAttr("disabled"),e("#nivel_bajo").removeAttr("disabled"),e("#nivel_medio").removeAttr("disabled"),e("#nivel_alto").removeAttr("disabled"),e("#geographic_text_area").removeAttr("disabled"),e("#nativo").removeAttr("disabled"),e("#geographic_checkbox_zona_riesgo").prop("checked")&&e("#nativo").removeAttr("disabled");var o=e("#latitude").val(),a=e("#longitude").val();t=l(o,a)}),e("#button_cancel_geographic").on("click",function(){e("#button_edit_geographic").removeAttr("hidden"),e("#div_save_buttons").attr("hidden",!0),e("#select_neighborhood").attr("disabled",!0),e("#latitude").attr("disabled",!0),e("#longitude").attr("disabled",!0),e("#geographic_direccion").attr("disabled",!0),e("#geographic_ciudad").attr("disabled",!0),e("#geographic_checkbox_vive_lejos").attr("disabled",!0),e("#geographic_checkbox_zona_riesgo").attr("disabled",!0),e("#nivel_bajo").attr("disabled",!0),e("#nivel_medio").attr("disabled",!0),e("#nivel_alto").attr("disabled",!0),e("#inmigrante").attr("disabled",!0),e("#geographic_text_area").attr("disabled",!0),e("#nativo").attr("disabled",!0);var o=document.getElementById("geographic_ciudad").value,t=e("#latitude").val(),a=e("#longitude").val();document.getElementById("mapa").innerHTML=1079==o?"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+t+","+a+"&destination="+r.lat()+","+r.lng()+"&mode=transit'></iframe>":"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+t+","+a+"&destination="+r.lat()+","+r.lng()+"&mode=driving'></iframe>"}),e("#button_save_geographic").on("click",function(){swal({title:"Atención",text:"¿Está seguro que la ubicación del marcador en el mapa coincide con la dirección del estudiante?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Sí",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var i,n=e("#latitude").val(),d=e("#longitude").val(),l=e("#geographic_direccion").val(),c=e("#geographic_ciudad").val(),s=0,g=0,u=document.getElementById("geographic_ciudad"),m=u.options[u.selectedIndex].text,p=l+" "+m+" Colombia";document.getElementById("direccion_res").value=l,document.getElementById("municipio_act").value=m;var v,_={query:p,fields:["photos","formatted_address","name","rating","opening_hours","geometry"]},h=document.getElementById("mapa"),b=new google.maps.DirectionsService;service=new google.maps.places.PlacesService(h),service.findPlaceFromQuery(_,function(e){null!=e&&(v=e[0])}),null!=v?(n=v.geometry.location.lat(),d=v.geometry.location.lng()):(n=t.getPosition().lat(),d=t.getPosition().lng()),document.getElementById("latitude").value=n,document.getElementById("longitude").value=d;var f=new google.maps.LatLng(n,d);if(1079==c){var y=document.getElementById("mapa").outerHTML;document.getElementById("geographic_map").innerHTML=y,document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+n+","+d+"&destination="+r.lat()+","+r.lng()+"&mode=transit'></iframe>",i="TRANSIT"}else{y=document.getElementById("mapa").outerHTML;document.getElementById("geographic_map").innerHTML=y,document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+n+","+d+"&destination="+r.lat()+","+r.lng()+"&mode=driving' allowfullscreen></iframe>",i="DRIVING"}var w={origin:f,destination:r,travelMode:i};b.route(w,function(t,a){var i=e("input[name=geographic_nivel_riesgo]:checked").val(),r=e("#select_neighborhood").val();if(1==c)swal("Error","Debe definir la ciudad del estudiante antes de guardar","error");else if(1079==c&&"No registra"==r)swal("Error","Debe definir un barrio de residencia antes de guardar","error");else if(null==i)swal("Error","Debe definir un nivel de riesgo antes de guardar","error");else if(""==l.trim())swal("Error","Debe definir una dirección antes de guardar","error");else{var u=t.routes[0].legs[0];g=u.distance.value,s=u.duration.value,function(o,t,a,i,n,r,d,l,c){var s=e("#geographic_text_area").val(),g=e("#geographic_checkbox_vive_lejos").prop("checked"),u=e("#geographic_checkbox_zona_riesgo").prop("checked"),m=e("#nativo").prop("checked");e.ajax({type:"POST",data:JSON.stringify({func:"save_geographic_info",params:[o,t,a,d,i,n,r,l,s,g,u,m,c]}),url:"../managers/student_profile/geographic_api.php",success:function(o){0==o.status_code?swal(o.title,o.message,o.type):console.log(o),e("#button_edit_geographic").removeAttr("hidden"),e("#div_save_buttons").attr("hidden",!0),e("#select_neighborhood").attr("disabled",!0),e("#latitude").attr("disabled",!0),e("#longitude").attr("disabled",!0),e("#geographic_direccion").attr("disabled",!0),e("#geographic_ciudad").attr("disabled",!0),e("#geographic_checkbox_vive_lejos").attr("disabled",!0),e("#geographic_checkbox_zona_riesgo").attr("disabled",!0),e("#nivel_bajo").attr("disabled",!0),e("#nivel_medio").attr("disabled",!0),e("#nivel_alto").attr("disabled",!0),e("#geographic_text_area").attr("disabled",!0),e("#nativo").attr("disabled",!0)},dataType:"json",cache:"false",error:function(e){console.log(e)}})}(o,n,d,s,g,l,r,c,i)}})}})})}}});