define(["jquery","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui"],function(e,o,t,a){return{init:function(){const o=new google.maps.LatLng(3.3741569,-76.5355235),t=new google.maps.LatLng(3.431626,-76.546822),a=e("#id_ases").val();var i,r=document.querySelector("#cod_programa_activo").dataset.info[1],n="6"===r||"8"===r?t:o,d=!1;function l(){if(d){var o=new google.maps.Geocoder,t=document.getElementById("geographic_ciudad"),a=e("#geographic_direccion").val()+" "+t.options[t.selectedIndex].text+" Colombia";o.geocode({address:a},function(e){if(e[0]){var o=e[0].geometry.location.lat(),t=e[0].geometry.location.lng();i=c(o,t),document.getElementById("latitude").value=o,document.getElementById("longitude").value=t}else console.log("No se encontraron resultados")})}}function c(e,o){if(!d)return i;var t;document.getElementById("mapa").innerHTML="";var a={center:n,zoom:14},r=new google.maps.Map(document.getElementById("mapa"),a),l=new google.maps.Marker({position:n,map:r,title:"Universidad del Valle"}),c=new google.maps.InfoWindow;c.setContent("Universidad del Valle"),c.open(r,l);var s=new google.maps.Marker({position:{lat:parseFloat(e),lng:parseFloat(o)},map:r});t=new google.maps.Geocoder;var g=new google.maps.InfoWindow;return g.setContent("Residencia Estudiante"),g.open(r,s),google.maps.event.addListener(r,"click",function(e){t.geocode({latLng:e.latLng},function(o,t){t==google.maps.GeocoderStatus.OK?o[0]?(s?s.setPosition(e.latLng):s=new google.maps.Marker({position:e.latLng,map:r}),g.setContent(o[0].formatted_address+"<br/> Coordenadas: "+o[0].geometry.location),g.open(r,s)):console.log("No se encontraron resultados"):console.log("Geocodificación ha fallado debido a: "+t)})}),s}function s(o,t,a,i,r,n,d,l,c){if(1!=l)if(1079!=l||"No registra"!=d){if(null==c)console.log("On save - risk level"),swal("Error","Debe definir un nivel de riesgo antes de guardar","error");else if(""==n.trim())return console.log("On save - address"),void swal("Error","Debe definir una dirección antes de guardar","error");var s=e("#geographic_text_area").val(),g=e("#geographic_checkbox_vive_lejos").prop("checked"),u=e("#geographic_checkbox_zona_riesgo").prop("checked"),m=e("#nativo").prop("checked");e.ajax({type:"POST",data:JSON.stringify({func:"save_geographic_info",params:[o,t,a,d,i,r,n,l,s,g,u,m,c]}),url:"../managers/student_profile/geographic_api.php",success:function(o){0==o.status_code?swal(o.title,o.message,o.type):console.log(o),e("#button_edit_geographic").removeAttr("hidden"),e("#div_save_buttons").attr("hidden",!0),e("#select_neighborhood").attr("disabled",!0),e("#latitude").attr("disabled",!0),e("#longitude").attr("disabled",!0),e("#geographic_direccion").attr("disabled",!0),e("#geographic_ciudad").attr("disabled",!0),e("#geographic_checkbox_vive_lejos").attr("disabled",!0),e("#geographic_checkbox_zona_riesgo").attr("disabled",!0),e("#nivel_bajo").attr("disabled",!0),e("#nivel_medio").attr("disabled",!0),e("#nivel_alto").attr("disabled",!0),e("#geographic_text_area").attr("disabled",!0),e("#nativo").attr("disabled",!0)},dataType:"json",cache:"false",error:function(e){console.log(e)}})}else swal("Error","Debe definir un barrio de residencia antes de guardar","error");else swal("Error","Debe definir la ciudad del estudiante antes de guardar","error")}e("#geographic_direccion").focusout(function(){l()}),e("#geographic_direccion").keypress(function(e){"13"==(e.keyCode?e.keyCode:e.which)&&l()}),e("#geographic_ciudad").on("change",function(){l()}),e("#select_neighborhood").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},dropdownAutoWidth:!0}),e("#geographic_ciudad").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}},dropdownAutoWidth:!0}),e("#button_edit_geographic").on("click",function(){e("#button_edit_geographic").attr("hidden",!0),e("#div_save_buttons").removeAttr("hidden"),e("#select_neighborhood").removeAttr("disabled"),e("#latitude").removeAttr("disabled"),e("#longitude").removeAttr("disabled"),e("#geographic_direccion").removeAttr("disabled"),e("#geographic_ciudad").removeAttr("disabled"),e("#geographic_checkbox_vive_lejos").removeAttr("disabled"),e("#geographic_checkbox_zona_riesgo").removeAttr("disabled"),e("#nivel_bajo").removeAttr("disabled"),e("#nivel_medio").removeAttr("disabled"),e("#nivel_alto").removeAttr("disabled"),e("#geographic_text_area").removeAttr("disabled"),e("#nativo").removeAttr("disabled"),e("#geographic_checkbox_zona_riesgo").prop("checked")&&e("#nativo").removeAttr("disabled");var o=e("#latitude").val(),t=e("#longitude").val();i=c(o,t)}),e("#button_cancel_geographic").on("click",function(){e("#button_edit_geographic").removeAttr("hidden"),e("#div_save_buttons").attr("hidden",!0),e("#select_neighborhood").attr("disabled",!0),e("#latitude").attr("disabled",!0),e("#longitude").attr("disabled",!0),e("#geographic_direccion").attr("disabled",!0),e("#geographic_ciudad").attr("disabled",!0),e("#geographic_checkbox_vive_lejos").attr("disabled",!0),e("#geographic_checkbox_zona_riesgo").attr("disabled",!0),e("#nivel_bajo").attr("disabled",!0),e("#nivel_medio").attr("disabled",!0),e("#nivel_alto").attr("disabled",!0),e("#inmigrante").attr("disabled",!0),e("#geographic_text_area").attr("disabled",!0),e("#nativo").attr("disabled",!0);var o=document.getElementById("geographic_ciudad").value,t=e("#latitude").val(),a=e("#longitude").val();document.getElementById("mapa").innerHTML=1079==o?"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+t+","+a+"&destination="+n.lat()+","+n.lng()+"&mode=transit'></iframe>":"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+t+","+a+"&destination="+n.lat()+","+n.lng()+"&mode=driving'></iframe>"}),e("#button_save_geographic").on("click",function(){swal({title:"Atención",text:"¿Está seguro que la ubicación del marcador en el mapa coincide con la dirección del estudiante?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Sí",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(o){if(o){var t,r=e("input[name=geographic_nivel_riesgo]:checked").val(),l=e("#select_neighborhood").val(),c=e("#latitude").val(),g=e("#longitude").val(),u=e("#geographic_direccion").val(),m=e("#geographic_ciudad").val(),p=0,v=0;if(!d)return void s(a,c,g,p,v,u,l,m,r);var _=document.getElementById("geographic_ciudad"),h=_.options[_.selectedIndex].text,b=u+" "+h+" Colombia";document.getElementById("direccion_res").value=u,document.getElementById("municipio_act").value=h;var f,y={query:b,fields:["photos","formatted_address","name","rating","opening_hours","geometry"]},w=document.getElementById("mapa"),B=new google.maps.DirectionsService;service=new google.maps.places.PlacesService(w),service.findPlaceFromQuery(y,function(e){null!=e&&(f=e[0])}),null!=f?(c=f.geometry.location.lat(),g=f.geometry.location.lng()):(c=i.getPosition().lat(),g=i.getPosition().lng()),document.getElementById("latitude").value=c,document.getElementById("longitude").value=g;var E=new google.maps.LatLng(c,g);if(1079==m){var k=document.getElementById("mapa").outerHTML;document.getElementById("geographic_map").innerHTML=k,document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+c+","+g+"&destination="+n.lat()+","+n.lng()+"&mode=transit'></iframe>",t="TRANSIT"}else{k=document.getElementById("mapa").outerHTML;document.getElementById("geographic_map").innerHTML=k,document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+c+","+g+"&destination="+n.lat()+","+n.lng()+"&mode=driving' allowfullscreen></iframe>",t="DRIVING"}var I={origin:E,destination:n,travelMode:t};B.route(I,function(e,o){var t=e.routes[0].legs[0];v=t.distance.value,p=t.duration.value,s(a,c,g,p,v,u,l,m,r)})}})})}}});