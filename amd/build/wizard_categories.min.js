'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui'],function(a){return{init:function init(){function f(u){console.log(u);var v=u.attr('title');a('#titulo').text(v);var w=!1;a('#nombre_editar').show(),a('#label_nombre').show(),a('#alta').show(),a('#div_padres').show(),u.hasClass('curso')&&(w=!0,a('#alta').hide(),console.log('CURSO'),a('#nombre_editar').hide(),a('#label_nombre').hide(),a('#div_padres').hide());var x=k(),y=u.attr('id');if(a('#save_edit').attr('name',y),'Editar Categor\xEDa'===v){a('#type_cal').show();var z=u.parent().parent().attr('id');a('#otro').hide(),10!=z&&0!=z&&6!=z&&(z=99,a('#otro').show()),a('#calific').prop('value',z);var A='cat',B=u.parent().parent().text();if(-1==B.search('-')){nom_text=B.split('('),B=nom_text[0],D=nom_text[1],w||a('#peso').show(),D=D.replace('(',''),D=D.replace(')',''),D=D.replace(' ',''),D=D.replace('%',''),t=D,a('#peso_editar').val(D);var C=u.attr('data-maxweight');a('.maxweight-edit').attr('id',C)}else B=B.split('-')[0],a('#peso').hide()}else{a('#type_cal').hide();var D=u.parent().parent().prev().text();if('-'==D)a('#peso').hide(),a('#peso_editar').val(D);else{a('#peso').show(),D=D.replace('(',''),D=D.replace(')',''),D=D.replace(' ',''),D=D.replace('%',''),t=D,a('#peso_editar').val(D);var C=u.parent().attr('id');a('.maxweight-edit').attr('id',C)}var A='it',B=u.parent().parent().prev().prev().attr('title');'Enlazar a la actividad Tarea'==B&&(a('#nombre_editar').hide(),a('#label_nombre').hide())}a('#nombre_editar').val(B),h(x,y,A),a('#edit').modal({backdrop:!1})}function g(u){var v=u.parent().parent().parent().attr('id').split('_'),w=k(),x=v[1],y=v[0];if('cat'===y)var z='esta categor\xEDa';else var z='este item';swal({title:'Esta seguro que desea eliminar '+z+'?',text:'Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Aceptar, Borrar '+z,cancelButtonText:'Cancelar',closeOnConfirm:!1,closeOnCancel:!1},function(B){B?j(x,w,y):swal({title:'Cancelado',type:'error',showCancelButton:!1,showConfirmButton:!1,timer:1200})})}function h(u,v,w){a.ajax({type:'POST',data:{course:u,element:v,type_e:w,type:'loadParentCat'},url:'../managers/grade_categories/grader_processing.php',success:function success(x){a('#padre').html(x.html)},dataType:'json',cache:'false',error:function error(x){console.log(x)}})}function j(u,v,w){a.ajax({type:'POST',data:{type_ajax:'deleteElement',id:u,courseid:v,type:w},url:'../managers/grade_categories/grader_processing.php',success:function success(x){swal({title:'Listo',text:x.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1200}),location.reload(),l(v)},dataType:'json',cache:'false',error:function error(x){console.log(x)}})}function k(){for(var w,u=window.location.search.split('&'),v=0;v<u.length;v++)if(w=u[v].split('='),'?id_course'==w[0]||'id_course'==w[0])var x=w[1];return x}function l(u){a.ajax({type:'POST',data:{course:u,type:'loadCat'},url:'../managers/grade_categories/grader_processing.php',success:function success(v){a('#mymodalbody').html(v)},dataType:'text',cache:'false',error:function error(v){console.log(v)}})}function m(u,v){var w=a('#tipoItem').val(),x=k();if('CATEGOR\xCDA'==w){if(q(u)){var y=a.trim(a('#inputNombre').val()),z=a('#inputValor').val(),A=n(a('#tipoCalificacion').prop('selectedIndex'));a.ajax({type:'POST',data:{course:x,parent:v,fullname:y,agregation:A,tipo:w,peso:z},url:'../managers/grade_categories/grader_processing.php',success:function success(B){1==B?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),l(x)):0==B&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}else if('\xCDTEM'==w){if(o(u)){var y=a.trim(a('#inputNombre').val()),z=a('#inputValor').val();a.ajax({type:'POST',data:{course:x,parent:v,fullname:y,tipo:w,peso:z},url:'../managers/grade_categories/grader_processing.php',success:function success(B){1==B?(swal({title:'item a\xF1adido con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),l(x)):0==B&&swal({title:'Error al a\xF1adir el item (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir el item',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}else if(!('PARCIAL'==w))swal({title:'Seleccione el tipo de elemento que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'});else if(p(u)){var y=a.trim(a('#inputNombre').val()),z=a('#inputValor').val();a.ajax({type:'POST',data:{course:x,parent:v,fullname:y,agregation:6,tipo:w,peso:z},url:'../managers/grade_categories/grader_processing.php',success:function success(B){1==B?(swal({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:'#d51b23'}),l(x)):0==B&&swal({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:'#d51b23'})},cache:'false',error:function error(){swal({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}}function n(u){switch(u){case 1:return 0;break;case 2:return 10;}}function o(u){var v=a.trim(a('#inputNombre').val());if(''==v)return swal({title:'Ingrese el nombre del \xEDtem que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==u){var w=a('#inputValor').val();if(''==w)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function p(u){var v=a.trim(a('#inputNombre').val());if(''==v)return swal({title:'Ingrese el nombre del parcial que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==u){var w=a('#inputValor').val();if(''==w)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}return!0}function q(u){if(0==a('#tipoCalificacion').prop('selectedIndex'))return swal({title:'Seleccione el tipo de calificaci\xF3n de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;var v=a.trim(a('#inputNombre').val());if(''==v)return swal({title:'Ingrese el nombre de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1;if(10==u){var w=a('#inputValor').val();if(''==w)return swal({title:'Ingrese un peso v\xE1lido entre 0 y 100',html:!0,type:'warning',confirmButtonColor:'#d51b23'}),!1}else;return!0}var r=a('<div class ="mini-menu"><i class="fa fa-plus"></i></div>'),s=a('<div class ="mini-menu"><i class="fa fa-edit" title="Editar \xCDtem"></i><i class="fa fa-trash"></i></div>');r.appendTo(a('th.category:not(.catlevel1)')),s.appendTo(a('th.item')),a('.mini-menu').attr('iditem',function(){return a(this).parent().attr('data-itemid')}),a('.mini-menu').children().attr('iditem',function(){return a(this).parent().attr('iditem')});var t;a(document).on('click','#wizard_button',function(){a('#modalCategories').modal({backdrop:!1}),a('.fondo').show(),id=k(),l(id)}),a(document).on('click','.fa-plus',function(){a('#modalCategories').modal({backdrop:!1}),a('.fondo').show(),id=k(),l(id)}),a(document).on('click','.fa-edit',function(){id=k(),l(id);var u='#'+a(this).attr('iditem');setTimeout(function(){f(a(u))},300)}),a(document).on('click','.fa-trash',function(){id=k(),l(id);var u='#'+a(this).attr('iditem');setTimeout(function(){$element=a(u).parent().children().last(),console.log($element),g(a(u))},300)}),a(document).on('click','.mymodal-close',function(){location.reload(),a('.fondo').hide()}),a(document).on('click','.edit',function(){console.log(a(this));var u=a(this).attr('title');a('#titulo').text(u);var v=!1;a('#nombre_editar').show(),a('#label_nombre').show(),a('#alta').show(),a('#div_padres').show(),a(this).hasClass('curso')&&(v=!0,a('#alta').hide(),console.log('CURSO'),a('#nombre_editar').hide(),a('#label_nombre').hide(),a('#div_padres').hide());var w=k(),x=a(this).attr('id');if(a('#save_edit').attr('name',x),'Editar Categor\xEDa'===u){a('#type_cal').show();var y=a(this).parent().parent().attr('id');a('#otro').hide(),10!=y&&0!=y&&6!=y&&(y=99,a('#otro').show()),a('#calific').prop('value',y);var z='cat',A=a(this).parent().parent().text();if(-1==A.search('-')){nom_text=A.split('('),A=nom_text[0],C=nom_text[1],v||a('#peso').show(),C=C.replace('(',''),C=C.replace(')',''),C=C.replace(' ',''),C=C.replace('%',''),t=C,a('#peso_editar').val(C);var B=a(this).attr('data-maxweight');a('.maxweight-edit').attr('id',B)}else A=A.split('-')[0],a('#peso').hide()}else{a('#type_cal').hide();var C=a(this).parent().parent().prev().text();if('-'==C)a('#peso').hide(),a('#peso_editar').val(C);else{a('#peso').show(),C=C.replace('(',''),C=C.replace(')',''),C=C.replace(' ',''),C=C.replace('%',''),t=C,a('#peso_editar').val(C);var B=a(this).parent().attr('id');a('.maxweight-edit').attr('id',B)}var z='it',A=a(this).parent().parent().prev().prev().attr('title');'Enlazar a la actividad Tarea'==A&&(a('#nombre_editar').hide(),a('#label_nombre').hide())}a('#nombre_editar').val(A),h(w,x,z),a('#edit').modal({backdrop:!1})});a(document).on('click','#save_edit',function(){var u=a(this).attr('name'),v=a('#nombre_editar').val(),w=a('#peso_editar').val(),x=parseFloat(a('.maxweight-edit').attr('id'))+parseFloat(t),y=a('#calific').val(),z=a('#padre').val();if('-'==w&&(w=0),'99'==y)return void swal({title:'Tipo de Calificacion no valida.',text:'No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(console.log('nombre: '+v+'\n peso:'+w+'\n MAXpeso:'+x+'\n new_calif: '+y),w>x)return void swal({title:'Peso no valido.',text:'El peso ingresado supera el peso m\xE1ximo posible de la categoria padre que es: '+x+'% \n Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});if(''==v)return void swal({title:'Ingrese el nuevo nombre del elemento',html:!0,type:'warning',confirmButtonColor:'#d51b23'});var A=a('#titulo').text();'\xCDtem'==A.split(' ')[1]?(type_e='it',y=!1):type_e='cat';var B=k();a.ajax({type:'POST',data:{course:B,element:u,type_e:type_e,newNombre:v,newPeso:w,newCalific:y,type:'editElement',parent:z},url:'../managers/grade_categories/grader_processing.php',success:function success(C){C.error?swal('Error',C.error,'error'):(swal({title:'Listo',text:C.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1300}),a('#edit').modal('hide'),l(B),console.log(C),location.reload())},dataType:'json',cache:'false',error:function error(C){console.log('AJAXerror'),console.log(C)}})}),a(document).on('click','.delete',function(){var u=a(this).parent().parent().parent().attr('id').split('_'),v=k(),w=u[1],x=u[0];if('cat'===x)var y='esta categor\xEDa';else var y='este item';swal({title:'Esta seguro que desea eliminar '+y+'?',text:'Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Aceptar, Borrar '+y,cancelButtonText:'Cancelar',closeOnConfirm:!1,closeOnCancel:!1},function(A){A?j(w,v,x):swal({title:'Cancelado',type:'error',showCancelButton:!1,showConfirmButton:!1,timer:1200})})});a(document).on('click','.new',function(){var u=a(this).parent().parent().children().next('.maxweight').attr('id');if(0>=u)return void swal({title:'No se pueden crear mas categor\xEDas o \xEDtems en la categoria seleccionada.',text:'\n\r El peso de los elementos dentro de \xE9sta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'});a('.new').prop('disabled',!0),a('.delete').prop('disabled',!0),a('.edit').prop('disabled',!0);var v=a('<div class = \'divForm\'>');v.load('../templates/categories_form.html');var w=a(this).parent().parent();w.append('<hr style = "border-top: 1px solid #ddd">'),w.append(v),window.setTimeout(function(){var x=w.attr('id');10==x&&(a('#divPeso').show(),a('#inputValor').on('blur',function(){var y=a(this).val(),z=parseInt(a(this).parent().parent().parent().parent().children().next('.maxweight').attr('id'));(0>y||y>z)&&(swal({title:'El valor debe estar entre 0 y el peso m\xE1ximo: '+z,text:'\n\rUsted ingres\xF3: '+y,html:!0,type:'warning',confirmButtonColor:'#d51b23'}),a(this).val(''))}),a('#inputValor').on('keypress',function(y){return!(tecla=document.all?y.keyCode:y.which,8!=tecla&&46!=tecla)||(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))})),a('#tipoItem').on('change',function(){var y=a(this).prop('selectedIndex');1==y?a('#divTipeC').show():a('#divTipeC').hide()}),a('#save').on('click',function(){var y=a(this).parent().parent().parent().parent().attr('id'),z=a(this).parent().parent().parent().parent().parent().attr('id');z=z.split('_')[1],m(y,z)}),a('#cancel').on('click',function(){var y=k();l(y)})},400)})}}});