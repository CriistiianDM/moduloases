define(["jquery","block_ases/bootstrap","block_ases/datatables.net","block_ases/datatables.net-buttons","block_ases/buttons.flash","block_ases/jszip","block_ases/pdfmake","block_ases/buttons.html5","block_ases/buttons.print","block_ases/sweetalert","block_ases/select2","block_ases/jqueryui"],function(e,t,r,a,o,n,i,l,s,c,p,d){return{init:function(){function t(t,r,a){e.ajax({type:"POST",data:{course:t,element:r,type_e:a,type:"loadParentCat"},url:"../managers/grade_categories/grader_processing.php",success:function(t){e("#padre").html(t.html)},dataType:"json",cache:"false",error:function(e){console.log(e)}})}function r(t,r,a){e.ajax({type:"POST",data:{type_ajax:"deleteElement",id:t,courseid:r,type:a},url:"../managers/grade_categories/grader_processing.php",success:function(e){e.error?swal("Error",e.error,"error"):(swal({title:"Listo",text:e.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1200}),o(r))},dataType:"json",cache:"false",error:function(e){console.log(e)}})}function a(){for(var e=window.location.search.split("&"),t=0;t<e.length;t++){var r=e[t].split("=");if("?id_course"==r[0]||"id_course"==r[0])var a=r[1]}return a}function o(t){e.ajax({type:"POST",data:{course:t,type:"loadCat"},url:"../managers/grade_categories/grader_processing.php",success:function(t){e("#mymodalbody").html(t)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}function n(t,r){var n=e("#tipoItem").val(),p=a();if("CATEGORÍA"==n){if(c(t)){var d=e.trim(e("#inputNombre").val()),u=e("#inputValor").val(),m=i(e("#tipoCalificacion").prop("selectedIndex"));e.ajax({type:"POST",data:{course:p,parent:r,fullname:d,agregation:m,tipo:n,peso:u},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),o(p)):0==e&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("ÍTEM"==n){if(l(t)){var d=e.trim(e("#inputNombre").val()),u=e("#inputValor").val();e.ajax({type:"POST",data:{course:p,parent:r,fullname:d,tipo:n,peso:u},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"item añadido con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),o(p)):0==e&&swal({title:"Error al añadir el item (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir el item",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("PARCIAL"==n){if(s(t)){var d=e.trim(e("#inputNombre").val()),u=e("#inputValor").val();e.ajax({type:"POST",data:{course:p,parent:r,fullname:d,agregation:6,tipo:n,peso:u},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),o(p)):0==e&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else swal({title:"Seleccione el tipo de elemento que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}function i(e){switch(e){case 1:return 0;case 2:return 10}}function l(t){var r=e.trim(e("#inputNombre").val());if(""==r)return swal({title:"Ingrese el nombre del ítem que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==t){var a=e("#inputValor").val();if(""==a)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}function s(t){var r=e.trim(e("#inputNombre").val());if(""==r)return swal({title:"Ingrese el nombre del parcial que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==t){var a=e("#inputValor").val();if(""==a)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}function c(t){if(0==e("#tipoCalificacion").prop("selectedIndex"))return swal({title:"Seleccione el tipo de calificación de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;var r=e.trim(e("#inputNombre").val());if(""==r)return swal({title:"Ingrese el nombre de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==t){var a=e("#inputValor").val();if(""==a)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}e(document).on("click","#wizard_button",function(){e("#modalCategories").modal({backdrop:!1}),e(".fondo").show(),id=a(),o(id)}),e(document).on("click",".mymodal-close",function(){location.reload(),e(".fondo").hide()}),e(document).on("click",".edit",function(){var r=e(this).attr("title");e("#titulo").text(r);var o=a(),n=e(this).attr("id");if(e("#save_edit").attr("name",n),"Editar Categoría"===r){e("#type_cal").show();var i=e(this).parent().parent().attr("id");10!=i&&11!=i&&6!=i&&(i=0),e("#calific").prop("value",i);var l="cat",s=e(this).parent().parent().text();-1==s.search("-")?(nom_text=s.split("("),s=nom_text[0],c=nom_text[1],e("#peso").show(),c=c.replace("(",""),c=c.replace(")",""),c=c.replace(" ",""),c=c.replace("%",""),e("#peso_editar").val(c)):(s=s.split("-")[0],e("#peso").hide())}else{e("#type_cal").hide();var c=e(this).parent().parent().prev().text();"-"==c?e("#peso").hide():(e("#peso").show(),c=c.replace("(",""),c=c.replace(")",""),c=c.replace(" ",""),c=c.replace("%",""),e("#peso_editar").val(c));var l="it",s=e(this).parent().parent().prev().prev().attr("title")}e("#nombre_editar").val(s),t(o,n,l),e("#edit").modal({backdrop:!1})}),e(document).on("click",".delete",function(){var t=e(this).parent().parent().parent().attr("id").split("_"),o=a(),n=t[1],i=t[0];if("cat"===i)var l="esta categoría";else var l="este item";var s="Esta seguro que desea eliminar "+l+"?";swal({title:s,text:"Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Aceptar, Borrar "+l,cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?r(n,o,i):swal({title:"Cancelado",type:"error",showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),e(document).on("click",".new",function(){var t=e(this).parent().parent().children().next(".maxweight").attr("id");if(0>=t)return void swal({title:"No se pueden crear mas categorías o ítems en la categoria seleccionada.",text:"\n\r El peso de los elementos dentro de ésta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});e(".new").prop("disabled",!0),e(".delete").prop("disabled",!0),e(".edit").prop("disabled",!0);var r=e("<div class = 'divForm'>");r.load("../templates/categories_form.html");var i=e(this).parent().parent();i.append('<hr style = "border-top: 1px solid #ddd">'),i.append(r),window.setTimeout(function(){var t=i.attr("id");10==t&&(e("#divPeso").show(),e("#inputValor").on("blur",function(){var t=e(this).val(),r=parseInt(e(this).parent().parent().parent().parent().children().next(".maxweight").attr("id"));(0>t||t>r)&&(swal({title:"El valor debe estar entre 0 y el peso máximo: "+r,text:"\n\rUsted ingresó: "+t,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),e(this).val(""))}),e("#inputValor").on("keypress",function(e){return tecla=document.all?e.keyCode:e.which,8==tecla||46==tecla?!0:(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))})),e("#tipoItem").on("change",function(){var t=e(this).prop("selectedIndex");1==t?e("#divTipeC").show():e("#divTipeC").hide()}),e("#save").on("click",function(){var t=e(this).parent().parent().parent().parent().attr("id"),r=e(this).parent().parent().parent().parent().parent().attr("id");r=r.split("_")[1],n(t,r)}),e("#cancel").on("click",function(){var e=a();o(e)})},400)})}}});