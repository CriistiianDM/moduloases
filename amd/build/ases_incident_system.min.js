define(["jquery","block_ases/sweetalert","block_ases/jqueryui","block_ases/loading_indicator"],function(e,i,n,o){return e("head").append("<style>            #ases_incident_system_box {                padding: 0.5em;                color:white;                cursor:pointer;                background-color:#d51b23;                position: fixed;                bottom: 0px;                left: 0px;                z-index: 9999;                height: 30px;            }            #incident_box {                position: fixed;                bottom: 0px;                left: 0px;                z-index: 9999;                height: 400px;                border:1px solid #d51b23;                width: 400px;                background-color:white;                display:none;            }            .inc_header{                height: 30px;                background-color:#d51b23;                padding: 0.5em;                color:white;            }            .inc_body{                padding: 0.7em;            }            #close_incident_box{                float:right;                cursor:pointer;            }            #new_inc{                width: 100%;            }            #inc_detail{                width: 100%;            }            #inc_registrar{                background-color:#d51b23;                color:white;                padding: 0.3em;                float:right;                margin-top:0.5em;            }            #inc_registrar:hover{                background-color:whitesmoke;                color:black;            }            .inc_item{                cursor:pointer;            }            .inc_item > .status-icon{                float:left;                margin-right:0.3em;            }            .inc_item > .remove-icon{                float:right;                color:gray            }            .inc_item > .remove-icon:hover{                color:black            }            .inc_item:hover{                background-color:whitesmoke;            }            #old_inc_body{                overflow-y: auto;                height:130px;            }          </style>"),e("body").append('            <div                 id="ases_incident_system_box"                title="Reporte de incidencias">                <i id="inc_icon" class="glyphicon glyphicon-wrench ases-glyphicon ases-glyphicon-wrench"></i>                <span id="inc_text"><strong>Incidencias</strong></span>            </div>            '),e("body").append('            <div id="incident_box" >                <div class="inc_header">                    <i class="glyphicon glyphicon-wrench ases-glyphicon ases-glyphicon-wrench"></i>                    <span><strong>Incidencias</strong></span>                    <i id="close_incident_box" class="glyphicon glyphicon-remove ases-glyphicon ases-glyphicon-remove"></i>                </div>                <div class="inc_body">                    <div id="prev_inc_selector">                    </div>                    <div id="new_inc">                        <span><strong>Registro de nueva incidencia</strong></span>                        <hr style="margin:5px;">                        <input id="inc_title" class="form-control ases-form-control" placeholder="Título corto" type="text">                        <textarea id="inc_detail" class="form-control ases-form-control" name="" placeholder="Descripción detallada de la incidencia" cols="" rows="2"></textarea>                        <a id="inc_registrar" href="javascript:void(0)">Registrar</a>                    </div>                    <hr style="margin-bottom:5px;margin-top:50px;">                    <div id="old_inc">                        <span><strong>Incidencias previas</strong></span>                    </div>                    <hr style="margin:5px;">                    <div id="old_inc_body">                    </div>                    <hr style="margin:5px;">                </div>            </div>            '),console.log("ases_incident_system loaded"),{init:function(){function i(){o.show(),e.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"get_logged_user_incidents",params:[]}),success:function(i){o.hide();let n="";i.data_response.forEach(function(e){let i=JSON.parse(e.estados),o={change_order:-1,status:""};i.forEach(function(e){o.change_order<parseInt(e.change_order)&&(o=e)});let t=null,c=null;JSON.parse(e.comentarios).forEach(function(e){if(0==parseInt(e.message_number))return t=e.message.title,void(c=e.message.commentary)});let s="";"solved"!=o.status&&(s='<i class="remove-icon glyphicon glyphicon-remove-sign ases-glyphicon ases-glyphicon-remove-sign" data-id="'+e.id+'" title="Eliminar"></i>'),n+='                                    <div class="inc_item col-xs-12 col-sm-12 col-md-12 col-lg-12 ases-col-xs-12 ases-col-sm-12 ases-col-md-12 ases-col-lg-12">                                        <i class="status-icon glyphicon glyphicon-record ases-glyphicon ases-glyphicon-record" style="color:'+{solved:"#239f07",waiting:"#ff9a00",closed:"#000"}[o.status]+'" title="'+o.status+'"></i>                                        '+s+'                                        <div class="item-title" data-id="'+e.id+'" data-title="'+t+'" data-detail="'+c+'">#'+e.id+" - "+t+"</div>                                    </div>                                    "}),e("#old_inc_body").html(""),e("#old_inc_body").append(n)},error:function(e,i,n){o.hide(),console.log("some error "+i+" "+n),console.log(e)}})}e(document).ready(function(){i(),setInterval(function(){e("#inc_text").fadeOut(700)},3e3)}),e(document).on("click","#ases_incident_system_box",function(){e("#ases_incident_system_box").hide(0),e("#incident_box").show(100)}),e(document).on("click","#close_incident_box",function(){e("#incident_box").hide(),e("#ases_incident_system_box").show(100)}),e(document).on("click",".item-title",function(){let i=e(this).data("id"),n=e(this).data("title"),o=e(this).data("detail");swal({html:!0,title:"Ticket #"+i,text:'<span style="font-size:1.5em;">'+n+"</span><br><br>                                   <strong>Detalle:</strong>"+o+"<br>",type:"info"})}),e(document).on("click",".remove-icon",function(){let n=e(this).data("id");swal({html:!0,title:"Confirmación",text:"<strong>Nota importante!</strong>: Está cerrando una incidencia que aun no está resuelta.",type:"warning",showCancelButton:!0,confirmButtonText:"Sí, cerrar!"},function(t){t&&(o.show(),e.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"close_logged_user_incident",params:[n]}),success:function(e){o.hide(),i(),0===e.status_code?swal("Éxito!","Se ha cerrado correctamente la incidencia","success"):swal("Error!","Oops!: Al parece no existe la incidencia","error")},error:function(e,i,n){o.hide(),console.log("some error "+i+" "+n),console.log(e)}}))})}),e(document).on("click","#inc_registrar",function(){let n=e("html").html(),t={title:e("#inc_title").val(),commentary:e("#inc_detail").val()};""!=t.title&&""!=t.commentary?(o.show(),e.ajax({method:"POST",url:"../managers/incident_manager/incident_api.php",contentType:"application/json",dataType:"json",data:JSON.stringify({function:"create_incident",params:[t,n]}),success:function(e){o.hide(),0===e.status_code?(swal("Éxito!","Se ha registrado correctamente la incidencia, ticket #"+e.data_response,"success"),i()):swal("Error!","Oops!: "+e.data_response,"error")},error:function(e,i,n){o.hide(),console.log("some error "+i+" "+n),console.log(e)}})):swal("Oops!","Verifica que tanto el título como la descripción no estén vacíos.","warning")})}}});