define(["jquery","block_ases/Modernizr-v282","block_ases/bootstrap","block_ases/datatables","block_ases/sweetalert","block_ases/select2"],function(a,b,c,d,e,f){return{init:function(){function b(){a(".dphpforms-peer-record").on("click",function(){var b=a(this).attr("data-record-id");k("seguimiento_pares",b),a("#modal_v2_edit_peer_tracking").fadeIn(300)})}function c(){a(".dphpforms-groupal-record").on("click",function(){var b=a(this).attr("data-record-id");k("seguimiento_grupal",b),a("#modal_v2_edit_groupal_tracking").fadeIn(300)})}function d(){a('a[class*="practicant"]').click(function(){var b=a(this).attr("href").split("#practicant")[1],c=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_practicants_of_professional",practicant_code:b,instance:E()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(c+" > div").empty(),a(c+" > div").append(b),e(),f()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el practicante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function e(){a('a[class*="monitor"]').click(function(){var b=a(this).attr("href").split("#monitor")[1],c=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_monitors_of_practicant",monitor_code:b,instance:E()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(c+" > div").empty(),a(c+" > div").append(b),g(),f()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el monitor seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function f(){a('a[class*="groupal"]').click(function(){var b=a(this).attr("href").split("#groupal")[1],d=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_groupal_trackings",student_code:b,instance:J},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(d+" > div").empty(),a(d+" > div").append(b),c()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con los seguimientos grupales seleccionados.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function g(){a('a[class*="student"]').click(function(){var d=a(this).attr("href").split("#student")[1],e=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_student_trackings",student_code:d,instance:J},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(d){a(e+" > div").empty(),a(e+" > div").append(d),b(),c()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el estudiante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function h(b){var c=i(".puntuacion_riesgo_individual"),d=a(".comentarios_individual").find("textarea").val(),e=i(".puntuacion_riesgo_familiar"),f=a(".comentarios_familiar").find("textarea").val(),g=i(".puntuacion_riesgo_academico"),h=a(".comentarios_academico").find("textarea").val(),j=i(".puntuacion_riesgo_economico"),k=a(".comentarios_economico").find("textarea").val(),l=i(".puntuacion_vida_uni"),m=a(".comentarios_vida_uni").find("textarea").val();if("3"==c||"3"==e||"3"==g||"3"==j||"3"==l){var n={"function":"send_email_dphpforms",student_code:get_student_code(),risks:[{name:"Individual",risk_lvl:c,observation:d},{name:"Familiar",risk_lvl:e,observation:f},{name:"Académico",risk_lvl:g,observation:h},{name:"Económico",risk_lvl:j,observation:k},{name:"Vida Universitaria",risk_lvl:l,observation:m}],date:a(".fecha").find("input").val(),url:window.location.href};a.ajax({type:"POST",data:JSON.stringify(n),url:"../managers/pilos_tracking/send_risk_email.php",success:function(a){console.log(a)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}}function i(b){var c=0;return a(b).find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").is(":checked")&&(c=a(this).find("label").find("input").val())}),c}function j(b){a.ajax({type:"POST",data:{students:b,type:"consult_students_name"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){if(""!=b){var c='<hr style="border-color:red"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 estudiantes" id="students"><h3>Estudiantes asistentes:</h3><br>'+b+"<br>";a("#modal_v2_edit_groupal_tracking").find("#students").remove(),a("#modal_v2_edit_groupal_tracking").find("form").find("h1").after(c)}},dataType:"text",cache:"false",error:function(a){alert("Error al consultar nombres de los estudiantes pertenecientes a un seguimiento grupal")}})}function k(b,c){a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+b+"&record_id="+c,function(c){if("seguimiento_grupal"==b){a("#body_editor").html(""),a("#modal_v2_edit_groupal_tracking").find("#body_editor").html(""),a("#modal_v2_edit_groupal_tracking").find("#body_editor").append(c),a("#modal_v2_edit_groupal_tracking").find(".btn-dphpforms-univalle").remove();var d=a("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val();j(d)}else a("#modal_v2_edit_groupal_tracking").find("#body_editor").html(""),a("#body_editor").html(""),a("#body_editor").append(c),a(".dphpforms.dphpforms-record.dphpforms-updater").append('<br><br><div class="div-observation col-xs-12 col-sm-12 col-md-12 col-lg-12 comentarios_vida_uni">Observaciones de Practicante/profesional:<br> <textarea id="observation_text" class="form-control " name="observation_text" maxlength="5000"></textarea><br><a id="send_observation" class="btn btn-sm btn-danger btn-dphpforms-univalle btn-dphpforms-send-observation">Enviar observación</a></div>'),a("button.btn.btn-sm.btn-danger.btn-dphpforms-univalle").attr("id","button");a("#permissions_informationr").html("");var e=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),f=a(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(e||f)&&a(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var g=JSON.parse(a("#permissions_information").text()),h=0;h<g.behaviors_permissions.length;h++){for(var i=g.behaviors_permissions[h].behaviors[0],k=i.behaviors_accessibility,l=0;l<k.length;l++){var m=k[l].disabled;"true"==m?m=!0:"false"==m&&(m=!1),a(".dphpforms-record").find("#"+k[l].id).prop("disabled",m),a(".dphpforms-record").find("."+k[l]["class"]).prop("disabled",m)}for(var n=i.behaviors_fields_to_remove,l=0;l<n.length;l++)a(".dphpforms-record").find("#"+n[l].id).remove(),a(".dphpforms-record").find("."+n[l]["class"]).remove();for(var o=i.limpiar_to_eliminate,l=0;l<o.length;l++)a(".dphpforms-record").find("."+o[l]["class"]+".limpiar ").remove()}a("#permissions_informationr").html("")})}function l(h,i){a("#periodos").change(function(){if("sistemas"!=namerol){var j=a("#periodos").val(),k=H;a.ajax({type:"POST",data:{id_persona:k,id_semestre:j,instance:h,otro:!0,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){""==b?(a("#reemplazarToogle").html("<label> No se encontraron registros </label>"),n(i)):(a("#reemplazarToogle").html(b),g(),e(),d(),f()),a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow"),n(i)},dataType:"text",cache:"false",error:function(a){alert("error al consultar seguimientos de personas")}}),b(),c()}})}function m(h){a("#personas").val("").change(),a("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),a("#periodos").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),x(h,namerol),a("#consultar_persona").on("click",function(){var i=a("#personas").children(":selected").attr("value"),j=a("#periodos").children(":selected").attr("value");void 0==i?swal({title:"Debe escoger una persona para realizar la consulta",html:!0,type:"warning",confirmButtonColor:"#d51b23"}):(a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").show(),a(".se-pre-con").show(),a("#reemplazarToogle").hide(),a.ajax({type:"POST",data:{id_persona:i,id_semestre:j,instance:h,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){""==b?a("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(a("#reemplazarToogle").html(b),a("input[name=practicante]").prop("disabled",!0),a("input[name=profesional]").prop("disabled",!0)),g(),e(),d(),f(),a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow")},dataType:"text",cache:"false",error:function(a){alert("error al consultar seguimientos de personas")},complete:function(){a(".se-pre-con").hide(),a("#reemplazarToogle").fadeIn()}}),b(),c())})}function n(b){var c=a("#periodos option:selected").text(),d=0,e="";if("monitor_ps"==b.namerol){var f=o(b);e='<div class="row"><div class="col-sm-12"><h2>Información monitor - PERIODO :'+c+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :<label for="revisado_monitor_'+d+'">'+f[0]+'</label><b></b> - NO Revisados :<label for="norevisado_monitor_'+d+'">'+f[1]+'</label><b></b> - Total  :<label for="total_monitor_'+d+'">'+f[2]+"</label> <b></b> </span></h4></div></div></div></div>",a("#conteo_principal").empty(),a("#conteo_principal").html(e)}else if("practicante_ps"==b.namerol){var g=o(b);e='<div class="row"><div class="col-sm-12"><h2>Información practicante - PERIODO :'+c+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :'+g[0]+" <b></b> - NO Revisados :"+g[1]+" <b></b> - Total  :"+g[2]+" <b></b> </span></h4></div></div></div></div>",a("#conteo_principal").empty(),a("#conteo_principal").html(e)}else if("profesional_ps"==b.namerol){var h=o(b);e='<div class="row"><div class="col-sm-12"><h2>Información profesional - PERIODO :'+c+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :'+h[0]+" <b></b> - NO Revisados :"+h[1]+" <b></b> - Total  :"+h[2]+" <b></b> </span></h4></div></div></div></div>",a("#conteo_principal").empty(),a("#conteo_principal").html(e)}else"sistemas"==b.namerol}function o(b,c){void 0===c&&(c="ninguno");var d=[],e=0,f=0,g=0,h=0;if("monitor_ps"==b.namerol){var i=0,j=0;"ninguno"==c?(i=a(".panel-heading.pares").children().length,j=a(".panel-heading.grupal").children().length):(i=a("#collapse"+b.id+" .panel-heading.pares").children().length,j=a("#collapse"+b.id+" .panel-heading.grupal").children().length),a("label[for='norevisado_grupal_"+b.id+"']").html(j),a("label[for='total_grupal_"+b.id+"']").html(j);for(var k=0;k<i;k++)g+=Number(a("label[for='revisado_pares_"+b.id+"_"+k+"']").text()),h+=Number(a("label[for='norevisado_pares_"+b.id+"_"+k+"']").text());for(var k=0;k<j;k++)e+=0,f=j;return total=g+e+(h+f),new Array(g+e,h+f,total)}if("practicante_ps"==b.namerol){var l=0;d=[0,0,0];var m=[];if("ninguno"==c){l=a(".panel-heading.practicante").children().length;for(var n=0;n<l;n++){var p=a(".panel-heading.practicante:eq("+n+")").find("a").attr("href"),q=p.split("#collapse")[1],r=[];r.id=q,r.namerol="monitor_ps",m=o(r,"practicante"),a("label[for='revisado_monitor_"+q+"']").html(m[0]),a("label[for='norevisado_monitor_"+q+"']").html(m[1]),a("label[for='total_monitor_"+q+"']").html(m[2]),d[0]+=m[0],d[1]+=m[1],d[2]+=m[2]}}else{l=a("#collapse"+b.id+" .panel-heading.practicante").children().length;for(var n=0;n<l;n++){var p=a("#collapse"+b.id+" .panel-heading.practicante:eq("+n+")").find("a").attr("href"),q=p.split("#collapse")[1],r=[];r.id=q,r.namerol="monitor_ps",m=o(r,"practicante"),a("label[for='revisado_monitor_"+q+"']").html(m[0]),a("label[for='norevisado_monitor_"+q+"']").html(m[1]),a("label[for='total_monitor_"+q+"']").html(m[2]),d[0]+=m[0],d[1]+=m[1],d[2]+=m[2]}}return d}if("profesional_ps"==b.namerol){d=[0,0,0];for(var s=a(".panel-heading.profesional").children().length,t=[],u=0;u<s;u++){var p=a(".panel-heading.profesional:eq("+u+")").find("a").attr("href"),v=p.split("#collapse")[1],w=[];w.id=v,w.namerol="practicante_ps",t=o(w,"practicante"),a("label[for='revisado_practicante_"+v+"']").html(t[0]),a("label[for='norevisado_practicante_"+v+"']").html(t[1]),a("label[for='total_practicante_"+v+"']").html(t[2]),d[0]+=t[0],d[1]+=t[1],d[2]+=t[2]}return d}}function p(b){a("body").on("click","#send_observation",function(){var c=a("form").serializeArray(),d={};a(c).each(function(a,b){d[b.name]=b.value});var e=d.id_registro,f=a("#observation_text");if(console.log(),""==f.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var g="individual",h=a(".id_creado_por").find("input").val(),i=a(".fecha").find("input").val(),j=f.val(),k=a("#periodos").val(),l=a(".lugar").find("input").val();a.ajax({type:"POST",data:{id_tracking:e,type:"send_email_to_user",form:"new_form",tracking_type:g,monitor_code:h,date:i,message_to_send:j,semester:k,instance:b,place:l},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){console.log(a),"Error"!=a?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),f.val("")):(console.log("mensaje error : "+a),swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"}))},dataType:"text",cache:"false",error:function(a){console.log("mensaje error : "+a),swal({title:"error al enviar el correo",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}})}function q(b){a("body").on("click",".btn.btn-info.btn-lg.botonCorreo",function(){var b=a(this).attr("value"),c=a("#textarea_"+b);if(""==c.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var d=c.attr("name").split("_"),e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=c.val();a.ajax({type:"POST",data:{type:"send_email_to_user",tipoSeg:e,codigoEnviarN1:f,codigoEnviarN2:g,fecha:h,nombre:i,message:j},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){"Error"!=a?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),c.val("")):swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"})},dataType:"text",cache:"false",error:function(a){swal({title:"error al enviar el correo",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}})}function r(b){a("body").on("click","span.btn.btn-info.btn-lg.botonModificarSeguimiento",function(){var c=a(this).attr("value"),d="",e="",f=document.getElementById("h_ini_"+c),g=document.getElementById("h_fin_"+c),h=document.getElementById("m_ini_"+c),i=document.getElementById("m_fin_"+c),j=f.options[f.selectedIndex].text,k=g.options[g.selectedIndex].text,l=h.options[h.selectedIndex].text,m=i.options[i.selectedIndex].text,n=y(j,k,l,m);if(w(c,b),""==n){d=a("#profesional_"+c).is(":checked")?1:0,e=a("#practicante_"+c).is(":checked")?1:0;var o=a(this).parent().parent().parent(),p=a(this).attr("value"),q=o.find("#lugar_"+p).val(),r=o.find("#tema_"+c).val(),s=o.find("#objetivos_"+c).val(),t=o.find("#fecha_"+c).val(),u=j+":"+l,v=k+":"+m,x=o.find("#obindividual_"+c).val(),z=a("input[name='riesgo_individual_"+c+"']:checked").val();void 0==z&&(z="0");var A=o.find("#obfamiliar_"+c).val(),B=a("input[name='riesgo_familiar_"+c+"']:checked").val();void 0==B&&(B="0");var C=o.find("#obacademico_"+c).val(),D=a("input[name='riesgo_academico_"+c+"']:checked").val();void 0==D&&(D="0");var E=o.find("#obeconomico_"+c).val(),F=a("input[name='riesgo_economico_"+c+"']:checked").val();void 0==F&&(F="0");var G=o.find("#obuniversitario_"+c).val(),H=a("input[name='riesgo_universitario_"+c+"']:checked").val();void 0==H&&(H="0");var I=o.find("#observacionesGeneral_"+c).val();if(""==q||""==r||""==s)swal({title:"Debe ingresar los datos completamente",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else if(""!=x&&0==z||""!=A&&0==B||""!=C&&0==D||""!=E&&0==F||""!=G&&0==H||""==x&&z>0||""==A&&B>0||""==C&&D>0||""==E&&F>0||""==G&&H>0)swal({title:"Debe ingresar correctamente los riesgos",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else{var J=new Object;J.id=p,J.lugar=q,J.tema=r,J.objetivos=s,J.individual=x,J.individual_riesgo=z,J.familiar_desc=A,J.familiar_riesgo=B,J.academico=C,J.academico_riesgo=D,J.economico=E,J.economico_riesgo=F,J.vida_uni=G,J.vida_uni_riesgo=H,J.observaciones=I,J.revisado_practicante=e,J.revisado_profesional=d,J.fecha=t,J.hora_ini=u,J.hora_fin=v,a.ajax({type:"POST",data:{seguimiento:J,type:"actualizar_registro"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){"0"==a?swal({title:"error al actualizar registro",html:!0,type:"error",confirmButtonColor:"#d51b23"}):"1"==a?swal("¡Hecho!","El registro ha sido actualizado","success"):swal({title:"Debe ingresar correctamente los riesgos",html:!0,type:"warning",confirmButtonColor:"#d51b23"})},error:function(a){}})}}else swal({title:n,html:!0,type:"warning",confirmButtonColor:"#d51b23"})})}function s(b){a("body").on("click","span.btn-info.btn-lg.botonesSeguimiento.botonEditarSeguimiento",function(){var c=a(this).attr("value"),d=a(this).parent().parent().parent(),e=!1;"monitor_ps"==b?e=a("#profesional_"+c).is(":checked"):"practicante_ps"==b?a("input[name=practicante]").prop("disabled",!1):"profesional_ps"==b?a("input[name=profesional]").prop("disabled",!1):"sistemas"==b&&(a("input[name=profesional]").prop("disabled",!1),a("input[name=practicante]").prop("disabled",!1)),0==e?(d.find(".editable").removeAttr("readonly"),d.find(".botonesSeguimiento").toggleClass("ocultar"),d.find(".quitar-ocultar").toggleClass("ocultar"),d.find(".radio-ocultar").toggleClass("ocultar"),C(c),F(c)):swal("¡Advertencia!","No es posible editar el seguimiento, debido a que ya ha sido revisado por un profesional","warning")})}function t(b){a("body").on("click","span.btn.btn-info.btn-lg.botonBorrar",function(){var c=a(this).attr("value"),d=!1;"monitor_ps"==b&&(d=a("#profesional_"+H).is(":checked")),0==d&&swal({title:"¿Seguro que desea eliminar el registro?",text:"No podrás deshacer este paso",type:"warning",showCancelButton:!0,cancelButtonText:"No",confirmButtonColor:"#d51b23",confirmButtonText:"Si",closeOnConfirm:!1},function(){a.ajax({type:"POST",data:{id:c,type:"eliminar_registro"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){swal({title:a.title,html:!0,text:a.msg,type:a.type,confirmButtonColor:"#d51b23"}),setTimeout("document.location.reload()",500)},dataType:"json",cache:"false",error:function(a){}})})})}function u(b){a("body").on("click","span.btn.btn-info.btn-lg.botonesSeguimiento.botonCancelarSeguimiento",function(){var c=a(this).attr("value");"monitor_ps"==b||("practicante_ps"==b?a("input[name=practicante]").prop("disabled",!0):"profesional_ps"==b?a("input[name=profesional]").prop("disabled",!0):"sistemas"==b&&(a("input[name=profesional]").prop("disabled",!0),a("input[name=practicante]").prop("disabled",!0)));var d=a(this).parent().parent().parent();d.find(".editable").attr("readonly",!0),d.find(".botonesSeguimiento").toggleClass("ocultar"),d.find(".quitar-ocultar").toggleClass("ocultar"),d.find(".radio-ocultar").toggleClass("ocultar"),B(c)})}function v(){a("body").on("click",".limpiar",function(){var b=a(this).closest("div").attr("id").split("_"),c=b[2].split("div").pop();switch(b[1]){case"individual":a("#obindividual_"+c).val(""),D("riesgo_individual_",c);break;case"familiar":a("#obfamiliar_"+c).val(""),D("riesgo_familiar_",c);break;case"academico":a("#obacademico_"+c).val(""),D("riesgo_academico_",c);break;case"economico":a("#obeconomico_"+c).val(""),D("riesgo_economico_",c);break;case"universitario":a("#obuniversitario_"+c).val(""),D("riesgo_universitario_",c);break;default:a(this).parent().find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").prop("checked",!1)})}})}function w(b,c){var d=new Array,e=new Array,f=a("input:radio[name=riesgo_individual_"+b+"]:checked").val(),g=a("input:radio[name=riesgo_familiar_"+b+"]:checked").val(),h=a("input:radio[name=riesgo_academico_"+b+"]:checked").val(),i=a("input:radio[name=riesgo_economico_"+b+"]:checked").val(),j=a("input:radio[name=riesgo_universitario_"+b+"]:checked").val();"3"==f&&(d.push("Individual"),e.push(a("#obindividual_"+b).val())),"3"==g&&(d.push("Familiar"),e.push(a("#obfamiliar_"+b).val())),"3"==h&&(d.push("Académico"),e.push(a("#obacademico_"+b).val())),"3"==i&&(d.push("Económico"),e.push(a("#obeconomico_"+b).val())),"3"==j&&(d.push("Vida universitaria"),e.push(a("#obuniversitario_"+b).val()));var k=new Array;k.push({name:"function",value:"send_email"}),k.push({name:"id_student_moodle",value:c}),k.push({name:"id_student_pilos",value:b}),k.push({name:"risk_array",value:d}),k.push({name:"observations_array",value:e}),k.push({name:"date",value:a("#fecha_"+b).val()}),k.push({name:"url",value:window.location}),0!=d.length&&a.ajax({type:"POST",data:k,url:"../managers/pilos_tracking/send_risk_email.php",success:function(a){console.log(a)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}function x(b,c){a("#periodos").change(function(){var d=a("#periodos").val();a.ajax({type:"POST",data:{id:d,instance:b,type:"actualizar_personas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){if(a("#personas").empty(),a("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),"sistemas"==c){var d='<option value="">Seleccionar persona</option>';a("#personas").attr("selectedIndex","-1").find("option:selected").removeAttr("selected"),a("#personas").append(d+b)}},dataType:"text",cache:"false",error:function(a){alert("error al cargar personas")}})})}function y(a,b,c,d){var e="";return a>b?e+="* La hora final debe ser mayor a la inicial<br>":a==b&&(c>d?(isvalid=!1,e+="* La hora final debe ser mayor a la inicial<br>"):c==d&&(e+="* Las horas seleccionadas deben ser diferentes<br>")),e}function z(b){for(var c=new Date,d=c.getMinutes(),e=c.getHours(),f="",g=0;g<24;g++)g==e?(e<10&&(e="0"+e),f+='<option value="'+e+'" selected>'+e+"</option>"):f+=g<10?'<option value="0'+g+'">0'+g+"</option>":'<option value="'+g+'">'+g+"</option>";for(var h="",g=0;g<60;g++)g==d?(d<10&&(d="0"+d),h+='<option value="'+d+'" selected>'+d+"</option>"):h+=g<10?'<option value="0'+g+'">0'+g+"</option>":'<option value="'+g+'">'+g+"</option>";a("#h_ini_"+b).append(f),a("#m_ini_"+b).append(h),a("#h_fin_"+b).append(f),a("#m_fin_"+b).append(h),a("#seguimiento #m_fin").append(h)}function A(){a(document).ready(function(){a("input:radio").change(function(){var b=a(this).parent().parent().parent().attr("id"),c=a(this).attr("value");1==c?(a("#"+b).removeClass(),a("#"+b).addClass("table-info-pilos col-sm-12 riesgo_bajo")):2==c?(a("#"+b).removeClass(),a("#"+b).addClass("table-info-pilos col-sm-12 riesgo_medio")):3==c&&(a("#"+b).removeClass(),a("#"+b).addClass("table-info-pilos col-sm-12 riesgo_alto"))})})}function B(b){a("#titulo_fecha_"+b).hide(),a("#borrar_"+b).show(),a("#editar_"+b).show(),a("#enviar_"+b).show(),a("#hora_final_"+b).show(),a("#mod_hora_final_"+b).hide(),a("#hora_inicial_"+b).show(),a("#mod_hora_ini_"+b).hide()}function C(b){a("#borrar_"+b).hide(),a("#editar_"+b).hide(),a("#enviar_"+b).hide(),a("#hora_final_"+b).hide(),a("#hora_inicial_"+b).hide(),a("#titulo_fecha_"+b).show(),a("#mod_hora_final_"+b).show(),a("#mod_hora_ini_"+b).show();var c=a("#h_inicial_texto_"+b).val(),d=a("#h_final_texto_"+b).val(),e=c.split(":"),f=d.split(":");z(b),a("#h_ini_"+b+" option[value="+e[0]+"]").prop("selected",!0),a("#m_ini_"+b+" option[value="+e[1]+"]").prop("selected",!0),a("#h_fin_"+b+" option[value="+f[0]+"]").prop("selected",!0),a("#m_fin_"+b+" option[value="+f[1]+"]").prop("selected",!0)}function D(b,c){a("input:radio[name="+b+c+"]").parent().parent().parent().removeClass("riesgo_bajo"),a("input:radio[name="+b+c+"]").parent().parent().parent().removeClass("riesgo_medio"),a("input:radio[name="+b+c+"]").parent().parent().parent().removeClass("riesgo_alto");var d='"'+b.replace("#","")+c+'"';a("input:radio[name="+d+"]").each(function(a){this.checked=!1})}function E(){for(var a=window.location.search.split("&"),b=0;b<a.length;b++){var c=a[b].split("=");if("?instanceid"==c[0]||"instanceid"==c[0])var d=c[1]}return d}function F(b){a("#riesgo_individual_"+b).is(".riesgo_bajo")?a("input[name=riesgo_individual_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_individual_"+b).is(".riesgo_medio")?a("input[name=riesgo_individual_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_individual_"+b).is(".riesgo_alto")?a("input[name=riesgo_individual_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_individual_"+b+"][value=0]").prop("checked","checked"),a("#riesgo_familiar_"+b).is(".riesgo_bajo")?a("input[name=riesgo_familiar_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_familiar_"+b).is(".riesgo_medio")?a("input[name=riesgo_familiar_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_familiar_"+b).is(".riesgo_alto")?a("input[name=riesgo_familiar_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_familiar_"+b+"][value=0]").prop("checked","checked"),a("#riesgo_academico_"+b).is(".riesgo_bajo")?a("input[name=riesgo_academico_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_academico_"+b).is(".riesgo_medio")?a("input[name=riesgo_academico_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_academico_"+b).is(".riesgo_alto")?a("input[name=riesgo_academico_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_academico_"+b+"][value=0]").prop("checked","checked"),a("#riesgo_economico_"+b).is(".riesgo_bajo")?a("input[name=riesgo_economico_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_economico_"+b).is(".riesgo_medio")?a("input[name=riesgo_economico_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_economico_"+b).is(".riesgo_alto")?a("input[name=riesgo_economico_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_economico_"+b+"][value=0]").prop("checked","checked"),a("#riesgo_universitario_"+b).is(".riesgo_bajo")?a("input[name=riesgo_universitario_"+b+"][value=1]").prop("checked","checked"):a("#riesgo_universitario_"+b).is(".riesgo_medio")?a("input[name=riesgo_universitario_"+b+"][value=2]").prop("checked","checked"):a("#riesgo_universitario_"+b).is(".riesgo_alto")?a("input[name=riesgo_universitario_"+b+"][value=3]").prop("checked","checked"):a("input[name=riesgo_universitario_"+b+"][value=0]").prop("checked","checked")}var G=0,H=0,I="",J="",K="";a(document).ready(function(){a(".se-pre-con").fadeOut("slow"),a("#reemplazarToogle").fadeIn("slow");for(var b="",c=window.location.search.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if("?instanceid"==e[0]||"instanceid"==e[0])var f=e[1]}a.ajax({type:"POST",data:{type:"getInfo",instance:f},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){$data=a.parseJSON(b),I=$data.username,H=$data.id,K=$data.email,G=$data.rol,namerol=$data.name_rol},dataType:"text",cache:"false",error:function(a){swal({title:"error al obtener información del usuario, getInfo.",html:!0,type:"error",confirmButtonColor:"#d51b23"})}}),I="","monitor_ps"==namerol?b="monitor":"practicante_ps"==namerol?b="practicante":"profesional_ps"==namerol?b="profesional":"sistemas"==namerol&&(b="sistemas");var b=[];b.id=H,b.name=I,b.namerol=namerol,n(b),"practicante_ps"==namerol?(a("input[name=profesional]").prop("disabled",!0),a("input[name=practicante]").prop("disabled",!0),v(),s(namerol),u(namerol),t(namerol),r(H),A(),q(f),l(f,b),p(f)):"profesional_ps"==namerol?(a("input[name=practicante]").prop("disabled",!0),a("input[name=profesional]").prop("disabled",!0),v(),u(namerol),s(namerol),r(H),t(namerol),A(),q(f),l(f,b),p(f)):"monitor_ps"==namerol?(v(),s(namerol),u(namerol),t(namerol),r(H),A(),l(f,b)):"sistemas"==namerol&&(v(),s(namerol),u(namerol),t(namerol),r(H),A(),q(f),m(f),p(f))}),g(),e(),d(),f(),a(document).on("click",".dphpforms > #button",function(b){b.preventDefault();var c=(new FormData,a(this).parent()),d=c.attr("action");"procesador.php"==c.attr("action")&&(d="../managers/dphpforms/procesador.php"),a.ajax({type:"POST",url:d,data:a("form.dphpforms").serialize(),dataType:"json",success:function(b){var c=b;if(0==c.status){var d="";"Stored"==c.message?d="Almacenado":"Updated"==c.message&&(d="Actualizado"),h(),swal({title:"Información",text:d,type:"success"},function(){"Updated"==c.message&&a("#dphpforms-peer-record-"+a("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3)}),a(".dphpforms-response").trigger("reset"),a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300)}else if(c.status==-2){var d="";"Without changes"==c.message?d="No hay cambios que registrar":"Unfulfilled rules"==c.message&&(d="Revise los valores ingresados"),swal("Alerta",d,"warning")}else c.status==-1&&swal("ERROR!","Oops!, informe de este error","error")},error:function(a){swal("Error!","Oops!, informe de este error","error")}})}),a(".mymodal-close").click(function(){a(this).parent().parent().parent().parent().fadeOut(300)})}}});