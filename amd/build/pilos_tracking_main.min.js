'use strict';define(['jquery','block_ases/Modernizr-v282','block_ases/bootstrap','block_ases/jquery.dataTables','block_ases/sweetalert','block_ases/select2'],function(a){return{init:function init(){function h(I,J,K,L){var M='get_tracking_count';L&&(M='get_tracking_count_student'),a.ajax({type:'POST',data:JSON.stringify({function:M,params:[I,J,K]}),url:'../managers/pilos_tracking/v2/pilos_tracking_api.php',dataType:'json',cache:'false',success:function success(N){for(var O=N.data_response,P=0,Q=0,R=0,S=0,T=0,U=0,V=0;V<O.length;V++){P=O[V].count.revisado_profesional+O[V].count.not_revisado_profesional,Q=O[V].count.not_revisado_profesional,R=O[V].count.not_revisado_practicante,S=O[V].count.in_revisado_profesional+O[V].count.in_not_revisado_profesional,T=O[V].count.in_not_revisado_profesional,U=O[V].count.in_not_revisado_practicante;var W='                                <div class="conteo">                                    <div class="row">                                         <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             Fichas: <strong>'+P+'</strong>                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-prof">Pendientes Prof: </div>'+Q+'                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-pract">Pendientes pract: </div>'+R+'                                        </div>                                    </div>                                    <div class="row">                                         <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             Inasistencias: <strong>'+S+'</strong>                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-prof">Pendientes Prof: </div>'+T+'                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-pract">Pendientes pract: </div>'+U+'                                        </div>                                    </div>                                </div>                            ';a('#counting_'+O[V].username).find('.loader').html(W)}},error:function error(N){console.log(N),swal({title:'Error!',text:'Se present\xF3 un inconveniente con el practicante seleccionado.',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}function j(I,J){if('primer_acercamiento'==I&&'insert'==J);else if('primer_acercamiento'==I&&'update'==J);else if('inasistencia'==I&&'insert'==J);else if('inasistencia'==I&&'update'==J){var K=a('.dphpforms-record').find('.in_revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),L=a('.dphpforms-record').find('.in_revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked'),M=a('#dphpforms_role_support').attr('data-info');K&&'sistemas'!=M&&(a('.btn-dphpforms-delete-record').remove(),a('.btn-dphpforms-update').remove()),'dir_socioeducativo'==M&&(a('.btn-dphpforms-delete-record').remove(),a('.btn-dphpforms-update').remove());var N=a('.dphpforms-record .btn-dphpforms-univalle').length;1==N?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-a('.dphpforms-record .btn-dphpforms-close').outerWidth()/2+'px'}):2==N?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72+'px'}):3==N?a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'}):4==N&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})}else if('seguimiento_pares'==I&&'insert'==J);else if('seguimiento_pares'==I&&'update'==J){var K=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),L=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');K&&(a('.btn-dphpforms-delete-record').remove(),a('.btn-dphpforms-update').remove());L&&a('.btn-dphpforms-delete-record').remove();var N=a('.dphpforms-record .btn-dphpforms-univalle').length;3==N||2==N?a('.dphpforms-record .btn-dphpforms-close').css({'margin-left':a('.dphpforms-updater').width()/2-30+'px'}):4==N&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})}else if('seguimiento_geografico_'==I&&'insert'==J);else if('seguimiento_geografico_'==I&&'update'==J);else if('seguimiento_grupal_'==I&&'insert'==J);else if('seguimiento_grupal_'==I&&'update'==J);}function k(){a('.dphpforms-peer-record').on('click',function(){var I=a(this).attr('data-record-id');q('seguimiento_pares',I),a('#modal_v2_edit_peer_tracking').fadeIn(300)})}function l(){a('.dphpforms-groupal-record').on('click',function(){var I=a(this).attr('data-record-id');q('seguimiento_grupal',I),a('#modal_v2_edit_groupal_tracking').fadeIn(300)})}function m(I,J){var K=n('.puntuacion_riesgo_individual'),L=a('.comentarios_individual').find('textarea').val();var M=n('.puntuacion_riesgo_familiar'),N=a('.comentarios_familiar').find('textarea').val(),O=n('.puntuacion_riesgo_academico'),P=a('.comentarios_academico').find('textarea').val(),Q=n('.puntuacion_riesgo_economico'),R=a('.comentarios_economico').find('textarea').val(),S=n('.puntuacion_vida_uni'),T=a('.comentarios_vida_uni').find('textarea').val();if('3'==K||'3'==M||'3'==O||'3'==Q||'3'==S){var U={'function':'send_email_dphpforms',student_code:J,risks:[{name:'Individual',risk_lvl:K,observation:L},{name:'Familiar',risk_lvl:M,observation:N},{name:'Acad\xE9mico',risk_lvl:O,observation:P},{name:'Econ\xF3mico',risk_lvl:Q,observation:R},{name:'Vida Universitaria',risk_lvl:S,observation:T}],date:a('.fecha').find('input').val(),url:window.location.href};a.ajax({type:'POST',data:JSON.stringify(U),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(V){console.log(V)},dataType:'text',cache:'false',error:function error(V){console.log(V)}})}}function n(I){var J=0;return a(I).find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').is(':checked')&&(J=a(this).find('label').find('input').val())}),J}function o(I){a('#general_rev_pro').html('*'),a('#general_rev_prac').html('*'),a('#general_not_rev_pro').html('*'),a('#general_not_rev_prac').html('*'),a('#general_pro_t').html('*'),a('#general_prac_t').html('*'),a('#general_in_rev_pro').html('*'),a('#general_in_rev_prac').html('*'),a('#general_in_not_rev_pro').html('*'),a('#general_in_not_rev_prac').html('*'),a('#general_in_pro_t').html('*'),a('#general_in_prac_t').html('*'),a.ajax({type:'POST',data:{type:'user_specific_counting',user:I,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!0,dataType:'json',cache:'false',success:function success(J){a('#general_rev_pro').html(J.revisado_profesional),a('#general_rev_prac').html(J.revisado_practicante),a('#general_not_rev_pro').html(J.not_revisado_profesional),a('#general_not_rev_prac').html(J.not_revisado_practicante),a('#general_pro_t').html(J.total_profesional),a('#general_prac_t').html(J.total_practicante),a('#general_in_rev_pro').html(J.in_revisado_profesional),a('#general_in_rev_prac').html(J.in_revisado_practicante),a('#general_in_not_rev_pro').html(J.in_not_revisado_profesional),a('#general_in_not_rev_prac').html(J.in_not_revisado_practicante),a('#general_in_pro_t').html(J.in_total_profesional),a('#general_in_prac_t').html(J.in_total_practicante)},error:function error(){}})}function p(I){a.ajax({type:'POST',data:{students:I,type:'consult_students_name'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(J){if(''!=J){a('#modal_v2_edit_groupal_tracking').find('#students').remove(),a('#modal_v2_edit_groupal_tracking').find('form').find('h1').after('<hr style="border-color:red"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 estudiantes" id="students"><h3>Estudiantes asistentes:</h3><br>'+J+'<br>')}},dataType:'text',cache:'false',error:function error(){alert('Error al consultar nombres de los estudiantes pertenecientes a un seguimiento grupal')}})}function q(I,J){a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id=&record_id='+J,function(K){if('seguimiento_grupal'==I){a('#body_editor').html(''),a('#modal_v2_edit_groupal_tracking').find('#body_editor').html(''),a('#modal_v2_edit_groupal_tracking').find('#body_editor').append(K),a('#modal_v2_edit_groupal_tracking').find('.btn-dphpforms-univalle').remove();var L=a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val();p(L)}else{a('#modal_v2_edit_groupal_tracking').find('#body_editor').html(''),a('#body_editor').html(''),a('#body_editor').append(K),a('.dphpforms.dphpforms-record.dphpforms-updater').append('<br><br><div class="div-observation col-xs-12 col-sm-12 col-md-12 col-lg-12 comentarios_vida_uni">Observaciones de Practicante/profesional:<br> <textarea id="observation_text" class="form-control " name="observation_text" maxlength="5000"></textarea><br><a id="send_observation" class="btn btn-sm btn-danger btn-dphpforms-univalle btn-dphpforms-send-observation">Enviar observaci\xF3n</a></div>'),a('button.btn.btn-sm.btn-danger.btn-dphpforms-univalle').attr('id','button');var M=K.indexOf('seguimiento_de_pares_');-1!=M&&j('seguimiento_pares','update');var N=K.indexOf('inasistencia');-1!=N&&j('inasistencia','update')}a('#permissions_informationr').html('');var O=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),P=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');O&&a('.dphpforms-record').find('.btn-dphpforms-delete-record').remove();for(var Q=JSON.parse(a('#permissions_information').text()),R=0;R<Q.behaviors_permissions.length;R++){for(var V,S=Q.behaviors_permissions[R].behaviors[0],T=S.behaviors_accessibility,U=0;U<T.length;U++)V=T[U].disabled,'true'==V?V=!0:'false'==V&&(V=!1),a('.dphpforms-record').find('#'+T[U].id).prop('disabled',V),a('.dphpforms-record').find('.'+T[U]['class']).prop('disabled',V);for(var W=S.behaviors_fields_to_remove,U=0;U<W.length;U++)a('.dphpforms-record').find('#'+W[U].id).remove(),a('.dphpforms-record').find('.'+W[U]['class']).remove();for(var X=S.limpiar_to_eliminate,U=0;U<X.length;U++)a('.dphpforms-record').find('.'+X[U]['class']+'.limpiar ').remove()}a('#permissions_informationr').html('')})}function r(){a('a[class*="practicant"]').click(function(){var K=a(this).data('username');if(-1==C.indexOf(K))C.push(K);else return;var I=a(this).attr('href').split('#practicant')[1],J=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_practicants_of_professional',practicant_code:I,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!0,dataType:'json',cache:'false',success:function success(L){a(J+' > div').empty(),a(J+' > div').append(L.render);L.counting;h(I,8,parseInt(B()),!1),s(),t()},error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el practicante seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function s(){a('a[class*="monitor"]').click(function(){var K=a(this).data('username');if(-1==C.indexOf(K))C.push(K);else return;var I=a(this).attr('href').split('#monitor')[1],J=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_monitors_of_practicant',monitor_code:I,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!0,dataType:'json',cache:'false',success:function success(L){a(J+' > div').empty(),a(J+' > div').append(L),h(I,8,parseInt(B()),!0),u(),t()},error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el monitor seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function t(){a('a[class*="groupal"]').click(function(){var I=a(this).attr('href').split('#groupal')[1],J=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_groupal_trackings',student_code:I,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(K){a(J+' > div').empty(),a(J+' > div').append(K),l()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con los seguimientos grupales seleccionados.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function u(){a('a[class*="student"]').click(function(){var K=a(this).data('username');if(-1==C.indexOf(K))C.push(K);else return;var I=a(this).attr('href').split('#student')[1],J=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_student_trackings',student_code:I,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(L){a(J+' > div').empty(),a(J+' > div').append(L),k(),l()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el estudiante seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})}),a('.see_history').unbind().click(function(){var J=a(this).parents().eq(3).attr('href').split('#monitor')[1];a.ajax({type:'POST',data:{type:'redirect_tracking_time_control',monitor:J},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(K){var L=window.location.href,M=L.replace('report_trackings','tracking_time_control');try{var N=window.open(M+'&&monitorid='+K,'_blank');N&&N.focus()}catch(O){alert('Se ha producido un error al abrir la ventana : '+O)}},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente al reedirecionar al reporte de horas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function v(I){a('#periodos').change(function(){if('sistemas'!=H){var K=a('#periodos').val(),L=E;a.ajax({type:'POST',data:{id_persona:L,id_semestre:K,instance:I,otro:!0,type:'consulta_sistemas'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(M){''==M?a('#reemplazarToogle').html('<label> No se encontraron registros </label>'):(a('#reemplazarToogle').html(M),u(),s(),r(),t()),a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').slideDown('slow')},dataType:'text',cache:'false',error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al consultar seguimientos de personas','error')}}),k(),l()}})}function w(I){a('#personas').val('').change(),a('#personas').select2({placeholder:'Seleccionar persona',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),a('#periodos').select2({language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),A(I,H),a('#consultar_persona').on('click',function(){var J=a('#personas').children(':selected').attr('value'),K=a('#periodos').children(':selected').attr('value');if(J==void 0)swal({title:'Debe escoger una persona para realizar la consulta',html:!0,type:'warning',confirmButtonColor:'#d51b23'});else{a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').show(),a('.se-pre-con').show(),a('#reemplazarToogle').hide();a.ajax({type:'POST',data:{id_persona:J,id_semestre:K,instance:B(),type:'consulta_sistemas'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!0,dataType:'text',cache:'false',success:function success(N){''==N?a('#reemplazarToogle').html('<label> No se encontraron registros </label>'):(a('#reemplazarToogle').html(N),a('input[name=practicante]').prop('disabled',!0),a('input[name=profesional]').prop('disabled',!0)),o(J),u(),s(),r(),t(),a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').slideDown('slow')},error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al cargar seguimientos de personas','error')},complete:function complete(){a('.se-pre-con').hide(),a('#reemplazarToogle').fadeIn()}}),k(),l()}})}function y(I){a('body').on('click','#send_observation',function(){var J=a('form').serializeArray(),K={};a(J).each(function(U,V){K[V.name]=V.value});var L=K.id_registro,M=a('#observation_text');if(''==M.val())swal({title:'Para enviar una observaci\xF3n debe llenar el campo correspondiente',html:!0,type:'error',confirmButtonColor:'#d51b23'});else{var N='individual',O=a('.id_creado_por').find('input').val();''==O&&(O=a('.in_id_creado_por').find('input').val(),N='individual_inasistencia');var P=a('.fecha').find('input').val();''==P&&(P=a('.in_fecha').find('input').val());var Q=M.val(),R=a('#periodos').val(),S=a('.lugar').find('input').val();''==S&&(S=a('.in_lugar').find('input').val());a.ajax({type:'POST',data:{id_tracking:L,type:'send_email_to_user',form:'new_form',tracking_type:N,monitor_code:O,date:P,message_to_send:Q,semester:R,instance:I,place:S},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(U){'Error'==U?(console.log('mensaje error : '),console.log(U),swal({title:'error al enviar el correo al monitor',html:!0,type:'error',confirmButtonColor:'#d51b23'})):(swal({title:'Correo enviado',html:!0,type:'success',confirmButtonColor:'#d51b23'}),M.val(''))},dataType:'text',cache:'false',error:function error(U){console.log('mensaje error : '),console.log(U),swal('ERROR!','Oops!, Se present\xF3 un error al enviar el correo','error')}})}})}function A(I,J){a('#periodos').change(function(){var K=a('#periodos').val();a.ajax({type:'POST',data:{id:K,instance:I,type:'update_people'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(L){if(a('#personas').empty(),a('#personas').select2({placeholder:'Seleccionar persona',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),'sistemas'==J){a('#personas').attr('selectedIndex','-1').find('option:selected').removeAttr('selected'),a('#personas').append('<option value="">Seleccionar persona</option>'+L)}},dataType:'text',cache:'false',error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al cargar personas','error')}})})}function B(){for(var K,I=window.location.search.split('&'),J=0;J<I.length;J++)if(K=I[J].split('='),'?instanceid'==K[0]||'instanceid'==K[0])var L=K[1];return L}var C=[],D=0,E=0,F='',G='',H='';a(document).on('click','.btn-dphpforms-close',function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a('.outside').click(function(){var I=a(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(J){J&&a(I).parent('.mymodal').fadeOut(300)})}),a(document).ready(function(){a('.se-pre-con').fadeOut('slow'),a('#reemplazarToogle').fadeIn('slow');var J='';a.ajax({type:'POST',data:{type:'getInfo',instance:B()},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(K){$data=a.parseJSON(K),F=$data.username,J=$data.username,E=$data.id,G=$data.email,D=$data.rol,H=$data.name_rol},dataType:'text',cache:'false',error:function error(){swal({title:'error al obtener informaci\xF3n del usuario, getInfo.',html:!0,type:'error',confirmButtonColor:'#d51b23'})}}),F='';var I=[];I.id=E,I.name=F,I.namerol=H,o(I),'practicante_ps'==H?(h(J,8,parseInt(B()),!1),v(B(),I),y(B())):'profesional_ps'==H?(h(J,8,parseInt(B()),!1),v(B(),I),y(B())):'monitor_ps'==H?(h(J,8,parseInt(B()),!0),v(B(),I),y(B())):'sistemas'==H&&(w(B()),y(B()))});a(document).on('click','.dphpforms > #button',function(I){I.preventDefault(),a(':disabled').prop('disabled',!1);var J=new FormData,K=a(this).parent(),L=K.attr('action');'procesador.php'==K.attr('action')&&(L='../managers/dphpforms/procesador.php');var M=K.find('.id_estudiante').find('input').val();a.ajax({type:'POST',url:L,data:a('form.dphpforms').serialize(),dataType:'json',success:function success(N){var O=N;if(0==O.status){a.get('../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg='+M+'&rid=-1',function(Q){console.log(Q)});var P='';'Stored'==O.message?P='Almacenado':'Updated'==O.message&&(P='Actualizado'),m(!1,M),swal({title:'Informaci\xF3n',text:P,type:'success'},function(){'Updated'==O.message&&a('#dphpforms-peer-record-'+a('#dphpforms_record_id').val()).stop().animate({backgroundColor:'rgb(175, 255, 173)'},400).animate({backgroundColor:'#f5f5f5'},4e3)}),a('.dphpforms-response').trigger('reset'),a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300)}else if(-2==O.status){var P='';'Without changes'==O.message?(P='No hay cambios que registrar',a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300),a('#modal_primer_acercamiento').fadeOut(300),a('#modal_seguimiento_geografico').fadeOut(300)):'Unfulfilled rules'==O.message&&(P='Revise los valores ingresados'),swal('Alerta',P,'warning')}else-1==O.status&&swal('ERROR!','Oops!, informe de este error','error')},error:function error(){swal('Error!','Oops!, informe de este error','error')}})}),a('.mymodal-close').click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),u(),s(),r(),t()}}});