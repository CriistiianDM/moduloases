'use strict';define(['jquery','block_ases/Modernizr-v282','block_ases/bootstrap','block_ases/jquery.dataTables','block_ases/sweetalert','block_ases/select2','block_ases/loading_indicator'],function(a,b,c,d,f,g,h){return{init:function init(){function j(E,F,G,H){var I='get_tracking_count';H&&(I='get_tracking_count_student'),h.show(),a.ajax({type:'POST',data:JSON.stringify({function:I,params:[E,F,G]}),url:'../managers/pilos_tracking/v2/pilos_tracking_api.php',dataType:'json',cache:'false',success:function success(J){h.hide();for(var K=J.data_response,L=0,M=0,N=0,O=0,P=0,Q=0,R=0;R<K.length;R++){L=K[R].count.revisado_profesional+K[R].count.not_revisado_profesional,M=K[R].count.not_revisado_profesional,N=K[R].count.not_revisado_practicante,O=K[R].count.in_revisado_profesional+K[R].count.in_not_revisado_profesional,P=K[R].count.in_not_revisado_profesional,Q=K[R].count.in_not_revisado_practicante;var S='                                <div class="conteo">                                    <div class="row">                                         <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             Fichas: <strong>'+L+'</strong>                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-prof">Pendientes Prof: </div>'+M+'                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-pract">Pendientes pract: </div>'+N+'                                        </div>                                    </div>                                    <div class="row">                                         <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             Inasistencias: <strong>'+O+'</strong>                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-prof">Pendientes Prof: </div>'+P+'                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-pract">Pendientes pract: </div>'+Q+'                                        </div>                                    </div>                                </div>                            ';a('#counting_'+K[R].username).find('.loader').html(S)}},error:function error(J){h.hide(),console.log(J),swal({title:'Error!',text:'',html:!0,type:'error',confirmButtonColor:'#d51b23'})}})}function n(E){a('#general_rev_pro').html('*'),a('#general_rev_prac').html('*'),a('#general_not_rev_pro').html('*'),a('#general_not_rev_prac').html('*'),a('#general_pro_t').html('*'),a('#general_prac_t').html('*'),a('#general_in_rev_pro').html('*'),a('#general_in_rev_prac').html('*'),a('#general_in_not_rev_pro').html('*'),a('#general_in_not_rev_prac').html('*'),a('#general_in_pro_t').html('*'),a('#general_in_prac_t').html('*'),h.show(),a.ajax({type:'POST',data:{type:'user_specific_counting',user:E,instance:w()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!0,dataType:'json',cache:'false',success:function success(F){h.hide(),a('#general_rev_pro').html(F.revisado_profesional),a('#general_rev_prac').html(F.revisado_practicante),a('#general_not_rev_pro').html(F.not_revisado_profesional),a('#general_not_rev_prac').html(F.not_revisado_practicante),a('#general_pro_t').html(F.total_profesional),a('#general_prac_t').html(F.total_practicante),a('#general_in_rev_pro').html(F.in_revisado_profesional),a('#general_in_rev_prac').html(F.in_revisado_practicante),a('#general_in_not_rev_pro').html(F.in_not_revisado_profesional),a('#general_in_not_rev_prac').html(F.in_not_revisado_practicante),a('#general_in_pro_t').html(F.in_total_profesional),a('#general_in_prac_t').html(F.in_total_practicante)},error:function error(){h.hide()}})}function o(){a('a[class*="practicant"]').click(function(){var G=a(this).data('username');if(-1==x.indexOf(G))x.push(G);else return;var E=a(this).attr('href').split('#practicant')[1],F=a(this).attr('href');h.show(),a.ajax({type:'POST',data:{type:'get_practicants_of_professional',practicant_code:E,instance:w()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!0,dataType:'json',cache:'false',success:function success(H){h.hide(),a(F+' > div').empty(),a(F+' > div').append(H.render);H.counting;j(E,D,parseInt(w()),!1),p(),q()},error:function error(){h.hide(),swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el practicante seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function p(){a('a[class*="monitor"]').click(function(){var G=a(this).data('username');if(-1==x.indexOf(G))x.push(G);else return;var E=a(this).attr('href').split('#monitor')[1],F=a(this).attr('href');h.show(),a.ajax({type:'POST',data:{type:'get_monitors_of_practicant',monitor_code:E,instance:w()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!0,dataType:'json',cache:'false',success:function success(H){h.hide(),a(F+' > div').empty(),a(F+' > div').append(H),j(E,D,parseInt(w()),!0),r(),q()},error:function error(){h.hide(),swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el monitor seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function q(){a('a[class*="groupal"]').click(function(){var E=a(this).attr('href').split('#groupal')[1],F=a(this).attr('href');h.show(),a.ajax({type:'POST',data:{type:'get_groupal_trackings',student_code:E,instance:w()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(G){h.hide(),a(F+' > div').empty(),a(F+' > div').append(G)},dataType:'json',cache:'false',error:function error(){h.hide(),swal({title:'Oops !',text:'Se present\xF3 un inconveniente con los seguimientos grupales seleccionados.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function r(){a('a[class*="student"]').click(function(){var G=a(this).data('username');if(-1==x.indexOf(G))x.push(G);else return;var E=a(this).attr('href').split('#student')[1],F=a(this).attr('href');h.show(),a.ajax({type:'POST',data:{type:'get_student_trackings',student_code:E,instance:w()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(H){h.hide(),a(F+' > div').empty(),a(F+' > div').append(H)},dataType:'json',cache:'false',error:function error(){h.hide(),swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el estudiante seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})}),a('.see_history').unbind().click(function(){var F=a(this).parents().eq(3).attr('href').split('#monitor')[1];h.show(),a.ajax({type:'POST',data:{type:'redirect_tracking_time_control',monitor:F},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(G){h.hide();var H=window.location.href,I=H.replace('report_trackings','tracking_time_control');try{var J=window.open(I+'&&monitorid='+G,'_blank');J&&J.focus()}catch(K){alert('Se ha producido un error al abrir la ventana : '+K)}},dataType:'json',cache:'false',error:function error(){h.hide(),swal({title:'Oops !',text:'Se present\xF3 un inconveniente al reedirecionar al reporte de horas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function s(E,F,G){a('#periodos').change(function(){if('sistemas'!=C){var H=a('#periodos').val(),I=z;h.show(),a.ajax({type:'POST',data:{id_persona:I,id_semestre:H,instance:E,otro:!0,type:'consulta_sistemas'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',dataType:'text',cache:'false',success:function success(J){h.hide(),''==J?a('#reemplazarToogle').html('<label> No se encontraron registros </label>'):(a('#reemplazarToogle').html(J),r(),p(),o(),q()),a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').slideDown('slow'),j(G,H,parseInt(w()),!1)},error:function error(){h.hide(),swal('ERROR!','Oops!, Se present\xF3 un error al consultar seguimientos de personas','error')}})}})}function t(E){a('#personas').val('').change(),a('#personas').select2({placeholder:'Seleccionar persona',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),a('#periodos').select2({language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),v(E,C),a('#consultar_persona').on('click',function(){var F=a('#personas').children(':selected').attr('value'),G=a('#periodos').children(':selected').attr('value'),H=a('#personas').children(':selected').data('username');if(x=[],void 0==F)swal({title:'Debe escoger una persona para realizar la consulta',html:!0,type:'warning',confirmButtonColor:'#d51b23'});else{a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').show(),a('.se-pre-con').show(),a('#reemplazarToogle').hide();h.show(),a.ajax({type:'POST',data:{id_persona:F,id_semestre:G,instance:w(),type:'consulta_sistemas'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',dataType:'text',cache:'false',success:function success(J){h.hide(),''==J?a('#reemplazarToogle').html('<label> No se encontraron registros </label>'):(a('#reemplazarToogle').html(J),a('input[name=practicante]').prop('disabled',!0),a('input[name=profesional]').prop('disabled',!0)),n(F),r(),p(),o(),q(),a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').slideDown('slow'),j(H,G,parseInt(w()),!1)},error:function error(){h.hide(),swal('ERROR!','Oops!, Se present\xF3 un error al cargar seguimientos de personas','error')},complete:function complete(){a('.se-pre-con').hide(),a('#reemplazarToogle').fadeIn()}})}})}function u(E){a('body').on('click','#send_observation',function(){var F=a('form').serializeArray(),G={};a(F).each(function(R,S){G[S.name]=S.value});var H=G.id_registro,I=a('#observation_text');if(''==I.val())swal({title:'Para enviar una observaci\xF3n debe llenar el campo correspondiente.',html:!0,type:'error',confirmButtonColor:'#d51b23'});else{var J='individual',K=a('.id_creado_por').find('input').val();K==void 0&&(K=a('.in_id_creado_por').find('input').val(),J='individual_inasistencia');var L=a('.fecha').find('input').val();L==void 0&&(L=a('.in_fecha').find('input').val());var M=I.val(),N=a('#periodos').val(),O=a('.lugar').find('input').val();O==void 0&&(O=a('.in_lugar').find('input').val());var Q=a('#dphpforms_block_courseid').data('info');h.show(),a.ajax({type:'POST',data:{id_tracking:H,type:'send_email_to_user',form:'new_form',tracking_type:J,monitor_code:K,date:L,message_to_send:M,semester:N,instance:E,place:O,courseid:Q},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(R){h.hide(),'Error'==R?(console.log('mensaje error : '),console.log(R),swal({title:'error al enviar el correo al monitor',html:!0,type:'error',confirmButtonColor:'#d51b23'})):(swal({title:'Correo enviado',html:!0,type:'success',confirmButtonColor:'#d51b23'}),I.val(''))},dataType:'text',cache:'false',error:function error(R){h.hide(),console.log('mensaje error : '),console.log(R),swal('ERROR!','Oops!, Se present\xF3 un error al enviar el correo','error')}})}})}function v(E,F){a('#periodos').change(function(){var G=a('#periodos').val();h.show(),a.ajax({type:'POST',data:{id:G,instance:E,type:'update_people'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(H){if(h.hide(),a('#personas').empty(),a('#personas').select2({placeholder:'Seleccionar persona',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),'sistemas'==F){a('#personas').attr('selectedIndex','-1').find('option:selected').removeAttr('selected'),a('#personas').append('<option value="">Seleccionar persona</option>'+H)}},dataType:'text',cache:'false',error:function error(){h.hide(),swal('ERROR!','Oops!, Se present\xF3 un error al cargar personas','error')}})})}function w(){for(var G,E=window.location.search.split('&'),F=0;F<E.length;F++)if(G=E[F].split('='),'?instanceid'==G[0]||'instanceid'==G[0])var H=G[1];return H}var x=[],y=0,z=0,A='',B='',C='',D=parseInt(a('#current_ases_semester').data('info'));a(document).on('click','.btn-dphpforms-close',function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a('.outside').click(function(){var E=a(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(F){F&&a(E).parent('.mymodal').fadeOut(300)})}),a(document).ready(function(){a('.se-pre-con').fadeOut('slow'),a('#reemplazarToogle').fadeIn('slow');var F='';h.show(),a.ajax({type:'POST',data:{type:'getInfo',instance:w()},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(G){h.hide(),$data=a.parseJSON(G),A=$data.username,F=$data.username,z=$data.id,B=$data.email,y=$data.rol,C=$data.name_rol},dataType:'text',cache:'false',error:function error(){h.hide(),swal({title:'error al obtener informaci\xF3n del usuario, getInfo.',html:!0,type:'error',confirmButtonColor:'#d51b23'})}}),A='';var E=[];E.id=z,E.name=A,E.namerol=C,n(E),'practicante_ps'==C?(j(F,D,parseInt(w()),!1),s(w(),E,F),u(w())):'profesional_ps'==C?(j(F,D,parseInt(w()),!1),s(w(),E,F),u(w())):'monitor_ps'==C?(j(F,D,parseInt(w()),!0),s(w(),E,F),u(w())):'sistemas'==C&&(t(w()),u(w()))});a('.mymodal-close').click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),r(),p(),o(),q()}}});