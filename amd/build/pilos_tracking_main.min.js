define(["jquery","block_ases/Modernizr-v282","block_ases/bootstrap","block_ases/datatables","block_ases/sweetalert","block_ases/select2"],function(a,b,c,d,e,f){return{init:function(){function b(b,c){if("primer_acercamiento"==b&&"insert"==c);else if("primer_acercamiento"==b&&"update"==c);else if("seguimiento_pares"==b&&"insert"==c);else if("seguimiento_pares"==b&&"update"==c){var d=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked");d&&a(".btn-dphpforms-update").remove();var e=a(".dphpforms-record .btn-dphpforms-univalle").length;console.log(e),2==e?a(".dphpforms-record .btn-dphpforms-close").css({"margin-left":a(".dphpforms-updater").width()/2-30+"px"}):3==e&&a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-72-30+"px"})}}function c(){a(".dphpforms-peer-record").on("click",function(){var b=a(this).attr("data-record-id");f("seguimiento_pares",b),a("#modal_v2_edit_peer_tracking").fadeIn(300)})}function d(){a(".dphpforms-groupal-record").on("click",function(){var b=a(this).attr("data-record-id");f("seguimiento_grupal",b),a("#modal_v2_edit_groupal_tracking").fadeIn(300)})}function e(b){a.ajax({type:"POST",data:{students:b,type:"consult_students_name"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){if(""!=b){var c='<hr style="border-color:red"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 estudiantes" id="students"><h3>Estudiantes asistentes:</h3><br>'+b+"<br>";a("#modal_v2_edit_groupal_tracking").find("#students").remove(),a("#modal_v2_edit_groupal_tracking").find("form").find("h1").after(c)}},dataType:"text",cache:"false",error:function(a){alert("Error al consultar nombres de los estudiantes pertenecientes a un seguimiento grupal")}})}function f(c,d){a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+c+"&record_id="+d,function(d){if("seguimiento_grupal"==c){a("#body_editor").html(""),a("#modal_v2_edit_groupal_tracking").find("#body_editor").html(""),a("#modal_v2_edit_groupal_tracking").find("#body_editor").append(d),a("#modal_v2_edit_groupal_tracking").find(".btn-dphpforms-univalle").remove();var f=a("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val();e(f)}else{a("#modal_v2_edit_groupal_tracking").find("#body_editor").html(""),a("#body_editor").html(""),a("#body_editor").append(d),a(".dphpforms.dphpforms-record.dphpforms-updater").append('<br><br><div class="div-observation col-xs-12 col-sm-12 col-md-12 col-lg-12 comentarios_vida_uni">Observaciones de Practicante/profesional:<br> <textarea id="observation_text" class="form-control " name="observation_text" maxlength="5000"></textarea><br><a id="send_observation" class="btn btn-sm btn-danger btn-dphpforms-univalle btn-dphpforms-send-observation">Enviar observación</a></div>'),a("button.btn.btn-sm.btn-danger.btn-dphpforms-univalle").attr("id","button");var g=d.indexOf("seguimiento_de_pares_");g!=-1&&b("seguimiento_pares","update")}a("#permissions_informationr").html("");var h=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),i=a(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(h||i)&&a(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var j=JSON.parse(a("#permissions_information").text()),k=0;k<j.behaviors_permissions.length;k++){for(var l=j.behaviors_permissions[k].behaviors[0],m=l.behaviors_accessibility,n=0;n<m.length;n++){var o=m[n].disabled;"true"==o?o=!0:"false"==o&&(o=!1),a(".dphpforms-record").find("#"+m[n].id).prop("disabled",o),a(".dphpforms-record").find("."+m[n]["class"]).prop("disabled",o)}for(var p=l.behaviors_fields_to_remove,n=0;n<p.length;n++)a(".dphpforms-record").find("#"+p[n].id).remove(),a(".dphpforms-record").find("."+p[n]["class"]).remove();for(var q=l.limpiar_to_eliminate,n=0;n<q.length;n++)a(".dphpforms-record").find("."+q[n]["class"]+".limpiar ").remove()}a("#permissions_informationr").html("")})}function g(){a('a[class*="practicant"]').click(function(){var b=a(this).attr("href").split("#practicant")[1],c=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_practicants_of_professional",practicant_code:b,instance:o()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(c+" > div").empty(),a(c+" > div").append(b),h(),i()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el practicante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function h(){a('a[class*="monitor"]').click(function(){var b=a(this).attr("href").split("#monitor")[1],c=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_monitors_of_practicant",monitor_code:b,instance:o()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(c+" > div").empty(),a(c+" > div").append(b),j(),i()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el monitor seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function i(){a('a[class*="groupal"]').click(function(){var b=a(this).attr("href").split("#groupal")[1],c=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_groupal_trackings",student_code:b,instance:o()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(c+" > div").empty(),a(c+" > div").append(b),d()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con los seguimientos grupales seleccionados.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function j(){a('a[class*="student"]').click(function(){var b=a(this).attr("href").split("#student")[1],e=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_student_trackings",student_code:b,instance:o()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(e+" > div").empty(),a(e+" > div").append(b),c(),d()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el estudiante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function k(b,e){a("#periodos").change(function(){if("sistemas"!=namerol){var f=a("#periodos").val(),k=q;a.ajax({type:"POST",data:{id_persona:k,id_semestre:f,instance:b,otro:!0,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){""==b?(a("#reemplazarToogle").html("<label> No se encontraron registros </label>"),crear_conteo(e)):(a("#reemplazarToogle").html(b),j(),h(),g(),i()),a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow"),crear_conteo(e)},dataType:"text",cache:"false",error:function(a){swal("ERROR!","Oops!, Se presentó un error al consultar seguimientos de personas","error")}}),c(),d()}})}function l(b){a("#personas").val("").change(),a("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),a("#periodos").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),n(b,namerol),a("#consultar_persona").on("click",function(){var b=a("#personas").children(":selected").attr("value"),e=a("#periodos").children(":selected").attr("value");void 0==b?swal({title:"Debe escoger una persona para realizar la consulta",html:!0,type:"warning",confirmButtonColor:"#d51b23"}):(a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").show(),a(".se-pre-con").show(),a("#reemplazarToogle").hide(),a.ajax({type:"POST",data:{id_persona:b,id_semestre:e,instance:o(),type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){""==b?a("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(a("#reemplazarToogle").html(b),a("input[name=practicante]").prop("disabled",!0),a("input[name=profesional]").prop("disabled",!0)),j(),h(),g(),i(),a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow")},dataType:"text",cache:"false",error:function(a){swal("ERROR!","Oops!, Se presentó un error al cargar seguimientos de personas","error")},complete:function(){a(".se-pre-con").hide(),a("#reemplazarToogle").fadeIn()}}),c(),d())})}function m(b){a("body").on("click","#send_observation",function(){var c=a("form").serializeArray(),d={};a(c).each(function(a,b){d[b.name]=b.value});var e=d.id_registro,f=a("#observation_text");if(console.log(),""==f.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var g="individual",h=a(".id_creado_por").find("input").val(),i=a(".fecha").find("input").val(),j=f.val(),k=a("#periodos").val(),l=a(".lugar").find("input").val();a.ajax({type:"POST",data:{id_tracking:e,type:"send_email_to_user",form:"new_form",tracking_type:g,monitor_code:h,date:i,message_to_send:j,semester:k,instance:b,place:l},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){console.log(a),"Error"!=a?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),f.val("")):(console.log("mensaje error : "+a),swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"}))},dataType:"text",cache:"false",error:function(a){console.log("mensaje error : "+a),swal("ERROR!","Oops!, Se presentó un error al enviar el correo","error")}})}})}function n(b,c){a("#periodos").change(function(){var d=a("#periodos").val();a.ajax({type:"POST",data:{id:d,instance:b,type:"update_people"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){if(a("#personas").empty(),a("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),"sistemas"==c){var d='<option value="">Seleccionar persona</option>';a("#personas").attr("selectedIndex","-1").find("option:selected").removeAttr("selected"),a("#personas").append(d+b)}},dataType:"text",cache:"false",error:function(a){swal("ERROR!","Oops!, Se presentó un error al cargar personas","error")}})})}function o(){for(var a=window.location.search.split("&"),b=0;b<a.length;b++){var c=a[b].split("=");if("?instanceid"==c[0]||"instanceid"==c[0])var d=c[1]}return d}var p=0,q=0,r="",s="";a(document).on("click",".btn-dphpforms-close",function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a(".outside").click(function(){var b=a(this);swal({title:"Confirmación de salida",text:"",type:"warning",showCancelButton:!0,confirmButtonText:"Salir"},function(c){c&&(a(b).parent(".mymodal").fadeOut(300),console.log(a(this).parent(".mymodal")))})}),a(document).ready(function(){a(".se-pre-con").fadeOut("slow"),a("#reemplazarToogle").fadeIn("slow"),a.ajax({type:"POST",data:{type:"getInfo",instance:o()},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){$data=a.parseJSON(b),r=$data.username,q=$data.id,s=$data.email,p=$data.rol,namerol=$data.name_rol},dataType:"text",cache:"false",error:function(a){swal({title:"error al obtener información del usuario, getInfo.",html:!0,type:"error",confirmButtonColor:"#d51b23"})}}),r="";var b=[];b.id=q,b.name=r,b.namerol=namerol,"practicante_ps"==namerol?(k(o(),b),m(o())):"profesional_ps"==namerol?(k(o(),b),m(o())):"monitor_ps"==namerol?k(o(),b):"sistemas"==namerol&&(l(o()),m(o()))}),a(document).on("click",".dphpforms > #button",function(b){b.preventDefault(),a(":disabled").prop("disabled",!1);var c=(new FormData,a(this).parent()),d=c.attr("action");"procesador.php"==c.attr("action")&&(d="../managers/dphpforms/procesador.php"),a.ajax({type:"POST",url:d,data:a("form.dphpforms").serialize(),dataType:"json",success:function(b){var c=b;if(0==c.status){var d="";"Stored"==c.message?d="Almacenado":"Updated"==c.message&&(d="Actualizado"),swal({title:"Información",text:d,type:"success"},function(){"Updated"==c.message&&a("#dphpforms-peer-record-"+a("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3)}),a(".dphpforms-response").trigger("reset"),a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300)}else if(c.status==-2){var d="";"Without changes"==c.message?(d="No hay cambios que registrar",a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300),a("#modal_primer_acercamiento").fadeOut(300),a("#modal_seguimiento_geografico").fadeOut(300)):"Unfulfilled rules"==c.message&&(d="Revise los valores ingresados"),swal("Alerta",d,"warning")}else c.status==-1&&swal("ERROR!","Oops!, informe de este error","error")},error:function(a){swal("Error!","Oops!, informe de este error","error")}})}),a(".mymodal-close").click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),j(),h(),g(),i()}}});