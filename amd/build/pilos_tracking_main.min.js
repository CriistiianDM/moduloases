'use strict';define(['jquery','block_ases/Modernizr-v282','block_ases/bootstrap','block_ases/jquery.dataTables','block_ases/sweetalert','block_ases/select2'],function(a){return{init:function init(){function h(G,H){if('primer_acercamiento'==G&&'insert'==H);else if('primer_acercamiento'==G&&'update'==H);else if('seguimiento_pares'==G&&'insert'==H);else if('seguimiento_pares'==G&&'update'==H){var I=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),J=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');I&&(a('.btn-dphpforms-delete-record').remove(),a('.btn-dphpforms-update').remove());J&&a('.btn-dphpforms-delete-record').remove();var K=a('.dphpforms-record .btn-dphpforms-univalle').length;2==K?a('.dphpforms-record .btn-dphpforms-close').css({'margin-left':a('.dphpforms-updater').width()/2-30+'px'}):3==K&&a('.dphpforms-record .btn-dphpforms-univalle:eq(0)').css({'margin-left':a('.dphpforms-updater').width()/2-72-30+'px'})}else if('seguimiento_geografico_'==G&&'insert'==H);else if('seguimiento_geografico_'==G&&'update'==H);else if('seguimiento_grupal_'==G&&'insert'==H);else if('seguimiento_grupal_'==G&&'update'==H);}function j(){a('.dphpforms-peer-record').on('click',function(){var G=a(this).attr('data-record-id');q('seguimiento_pares',G),a('#modal_v2_edit_peer_tracking').fadeIn(300)})}function k(){a('.dphpforms-groupal-record').on('click',function(){var G=a(this).attr('data-record-id');q('seguimiento_grupal',G),a('#modal_v2_edit_groupal_tracking').fadeIn(300)})}function l(G,H){var I=m('.puntuacion_riesgo_individual'),J=a('.comentarios_individual').find('textarea').val();var K=m('.puntuacion_riesgo_familiar'),L=a('.comentarios_familiar').find('textarea').val(),M=m('.puntuacion_riesgo_academico'),N=a('.comentarios_academico').find('textarea').val(),O=m('.puntuacion_riesgo_economico'),P=a('.comentarios_economico').find('textarea').val(),Q=m('.puntuacion_vida_uni'),R=a('.comentarios_vida_uni').find('textarea').val();if('3'==I||'3'==K||'3'==M||'3'==O||'3'==Q){var S={'function':'send_email_dphpforms',student_code:H,risks:[{name:'Individual',risk_lvl:I,observation:J},{name:'Familiar',risk_lvl:K,observation:L},{name:'Acad\xE9mico',risk_lvl:M,observation:N},{name:'Econ\xF3mico',risk_lvl:O,observation:P},{name:'Vida Universitaria',risk_lvl:Q,observation:R}],date:a('.fecha').find('input').val(),url:window.location.href};a.ajax({type:'POST',data:JSON.stringify(S),url:'../managers/pilos_tracking/send_risk_email.php',success:function success(T){console.log(T)},dataType:'text',cache:'false',error:function error(T){console.log(T)}})}}function m(G){var H=0;return a(G).find('.opcionesRadio').find('div').each(function(){a(this).find('label').find('input').is(':checked')&&(H=a(this).find('label').find('input').val())}),H}function n(G){a.ajax({type:'POST',data:{type:'user_specific_counting',user:G,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(H){a.each(H,function(J,K){a('#counting_'+K.code).html(K.html)}),o(G),a('#loading').fadeOut('slow')},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente al cargar conteo de usuarios',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})}function o(G){var H=0,I=0,J=0,K=0,L;a('.review_prof').each(function(){H+=parseInt(a(this).text(),10)}),a('.not_review_prof').each(function(){I+=parseInt(a(this).text(),10)}),a('.review_pract').each(function(){J+=parseInt(a(this).text(),10)}),a('.not_review_pract').each(function(){K+=parseInt(a(this).text(),10)}),'profesional_ps'==G.namerol?L='PROFESIONAL':'practicante_ps'==G.namerol?L='PRACTICANTE':'monitor_ps'==G.namerol?L='MONITOR':'sistemas'==G.namerol&&(L='SISTEMAS'),advice='',advice+='<h2> INFORMACI\xD3N DE  '+L+'</h2><hr>',advice+='<div class="row">',advice+='<div class="col-sm-6">',advice+='<strong>Profesional</strong><br>',advice+='Revisado :'+H+' - No revisado : '+I+' -  Total :'+(H+I)+'</div>',advice+='<div class="col-sm-6">',advice+='<strong>Practicante</strong><br>',advice+='Revisado :'+J+' - No revisado : '+K+' -  Total :'+(J+K)+'</div></div>',a('#div-header-info').html(advice)}function p(G){a.ajax({type:'POST',data:{students:G,type:'consult_students_name'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(H){if(''!=H){a('#modal_v2_edit_groupal_tracking').find('#students').remove(),a('#modal_v2_edit_groupal_tracking').find('form').find('h1').after('<hr style="border-color:red"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 estudiantes" id="students"><h3>Estudiantes asistentes:</h3><br>'+H+'<br>')}},dataType:'text',cache:'false',error:function error(){alert('Error al consultar nombres de los estudiantes pertenecientes a un seguimiento grupal')}})}function q(G,H){a.get('../managers/dphpforms/dphpforms_forms_core.php?form_id='+G+'&record_id='+H,function(I){if('seguimiento_grupal'==G){a('#body_editor').html(''),a('#modal_v2_edit_groupal_tracking').find('#body_editor').html(''),a('#modal_v2_edit_groupal_tracking').find('#body_editor').append(I),a('#modal_v2_edit_groupal_tracking').find('.btn-dphpforms-univalle').remove();var J=a('#modal_v2_edit_groupal_tracking').find('form').find('.oculto.id_estudiante').find('input').val();p(J)}else{a('#modal_v2_edit_groupal_tracking').find('#body_editor').html(''),a('#body_editor').html(''),a('#body_editor').append(I),a('.dphpforms.dphpforms-record.dphpforms-updater').append('<br><br><div class="div-observation col-xs-12 col-sm-12 col-md-12 col-lg-12 comentarios_vida_uni">Observaciones de Practicante/profesional:<br> <textarea id="observation_text" class="form-control " name="observation_text" maxlength="5000"></textarea><br><a id="send_observation" class="btn btn-sm btn-danger btn-dphpforms-univalle btn-dphpforms-send-observation">Enviar observaci\xF3n</a></div>'),a('button.btn.btn-sm.btn-danger.btn-dphpforms-univalle').attr('id','button');var K=I.indexOf('seguimiento_de_pares_');-1!=K&&h('seguimiento_pares','update')}a('#permissions_informationr').html('');var L=a('.dphpforms-record').find('.revisado_profesional').find('.checkbox').find('input[type=checkbox]').prop('checked'),M=a('.dphpforms-record').find('.revisado_practicante').find('.checkbox').find('input[type=checkbox]').prop('checked');L&&a('.dphpforms-record').find('.btn-dphpforms-delete-record').remove();for(var N=JSON.parse(a('#permissions_information').text()),O=0;O<N.behaviors_permissions.length;O++){for(var S,P=N.behaviors_permissions[O].behaviors[0],Q=P.behaviors_accessibility,R=0;R<Q.length;R++)S=Q[R].disabled,'true'==S?S=!0:'false'==S&&(S=!1),a('.dphpforms-record').find('#'+Q[R].id).prop('disabled',S),a('.dphpforms-record').find('.'+Q[R]['class']).prop('disabled',S);for(var T=P.behaviors_fields_to_remove,R=0;R<T.length;R++)a('.dphpforms-record').find('#'+T[R].id).remove(),a('.dphpforms-record').find('.'+T[R]['class']).remove();for(var U=P.limpiar_to_eliminate,R=0;R<U.length;R++)a('.dphpforms-record').find('.'+U[R]['class']+'.limpiar ').remove()}a('#permissions_informationr').html('')})}function r(){a('a[class*="practicant"]').click(function(){var G=a(this).attr('href').split('#practicant')[1],H=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_practicants_of_professional',practicant_code:G,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(I){a(H+' > div').empty(),a(H+' > div').append(I.render);var J=I.counting;a.each(J,function(K,L){a('#counting_'+L.code).html(L.html)}),s(),t()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el practicante seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function s(){a('a[class*="monitor"]').click(function(){var G=a(this).attr('href').split('#monitor')[1],H=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_monitors_of_practicant',monitor_code:G,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(I){a(H+' > div').empty(),a(H+' > div').append(I),u(),t()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el monitor seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function t(){a('a[class*="groupal"]').click(function(){var G=a(this).attr('href').split('#groupal')[1],H=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_groupal_trackings',student_code:G,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(I){a(H+' > div').empty(),a(H+' > div').append(I),k()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con los seguimientos grupales seleccionados.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function u(){a('a[class*="student"]').click(function(){var G=a(this).attr('href').split('#student')[1],H=a(this).attr('href');a.ajax({type:'POST',data:{type:'get_student_trackings',student_code:G,instance:B()},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(I){a(H+' > div').empty(),a(H+' > div').append(I),j(),k()},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente con el estudiante seleccionado.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})}),a('.see_history').unbind().click(function(){var H=a(this).parents().eq(3).attr('href').split('#monitor')[1];a.ajax({type:'POST',data:{type:'redirect_tracking_time_control',monitor:H},url:'../managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(I){var J=window.location.href,K=J.replace('report_trackings','tracking_time_control');try{var L=window.open(K+'&&monitorid='+I,'_blank');L&&L.focus()}catch(M){alert('Se ha producido un error al abrir la ventana : '+M)}},dataType:'json',cache:'false',error:function error(){swal({title:'Oops !',text:'Se present\xF3 un inconveniente al reedirecionar al reporte de horas.',html:!0,type:'warning',confirmButtonColor:'#d51b23'})}})})}function v(G){a('#periodos').change(function(){if('sistemas'!=namerol){var I=a('#periodos').val(),J=D;a.ajax({type:'POST',data:{id_persona:J,id_semestre:I,instance:G,otro:!0,type:'consulta_sistemas'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(K){''==K?a('#reemplazarToogle').html('<label> No se encontraron registros </label>'):(a('#reemplazarToogle').html(K),u(),s(),r(),t()),a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').slideDown('slow')},dataType:'text',cache:'false',error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al consultar seguimientos de personas','error')}}),j(),k()}})}function w(G){a('#personas').val('').change(),a('#personas').select2({placeholder:'Seleccionar persona',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),a('#periodos').select2({language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),A(G,namerol),a('#consultar_persona').on('click',function(){var H=a('#personas').children(':selected').attr('value'),I=a('#periodos').children(':selected').attr('value');H==void 0?swal({title:'Debe escoger una persona para realizar la consulta',html:!0,type:'warning',confirmButtonColor:'#d51b23'}):(a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').show(),a('.se-pre-con').show(),a('#reemplazarToogle').hide(),a.ajax({type:'POST',data:{id_persona:H,id_semestre:I,instance:B(),type:'consulta_sistemas'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(K){''==K?a('#reemplazarToogle').html('<label> No se encontraron registros </label>'):(a('#reemplazarToogle').html(K),a('input[name=practicante]').prop('disabled',!0),a('input[name=profesional]').prop('disabled',!0)),u(),s(),r(),t(),a('.well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto').slideDown('slow')},dataType:'text',cache:'false',error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al cargar seguimientos de personas','error')},complete:function complete(){a('.se-pre-con').hide(),a('#reemplazarToogle').fadeIn()}}),j(),k())})}function y(G){a('body').on('click','#send_observation',function(){var H=a('form').serializeArray(),I={};a(H).each(function(S,T){I[T.name]=T.value});var J=I.id_registro,K=a('#observation_text');if(''==K.val())swal({title:'Para enviar una observaci\xF3n debe llenar el campo correspondiente',html:!0,type:'error',confirmButtonColor:'#d51b23'});else{var M=a('.id_creado_por').find('input').val(),N=a('.fecha').find('input').val(),O=K.val(),P=a('#periodos').val(),Q=a('.lugar').find('input').val();a.ajax({type:'POST',data:{id_tracking:J,type:'send_email_to_user',form:'new_form',tracking_type:'individual',monitor_code:M,date:N,message_to_send:O,semester:P,instance:G,place:Q},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(S){'Error'==S?(console.log('mensaje error : '+S),swal({title:'error al enviar el correo al monitor',html:!0,type:'error',confirmButtonColor:'#d51b23'})):(swal({title:'Correo enviado',html:!0,type:'success',confirmButtonColor:'#d51b23'}),K.val(''))},dataType:'text',cache:'false',error:function error(S){console.log('mensaje error : '+S),swal('ERROR!','Oops!, Se present\xF3 un error al enviar el correo','error')}})}})}function A(G,H){a('#periodos').change(function(){var I=a('#periodos').val();a.ajax({type:'POST',data:{id:I,instance:G,type:'update_people'},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(J){if(a('#personas').empty(),a('#personas').select2({placeholder:'Seleccionar persona',language:{noResults:function noResults(){return'No hay resultado'},searching:function searching(){return'Buscando..'}}}),'sistemas'==H){a('#personas').attr('selectedIndex','-1').find('option:selected').removeAttr('selected'),a('#personas').append('<option value="">Seleccionar persona</option>'+J)}},dataType:'text',cache:'false',error:function error(){swal('ERROR!','Oops!, Se present\xF3 un error al cargar personas','error')}})})}function B(){for(var I,G=window.location.search.split('&'),H=0;H<G.length;H++)if(I=G[H].split('='),'?instanceid'==I[0]||'instanceid'==I[0])var J=I[1];return J}var C=0,D=0,E='',F='';a(document).on('click','.btn-dphpforms-close',function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a('.outside').click(function(){var G=a(this);swal({title:'Confirmaci\xF3n de salida',text:'',type:'warning',showCancelButton:!0,confirmButtonText:'Salir'},function(H){H&&a(G).parent('.mymodal').fadeOut(300)})}),a(document).ready(function(){a('.se-pre-con').fadeOut('slow'),a('#reemplazarToogle').fadeIn('slow'),a.ajax({type:'POST',data:{type:'getInfo',instance:B()},url:'../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php',async:!1,success:function success(H){$data=a.parseJSON(H),E=$data.username,D=$data.id,F=$data.email,C=$data.rol,namerol=$data.name_rol},dataType:'text',cache:'false',error:function error(){swal({title:'error al obtener informaci\xF3n del usuario, getInfo.',html:!0,type:'error',confirmButtonColor:'#d51b23'})}}),E='';var G=[];G.id=D,G.name=E,G.namerol=namerol,n(G),'practicante_ps'==namerol?(v(B(),G),y(B())):'profesional_ps'==namerol?(v(B(),G),y(B())):'monitor_ps'==namerol?(v(B(),G),y(B())):'sistemas'==namerol&&(w(B()),y(B()))});a(document).on('click','.dphpforms > #button',function(G){G.preventDefault(),a(':disabled').prop('disabled',!1);var H=new FormData,I=a(this).parent(),J=I.attr('action');'procesador.php'==I.attr('action')&&(J='../managers/dphpforms/procesador.php');var K=I.find('.id_estudiante').find('input').val();a.ajax({type:'POST',url:J,data:a('form.dphpforms').serialize(),dataType:'json',success:function success(L){var M=L;if(0==M.status){a.get('../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg='+K,function(O){console.log(O)});var N='';'Stored'==M.message?N='Almacenado':'Updated'==M.message&&(N='Actualizado'),l(!1,K),swal({title:'Informaci\xF3n',text:N,type:'success'},function(){'Updated'==M.message&&a('#dphpforms-peer-record-'+a('#dphpforms_record_id').val()).stop().animate({backgroundColor:'rgb(175, 255, 173)'},400).animate({backgroundColor:'#f5f5f5'},4e3)}),a('.dphpforms-response').trigger('reset'),a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300)}else if(-2==M.status){var N='';'Without changes'==M.message?(N='No hay cambios que registrar',a('#modal_v2_edit_peer_tracking').fadeOut(300),a('#modal_v2_peer_tracking').fadeOut(300),a('#modal_primer_acercamiento').fadeOut(300),a('#modal_seguimiento_geografico').fadeOut(300)):'Unfulfilled rules'==M.message&&(N='Revise los valores ingresados'),swal('Alerta',N,'warning')}else-1==M.status&&swal('ERROR!','Oops!, informe de este error','error')},error:function error(){swal('Error!','Oops!, informe de este error','error')}})}),a('.mymodal-close').click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),u(),s(),r(),t()}}});