define(["jquery","block_ases/Modernizr-v282","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert","block_ases/select2"],function(a,b,c,d,e,f){return{init:function(){function b(b,c){if("primer_acercamiento"==b&&"insert"==c);else if("primer_acercamiento"==b&&"update"==c);else if("seguimiento_pares"==b&&"insert"==c);else if("seguimiento_pares"==b&&"update"==c){var d=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),e=a(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");d&&(a(".btn-dphpforms-delete-record").remove(),a(".btn-dphpforms-update").remove()),e&&a(".btn-dphpforms-delete-record").remove();var f=a(".dphpforms-record .btn-dphpforms-univalle").length;2==f?a(".dphpforms-record .btn-dphpforms-close").css({"margin-left":a(".dphpforms-updater").width()/2-30+"px"}):3==f&&a(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":a(".dphpforms-updater").width()/2-72-30+"px"})}}function c(){a(".dphpforms-peer-record").on("click",function(){var b=a(this).attr("data-record-id");j("seguimiento_pares",b),a("#modal_v2_edit_peer_tracking").fadeIn(300)})}function d(){a(".dphpforms-groupal-record").on("click",function(){var b=a(this).attr("data-record-id");j("seguimiento_grupal",b),a("#modal_v2_edit_groupal_tracking").fadeIn(300)})}function e(b,c){var d=f(".puntuacion_riesgo_individual"),e=a(".comentarios_individual").find("textarea").val(),g=f(".puntuacion_riesgo_familiar"),h=a(".comentarios_familiar").find("textarea").val(),i=f(".puntuacion_riesgo_academico"),j=a(".comentarios_academico").find("textarea").val(),k=f(".puntuacion_riesgo_economico"),l=a(".comentarios_economico").find("textarea").val(),m=f(".puntuacion_vida_uni"),n=a(".comentarios_vida_uni").find("textarea").val();if("3"==d||"3"==g||"3"==i||"3"==k||"3"==m){var o={"function":"send_email_dphpforms",student_code:c,risks:[{name:"Individual",risk_lvl:d,observation:e},{name:"Familiar",risk_lvl:g,observation:h},{name:"Académico",risk_lvl:i,observation:j},{name:"Económico",risk_lvl:k,observation:l},{name:"Vida Universitaria",risk_lvl:m,observation:n}],date:a(".fecha").find("input").val(),url:window.location.href};a.ajax({type:"POST",data:JSON.stringify(o),url:"../managers/pilos_tracking/send_risk_email.php",success:function(a){console.log(a)},dataType:"text",cache:"false",error:function(a){console.log(a)}})}}function f(b){var c=0;return a(b).find(".opcionesRadio").find("div").each(function(){a(this).find("label").find("input").is(":checked")&&(c=a(this).find("label").find("input").val())}),c}function g(b){a.ajax({type:"POST",data:{type:"user_specific_counting",user:b,instance:s()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(c){var d=c;a.each(d,function(b,c){a("#counting_"+c.code).html(c.html)}),h(b),a("#loading").fadeOut("slow")},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente al cargar conteo de usuarios",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})}function h(b){var c,d=0,e=0,f=0,g=0;a(".review_prof").each(function(b,c){d+=parseInt(a(this).text(),10)}),a(".not_review_prof").each(function(b,c){e+=parseInt(a(this).text(),10)}),a(".review_pract").each(function(b,c){f+=parseInt(a(this).text(),10)}),a(".not_review_pract").each(function(b,c){g+=parseInt(a(this).text(),10)}),"profesional_ps"==b.namerol?c="PROFESIONAL":"practicante_ps"==b.namerol?c="PRACTICANTE":"monitor_ps"==b.namerol?c="MONITOR":"sistemas"==b.namerol&&(c="SISTEMAS"),advice="",advice+="<h2> INFORMACIÓN DE  "+c+"</h2><hr>",advice+='<div class="row">',advice+='<div class="col-sm-6">',advice+="<strong>Profesional</strong><br>",advice+="Revisado :"+d+" - No revisado : "+e+" -  Total :"+(d+e)+"</div>",advice+='<div class="col-sm-6">',advice+="<strong>Practicante</strong><br>",advice+="Revisado :"+f+" - No revisado : "+g+" -  Total :"+(f+g)+"</div></div>",a("#div-header-info").html(advice)}function i(b){a.ajax({type:"POST",data:{students:b,type:"consult_students_name"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){if(""!=b){var c='<hr style="border-color:red"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 estudiantes" id="students"><h3>Estudiantes asistentes:</h3><br>'+b+"<br>";a("#modal_v2_edit_groupal_tracking").find("#students").remove(),a("#modal_v2_edit_groupal_tracking").find("form").find("h1").after(c)}},dataType:"text",cache:"false",error:function(a){alert("Error al consultar nombres de los estudiantes pertenecientes a un seguimiento grupal")}})}function j(c,d){a.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+c+"&record_id="+d,function(d){if("seguimiento_grupal"==c){a("#body_editor").html(""),a("#modal_v2_edit_groupal_tracking").find("#body_editor").html(""),a("#modal_v2_edit_groupal_tracking").find("#body_editor").append(d),a("#modal_v2_edit_groupal_tracking").find(".btn-dphpforms-univalle").remove();var e=a("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val();i(e)}else{a("#modal_v2_edit_groupal_tracking").find("#body_editor").html(""),a("#body_editor").html(""),a("#body_editor").append(d),a(".dphpforms.dphpforms-record.dphpforms-updater").append('<br><br><div class="div-observation col-xs-12 col-sm-12 col-md-12 col-lg-12 comentarios_vida_uni">Observaciones de Practicante/profesional:<br> <textarea id="observation_text" class="form-control " name="observation_text" maxlength="5000"></textarea><br><a id="send_observation" class="btn btn-sm btn-danger btn-dphpforms-univalle btn-dphpforms-send-observation">Enviar observación</a></div>'),a("button.btn.btn-sm.btn-danger.btn-dphpforms-univalle").attr("id","button");var f=d.indexOf("seguimiento_de_pares_");f!=-1&&b("seguimiento_pares","update")}a("#permissions_informationr").html("");var g=a(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked");a(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");g&&a(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var h=JSON.parse(a("#permissions_information").text()),j=0;j<h.behaviors_permissions.length;j++){for(var k=h.behaviors_permissions[j].behaviors[0],l=k.behaviors_accessibility,m=0;m<l.length;m++){var n=l[m].disabled;"true"==n?n=!0:"false"==n&&(n=!1),a(".dphpforms-record").find("#"+l[m].id).prop("disabled",n),a(".dphpforms-record").find("."+l[m]["class"]).prop("disabled",n)}for(var o=k.behaviors_fields_to_remove,m=0;m<o.length;m++)a(".dphpforms-record").find("#"+o[m].id).remove(),a(".dphpforms-record").find("."+o[m]["class"]).remove();for(var p=k.limpiar_to_eliminate,m=0;m<p.length;m++)a(".dphpforms-record").find("."+p[m]["class"]+".limpiar ").remove()}a("#permissions_informationr").html("")})}function k(){a('a[class*="practicant"]').click(function(){var b=a(this).attr("href").split("#practicant")[1],c=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_practicants_of_professional",practicant_code:b,instance:s()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(c+" > div").empty(),a(c+" > div").append(b.render);var d=b.counting;a.each(d,function(b,c){a("#counting_"+c.code).html(c.html)}),l(),m()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el practicante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function l(){a('a[class*="monitor"]').click(function(){var b=a(this).attr("href").split("#monitor")[1],c=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_monitors_of_practicant",monitor_code:b,instance:s()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(c+" > div").empty(),a(c+" > div").append(b),n(),m()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el monitor seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function m(){a('a[class*="groupal"]').click(function(){var b=a(this).attr("href").split("#groupal")[1],c=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_groupal_trackings",student_code:b,instance:s()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(c+" > div").empty(),a(c+" > div").append(b),d()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con los seguimientos grupales seleccionados.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function n(){a('a[class*="student"]').click(function(){var b=a(this).attr("href").split("#student")[1],e=a(this).attr("href");a.ajax({type:"POST",data:{type:"get_student_trackings",student_code:b,instance:s()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){a(e+" > div").empty(),a(e+" > div").append(b),c(),d()},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente con el estudiante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})}),a(".see_history").unbind().click(function(b){var c=a(this).parents().eq(3).attr("href").split("#monitor")[1];a.ajax({type:"POST",data:{type:"redirect_tracking_time_control",monitor:c},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){var b=window.location.href,c=b.replace("report_trackings","tracking_time_control");try{var d=window.open(c+"&&monitorid="+a,"_blank");d&&d.focus()}catch(e){alert("Se ha producido un error al abrir la ventana : "+e)}},dataType:"json",cache:"false",error:function(a){swal({title:"Oops !",text:"Se presentó un inconveniente al reedirecionar al reporte de horas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function o(b,e){a("#periodos").change(function(){if("sistemas"!=x){var e=a("#periodos").val(),f=u;a.ajax({type:"POST",data:{id_persona:f,id_semestre:e,instance:b,otro:!0,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){""==b?a("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(a("#reemplazarToogle").html(b),n(),l(),k(),m()),a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow")},dataType:"text",cache:"false",error:function(a){swal("ERROR!","Oops!, Se presentó un error al consultar seguimientos de personas","error")}}),c(),d()}})}function p(b){a("#personas").val("").change(),a("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),a("#periodos").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),r(b,x),a("#consultar_persona").on("click",function(){var b=a("#personas").children(":selected").attr("value"),e=a("#periodos").children(":selected").attr("value");void 0==b?swal({title:"Debe escoger una persona para realizar la consulta",html:!0,type:"warning",confirmButtonColor:"#d51b23"}):(a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").show(),a(".se-pre-con").show(),a("#reemplazarToogle").hide(),a.ajax({type:"POST",data:{id_persona:b,id_semestre:e,instance:s(),type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){""==b?a("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(a("#reemplazarToogle").html(b),a("input[name=practicante]").prop("disabled",!0),a("input[name=profesional]").prop("disabled",!0)),n(),l(),k(),m(),a(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow")},dataType:"text",cache:"false",error:function(a){swal("ERROR!","Oops!, Se presentó un error al cargar seguimientos de personas","error")},complete:function(){a(".se-pre-con").hide(),a("#reemplazarToogle").fadeIn()}}),c(),d())})}function q(b){a("body").on("click","#send_observation",function(){var c=a("form").serializeArray(),d={};a(c).each(function(a,b){d[b.name]=b.value});var e=d.id_registro,f=a("#observation_text");if(""==f.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var g="individual",h=a(".id_creado_por").find("input").val(),i=a(".fecha").find("input").val(),j=f.val(),k=a("#periodos").val(),l=a(".lugar").find("input").val();a.ajax({type:"POST",data:{id_tracking:e,type:"send_email_to_user",form:"new_form",tracking_type:g,monitor_code:h,date:i,message_to_send:j,semester:k,instance:b,place:l},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){"Error"!=a?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),f.val("")):(console.log("mensaje error : "+a),swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"}))},dataType:"text",cache:"false",error:function(a){console.log("mensaje error : "+a),swal("ERROR!","Oops!, Se presentó un error al enviar el correo","error")}})}})}function r(b,c){a("#periodos").change(function(){var d=a("#periodos").val();a.ajax({type:"POST",data:{id:d,instance:b,type:"update_people"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){if(a("#personas").empty(),a("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),"sistemas"==c){var d='<option value="">Seleccionar persona</option>';a("#personas").attr("selectedIndex","-1").find("option:selected").removeAttr("selected"),a("#personas").append(d+b)}},dataType:"text",cache:"false",error:function(a){swal("ERROR!","Oops!, Se presentó un error al cargar personas","error")}})})}function s(){for(var a=window.location.search.split("&"),b=0;b<a.length;b++){var c=a[b].split("=");if("?instanceid"==c[0]||"instanceid"==c[0])var d=c[1]}return d}var t=0,u=0,v="",w="",x="";a(document).on("click",".btn-dphpforms-close",function(){a(this).closest('div[class="mymodal"]').fadeOut(300)}),a(".outside").click(function(){var b=a(this);swal({title:"Confirmación de salida",text:"",type:"warning",showCancelButton:!0,confirmButtonText:"Salir"},function(c){c&&a(b).parent(".mymodal").fadeOut(300)})}),a(document).ready(function(){a(".se-pre-con").fadeOut("slow"),a("#reemplazarToogle").fadeIn("slow"),a.ajax({type:"POST",data:{type:"getInfo",instance:s()},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(b){$data=a.parseJSON(b),v=$data.username,u=$data.id,w=$data.email,t=$data.rol,x=$data.name_rol},dataType:"text",cache:"false",error:function(a){swal({title:"error al obtener información del usuario, getInfo.",html:!0,type:"error",confirmButtonColor:"#d51b23"})}}),v="";var b=[];b.id=u,b.name=v,b.namerol=x,g(b),"practicante_ps"==x?(o(s(),b),q(s())):"profesional_ps"==x?(o(s(),b),q(s())):"monitor_ps"==x?(o(s(),b),q(s())):"sistemas"==x&&(p(s()),q(s()))}),a(document).on("click",".dphpforms > #button",function(b){b.preventDefault(),a(":disabled").prop("disabled",!1);var c=(new FormData,a(this).parent()),d=c.attr("action");"procesador.php"==c.attr("action")&&(d="../managers/dphpforms/procesador.php");var f=c.find(".id_estudiante").find("input").val();a.ajax({type:"POST",url:d,data:a("form.dphpforms").serialize(),dataType:"json",success:function(b){var c=b;if(0==c.status){a.get("../managers/pilos_tracking/api_pilos_tracking.php?function=update_last_user_risk&arg="+f+"&rid=-1",function(a){console.log(a)});var d="";"Stored"==c.message?d="Almacenado":"Updated"==c.message&&(d="Actualizado"),e(!1,f),swal({title:"Información",text:d,type:"success"},function(){"Updated"==c.message&&a("#dphpforms-peer-record-"+a("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3)}),a(".dphpforms-response").trigger("reset"),a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300)}else if(c.status==-2){var d="";"Without changes"==c.message?(d="No hay cambios que registrar",a("#modal_v2_edit_peer_tracking").fadeOut(300),a("#modal_v2_peer_tracking").fadeOut(300),a("#modal_primer_acercamiento").fadeOut(300),a("#modal_seguimiento_geografico").fadeOut(300)):"Unfulfilled rules"==c.message&&(d="Revise los valores ingresados"),swal("Alerta",d,"warning")}else c.status==-1&&swal("ERROR!","Oops!, informe de este error","error")},error:function(a){swal("Error!","Oops!, informe de este error","error")}})}),a(".mymodal-close").click(function(){a(this).parent().parent().parent().parent().fadeOut(300)}),n(),l(),k(),m()}}});