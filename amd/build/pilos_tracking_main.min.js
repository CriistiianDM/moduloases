define(["jquery","block_ases/Modernizr-v282","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert","block_ases/select2","block_ases/loading_indicator"],function(e,n,t,a,o,r,s){return{init:function(){var n=[],t=0,a="",o="",r=parseInt(e("#current_ases_semester").data("info"));function i(n,t,a,o){let r="get_tracking_count";o&&(r="get_tracking_count_student"),s.show(),e.ajax({type:"POST",data:JSON.stringify({function:r,params:[n,t,a]}),url:"../managers/pilos_tracking/v2/pilos_tracking_api.php",dataType:"json",cache:"false",success:function(n){s.hide();let t=n.data_response,a=0,o=0,r=0,i=0,l=0,c=0;for(let n=0;n<t.length;n++){let s='                                <div class="conteo">                                    <div class="row">                                         <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             Fichas: <strong>'+(a=t[n].count.revisado_profesional+t[n].count.not_revisado_profesional)+'</strong>                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-prof">Pendientes Prof: </div>'+(o=t[n].count.not_revisado_profesional)+'                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-pract">Pendientes pract: </div>'+(r=t[n].count.not_revisado_practicante)+'                                        </div>                                    </div>                                    <div class="row">                                         <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             Inasistencias: <strong>'+(i=t[n].count.in_revisado_profesional+t[n].count.in_not_revisado_profesional)+'</strong>                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-prof">Pendientes Prof: </div>'+(l=t[n].count.in_not_revisado_profesional)+'                                        </div>                                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">                                             <div class="pend-pract">Pendientes pract: </div>'+(c=t[n].count.in_not_revisado_practicante)+"                                        </div>                                    </div>                                </div>                            ";e("#counting_"+t[n].username).find(".loader").html(s)}},error:function(e){s.hide(),console.log(e),swal({title:"Error!",text:"",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}function l(n){e("#general_rev_pro").html("*"),e("#general_rev_prac").html("*"),e("#general_not_rev_pro").html("*"),e("#general_not_rev_prac").html("*"),e("#general_pro_t").html("*"),e("#general_prac_t").html("*"),e("#general_in_rev_pro").html("*"),e("#general_in_rev_prac").html("*"),e("#general_in_not_rev_pro").html("*"),e("#general_in_not_rev_prac").html("*"),e("#general_in_pro_t").html("*"),e("#general_in_prac_t").html("*"),s.show(),e.ajax({type:"POST",data:{type:"user_specific_counting",user:n,instance:m()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!0,dataType:"json",cache:"false",success:function(n){s.hide(),e("#general_rev_pro").html(n.revisado_profesional),e("#general_rev_prac").html(n.revisado_practicante),e("#general_not_rev_pro").html(n.not_revisado_profesional),e("#general_not_rev_prac").html(n.not_revisado_practicante),e("#general_pro_t").html(n.total_profesional),e("#general_prac_t").html(n.total_practicante),e("#general_in_rev_pro").html(n.in_revisado_profesional),e("#general_in_rev_prac").html(n.in_revisado_practicante),e("#general_in_not_rev_pro").html(n.in_not_revisado_profesional),e("#general_in_not_rev_prac").html(n.in_not_revisado_practicante),e("#general_in_pro_t").html(n.in_total_profesional),e("#general_in_prac_t").html(n.in_total_practicante)},error:function(e){s.hide()}})}function c(){e('a[class*="practicant"]').click(function(){let t=e(this).data("username");if(-1==n.indexOf(t)){n.push(t);var a=e(this).attr("href").split("#practicant")[1],o=e(this).attr("href");s.show(),e.ajax({type:"POST",data:{type:"get_practicants_of_professional",practicant_code:a,instance:m()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!0,dataType:"json",cache:"false",success:function(n){s.hide(),e(o+" > div").empty(),e(o+" > div").append(n.render);n.counting;i(a,r,parseInt(m()),!1),p(),d()},error:function(e){s.hide(),swal({title:"Oops !",text:"Se presentó un inconveniente con el practicante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})}})}function p(){e('a[class*="monitor"]').click(function(){let t=e(this).data("username");if(-1==n.indexOf(t)){n.push(t);var a=e(this).attr("href").split("#monitor")[1],o=e(this).attr("href");s.show(),e.ajax({type:"POST",data:{type:"get_monitors_of_practicant",monitor_code:a,instance:m()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!0,dataType:"json",cache:"false",success:function(n){s.hide(),e(o+" > div").empty(),e(o+" > div").append(n),i(a,r,parseInt(m()),!0),u(),d()},error:function(e){s.hide(),swal({title:"Oops !",text:"Se presentó un inconveniente con el monitor seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})}})}function d(){e('a[class*="groupal"]').click(function(){var n=e(this).attr("href").split("#groupal")[1],t=e(this).attr("href");s.show(),e.ajax({type:"POST",data:{type:"get_groupal_trackings",student_code:n,instance:m()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(n){s.hide(),e(t+" > div").empty(),e(t+" > div").append(n)},dataType:"json",cache:"false",error:function(e){s.hide(),swal({title:"Oops !",text:"Se presentó un inconveniente con los seguimientos grupales seleccionados.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function u(){e('a[class*="student"]').click(function(){let t=e(this).data("username");if(-1==n.indexOf(t)){n.push(t);var a=e(this).attr("href").split("#student")[1],o=e(this).attr("href");s.show(),e.ajax({type:"POST",data:{type:"get_student_trackings",student_code:a,instance:m()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(n){s.hide(),e(o+" > div").empty(),e(o+" > div").append(n)},dataType:"json",cache:"false",error:function(e){s.hide(),swal({title:"Oops !",text:"Se presentó un inconveniente con el estudiante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})}}),e(".see_history").unbind().click(function(n){var t=e(this).parents().eq(3).attr("href").split("#monitor")[1];s.show(),e.ajax({type:"POST",data:{type:"redirect_tracking_time_control",monitor:t},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(e){s.hide();var n=window.location.href.replace("report_trackings","tracking_time_control");try{var t=window.open(n+"&&monitorid="+e,"_blank");t&&t.focus()}catch(e){alert("Se ha producido un error al abrir la ventana : "+e)}},dataType:"json",cache:"false",error:function(e){s.hide(),swal({title:"Oops !",text:"Se presentó un inconveniente al reedirecionar al reporte de horas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function _(n,a,r){e("#periodos").change(function(){if("sistemas"!=o){var a=e("#periodos").val(),l=t;s.show(),e.ajax({type:"POST",data:{id_persona:l,id_semestre:a,instance:n,otro:!0,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",dataType:"text",cache:"false",success:function(n){s.hide(),""==n?e("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(e("#reemplazarToogle").html(n),u(),p(),c(),d()),e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow"),i(r,a,parseInt(m()),!1)},error:function(e){s.hide(),swal("ERROR!","Oops!, Se presentó un error al consultar seguimientos de personas","error")}})}})}function f(n){e("body").on("click","#send_observation",function(){var t=e("form").serializeArray(),a={};e(t).each(function(e,n){a[n.name]=n.value});var o=a.id_registro,r=e("#observation_text");if(""==r.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente.",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var i="individual",l=e(".id_creado_por").find("input").val();null==l&&(l=e(".in_id_creado_por").find("input").val(),i="individual_inasistencia");var c=e(".fecha").find("input").val();null==c&&(c=e(".in_fecha").find("input").val());var p=r.val(),d=e("#periodos").val(),u=e(".lugar").find("input").val();null==u&&(u=e(".in_lugar").find("input").val());let t=e("#dphpforms_block_courseid").data("info");s.show(),e.ajax({type:"POST",data:{id_tracking:o,type:"send_email_to_user",form:"new_form",tracking_type:i,monitor_code:l,date:c,message_to_send:p,semester:d,instance:n,place:u,courseid:t},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(e){s.hide(),"Error"!=e?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),r.val("")):(console.log("mensaje error : "),console.log(e),swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"}))},dataType:"text",cache:"false",error:function(e){s.hide(),console.log("mensaje error : "),console.log(e),swal("ERROR!","Oops!, Se presentó un error al enviar el correo","error")}})}})}function m(){for(var e=window.location.search.split("&"),n=0;n<e.length;n++){var t=e[n].split("=");if("?instanceid"==t[0]||"instanceid"==t[0])var a=t[1]}return a}e("#msg-cache").click(function(){swal({title:"¡Información!",text:"Está observando una versión reciente del conteo, más no una versión en vivo. El conteo se actualizará en un intervalo de tiempo no mayor a 30 minutos.",type:"info"})}),e(document).on("click",".btn-dphpforms-close",function(){e(this).closest('div[class="mymodal"]').fadeOut(300)}),e(".outside").click(function(){var n=e(this);swal({title:"Confirmación de salida",text:"",type:"warning",showCancelButton:!0,confirmButtonText:"Salir"},function(t){t&&e(n).parent(".mymodal").fadeOut(300)})}),e(document).ready(function(){e(".se-pre-con").fadeOut("slow"),e("#reemplazarToogle").fadeIn("slow");let h="";s.show(),e.ajax({type:"POST",data:{type:"getInfo",instance:m()},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(n){s.hide(),$data=e.parseJSON(n),a=$data.username,h=$data.username,t=$data.id,$data.email,$data.rol,o=$data.name_rol},dataType:"text",cache:"false",error:function(e){s.hide(),swal({title:"error al obtener información del usuario, getInfo.",html:!0,type:"error",confirmButtonColor:"#d51b23"})}}),a="";var g,v=[];v.id=t,v.name=a,v.namerol=o,l(v),"practicante_ps"==o?(i(h,r,parseInt(m()),!1),_(m(),v,h),f(m())):"profesional_ps"==o?(i(h,r,parseInt(m()),!1),_(m(),v,h),f(m())):"monitor_ps"==o?(i(h,r,parseInt(m()),!0),_(m(),v,h),f(m())):"sistemas"==o&&(g=m(),e("#personas").val("").change(),e("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),e("#periodos").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),function(n,t){e("#periodos").change(function(){var a=e("#periodos").val();s.show(),e.ajax({type:"POST",data:{id:a,instance:n,type:"update_people"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(n){s.hide(),e("#personas").empty(),e("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),"sistemas"==t&&(e("#personas").attr("selectedIndex","-1").find("option:selected").removeAttr("selected"),e("#personas").append('<option value="">Seleccionar persona</option>'+n))},dataType:"text",cache:"false",error:function(e){s.hide(),swal("ERROR!","Oops!, Se presentó un error al cargar personas","error")}})})}(g,o),e("#consultar_persona").on("click",function(){var t=e("#personas").children(":selected").attr("value"),a=e("#periodos").children(":selected").attr("value");let o=e("#personas").children(":selected").data("username");if(n=[],null==t)swal({title:"Debe escoger una persona para realizar la consulta",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else{e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").show(),e(".se-pre-con").show(),e("#reemplazarToogle").hide();let n=t;s.show(),e.ajax({type:"POST",data:{id_persona:t,id_semestre:a,instance:m(),type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",dataType:"text",cache:"false",success:function(t){s.hide(),""==t?e("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(e("#reemplazarToogle").html(t),e("input[name=practicante]").prop("disabled",!0),e("input[name=profesional]").prop("disabled",!0)),l(n),u(),p(),c(),d(),e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow"),i(o,a,parseInt(m()),!1)},error:function(e){s.hide(),swal("ERROR!","Oops!, Se presentó un error al cargar seguimientos de personas","error")},complete:function(){e(".se-pre-con").hide(),e("#reemplazarToogle").fadeIn()}})}}),f(m()))}),e(".mymodal-close").click(function(){e(this).parent().parent().parent().parent().fadeOut(300)}),u(),p(),c(),d()}}});