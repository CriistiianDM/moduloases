define(["jquery","block_ases/Modernizr-v282","block_ases/bootstrap","block_ases/datatables","block_ases/sweetalert","block_ases/select2"],function(e,a,o,i,r,n){return{init:function(){var a=0,o="";function i(a){var o=0;return e(a).find(".opcionesRadio").find("div").each(function(){e(this).find("label").find("input").is(":checked")&&(o=e(this).find("label").find("input").val())}),o}function r(a,o){e.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+a+"&record_id="+o,function(a){e("#body_editor").html(""),e("#body_editor").append(a),"monitor_ps"!=namerol&&e(".dphpforms.dphpforms-record.dphpforms-updater").append('<br><br><div class="div-observation col-xs-12 col-sm-12 col-md-12 col-lg-12 comentarios_vida_uni">Observaciones de Practicante/profesional:<br> <textarea id="observation_text" class="form-control " name="observation_text" maxlength="5000"></textarea><br><a id="send_observation" class="btn btn-sm btn-danger btn-dphpforms-univalle btn-dphpforms-send-observation">Enviar observación</a></div>'),e("#permissions_informationr").html("");var o=e(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),i=e(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(o||i)&&e(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var r=JSON.parse(e("#permissions_information").text()),n=0;n<r.behaviors_permissions.length;n++){for(var t=r.behaviors_permissions[n].behaviors[0],s=t.behaviors_accessibility,l=0;l<s.length;l++){var c=s[l].disabled;"true"==c?c=!0:"false"==c&&(c=!1),e(".dphpforms-record").find("#"+s[l].id).prop("disabled",c),e(".dphpforms-record").find("."+s[l].class).prop("disabled",c)}var d=t.behaviors_fields_to_remove;for(l=0;l<d.length;l++)e(".dphpforms-record").find("#"+d[l].id).remove(),e(".dphpforms-record").find("."+d[l].class).remove();var p=t.limpiar_to_eliminate;for(l=0;l<p.length;l++)e(".dphpforms-record").find("."+p[l].class+".limpiar ").remove()}e("#permissions_informationr").html("")})}function n(o,i){e("#periodos").change(function(){if("sistemas"!=namerol){var n=e("#periodos").val(),s=a;e.ajax({type:"POST",data:{id_persona:s,id_semestre:n,instance:o,otro:!0,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){""==a?(e("#reemplazarToogle").html("<label> No se encontraron registros </label>"),t(i)):e("#reemplazarToogle").html(a),e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow"),t(i)},dataType:"text",cache:"false",error:function(e){alert("error al consultar seguimientos de personas")}}),e(".dphpforms-peer-record").on("click",function(){r("seguimiento_pares",e(this).attr("data-record-id")),e("#modal_v2_edit_peer_tracking").fadeIn(300)})}})}function t(a){var o=e("#periodos option:selected").text(),i="";if("monitor_ps"==a.namerol){var r=s(a);i='<div class="row"><div class="col-sm-12"><h2>Información monitor - PERIODO :'+o+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :<label for="revisado_monitor_0">'+r[0]+'</label><b></b> - NO Revisados :<label for="norevisado_monitor_0">'+r[1]+'</label><b></b> - Total  :<label for="total_monitor_0">'+r[2]+"</label> <b></b> </span></h4></div></div></div></div>",e("#conteo_principal").empty(),e("#conteo_principal").html(i)}else if("practicante_ps"==a.namerol){var n=s(a);i='<div class="row"><div class="col-sm-12"><h2>Información practicante - PERIODO :'+o+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :'+n[0]+" <b></b> - NO Revisados :"+n[1]+" <b></b> - Total  :"+n[2]+" <b></b> </span></h4></div></div></div></div>",e("#conteo_principal").empty(),e("#conteo_principal").html(i)}else if("profesional_ps"==a.namerol){var t=s(a);i='<div class="row"><div class="col-sm-12"><h2>Información profesional - PERIODO :'+o+' </h2><div class="panel panel-default"> <div class="panel-body"><h4 class="panel-title"><span class="pull-left"> Revisados  :'+t[0]+" <b></b> - NO Revisados :"+t[1]+" <b></b> - Total  :"+t[2]+" <b></b> </span></h4></div></div></div></div>",e("#conteo_principal").empty(),e("#conteo_principal").html(i)}else a.namerol}function s(a,o){void 0===o&&(o="ninguno");var i=[],r=0,n=0,t=0,l=0;if("monitor_ps"==a.namerol){var c=0,d=0;"ninguno"==o?(c=e(".panel-heading.pares").children().length,d=e(".panel-heading.grupal").children().length):(c=e("#collapse"+a.id+" .panel-heading.pares").children().length,d=e("#collapse"+a.id+" .panel-heading.grupal").children().length),e("label[for='norevisado_grupal_"+a.id+"']").html(d),e("label[for='total_grupal_"+a.id+"']").html(d);for(var p=0;p<c;p++)t+=Number(e("label[for='revisado_pares_"+a.id+"_"+p+"']").text()),l+=Number(e("label[for='norevisado_pares_"+a.id+"_"+p+"']").text());for(p=0;p<d;p++)r+=0,n=d;return total=t+r+(l+n),new Array(t+r,l+n,total)}if("practicante_ps"==a.namerol){var m=0;i=[0,0,0];var u=[];if("ninguno"==o){m=e(".panel-heading.practicante").children().length;for(var _=0;_<m;_++){var f=e(".panel-heading.practicante:eq("+_+")").find("a").attr("href").split("#collapse")[1];(v=[]).id=f,v.namerol="monitor_ps",u=s(v,"practicante"),e("label[for='revisado_monitor_"+f+"']").html(u[0]),e("label[for='norevisado_monitor_"+f+"']").html(u[1]),e("label[for='total_monitor_"+f+"']").html(u[2]),i[0]+=u[0],i[1]+=u[1],i[2]+=u[2]}}else{m=e("#collapse"+a.id+" .panel-heading.practicante").children().length;for(_=0;_<m;_++){var v;f=e("#collapse"+a.id+" .panel-heading.practicante:eq("+_+")").find("a").attr("href").split("#collapse")[1];(v=[]).id=f,v.namerol="monitor_ps",u=s(v,"practicante"),e("label[for='revisado_monitor_"+f+"']").html(u[0]),e("label[for='norevisado_monitor_"+f+"']").html(u[1]),e("label[for='total_monitor_"+f+"']").html(u[2]),i[0]+=u[0],i[1]+=u[1],i[2]+=u[2]}}return i}if("profesional_ps"==a.namerol){i=[0,0,0];for(var h=e(".panel-heading.profesional").children().length,g=[],b=0;b<h;b++){var k=e(".panel-heading.profesional:eq("+b+")").find("a").attr("href").split("#collapse")[1],y=[];y.id=k,y.namerol="practicante_ps",g=s(y,"practicante"),e("label[for='revisado_practicante_"+k+"']").html(g[0]),e("label[for='norevisado_practicante_"+k+"']").html(g[1]),e("label[for='total_practicante_"+k+"']").html(g[2]),i[0]+=g[0],i[1]+=g[1],i[2]+=g[2]}return i}}function l(a){e("body").on("click","#send_observation",function(){var o=e("form").serializeArray(),i={};e(o).each(function(e,a){i[a.name]=a.value});var r=i.id_registro,n=e("#observation_text");if(""==n.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var t=o[28].value,s=o[5].value,l=n.val(),c=e("#periodos").val();e.ajax({type:"POST",data:{id_tracking:r,type:"send_email_to_user",form:"new_form",tracking_type:"individual",monitor_code:t,date:s,message_to_send:l,semester:c,instance:a},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(e){console.log(e),"Error"!=e?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),n.val("")):swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"})},dataType:"text",cache:"false",error:function(e){swal({title:"error al enviar el correo",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}})}function c(a){e("body").on("click",".btn.btn-info.btn-lg.botonCorreo",function(){var a=e(this).attr("value"),o=e("#textarea_"+a);if(""==o.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var i=o.attr("name").split("_"),r=i[0],n=i[1],t=i[2],s=i[3],l=i[4],c=o.val();e.ajax({type:"POST",data:{type:"send_email_to_user",tipoSeg:r,codigoEnviarN1:n,codigoEnviarN2:t,fecha:s,nombre:l,message:c},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(e){"Error"!=e?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),o.val("")):swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"})},dataType:"text",cache:"false",error:function(e){swal({title:"error al enviar el correo",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}})}function d(a){e("body").on("click","span.btn.btn-info.btn-lg.botonModificarSeguimiento",function(){var o=e(this).attr("value"),i="",r="",n=document.getElementById("h_ini_"+o),t=document.getElementById("h_fin_"+o),s=document.getElementById("m_ini_"+o),l=document.getElementById("m_fin_"+o),c=n.options[n.selectedIndex].text,d=t.options[t.selectedIndex].text,p=s.options[s.selectedIndex].text,m=l.options[l.selectedIndex].text,u=function(e,a,o,i){var r="";e>a?r+="* La hora final debe ser mayor a la inicial<br>":e==a&&(o>i?(isvalid=!1,r+="* La hora final debe ser mayor a la inicial<br>"):o==i&&(r+="* Las horas seleccionadas deben ser diferentes<br>"));return r}(c,d,p,m);if(function(a,o){var i=new Array,r=new Array,n=e("input:radio[name=riesgo_individual_"+a+"]:checked").val(),t=e("input:radio[name=riesgo_familiar_"+a+"]:checked").val(),s=e("input:radio[name=riesgo_academico_"+a+"]:checked").val(),l=e("input:radio[name=riesgo_economico_"+a+"]:checked").val(),c=e("input:radio[name=riesgo_universitario_"+a+"]:checked").val();"3"==n&&(i.push("Individual"),r.push(e("#obindividual_"+a).val()));"3"==t&&(i.push("Familiar"),r.push(e("#obfamiliar_"+a).val()));"3"==s&&(i.push("Académico"),r.push(e("#obacademico_"+a).val()));"3"==l&&(i.push("Económico"),r.push(e("#obeconomico_"+a).val()));"3"==c&&(i.push("Vida universitaria"),r.push(e("#obuniversitario_"+a).val()));var d=new Array;d.push({name:"function",value:"send_email"}),d.push({name:"id_student_moodle",value:o}),d.push({name:"id_student_pilos",value:a}),d.push({name:"risk_array",value:i}),d.push({name:"observations_array",value:r}),d.push({name:"date",value:e("#fecha_"+a).val()}),d.push({name:"url",value:window.location}),0!=i.length&&e.ajax({type:"POST",data:d,url:"../managers/pilos_tracking/send_risk_email.php",success:function(e){console.log(e)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}(o,a),""==u){i=e("#profesional_"+o).is(":checked")?1:0,r=e("#practicante_"+o).is(":checked")?1:0;var _=e(this).parent().parent().parent(),f=e(this).attr("value"),v=_.find("#lugar_"+f).val(),h=_.find("#tema_"+o).val(),g=_.find("#objetivos_"+o).val(),b=_.find("#fecha_"+o).val(),k=c+":"+p,y=d+":"+m,w=_.find("#obindividual_"+o).val(),x=e("input[name='riesgo_individual_"+o+"']:checked").val();void 0==x&&(x="0");var C=_.find("#obfamiliar_"+o).val(),O=e("input[name='riesgo_familiar_"+o+"']:checked").val();void 0==O&&(O="0");var T=_.find("#obacademico_"+o).val(),S=e("input[name='riesgo_academico_"+o+"']:checked").val();void 0==S&&(S="0");var B=_.find("#obeconomico_"+o).val(),I=e("input[name='riesgo_economico_"+o+"']:checked").val();void 0==I&&(I="0");var j=_.find("#obuniversitario_"+o).val(),N=e("input[name='riesgo_universitario_"+o+"']:checked").val();void 0==N&&(N="0");var E=_.find("#observacionesGeneral_"+o).val();if(""==v||""==h||""==g)swal({title:"Debe ingresar los datos completamente",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else if(""!=w&&0==x||""!=C&&0==O||""!=T&&0==S||""!=B&&0==I||""!=j&&0==N||""==w&&x>0||""==C&&O>0||""==T&&S>0||""==B&&I>0||""==j&&N>0)swal({title:"Debe ingresar correctamente los riesgos",html:!0,type:"warning",confirmButtonColor:"#d51b23"});else{var P=new Object;P.id=f,P.lugar=v,P.tema=h,P.objetivos=g,P.individual=w,P.individual_riesgo=x,P.familiar_desc=C,P.familiar_riesgo=O,P.academico=T,P.academico_riesgo=S,P.economico=B,P.economico_riesgo=I,P.vida_uni=j,P.vida_uni_riesgo=N,P.observaciones=E,P.revisado_practicante=r,P.revisado_profesional=i,P.fecha=b,P.hora_ini=k,P.hora_fin=y,e.ajax({type:"POST",data:{seguimiento:P,type:"actualizar_registro"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(e){"0"==e?swal({title:"error al actualizar registro",html:!0,type:"error",confirmButtonColor:"#d51b23"}):"1"==e?swal("¡Hecho!","El registro ha sido actualizado","success"):swal({title:"Debe ingresar correctamente los riesgos",html:!0,type:"warning",confirmButtonColor:"#d51b23"})},error:function(e){}})}}else swal({title:u,html:!0,type:"warning",confirmButtonColor:"#d51b23"})})}function p(a){e("body").on("click","span.btn-info.btn-lg.botonesSeguimiento.botonEditarSeguimiento",function(){var o=e(this).attr("value"),i=e(this).parent().parent().parent(),r=!1;"monitor_ps"==a?r=e("#profesional_"+o).is(":checked"):"practicante_ps"==a?e("input[name=practicante]").prop("disabled",!1):"profesional_ps"==a?e("input[name=profesional]").prop("disabled",!1):"sistemas"==a&&(e("input[name=profesional]").prop("disabled",!1),e("input[name=practicante]").prop("disabled",!1)),0==r?(i.find(".editable").removeAttr("readonly"),i.find(".botonesSeguimiento").toggleClass("ocultar"),i.find(".quitar-ocultar").toggleClass("ocultar"),i.find(".radio-ocultar").toggleClass("ocultar"),function(a){e("#borrar_"+a).hide(),e("#editar_"+a).hide(),e("#enviar_"+a).hide(),e("#hora_final_"+a).hide(),e("#hora_inicial_"+a).hide(),e("#titulo_fecha_"+a).show(),e("#mod_hora_final_"+a).show(),e("#mod_hora_ini_"+a).show();var o=e("#h_inicial_texto_"+a).val(),i=e("#h_final_texto_"+a).val(),r=o.split(":"),n=i.split(":");(function(a){for(var o=new Date,i=o.getMinutes(),r=o.getHours(),n="",t=0;t<24;t++)t==r?(r<10&&(r="0"+r),n+='<option value="'+r+'" selected>'+r+"</option>"):n+=t<10?'<option value="0'+t+'">0'+t+"</option>":'<option value="'+t+'">'+t+"</option>";for(var s="",t=0;t<60;t++)t==i?(i<10&&(i="0"+i),s+='<option value="'+i+'" selected>'+i+"</option>"):s+=t<10?'<option value="0'+t+'">0'+t+"</option>":'<option value="'+t+'">'+t+"</option>";e("#h_ini_"+a).append(n),e("#m_ini_"+a).append(s),e("#h_fin_"+a).append(n),e("#m_fin_"+a).append(s),e("#seguimiento #m_fin").append(s)})(a),e("#h_ini_"+a+" option[value="+r[0]+"]").prop("selected",!0),e("#m_ini_"+a+" option[value="+r[1]+"]").prop("selected",!0),e("#h_fin_"+a+" option[value="+n[0]+"]").prop("selected",!0),e("#m_fin_"+a+" option[value="+n[1]+"]").prop("selected",!0)}(o),function(a){e("#riesgo_individual_"+a).is(".riesgo_bajo")?e("input[name=riesgo_individual_"+a+"][value=1]").prop("checked","checked"):e("#riesgo_individual_"+a).is(".riesgo_medio")?e("input[name=riesgo_individual_"+a+"][value=2]").prop("checked","checked"):e("#riesgo_individual_"+a).is(".riesgo_alto")?e("input[name=riesgo_individual_"+a+"][value=3]").prop("checked","checked"):e("input[name=riesgo_individual_"+a+"][value=0]").prop("checked","checked");e("#riesgo_familiar_"+a).is(".riesgo_bajo")?e("input[name=riesgo_familiar_"+a+"][value=1]").prop("checked","checked"):e("#riesgo_familiar_"+a).is(".riesgo_medio")?e("input[name=riesgo_familiar_"+a+"][value=2]").prop("checked","checked"):e("#riesgo_familiar_"+a).is(".riesgo_alto")?e("input[name=riesgo_familiar_"+a+"][value=3]").prop("checked","checked"):e("input[name=riesgo_familiar_"+a+"][value=0]").prop("checked","checked");e("#riesgo_academico_"+a).is(".riesgo_bajo")?e("input[name=riesgo_academico_"+a+"][value=1]").prop("checked","checked"):e("#riesgo_academico_"+a).is(".riesgo_medio")?e("input[name=riesgo_academico_"+a+"][value=2]").prop("checked","checked"):e("#riesgo_academico_"+a).is(".riesgo_alto")?e("input[name=riesgo_academico_"+a+"][value=3]").prop("checked","checked"):e("input[name=riesgo_academico_"+a+"][value=0]").prop("checked","checked");e("#riesgo_economico_"+a).is(".riesgo_bajo")?e("input[name=riesgo_economico_"+a+"][value=1]").prop("checked","checked"):e("#riesgo_economico_"+a).is(".riesgo_medio")?e("input[name=riesgo_economico_"+a+"][value=2]").prop("checked","checked"):e("#riesgo_economico_"+a).is(".riesgo_alto")?e("input[name=riesgo_economico_"+a+"][value=3]").prop("checked","checked"):e("input[name=riesgo_economico_"+a+"][value=0]").prop("checked","checked");e("#riesgo_universitario_"+a).is(".riesgo_bajo")?e("input[name=riesgo_universitario_"+a+"][value=1]").prop("checked","checked"):e("#riesgo_universitario_"+a).is(".riesgo_medio")?e("input[name=riesgo_universitario_"+a+"][value=2]").prop("checked","checked"):e("#riesgo_universitario_"+a).is(".riesgo_alto")?e("input[name=riesgo_universitario_"+a+"][value=3]").prop("checked","checked"):e("input[name=riesgo_universitario_"+a+"][value=0]").prop("checked","checked")}(o)):swal("¡Advertencia!","No es posible editar el seguimiento, debido a que ya ha sido revisado por un profesional","warning")})}function m(o){e("body").on("click","span.btn.btn-info.btn-lg.botonBorrar",function(){var i=e(this).attr("value"),r=!1;"monitor_ps"==o&&(r=e("#profesional_"+a).is(":checked")),0==r&&swal({title:"¿Seguro que desea eliminar el registro?",text:"No podrás deshacer este paso",type:"warning",showCancelButton:!0,cancelButtonText:"No",confirmButtonColor:"#d51b23",confirmButtonText:"Si",closeOnConfirm:!1},function(){e.ajax({type:"POST",data:{id:i,type:"eliminar_registro"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(e){swal({title:e.title,html:!0,text:e.msg,type:e.type,confirmButtonColor:"#d51b23"}),setTimeout("document.location.reload()",500)},dataType:"json",cache:"false",error:function(e){}})})})}function u(a){e("body").on("click","span.btn.btn-info.btn-lg.botonesSeguimiento.botonCancelarSeguimiento",function(){var o=e(this).attr("value");"monitor_ps"==a||("practicante_ps"==a?e("input[name=practicante]").prop("disabled",!0):"profesional_ps"==a?e("input[name=profesional]").prop("disabled",!0):"sistemas"==a&&(e("input[name=profesional]").prop("disabled",!0),e("input[name=practicante]").prop("disabled",!0)));var i,r=e(this).parent().parent().parent();r.find(".editable").attr("readonly",!0),r.find(".botonesSeguimiento").toggleClass("ocultar"),r.find(".quitar-ocultar").toggleClass("ocultar"),r.find(".radio-ocultar").toggleClass("ocultar"),e("#titulo_fecha_"+(i=o)).hide(),e("#borrar_"+i).show(),e("#editar_"+i).show(),e("#enviar_"+i).show(),e("#hora_final_"+i).show(),e("#mod_hora_final_"+i).hide(),e("#hora_inicial_"+i).show(),e("#mod_hora_ini_"+i).hide()})}function _(){e("body").on("click",".limpiar",function(){var a=e(this).closest("div").attr("id").split("_"),o=a[2].split("div").pop();switch(a[1]){case"individual":e("#obindividual_"+o).val(""),v("riesgo_individual_",o);break;case"familiar":e("#obfamiliar_"+o).val(""),v("riesgo_familiar_",o);break;case"academico":e("#obacademico_"+o).val(""),v("riesgo_academico_",o);break;case"economico":e("#obeconomico_"+o).val(""),v("riesgo_economico_",o);break;case"universitario":e("#obuniversitario_"+o).val(""),v("riesgo_universitario_",o);break;default:alert("Dato invalido")}})}function f(){e(document).ready(function(){e("input:radio").change(function(){var a=e(this).parent().parent().parent().attr("id"),o=e(this).attr("value");1==o?(e("#"+a).removeClass(),e("#"+a).addClass("table-info-pilos col-sm-12 riesgo_bajo")):2==o?(e("#"+a).removeClass(),e("#"+a).addClass("table-info-pilos col-sm-12 riesgo_medio")):3==o&&(e("#"+a).removeClass(),e("#"+a).addClass("table-info-pilos col-sm-12 riesgo_alto"))})})}function v(a,o){e("input:radio[name="+a+o+"]").parent().parent().parent().removeClass("riesgo_bajo"),e("input:radio[name="+a+o+"]").parent().parent().parent().removeClass("riesgo_medio"),e("input:radio[name="+a+o+"]").parent().parent().parent().removeClass("riesgo_alto");var i='"'+a.replace("#","")+o+'"';e("input:radio[name="+i+"]").each(function(e){this.checked=!1})}e(document).ready(function(){e(".se-pre-con").fadeOut("slow"),e("#reemplazarToogle").fadeIn("slow");for(var i="",s=window.location.search.split("&"),v=0;v<s.length;v++){var h=s[v].split("=");if("?instanceid"==h[0]||"instanceid"==h[0])var g=h[1]}var b,k,y;e.ajax({type:"POST",data:{type:"getInfo",instance:g},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(i){$data=e.parseJSON(i),o=$data.username,a=$data.id,$data.email,$data.rol,namerol=$data.name_rol},dataType:"text",cache:"false",error:function(e){swal({title:"error al obtener información del usuario, getInfo.",html:!0,type:"error",confirmButtonColor:"#d51b23"})}}),o="","monitor_ps"==namerol?i="monitor":"practicante_ps"==namerol?i="practicante":"profesional_ps"==namerol?i="profesional":"sistemas"==namerol&&(i="sistemas"),(i=[]).id=a,i.name=o,i.namerol=namerol,t(i),"practicante_ps"==namerol?(e("input[name=profesional]").prop("disabled",!0),e("input[name=practicante]").prop("disabled",!0),_(),p(namerol),u(namerol),m(namerol),d(a),f(),c(g),n(g,i),l(g)):"profesional_ps"==namerol?(e("input[name=practicante]").prop("disabled",!0),e("input[name=profesional]").prop("disabled",!0),_(),u(namerol),p(namerol),d(a),m(namerol),f(),c(g),n(g,i),l(g)):"monitor_ps"==namerol?(_(),p(namerol),u(namerol),m(namerol),d(a),f(),n(g,i)):"sistemas"==namerol&&(_(),p(namerol),u(namerol),m(namerol),d(a),f(),c(g),b=g,e("#personas").val("").change(),e("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),e("#periodos").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),k=b,y=namerol,e("#periodos").change(function(){var a=e("#periodos").val();e.ajax({type:"POST",data:{id:a,instance:k,type:"actualizar_personas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){e("#personas").empty(),e("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),"sistemas"==y&&(e("#personas").attr("selectedIndex","-1").find("option:selected").removeAttr("selected"),e("#personas").append('<option value="">Seleccionar persona</option>'+a))},dataType:"text",cache:"false",error:function(e){alert("error al cargar personas")}})}),e("#consultar_persona").on("click",function(){var a=e("#personas").children(":selected").attr("value"),o=e("#periodos").children(":selected").attr("value");void 0==a?swal({title:"Debe escoger una persona para realizar la consulta",html:!0,type:"warning",confirmButtonColor:"#d51b23"}):(e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").show(),e(".se-pre-con").show(),e("#reemplazarToogle").hide(),e.ajax({type:"POST",data:{id_persona:a,id_semestre:o,instance:b,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(a){""==a?e("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(e("#reemplazarToogle").html(a),e("input[name=practicante]").prop("disabled",!0),e("input[name=profesional]").prop("disabled",!0)),e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow")},dataType:"text",cache:"false",error:function(e){alert("error al consultar seguimientos de personas")},complete:function(){e(".se-pre-con").hide(),e("#reemplazarToogle").fadeIn()}}),e(".dphpforms-peer-record").on("click",function(){var a=e(this).attr("data-record-id");r("seguimiento_pares",a),e("#modal_v2_edit_peer_tracking").fadeIn(300)}))}),l(g))}),e(document).on("submit",".dphpforms",function(a){a.preventDefault();var o=new FormData(this),r=e(this),n=r.attr("action");"procesador.php"==r.attr("action")&&(n="../managers/dphpforms/procesador.php"),e.ajax({type:"POST",url:n,data:o,cache:!1,contentType:!1,processData:!1,success:function(a){var o=JSON.parse(a);if(console.log(a),0==o.status){var r="";"Stored"==o.message?r="Almacenado":"Updated"==o.message&&(r="Actualizado"),function(a){var o=i(".puntuacion_riesgo_individual"),r=e(".comentarios_individual").find("textarea").val(),n=i(".puntuacion_riesgo_familiar"),t=e(".comentarios_familiar").find("textarea").val(),s=i(".puntuacion_riesgo_academico"),l=e(".comentarios_academico").find("textarea").val(),c=i(".puntuacion_riesgo_economico"),d=e(".comentarios_economico").find("textarea").val(),p=i(".puntuacion_vida_uni"),m=e(".comentarios_vida_uni").find("textarea").val();if("3"==o||"3"==n||"3"==s||"3"==c||"3"==p){var u={function:"send_email_dphpforms",student_code:get_student_code(),risks:[{name:"Individual",risk_lvl:o,observation:r},{name:"Familiar",risk_lvl:n,observation:t},{name:"Académico",risk_lvl:s,observation:l},{name:"Económico",risk_lvl:c,observation:d},{name:"Vida Universitaria",risk_lvl:p,observation:m}],date:e(".fecha").find("input").val(),url:window.location.href};e.ajax({type:"POST",data:JSON.stringify(u),url:"../managers/pilos_tracking/send_risk_email.php",success:function(e){console.log(e)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}}(),swal({title:"Información",text:r,type:"success"},function(){"Updated"==o.message&&e("#dphpforms-peer-record-"+e("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3)}),e(".dphpforms-response").trigger("reset"),e("#modal_v2_edit_peer_tracking").fadeOut(300),e("#modal_v2_peer_tracking").fadeOut(300)}else if(-2==o.status){r="";"Without changes"==o.message?r="No hay cambios que registrar":"Unfulfilled rules"==o.message&&(r="Revise los valores ingresados"),swal("Alerta",r,"warning")}else-1==o.status&&(console.log(a),swal("ERROR!","Oops!, informe de este error","error"))},error:function(e){console.log(e),swal("Error!","Oops!, informe de este error","error")}})}),e(".dphpforms-peer-record").on("click",function(){r("seguimiento_pares",e(this).attr("data-record-id")),e("#modal_v2_edit_peer_tracking").fadeIn(300)}),e(".mymodal-close").click(function(){e(this).parent().parent().parent().parent().fadeOut(300)})}}});