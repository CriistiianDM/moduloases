define(["jquery","block_ases/Modernizr-v282","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert","block_ases/select2"],function(e,r,o,t,a,n){return{init:function(){var r=0,o="";function t(){e(".dphpforms-peer-record").on("click",function(){n("seguimiento_pares",e(this).attr("data-record-id")),e("#modal_v2_edit_peer_tracking").fadeIn(300)})}function a(){e(".dphpforms-groupal-record").on("click",function(){n("seguimiento_grupal",e(this).attr("data-record-id")),e("#modal_v2_edit_groupal_tracking").fadeIn(300)})}function n(r,o){e.get("../managers/dphpforms/dphpforms_forms_core.php?form_id="+r+"&record_id="+o,function(o){if("seguimiento_grupal"==r){e("#body_editor").html(""),e("#modal_v2_edit_groupal_tracking").find("#body_editor").html(""),e("#modal_v2_edit_groupal_tracking").find("#body_editor").append(o),e("#modal_v2_edit_groupal_tracking").find(".btn-dphpforms-univalle").remove();var t=e("#modal_v2_edit_groupal_tracking").find("form").find(".oculto.id_estudiante").find("input").val();a=t,e.ajax({type:"POST",data:{students:a,type:"consult_students_name"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){if(""!=r){var o='<hr style="border-color:red"><div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 estudiantes" id="students"><h3>Estudiantes asistentes:</h3><br>'+r+"<br>";e("#modal_v2_edit_groupal_tracking").find("#students").remove(),e("#modal_v2_edit_groupal_tracking").find("form").find("h1").after(o)}},dataType:"text",cache:"false",error:function(e){alert("Error al consultar nombres de los estudiantes pertenecientes a un seguimiento grupal")}})}else{e("#modal_v2_edit_groupal_tracking").find("#body_editor").html(""),e("#body_editor").html(""),e("#body_editor").append(o),e(".dphpforms.dphpforms-record.dphpforms-updater").append('<br><br><div class="div-observation col-xs-12 col-sm-12 col-md-12 col-lg-12 comentarios_vida_uni">Observaciones de Practicante/profesional:<br> <textarea id="observation_text" class="form-control " name="observation_text" maxlength="5000"></textarea><br><a id="send_observation" class="btn btn-sm btn-danger btn-dphpforms-univalle btn-dphpforms-send-observation">Enviar observación</a></div>'),e("button.btn.btn-sm.btn-danger.btn-dphpforms-univalle").attr("id","button"),-1!=o.indexOf("seguimiento_de_pares_")&&function(r,o){if("primer_acercamiento"==r&&"insert"==o);else if("primer_acercamiento"==r&&"update"==o);else if("seguimiento_pares"==r&&"insert"==o);else if("seguimiento_pares"==r&&"update"==o){e(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked")&&e(".btn-dphpforms-update").remove();var t=e(".dphpforms-record .btn-dphpforms-univalle").length;console.log(t),2==t?e(".dphpforms-record .btn-dphpforms-close").css({"margin-left":e(".dphpforms-updater").width()/2-30+"px"}):3==t&&e(".dphpforms-record .btn-dphpforms-univalle:eq(0)").css({"margin-left":e(".dphpforms-updater").width()/2-72-30+"px"})}}("seguimiento_pares","update")}var a;e("#permissions_informationr").html("");var n=e(".dphpforms-record").find(".revisado_profesional").find(".checkbox").find("input[type=checkbox]").prop("checked"),s=e(".dphpforms-record").find(".revisado_practicante").find(".checkbox").find("input[type=checkbox]").prop("checked");(n||s)&&e(".dphpforms-record").find(".btn-dphpforms-delete-record").remove();for(var i=JSON.parse(e("#permissions_information").text()),c=0;c<i.behaviors_permissions.length;c++){for(var l=i.behaviors_permissions[c].behaviors[0],p=l.behaviors_accessibility,d=0;d<p.length;d++){var u=p[d].disabled;"true"==u?u=!0:"false"==u&&(u=!1),e(".dphpforms-record").find("#"+p[d].id).prop("disabled",u),e(".dphpforms-record").find("."+p[d].class).prop("disabled",u)}var m=l.behaviors_fields_to_remove;for(d=0;d<m.length;d++)e(".dphpforms-record").find("#"+m[d].id).remove(),e(".dphpforms-record").find("."+m[d].class).remove();var f=l.limpiar_to_eliminate;for(d=0;d<f.length;d++)e(".dphpforms-record").find("."+f[d].class+".limpiar ").remove()}e("#permissions_informationr").html("")})}function s(){e('a[class*="practicant"]').click(function(){var r=e(this).attr("href").split("#practicant")[1],o=e(this).attr("href");e.ajax({type:"POST",data:{type:"get_practicants_of_professional",practicant_code:r,instance:u()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){e(o+" > div").empty(),e(o+" > div").append(r),i(),c()},dataType:"json",cache:"false",error:function(e){swal({title:"Oops !",text:"Se presentó un inconveniente con el practicante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function i(){e('a[class*="monitor"]').click(function(){var r=e(this).attr("href").split("#monitor")[1],o=e(this).attr("href");e.ajax({type:"POST",data:{type:"get_monitors_of_practicant",monitor_code:r,instance:u()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){e(o+" > div").empty(),e(o+" > div").append(r),l(),c()},dataType:"json",cache:"false",error:function(e){swal({title:"Oops !",text:"Se presentó un inconveniente con el monitor seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function c(){e('a[class*="groupal"]').click(function(){var r=e(this).attr("href").split("#groupal")[1],o=e(this).attr("href");e.ajax({type:"POST",data:{type:"get_groupal_trackings",student_code:r,instance:u()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){e(o+" > div").empty(),e(o+" > div").append(r),a()},dataType:"json",cache:"false",error:function(e){swal({title:"Oops !",text:"Se presentó un inconveniente con los seguimientos grupales seleccionados.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function l(){e('a[class*="student"]').click(function(){var r=e(this).attr("href").split("#student")[1],o=e(this).attr("href");e.ajax({type:"POST",data:{type:"get_student_trackings",student_code:r,instance:u()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){e(o+" > div").empty(),e(o+" > div").append(r),t(),a()},dataType:"json",cache:"false",error:function(e){swal({title:"Oops !",text:"Se presentó un inconveniente con el estudiante seleccionado.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})}),e("#see_history").click(function(){var r=e(this).parents().eq(3).attr("href").split("#monitor")[1];console.log(r),e.ajax({type:"POST",data:{type:"redirect_tracking_time_control",monitor:r},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(e){console.log(e);var r=window.location.href.replace("report_trackings","tracking_time_control");try{var o=window.open(r+"&&monitorid="+e,"_blank");o&&o.focus()}catch(e){alert("Se ha producido un error al abrir la ventana : "+e)}},dataType:"json",cache:"false",error:function(e){swal({title:"Oops !",text:"Se presentó un inconveniente al reedirecionar al reporte de horas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}})})}function p(o,n){e("#periodos").change(function(){if("sistemas"!=namerol){var n=e("#periodos").val(),p=r;e.ajax({type:"POST",data:{id_persona:p,id_semestre:n,instance:o,otro:!0,type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){""==r?e("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(e("#reemplazarToogle").html(r),l(),i(),s(),c()),e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow")},dataType:"text",cache:"false",error:function(e){swal("ERROR!","Oops!, Se presentó un error al consultar seguimientos de personas","error")}}),t(),a()}})}function d(r){e("body").on("click","#send_observation",function(){var o=e("form").serializeArray(),t={};e(o).each(function(e,r){t[r.name]=r.value});var a=t.id_registro,n=e("#observation_text");if(console.log(),""==n.val())swal({title:"Para enviar una observación debe llenar el campo correspondiente",html:!0,type:"error",confirmButtonColor:"#d51b23"});else{var s=e(".id_creado_por").find("input").val(),i=e(".fecha").find("input").val(),c=n.val(),l=e("#periodos").val(),p=e(".lugar").find("input").val();e.ajax({type:"POST",data:{id_tracking:a,type:"send_email_to_user",form:"new_form",tracking_type:"individual",monitor_code:s,date:i,message_to_send:c,semester:l,instance:r,place:p},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(e){console.log(e),"Error"!=e?(swal({title:"Correo enviado",html:!0,type:"success",confirmButtonColor:"#d51b23"}),n.val("")):(console.log("mensaje error : "+e),swal({title:"error al enviar el correo al monitor",html:!0,type:"error",confirmButtonColor:"#d51b23"}))},dataType:"text",cache:"false",error:function(e){console.log("mensaje error : "+e),swal("ERROR!","Oops!, Se presentó un error al enviar el correo","error")}})}})}function u(){for(var e=window.location.search.split("&"),r=0;r<e.length;r++){var o=e[r].split("=");if("?instanceid"==o[0]||"instanceid"==o[0])var t=o[1]}return t}e(document).on("click",".btn-dphpforms-close",function(){e(this).closest('div[class="mymodal"]').fadeOut(300)}),e(".outside").click(function(){var r=e(this);swal({title:"Confirmación de salida",text:"",type:"warning",showCancelButton:!0,confirmButtonText:"Salir"},function(o){o&&(e(r).parent(".mymodal").fadeOut(300),console.log(e(this).parent(".mymodal")))})}),e(document).ready(function(){e(".se-pre-con").fadeOut("slow"),e("#reemplazarToogle").fadeIn("slow"),e.ajax({type:"POST",data:{type:"getInfo",instance:u()},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(t){$data=e.parseJSON(t),o=$data.username,r=$data.id,$data.email,$data.rol,namerol=$data.name_rol},dataType:"text",cache:"false",error:function(e){swal({title:"error al obtener información del usuario, getInfo.",html:!0,type:"error",confirmButtonColor:"#d51b23"})}}),o="";var n,m,f,_,g=[];g.id=r,g.name=o,g.namerol=namerol,n=g,e.ajax({type:"POST",data:{type:"user_specific_counting",user:n,instance:u()},url:"../managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){console.log(r);var o=r;e.each(o,function(r,o){e("#counting_"+o.code).html(o.html)})},dataType:"json",cache:"false",error:function(e){swal({title:"Oops !",text:"Se presentó un inconveniente al cargar conteo de usuarios",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}}),"practicante_ps"==namerol?(p(u(),g),d(u())):"profesional_ps"==namerol?(p(u(),g),d(u())):"monitor_ps"==namerol?p(u(),g):"sistemas"==namerol&&(m=u(),e("#personas").val("").change(),e("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),e("#periodos").select2({language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),f=m,_=namerol,e("#periodos").change(function(){var r=e("#periodos").val();e.ajax({type:"POST",data:{id:r,instance:f,type:"update_people"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){e("#personas").empty(),e("#personas").select2({placeholder:"Seleccionar persona",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),"sistemas"==_&&(e("#personas").attr("selectedIndex","-1").find("option:selected").removeAttr("selected"),e("#personas").append('<option value="">Seleccionar persona</option>'+r))},dataType:"text",cache:"false",error:function(e){swal("ERROR!","Oops!, Se presentó un error al cargar personas","error")}})}),e("#consultar_persona").on("click",function(){var r=e("#personas").children(":selected").attr("value"),o=e("#periodos").children(":selected").attr("value");void 0==r?swal({title:"Debe escoger una persona para realizar la consulta",html:!0,type:"warning",confirmButtonColor:"#d51b23"}):(e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").show(),e(".se-pre-con").show(),e("#reemplazarToogle").hide(),e.ajax({type:"POST",data:{id_persona:r,id_semestre:o,instance:u(),type:"consulta_sistemas"},url:"../../../blocks/ases/managers/pilos_tracking/pilos_tracking_report.php",async:!1,success:function(r){""==r?e("#reemplazarToogle").html("<label> No se encontraron registros </label>"):(e("#reemplazarToogle").html(r),e("input[name=practicante]").prop("disabled",!0),e("input[name=profesional]").prop("disabled",!0)),l(),i(),s(),c(),e(".well.col-md-10.col-md-offset-1.reporte-seguimiento.oculto").slideDown("slow")},dataType:"text",cache:"false",error:function(e){swal("ERROR!","Oops!, Se presentó un error al cargar seguimientos de personas","error")},complete:function(){e(".se-pre-con").hide(),e("#reemplazarToogle").fadeIn()}}),t(),a())}),d(u()))}),e(document).on("click",".dphpforms > #button",function(r){r.preventDefault(),e(":disabled").prop("disabled",!1);new FormData;var o=e(this).parent(),t=o.attr("action");"procesador.php"==o.attr("action")&&(t="../managers/dphpforms/procesador.php"),e.ajax({type:"POST",url:t,data:e("form.dphpforms").serialize(),dataType:"json",success:function(r){var o=r;if(0==o.status){var t="";"Stored"==o.message?t="Almacenado":"Updated"==o.message&&(t="Actualizado"),swal({title:"Información",text:t,type:"success"},function(){"Updated"==o.message&&e("#dphpforms-peer-record-"+e("#dphpforms_record_id").val()).stop().animate({backgroundColor:"rgb(175, 255, 173)"},400).animate({backgroundColor:"#f5f5f5"},4e3)}),e(".dphpforms-response").trigger("reset"),e("#modal_v2_edit_peer_tracking").fadeOut(300),e("#modal_v2_peer_tracking").fadeOut(300)}else if(-2==o.status){t="";"Without changes"==o.message?(t="No hay cambios que registrar",e("#modal_v2_edit_peer_tracking").fadeOut(300),e("#modal_v2_peer_tracking").fadeOut(300),e("#modal_primer_acercamiento").fadeOut(300),e("#modal_seguimiento_geografico").fadeOut(300)):"Unfulfilled rules"==o.message&&(t="Revise los valores ingresados"),swal("Alerta",t,"warning")}else-1==o.status&&swal("ERROR!","Oops!, informe de este error","error")},error:function(e){swal("Error!","Oops!, informe de este error","error")}})}),e(".mymodal-close").click(function(){e(this).parent().parent().parent().parent().fadeOut(300)}),l(),i(),s(),c()}}});