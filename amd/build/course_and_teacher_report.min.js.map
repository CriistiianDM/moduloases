{"version":3,"sources":["../src/course_and_teacher_report.js"],"names":["define","$","notification","gg_b","templates","init","document","ready","load_report","data","html","ResumeReport","cursos_al_un_est_ases","cursos_al_item_calif","cursos_al_un_item","return_critic_and_no_critic_report","no_critic_report","critic_report","total_report","_i","data_1","report_item","length","items_con_almenos_una_nota","critica","cantidad_items","cantidad_estudiantes_ases","return_total_report","resume_report","course_id","instance_id","filter_columns","table","fix_grades_table_styles","parent","css","get_filter_column_indexes","filter_column_names","column_names","filter_column_indexes","i","includes","push","add_column_description","columns","each","index","attr","description","add_extra_course_info_controls","on","tr","closest","row","child","isShown","hide","removeClass","show","callback","data_html","read_only_view_styles","get_course_html","addClass","ajax","method","url","dataType","done","dataTable","render","then","js","appendNodeContents","fail","DataTable","bsort","language","order","initComplete","map","column","name","api","every","select","appendTo","header","val","fn","util","escapeRegex","search","draw","unique","sort","d","append","error","console","log","post_info","function","params","curso_id","course_caller_id","response","alert","responseText"],"mappings":"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","sourcesContent":["/**\n * Course and teacher report\n * @module amd/src/course_and_techar_report\n * @author Luis Gerardo Manrique Cardona\n * @copyright 2018 Luis Gerardo Manrique Cardona <luis.manrique@correounivalle.edu.co>\n * @license  http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @see https://datatables.net/examples/api/multi_filter_select.html\n */\ndefine([\n    'jquery',\n    'core/notification',\n    'block_ases/global_grade_book',\n    'core/templates',\n    'block_ases/jquery.dataTables'\n], function($, notification, gg_b, templates){\n\n    return {\n        init: function () {\n            $(document).ready(function () {\n\n            });\n        },\n\n        load_report: function (data) {\n            /**\n             * Class Resume Report\n             * @param cursos_al_un_est_ases Cantidad cursos con almenos un estudiante ases matriculado\n             * @param cursos_al_item_calif Cantidad de cursos ases con almenos un item calificado\n             * @param cursos_al_un_item Cantidad de cursos ases con almenos un item\n             * @constructor\n             */\n            $(\"#tableFinalgradesReport\").html('<img class=\"icon-loading\" src=\"../icon/loading.gif\"/>'); // loader image\n            var ResumeReport = /* @class */ (function   () {\n                function ResumeReport(cursos_al_un_est_ases,\n                                      cursos_al_item_calif,\n                                      cursos_al_un_item) {\n                    this.cursos_al_un_est_ases = cursos_al_un_est_ases ? cursos_al_un_est_ases : 0;\n                    this.cursos_al_item_calif = cursos_al_item_calif ? cursos_al_item_calif : 0;\n                    this.cursos_al_un_item = cursos_al_un_item ? cursos_al_un_item : 0;\n                }\n                ResumeReport.return_critic_and_no_critic_report = function(data) /* return {critic_report: ResumeReport, no_critic_report: ResumeReport} */  {\n                    var no_critic_report = new ResumeReport();\n                    var critic_report = new ResumeReport();\n                    var total_report = new ResumeReport();\n                    for( var _i = 0, data_1 = data; _i < data_1.length; _i++) {\n                        var report_item = data_1[_i];\n                        if(report_item.items_con_almenos_una_nota > 0) {\n                            switch (report_item.critica) {\n                                case 'SI': critic_report.cursos_al_item_calif++; break;\n                                case 'NO': no_critic_report.cursos_al_item_calif++; break;\n                            }\n                        }\n                        if(report_item.cantidad_items > 0) {\n                            switch (report_item.critica) {\n                                case 'SI': critic_report.cursos_al_un_item++; break;\n                                case 'NO': no_critic_report.cursos_al_un_item++; break;\n                            }\n                        }\n                        if(report_item.cantidad_estudiantes_ases > 0) {\n                            switch (report_item.critica) {\n                                case 'SI': critic_report.cursos_al_un_est_ases++; break;\n                                case 'NO': no_critic_report.cursos_al_un_est_ases++; break;\n                            }\n                        }\n                    }\n                    total_report = ResumeReport.return_total_report(critic_report , no_critic_report);\n                    return {critic_report: critic_report, no_critic_report: no_critic_report, total_report: total_report};\n                };\n                ResumeReport.return_total_report = function(critic_report, no_critic_report) {\n                  var total_report = new ResumeReport();\n                  total_report.cursos_al_item_calif = critic_report.cursos_al_item_calif + no_critic_report.cursos_al_item_calif;\n                    total_report.cursos_al_un_est_ases = critic_report.cursos_al_un_est_ases + no_critic_report.cursos_al_un_est_ases;\n                    total_report.cursos_al_un_item = critic_report.cursos_al_un_item + no_critic_report.cursos_al_un_item;\n                    return total_report;\n                };\n                return ResumeReport;\n            }());\n            var resume_report = {}/*{critic_report: ResumeReport, no_critic_report: ResumeReport, total_report: ResumeReport }*/;\n            var course_id = data.course_id;\n            var instance_id = data.instance_id;\n            var grade_table_border_color = '#cccccc';\n            var filter_columns = ['critica', 'nombre_profesor'];\n            var table = null;\n            /**\n             * Data: {\n             *     table,\n             *     course_id,\n             *     instance_id\n             * }\n             *\n             * DataTable:\n             * {\n             *     bsort,\n             *     columns,\n             *     data,\n             *     language,\n             *     order\n             * }\n             * DataTable.data[]:\n             * {\n             *     curso,\n             *     curso_id,\n             *     nombre_profesor,\n             *     estudiantes_perdiendo,\n             *     estudiantes_ganando,\n             *     estudiantes_sin_ninguna_nota,\n             *     cantidad_estudiantes_ases,\n             *     items_con_almenos_una_nota,\n             *     cantidad_items\n             *     critica,\n             * }\n             *\n             * ResumeReport {\n             *     cantidad_cursos_con_almenos_un_ases,\n             *     cantidad_cursos_almenos_un_item_calif,\n             *     cantidad_cursos_almenos_un_item\n             * }\n             *\n             */\n\n            function fix_grades_table_styles() {\n                $('.gradeparent').parent().css('background', grade_table_border_color);\n            }\n\n            function get_filter_column_indexes(filter_column_names, column_names) {\n                var filter_column_indexes = [];\n                var i;\n                for(i = 0; i < column_names.length; i++) {\n                    if(filter_column_names.includes(column_names[i])) {\n                        filter_column_indexes.push(i);\n                    }\n\n                }\n                return filter_column_indexes;\n            }\n            function add_column_description(columns) {\n                // Añadir descripción a las columnas\n               $('#tableFinalgradesReport th').each(function(index) {\n                   $(this).attr('title', columns[index].description);\n               });\n            }\n\n\n            /**\n             * Add the controls for extra info in each course, than display the specific student notes\n             * when the user open the view in the first column buttons\n             */\n            function add_extra_course_info_controls() {\n                $('#tableFinalgradesReport tbody').on('click', 'td.details-control', function () {\n\n                    var tr = $(this).closest('tr');\n                    var row = table.row(tr);\n\n                    if (row.child.isShown()) {\n                        // This row is already open - close it\n                        row.child.hide();\n                        tr.removeClass('shown');\n                    }\n                    else {\n                        // Open this row\n                        row.child('<img class=\"icon-loading\" src=\"../icon/loading.gif\"/>').show(); // loader image (is replaced when the data arrive)\n                        var callback = (row, data_html) => {\n                            row.child(data_html).show();\n                            /* Fix styles for ases table*/\n                            gg_b.read_only_view_styles();\n                            fix_grades_table_styles();\n                        };\n                        get_course_html(row, callback, tr);\n                        /* Fix styles and view for grades loaded */\n\n                        tr.addClass('shown');\n                    }\n                });\n            }\n            function init_datatable () {\n\n                $.ajax({\n                    method: \"GET\",\n                    url: '../managers/course_and_teacher_report/course_and_teacher_report_api.php/' + instance_id,\n                    dataType: 'json'\n\n                }).done(\n                    function (dataTable){\n                        $(\"#tableFinalgradesReport\").html('');\n                        resume_report = ResumeReport.return_critic_and_no_critic_report(dataTable.data);\n\n                        templates.render('block_ases/course_and_teacher_report_summary', {resume_report: resume_report})\n                            .then(function(html, js) {\n                                templates.appendNodeContents('.course_and_teacher_report .summary', html, js);\n                            }).fail(function(ex) {\n                        });\n                        table = $(\"#tableFinalgradesReport\").DataTable(\n                            {\n                                data: dataTable.data,\n                                bsort: dataTable.bsort,\n                                columns: dataTable.columns,\n                                language: dataTable.language,\n                                order: dataTable.order,\n                                initComplete: function () {\n                                    var column_names = dataTable.columns.map(column => column.name ? column.name : null);\n                                    var filter_column_indexes = get_filter_column_indexes(filter_columns, column_names);\n                                    this.api().columns(filter_column_indexes).every(function () {\n                                        var column = this;\n\n\n                                        var select = $('<select><option value=\"\"></option></select>')\n                                            .appendTo($(column.header()))\n                                            .on('change', function () {\n                                                var val = $.fn.dataTable.util.escapeRegex(\n                                                    $(this).val()\n                                                );\n\n                                                column\n                                                    .search(val ? '^' + val + '$' : '', true, false)\n                                                    .draw();\n                                            });\n\n                                        column.data().unique().sort().each(function (d, j) {\n                                            select.append('<option value=\"' + d + '\">' + d + '</option>');\n                                        });\n                                    });\n                                }\n                            }\n                        );\n                            add_column_description(dataTable.columns);\n                            add_extra_course_info_controls();\n                    }\n\n                    ).fail(\n                        function(error) {\n                            console.log(error);\n                        }\n                );\n\n            }\n            init_datatable();\n\n            function get_course_html( row , callback, tr ) {\n                var data = row.data();\n                var post_info = {\n                    function: 'grade_table',\n                    params: {\n                        course_id: data.curso_id, // Specific course selected\n                        course_caller_id: course_id, // Current course of block ASES instance\n                        instance_id: instance_id\n                    }\n                };\n                $.ajax({\n                        method: \"POST\",\n                        url: '../managers/grades/grades_api.php',\n                        data: post_info,\n                        dataType: 'html'\n                    }\n                ).fail(\n                    function (response) {\n                        notification.alert('Error, debe informar a un programador, adjunte esta información', response.responseText, 'Aceptar');\n                        tr.removeClass('shown');\n                    }\n                ).done(\n                    function (response) {\n\n                        callback(row, response);\n                    }\n                );\n            }\n\n\n        },\n\n    };\n\n});"],"file":"course_and_teacher_report.min.js"}