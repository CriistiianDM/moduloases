define(["jquery","block_ases/bootstrap","block_ases/validator","block_ases/sweetalert"],function(e,a,t,i){return{init:function(){function a(e){for(var a=[],t=document.location.search.substring(1).split("&"),i=0;i<t.length;i++){var n=t[i].split("=");a[n[0]]=n[1]}return a}function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null);var n=new Array,o=a(document.location.search);n.push({name:"function",value:"load_grupal"}),n.push({name:"idinstancia",value:o.instanceid}),e.ajax({type:"POST",data:n,url:"../managers/user_management/usermanagement_report.php",success:function(a){if(e("#seguimiento #mytable_consult tbody").html(""),0!=a.rows){var i=a.content;if(t)for(x in i)-1!=t.indexOf(x)?e("#seguimiento #mytable_consult tbody").append(" <tr> <td>"+i[x].username+"</td> <td>"+i[x].firstname+"</td> <td>"+i[x].lastname+'</td>  <td><input type="checkbox" checked="checked" id="asistencia" name="asistencia"  value="'+i[x].idtalentos+'"/></td>  </tr>'):e("#seguimiento #mytable_consult tbody").append("<tr> <td>"+i[x].username+"</td> <td>"+i[x].firstname+"</td> <td>"+i[x].lastname+'</td>  <td><input type="checkbox" id="asistencia" name="asistencia" value="'+i[x].idtalentos+'"/></td>  </tr>');else for(x in i)e("#seguimiento #mytable_consult tbody").append("<tr> <td>"+i[x].username+"</td> <td>"+i[x].firstname+"</td> <td>"+i[x].lastname+'</td>  <td><input type="checkbox" id="asistencia" name="asistencia" value="'+i[x].idtalentos+'"/></td>  </tr>')}else e("#seguimiento #list_grupal_seg").append("<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situación</a>");var n=e("#upd_seg").prop("name");e("#edit_seg").prop("name",n)},dataType:"json",cache:"false",error:function(e){alert("error al cargar listado de asistencia")}})}function i(){for(var a=new Date,t=(a.getDate(),a.getMonth(),a.getFullYear(),a.getMinutes()),i=a.getHours(),n="",o=0;o<24;o++)o==i?(i<10&&(i="0"+i),n+='<option value="'+i+'" selected>'+i+"</option>"):n+=o<10?'<option value="0'+o+'">0'+o+"</option>":'<option value="'+o+'">'+o+"</option>";var s="";for(o=0;o<60;o++)o==t?(t<10&&(t="0"+t),s+='<option value="'+t+'" selected>'+t+"</option>"):s+=o<10?'<option value="0'+o+'">0'+o+"</option>":'<option value="'+o+'">'+o+"</option>";e("#seguimiento #h_ini").append(n),e("#seguimiento #m_ini").append(s),e("#seguimiento #h_fin").append(n),e("#seguimiento #m_fin").append(s),e("#seguimiento").find("input:text, textarea").val(""),e("#seguimiento #infomonitor").addClass("hide"),e("#upd_seg").attr("disabled",!1),e("#upd_seg").attr("title",""),e("#seguimiento").find("select, textarea, input").attr("disabled",!1)}function n(){e("#list_grupal").html("");var t=new Array,n=a(document.location.search);t.push({name:"function",value:"loadSegMonitor"}),t.push({name:"tipo",value:"GRUPAL"}),t.push({name:"idinstancia",value:n.instanceid}),e.ajax({type:"POST",data:t,url:"../managers/seguimiento_grupal/groupal_trackings_report.php",success:function(t){var n=t.error;if(n)swal({title:n,html:!0,type:"error",text:t.msg,confirmButtonColor:"#D3D3D3"});else{var o=t.result;if(t.rows>0){for(x in o)e("#list_grupal").append('<div class="container well col-md-12"> <div class="container-fluid col-md-10" name="info"><div class="row"><label class="col-md-3" for="fecha_des">Fecha</label><label class="col-md-9" for="tema_des">Tema</label> </div> <div class="row"> <input type="text" class="col-md-3" value='+o[x].fecha+' id="fecha_seg" name="fecha_seg" disabled> <input type="text" class="col-md-9" value='+o[x].tema+' id="tema_seg" name="tema_seg" disabled> </div></div> <div id='+o[x].id+' class="col-md-2" name="div_button_seg"> <span class="btn btn-danger" id="consult_grupal" name="consult_grupal" data-toggle="modal" data-target="#myModal">Detalle</span><span class="btn btn-warning" id="delete_grupal" name="delete_grupal">Borrar</span> </div></div>');e("#list_grupal").on("click","#consult_grupal",function(){var t,n,o,s,r=e(this).parent().attr("id");e("#upd_seg").removeClass("hide"),e("#upd_seg").prop("name",r),t=r,n="GRUPAL",o=new Array,s=a(document.location.search),e("#save_seg").addClass("hide"),i(),o.push({name:"function",value:"getSeguimiento"}),o.push({name:"id",value:t}),o.push({name:"idinstancia",value:s.instanceid}),o.push({name:"tipo",value:n}),e.ajax({type:"POST",data:o,url:"../managers/seguimiento_grupal/groupal_trackings_report.php",success:function(a){var t=a.error;if(t)swal({title:t,html:!0,type:"error",text:a.msg,confirmButtonColor:"#D3D3D3"});else if(e("#place").val(a.seguimiento.lugar),e("#tema").val(a.seguimiento.tema),e("#objetivos").val(a.seguimiento.objetivos),e("#actividades").val(a.seguimiento.actividades),e("#observaciones").val(a.seguimiento.observaciones),e("#h_ini option[value="+a.hour.h_ini+"]").attr("selected",!0),e("#m_ini option[value="+a.hour.m_ini+"]").attr("selected",!0),e("#h_fin option[value="+a.hour.h_fin+"]").attr("selected",!0),e("#m_fin option[value="+a.hour.m_fin+"]").attr("selected",!0),e("#date").val(a.hour.seguimiento.fecha),e("#seguimiento :input").prop("disabled",!0),e("#mytable_consult tbody").html(""),0!=a.rows){var i=a.content;for(x in i)e("#mytable_consult tbody").append("<tr> <td>"+i[x].username+"</td> <td>"+i[x].firstname+"</td> <td>"+i[x].lastname+'</td>  <td id="talentos"  class = "hide">'+i[x].idtalentos+"</td> </tr>")}else e("#list_grupal_seg_consult").append("<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situación</a>")},dataType:"json",cache:"false",error:function(e){alert("error al ver detalles de seguimientos")}})}),e("#list_grupal").on("click","#delete_grupal",function(){var a,t=e(this).parent().attr("id");a=t,swal({title:"¿Seguro que desea eliminar el registro?",text:"No podrás deshacer este paso",type:"warning",showCancelButton:!0,cancelButtonText:"No",confirmButtonColor:"#d51b23",confirmButtonText:"Si",closeOnConfirm:!1},function(){e.ajax({type:"POST",data:{id:a,function:"delete"},url:"../../../blocks/ases/managers/seguimiento_grupal/groupal_trackings_report.php",async:!1,success:function(e){0==e?swal({title:"error al borrar registro",html:!0,type:"error",confirmButtonColor:"#d51b23"}):(setTimeout("document.location.reload()",500),swal("¡Hecho!","El registro ha sido eliminado","success"))},dataType:"text",cache:"false",error:function(e){alert("error al eliminar seguimiento")}})})})}else e("#list_grupal").append("<label>No registra</label><br>")}},dataType:"json",cache:"false",error:function(e){alert("error al cargar seguimiento monitor")}})}function o(a){var t,i,n,o,s,r,l,c,d,u=!0,p="";return e.each(a,function(e,a){switch(a.name){case"date":t=a.value;break;case"place":d=a.value;break;case"h_ini":i=a.value;break;case"m_ini":n=a.value;break;case"h_fin":o=a.value;break;case"m_fin":s=a.value;break;case"tema":r=a.value;break;case"objetivos":l=a.value;break;case"actividades":actividades=a.value;break;case"observaciones":observaciones=a.value;break;case"idtalentos":c=a.value}}),t||(u=!1,p+="* Selecciona una Fecha de seguimiento valida: date<br>"),void 0!=d&&""!=d||(p+="* Seleccione el lugar : lugar<br>",u=!1),void 0!=actividades&&""!=actividades||(p+="* Seleccione las actividades que se realizaron : actividades<br>",u=!1),void 0!=observaciones&&""!=observaciones||(p+="* Seleccione las observaciones : observaciones<br>",u=!1),i>o?(u=!1,p+="* La hora final debe ser mayor a la inicial<br>"):i==o&&n>s&&(u=!1,p+="* La hora final debe ser mayor a la inicial<br>"),0===c.length&&(u=!1,p+="* Selecciona los estudiantes que asistieron al seguimiento: "+c.length+"<br>"),""==r&&(u=!1,p+='* La informacion de "observaciones" es obligatoria :'+r+"<br>"),""==l&&(u=!1,p+='* La informacion de "Objetivos" es obligatoria:'+l+"<br>"),{isvalid:u,detalle:p}}e(document).ready(function(){var s,r;s=new Array,r=a(document.location.search),s.push({name:"function",value:"load_grupal"}),s.push({name:"idinstancia",value:r.instanceid}),e.ajax({type:"POST",data:s,url:"../managers/user_management/usermanagement_report.php",success:function(a){if(e("#mytable tbody").html(""),0!=a.rows){var t=a.content;for(x in t)e("#mytable tbody").append("<tr> <td>"+t[x].username+"</td> <td>"+t[x].firstname+"</td> <td>"+t[x].lastname+'</td>  <td class="hide">'+t[x].idtalentos+"</td> </tr>")}else e("#list_grupal_seg").append("<a>No registra ningun estudiante a su cargo.Por favor dirigete a la oficina de Sistemas de talentos pilos para gestionar tu situación</a>")},dataType:"json",cache:"false",error:function(e){alert("error al cargar estudiantes")}}),n(),e("#socioedu_add_grupal").click(function(){e("#save_seg").removeClass("hide"),e("#div_created").addClass("hide"),e("#upd_seg").addClass("hide"),e("#myModalLabel").attr("name","GRUPAL"),i(),t()}),e("#close_seg").on("click",function(){e("#edit_seg").addClass("hide")}),e("#go_back").on("click",function(){window.history.back()}),e("#edit_seg").click(function(){var t=new Array,i=a(document.location.search),s=e(this).prop("name");e("#seguimiento input[id=asistencia]:checked").each(function(){var a=e(this).val();t.push(a)}),e("#myModalLabel").attr("name","GRUPAL");var r=e("#myModalLabel").attr("name"),l=e("#seguimiento").serializeArray();l.push({name:"function",value:"update"}),l.push({name:"tipo",value:r}),l.push({name:"id_seg",value:s}),l.push({name:"idtalentos",value:t}),l.push({name:"idinstancia",value:i.instanceid}),l.push({name:"idmonitor",value:120});var c=o(l);c.isvalid?e.ajax({type:"POST",data:l,url:"../managers/seguimiento_grupal/groupal_trackings_report.php",success:function(a){var t=a.error;t?swal({title:t,html:!0,type:"error",text:a.msg,confirmButtonColor:"#D3D3D3"}):(swal({title:"Actualizado con exito!!!",html:!0,type:"success",text:a.msg,confirmButtonColor:"#d51b23"}),e("#myModal").modal("toggle"),e("#myModal").modal("toggle"),e("#save_seg").addClass("hide"),e(".modal-backdrop").remove(),n())},dataType:"json",cache:"false",error:function(e){alert("error al actualizar seguimiento")}}):swal({title:"Error",html:!0,type:"warning",text:"Detalles del error:<br>"+c.detalle,confirmButtonColor:"#D3D3D3"})}),e("#save_seg").click(function(){var t=new Array,i=a(document.location.search);e("#seguimiento input[id=asistencia]:checked").each(function(){var a=e(this).val();t.push(a)});var s=e("#myModalLabel").attr("name"),r=e("#seguimiento").serializeArray();r.push({name:"function",value:"new"}),r.push({name:"tipo",value:s}),r.push({name:"idtalentos",value:t}),r.push({name:"idinstancia",value:i.instanceid}),r.push({name:"idmonitor",value:120});var l=o(r);l.isvalid?e.ajax({type:"POST",data:r,url:"../managers/seguimiento_grupal/groupal_trackings_report.php",success:function(a){var t=a.error;t?swal({title:t,html:!0,type:"error",text:a.msg,confirmButtonColor:"#D3D3D3"}):(swal({title:"Actualizado con exito!!",html:!0,type:"success",text:a.msg,confirmButtonColor:"#d51b23"}),e("#myModal").modal("toggle"),e("#myModal").modal("toggle"),e("#save_seg").addClass("hide"),e(".modal-backdrop").remove(),n())},dataType:"json",cache:"false",error:function(e){alert("error al guardar seguimiento")}}):swal({title:"Error",html:!0,type:"warning",text:"Detalles del error:<br>"+l.detalle,confirmButtonColor:"#D3D3D3"})}),e("#upd_seg").click(function(){var a;e(this).attr("name");e("#seguimiento :input").prop("disabled",!1),t((a=[],e("#mytable_consult > tbody  > tr > td").each(function(){"talentos"==e(this).attr("id")&&a.push(e(this).html())}),a),!0),e("#edit_seg").removeClass("hide"),e("#upd_seg").addClass("hide")})}),e("#ficha_estudiante #editar_ficha").click(function(){e("#ficha_estudiante").find("input, textarea").prop("readonly",!1),e("#profesional_ps").prop("readonly",!0),e("#practicante_ps").prop("readonly",!0),e("#monitor_ps").prop("readonly",!0),e("#ficha_estudiante").find("select").prop("disabled",!1),e(this).hide(),e("#ficha_estudiante #cancel").fadeIn(),e("#ficha_estudiante #save").fadeIn(),e("#ficha_estudiante #codigo").attr("readonly",!0),e("#ficha_estudiante #search").fadeOut()}),e("#ficha_estudiante #cancel").click(function(){swal({title:"Estas seguro/a de cancelar?",text:"Los cambios realizados no serán tomados en cuenta y se perderán",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si!",cancelButtonText:"No",closeOnConfirm:!0},function(t){var i;t&&(e("#ficha_estudiante").find("input, textarea").prop("readonly",!0),e("#ficha_estudiante").find("select").prop("disabled",!0),e(this).hide(),e("#ficha_estudiante #save").fadeOut(),e("#ficha_estudiante #cancel").fadeOut(),e("#ficha_estudiante #editar_ficha").fadeIn(),e("#ficha_estudiante #codigo").attr("readonly",!1),e("#ficha_estudiante #search").fadeIn(),i=e("#ficha_estudiante #codigo").serializeArray(),e.ajax({type:"POST",data:i,url:"../managers/search_profile.php",success:function(t){var i=t.error;if(e("#ficha_estudiante input,textarea").val(""),e("#ficha_estudiante #nombreficha").text(""),e("#ficha_estudiante #email").text(""),e("#ficha_estudiante #cohorte").text(""),i)swal({title:"No encotrado",html:!0,type:"error",text:i,confirmButtonColor:"#d51b23"},function(e){if(e){var a=location.search.split("&");window.history.pushState(null,null,"talentos_profile.php"+a[0]+"&"+a[1])}});else{var n=a(document.location.search);canSeeStudent(t.idtalentos,n,function(e){if(e.result){var a=location.search.split("&"),i=location.href.split("?")[0]+a[0]+"&"+a[1]+"&talento_id="+t.username;location.href=i}else swal({title:"ÁREA RESTRINGIDA",html:!0,type:"warning",text:"No tienes permisos para ver la información de este estudiante.<br> Dirigete a la oficina de Sistemas del plan talentos pilos para gestionar tu situación",confirmButtonColor:"#d51b23"},function(a){a&&(location.href=e.pagina)})})}},dataType:"json",cache:"false",error:function(e){alert("Error "+e)}}))})}),e("#ficha_estudiante #go_back").on("click",function(){var e=location.search.split("&");location.href="index.php"+e[0]+"&"+e[1]}),e("#ficha_estudiante").on("click",".accordion-toggle",function(a){a.preventDefault();var t=e(this),i=t.next(".accordion-content"),n=e(this).children(".toggle-icon");t.toggleClass("open"),t.hasClass("open")?n.html("<i class='glyphicon glyphicon-chevron-down whitesmoke'></i>"):n.html("<i class='glyphicon glyphicon-chevron-left'></i>"),i.slideToggle(250)}),e(document).on("click","panel-heading",function(a){e(".panel-collapse.in").removeClass("in").addClass("collapse")})}}});