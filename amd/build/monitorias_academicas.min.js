define ("block_ases/monitorias_academicas",["jquery","block_ases/jquery.dataTables","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print","block_ases/_general_modal_manager","block_ases/select2","block_ases/jqueryui","block_ases/loading_indicator","block_ases/sweetalert","extras"],function(a,b,c,d,e,f,g,h,i,j,k,l){return{init:function init(){a(document).on("click","#anadir_monitoria",n);a(document).on("click","#config-icon",m);a.datepicker.setDefaults({closeText:"Cerrar",prevText:"&#x3C;Ant",nextText:"Sig&#x3E;",currentText:"Hoy",monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],dayNames:["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"],dayNamesShort:["dom","lun","mar","mi\xE9","jue","vie","s\xE1b"],dayNamesMin:["D","L","M","X","J","V","S"],weekHeader:"Sm",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""})},cargar_monitorias_default:function cargar_monitorias_default(b){a("#div_table").html("");a("#div_table").fadeIn(500).append("<table id=\"tableResult\" class=\"stripe row-border order-column\" cellspacing=\"0\" width=\"100%\"><thead> </thead></table>");a("#tableResult").DataTable(b)},continuar_setup_inicial:function continuar_setup_inicial(){a(".dt-button.buttons-print.eliminar").click(o)}};function m(){a.when(a.ajax({url:"../templates/monitorias_academicas_config.mustache",data:null,dataType:"text",async:!0,success:function success(a){g.generate_modal("modal_config","Configuraci\xF3n",a,null,function(){g.show_modal(".modal_config")})},error:function error(){console.log("../templates/monitorias_academicas_config.mustache cannot be reached.")}})).done(function(){a.ajax({type:"POST",data:JSON.stringify({function:"cargar_grupos",params:[l.getUrlParams(document.location.search).courseid]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function success(b){var c=a.map(b.data_response,function(b){return{id:b.id,text:b.nombre}});a("#grupos").select2({data:c,placeholder:"Seleccionar grupo"});a("#grupos").val(b.seleccionado.id_number).change()},error:function error(b){console.log("Error consulta BD grupo");console.log(b);a("#debug").html(b.responseText)}});a("#cancel_config").click(function(){a(".general_modal_close").first().click()});a("#form_config").submit(function(b){b.preventDefault();j.show();var c=a("select[name='grupo']").val();a.ajax({type:"POST",data:JSON.stringify({function:"actualizar_config",params:[parseInt(c)]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function success(b){j.hide();a(".general_modal_close").first().click();if(0!=b.status_code){swal("Error!","Oops!: "+b.data_response,"error");console.log(b)}},error:function error(b){console.log("Error update bd de config en backend");a("#debug").html(b.responseText)}})})})}function n(){a.ajax({url:"../templates/monitorias_academicas_anadir.mustache",data:null,dataType:"text",async:!0,success:function success(a){g.generate_modal("modal_fomulario_anadir","A\xF1adir monitoria",a,null,function(){g.show_modal(".modal_fomulario_anadir")});b()},error:function error(){console.log("../templates/monitorias_academicas_anadir.mustache cannot be reached.")}});function b(){(function(){a.ajax({type:"POST",data:JSON.stringify({function:"cargar_materias",params:[]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function success(d){var e=a.map(d.data_response,function(b){return{id:b.id,text:b.nombre}});a("#materia").select2({data:e,placeholder:"Seleccionar materia",templateResult:b,createTag:c,tags:!0,escapeMarkup:function escapeMarkup(a){return a}}).on("select2:closing",function(b){var c=b.params.args.originalEvent;if(null!=c&&a(c.target).hasClass("boton-eliminar-materia")){var d=b.params.args.originalSelect2Event.data;b.preventDefault();b.stopPropagation();a.ajax({type:"POST",data:JSON.stringify({function:"eliminar_materia",params:[parseInt(d.id)]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function success(b){if(0==b.status_code){a("#materia").find("option[value=".concat(d.id,"]"))[0].remove();a("#materia").trigger("change");a(c.target).parent(".opcion-select").parent(".select2-results__option").hide()}else{swal("Error!","Oops!: "+b.error_response,"error")}},error:function error(b){console.log("Error eliminar bd de materia en backend");a("#debug").html(b.responseText)}})}}).on("select2:opening",function(b){prevselection=a(b.target).find(":selected");a("#materia").val(null)}).on("select2:select",function(b){var c=b.params.data;if(-1==c.id){a.ajax({type:"POST",data:JSON.stringify({function:"anadir_materia",params:[c.text]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function success(b){if(0==b.status_code){a("#materia").find("option[value=-1]")[0].value=b.id;var d=new Option(c.text,b.id,!1,!0);a("#materia").append(d).trigger("change")}else{swal("Error!","Oops!: "+b.data_response,"error")}},error:function error(b){console.log("Error insercion bd de materia en backend");a("#debug").html(b.responseText)}})}})},error:function error(a){console.log("Error consulta BD materias");console.log(a)}});function b(b){if(b.hasOwnProperty("newTag")&&b.newTag){return a("<span id=\"materia_nueva\" class=\"opcion-select\">".concat(b.text,"<span style=\"opacity:0.5;margin-left:1ch\">(agregar)</span><div class=\"icono-agregar-materia\"><span>"))}var c=a("<span id=\"materia_".concat(b.id,"\" class=\"opcion-select\">").concat(b.text,"<div class=\"boton-eliminar-materia\"><span>"));return c}function c(b){if(""===a.trim(b.term)||3>a.trim(b.term).length){return null}return{id:-1,text:b.term,newTag:!0}}})();(function(){a.ajax({type:"POST",data:JSON.stringify({function:"cargar_monitores",params:[l.getUrlParams(document.location.search).instanceid]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function success(b){var c=a.map(b.data_response,function(b){return{id:b.id,text:b.nombre+" "+b.apellido}});a("#monitor").select2({data:c,placeholder:"Seleccionar monitor"})},error:function error(b){console.log("Error consulta BD monitores");a("#debug").html(b.responseText)}})})();(function(){a("#cancel_monitoria_btn").click(function(){a(".general_modal_close").first().click()});a("#form_anadir").submit(function(b){b.preventDefault();j.show();var c=a("select[name='dia']").val(),d=a("#hora_inicio1 option:selected").text()+" "+a("#hora_inicio2 option:selected").text()+" - "+a("#hora_final1 option:selected").text()+" "+a("#hora_final2 option:selected").text(),e=a("#materia").find(":selected").first().val(),f=a("#monitor").find(":selected").first().val(),g=a("#programar_monitorias_chckbx").prop("checked");if(g){var h=a("#fecha_hasta").val()}else{var h=-1}a.ajax({type:"POST",data:JSON.stringify({function:"anadir_monitoria",params:[c,d,e,f,g,h]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function success(b){j.hide();a(".general_modal_close").first().click();if(0==b.status_code){swal({title:"Monitoria registrada",text:"Se ha agregado correctamente la monitoria",icon:"success"},function(){location.reload()})}else{swal("Error!","Oops!: "+b.data_response,"error");console.log(b)}},error:function error(b){console.log("Error insercion bd de monitoria en backend");a("#debug").html(b.responseText)}})})})();a("#fecha_hasta").datepicker({minDate:0,showWeek:!0,dateFormat:"dd/M/y"});a("#programar_monitorias_chckbx").change(function(){a("#fecha_hasta").attr("required",a("#programar_monitorias_chckbx").prop("checked"));a("#seleccionar-fecha-anadir").toggle(300)})}}function o(b){var c=a(b.target).parent().parent().find("td").toArray().map(function(a){return a.innerHTML});swal({title:"Eliminar monitor\xEDa",text:"\xBFDeseas eliminar la monitor\xEDa de  "+c[0]+" programada los "+c[1]+" de "+c[2]+"?",type:"warning",showCancelButton:!0,confirmButtonText:"Eliminar"},function(c){if(c){a.ajax({type:"POST",data:JSON.stringify({function:"eliminar_monitoria",params:b.target.id}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function success(){location.reload()},error:function error(a){swal("Error!",a,"error");console.log(a)}})}})}});define("extras",function(){return{getUrlParams:function getUrlParams(a){for(var b=[],c=a.substring(1),d=c.split("&"),e=0,f;e<d.length;e++){f=d[e].split("=");b[f[0]]=f[1]}return b}}});
//# sourceMappingURL=monitorias_academicas.min.js.map
