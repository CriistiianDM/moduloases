define(["jquery","block_ases/_ases_api","block_ases/aaspect"],(e,t,a)=>{console.log("Plugin status initialised"),e(document).on("click","#select-visibles",t=>{t.preventDefault(),e(".user_enrolled[data-visible='true']").find(".remove_check").attr("checked",!0),e(".user_enrolled[data-visible='true']").find(".ucontainer").addClass("user-selected")}),e(document).on("click","#clear-selection",t=>{t.preventDefault(),e(".user_enrolled").find(".remove_check").attr("checked",!1),e(".user_enrolled").find(".ucontainer").removeClass("user-selected")}),e(document).on("click","#remove-selected",a=>{a.preventDefault();let s=[];e(".user_enrolled[data-visible='true']").find(".ucontainer").each(()=>{!0===e(this).find(".remove_check").prop("checked")&&s.push(e(this).data("id"))});t.post("plugin_status","remove_enrolled_users",[450299,s],async=!1,use_loading_indicator=!0,ok_callback=(()=>{alert("Eliminado(s)")}))}),e(document).on("click",".ucontainer",()=>{let t=e(this),a=e(this).find(".remove_check");!0===a.prop("checked")?(a.attr("checked",!1),t.removeClass("user-selected")):(a.attr("checked",!0),t.addClass("user-selected"))}),e(document).on("click",".mfilter",()=>{e(".ucontainer").find(".remove_check").attr("checked",!1),e(".ucontainer").removeClass("user-selected");let t=e(this);e(".mfilter").removeClass("filter-selected"),t.addClass("filter-selected");let a=t.data("filter");e(".ucontainer").parent().show(),e(".ucontainer").parent().attr("data-visible",!0),"all"!==a&&(e(".ucontainer").not('.ucontainer[data-glist="'+a+'"]').parent().attr("data-visible",!1),e(".ucontainer").not('.ucontainer[data-glist="'+a+'"]').parent().hide())});t.post("plugin_status","get_users_data_by_instance",[450299],async=!0,use_loading_indicator=!0,ok_callback=(t=>{let a=[],s=[];s.S="Sin grupo",t.data_response.forEach(t=>{let n=[],i=e(e("#user_enrolled_template").html());i.find(".ucontainer").find(".fname").text(t.user.firstname),i.find(".ucontainer").find(".lname").text(t.user.lastname),i.find(".ucontainer").attr("data-id",t.user.id),i.find(".ucontainer").attr("data-groups",JSON.stringify(t.groups)),i.find(".ucontainer").attr("data-groups-number",t.groups.length);for(let e=0;e<t.groups.length;e++){let r=t.groups[e].name,l="";if(r[0]in s){let a=1,n="";for(;;){let i=t.groups[e].name+n;if(!(i.substring(0,a)in s)){s[i.substring(0,a)]=i,l=i.substring(0,a);break}if(s[i.substring(0,a)]===i){l=i.substring(0,a);break}++a>t.groups[e].name.length&&(n+="1")}}else s[r[0]]=r,l=r[0];n.push(r),a.includes(r)||a.push(r),i.find(".ucontainer").find(".groups_container").append('<span class="enrolled_group" title="'+r+'">'+l+"</span>")}0===t.groups.length&&(n.push("Sin grupo"),i.find(".ucontainer").find(".groups_container").append('<span class="enrolled_group" title="Sin grupo">S</span>')),i.find(".ucontainer").attr("data-glist",n),i.appendTo("#plugin_members_container")}),a.push("Sin grupo"),a.forEach(t=>{e("#step_0_selector").append('<div class="mfilter" data-filter="'+t+'">'+t+"</div>")}),e("#step_0_selector").append('<div class="mfilter filter-selected" data-filter="all">Sin filtro</div>')})),t.post("plugin_status","get_all_periods",[],async=!0,use_loading_indicator=!0,ok_callback=(t=>{t.data_response.forEach(t=>{let a=e(e("#period-template").html());a.find(".p-name").text(t.nombre),a.find(".start-d").text(t.fecha_inicio),a.find(".end-d").text(t.fecha_fin),a.appendTo("#list-of-periods")})}));t.post("plugin_status","initialization_available",[],async=!1,use_loading_indicator=!0).data_response;return{init:()=>{e(document).on("click",'[data-toggle="ases-pill"]',t=>{var a=e(this);a.parent().find("li").removeClass("ases-active"),a.addClass("ases-active");var s=a.data("tab"),n=e(s),i=n.parent().find(".ases-tab-pane");i.removeClass("ases-tab-active"),i.removeClass("ases-fade"),i.removeClass("ases-in"),n.addClass("ases-fade"),n.addClass("ases-in"),n.addClass("ases-tab-active")})}}});