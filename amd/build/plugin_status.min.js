'use strict';define(['jquery','block_ases/_ases_api'],function(a,b){console.log('Plugin status initialised'),a(document).on('click','#select-visibles',function(g){g.preventDefault(),a('.user_enrolled[data-visible=\'true\']').find('.remove_check').attr('checked',!0),a('.user_enrolled[data-visible=\'true\']').find('.ucontainer').addClass('user-selected')}),a(document).on('click','#clear-selection',function(g){g.preventDefault(),a('.user_enrolled').find('.remove_check').attr('checked',!1),a('.user_enrolled').find('.ucontainer').removeClass('user-selected')}),a(document).on('click','#remove-selected',function(g){g.preventDefault();var h=[];a('.user_enrolled[data-visible=\'true\']').find('.ucontainer').each(function(){!0===a(void 0).find('.remove_check').prop('checked')&&h.push(a(void 0).data('id'))});b.post('plugin_status','remove_enrolled_users',[450299,h],async=!1,use_loading_indicator=!0,ok_callback=function ok_callback(){alert('Eliminado(s)')})}),a(document).on('click','.ucontainer',function(){var g=a(void 0),h=a(void 0).find('.remove_check');!0===h.prop('checked')?(h.attr('checked',!1),g.removeClass('user-selected')):(h.attr('checked',!0),g.addClass('user-selected'))}),a(document).on('click','.mfilter',function(){a('.ucontainer').find('.remove_check').attr('checked',!1),a('.ucontainer').removeClass('user-selected');var g=a(void 0);a('.mfilter').removeClass('filter-selected'),g.addClass('filter-selected');var h=g.data('filter');a('.ucontainer').parent().show(),a('.ucontainer').parent().attr('data-visible',!0),'all'!==h&&(a('.ucontainer').not('.ucontainer[data-glist="'+h+'"]').parent().attr('data-visible',!1),a('.ucontainer').not('.ucontainer[data-glist="'+h+'"]').parent().hide())});b.post('plugin_status','get_users_data_by_instance',[450299],async=!0,use_loading_indicator=!0,ok_callback=function c(g){var h=[],j=[];j.S='Sin grupo',g.data_response.forEach(function(k){var l=[],m=a(a('#user_enrolled_template').html());m.find('.ucontainer').find('.fname').text(k.user.firstname),m.find('.ucontainer').find('.lname').text(k.user.lastname),m.find('.ucontainer').attr('data-id',k.user.id),m.find('.ucontainer').attr('data-groups',JSON.stringify(k.groups)),m.find('.ucontainer').attr('data-groups-number',k.groups.length);for(var n=0;n<k.groups.length;n++){var o=k.groups[n].name,p='';if(!(o[0]in j))j[o[0]]=o,p=o[0];else for(var s,q=1,r='';;){if(s=k.groups[n].name+r,!(s.substring(0,q)in j)){j[s.substring(0,q)]=s,p=s.substring(0,q);break}else if(j[s.substring(0,q)]===s){p=s.substring(0,q);break}q++,q>k.groups[n].name.length&&(r+='1')}l.push(o),h.includes(o)||h.push(o),m.find('.ucontainer').find('.groups_container').append('<span class="enrolled_group" title="'+o+'">'+p+'</span>')}0===k.groups.length&&(l.push('Sin grupo'),m.find('.ucontainer').find('.groups_container').append('<span class="enrolled_group" title="Sin grupo">S</span>')),m.find('.ucontainer').attr('data-glist',l),m.appendTo('#plugin_members_container')}),h.push('Sin grupo'),h.forEach(function(k){a('#step_0_selector').append('<div class="mfilter" data-filter="'+k+'">'+k+'</div>')}),a('#step_0_selector').append('<div class="mfilter filter-selected" data-filter="all">Sin filtro</div>')}),b.post('plugin_status','get_all_periods',[],async=!0,use_loading_indicator=!0,ok_callback=function d(g){g.data_response.forEach(function(h){var k=a(a('#period-template').html());k.find('.p-name').text(h.nombre),k.find('.start-d').text(h.fecha_inicio),k.find('.end-d').text(h.fecha_fin),k.appendTo('#list-of-periods')})});b.post('plugin_status','initialization_available',[],async=!1,use_loading_indicator=!0).data_response;return{init:function init(){a(document).on('click','[data-toggle="ases-pill"]',function(){var h=a(void 0),j=h.parent();j.find('li').removeClass('ases-active'),h.addClass('ases-active');var k=h.data('tab'),l=a(k),m=l.parent().find('.ases-tab-pane');m.removeClass('ases-tab-active'),m.removeClass('ases-fade'),m.removeClass('ases-in'),l.addClass('ases-fade'),l.addClass('ases-in'),l.addClass('ases-tab-active')})}}});