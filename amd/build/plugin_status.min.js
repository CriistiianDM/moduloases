'use strict';define(['jquery','block_ases/loading_indicator','block_ases/_ases_api'],function(a,b,c){console.log('Plugin status initialised'),a(document).on('click','#select-visibles',function(h){h.preventDefault(),a('.user_enrolled[data-visible=\'true\']').find('.remove_check').attr('checked',!0),a('.user_enrolled[data-visible=\'true\']').find('.ucontainer').addClass('user-selected')}),a(document).on('click','#clear-selection',function(h){h.preventDefault(),a('.user_enrolled').find('.remove_check').attr('checked',!1),a('.user_enrolled').find('.ucontainer').removeClass('user-selected')}),a(document).on('click','#remove-selected',function(h){h.preventDefault();var j=[];a('.user_enrolled[data-visible=\'true\']').find('.ucontainer').each(function(){!0==a(this).find('.remove_check').prop('checked')&&j.push(a(this).data('id'))})}),a(document).on('click','.ucontainer',function(){var h=a(this),j=a(this).find('.remove_check');!0===j.prop('checked')?(j.attr('checked',!1),h.removeClass('user-selected')):(j.attr('checked',!0),h.addClass('user-selected'))}),a(document).on('click','.mfilter',function(){a('.ucontainer').find('.remove_check').attr('checked',!1),a('.ucontainer').removeClass('user-selected');var h=a(this);a('.mfilter').removeClass('filter-selected'),h.addClass('filter-selected');var j=h.data('filter');a('.ucontainer').parent().show(),a('.ucontainer').parent().attr('data-visible',!0),'all'!==j&&(a('.ucontainer').not('.ucontainer[data-glist="'+j+'"]').parent().attr('data-visible',!1),a('.ucontainer').not('.ucontainer[data-glist="'+j+'"]').parent().hide())});c.post('plugin_status','get_users_data_by_instance',[450299],async=!0,use_loading_indicator=!0,ok_callback=function d(h){var j=[],k=[];k.S='Sin grupo',h.data_response.forEach(function(l){var m=[],n=a(a('#user_enrolled_template').html());n.find('.ucontainer').find('.fname').text(l.user.firstname),n.find('.ucontainer').find('.lname').text(l.user.lastname),n.find('.ucontainer').attr('data-id',l.user.id),n.find('.ucontainer').attr('data-groups',JSON.stringify(l.groups)),n.find('.ucontainer').attr('data-groups-number',l.groups.length);for(var o=0;o<l.groups.length;o++){var p=l.groups[o].name,q='';if(!(p[0]in k))k[p[0]]=p,q=p[0];else for(var t,r=1,s='';;){if(t=l.groups[o].name+s,!(t.substring(0,r)in k)){k[t.substring(0,r)]=t,q=t.substring(0,r);break}else if(k[t.substring(0,r)]===t){q=t.substring(0,r);break}r++,r>l.groups[o].name.length&&(s+='1')}m.push(p),j.includes(p)||j.push(p),n.find('.ucontainer').find('.groups_container').append('<span class="enrolled_group" title="'+p+'">'+q+'</span>')}0===l.groups.length&&(m.push('Sin grupo'),n.find('.ucontainer').find('.groups_container').append('<span class="enrolled_group" title="Sin grupo">S</span>')),n.find('.ucontainer').attr('data-glist',m),n.appendTo('#plugin_members_container')}),console.log(k),j.push('Sin grupo'),j.forEach(function(l){a('#step_0_selector').append('<div class="mfilter" data-filter="'+l+'">'+l+'</div>')}),a('#step_0_selector').append('<div class="mfilter filter-selected" data-filter="all">Sin filtro</div>')}),c.post('plugin_status','get_all_periods',[],async=!0,use_loading_indicator=!0,ok_callback=function f(h){h.data_response.forEach(function(j){var l=a(a('#period-template').html());l.find('.p-name').text(j.nombre),l.find('.start-d').text(j.fecha_inicio),l.find('.end-d').text(j.fecha_fin),l.appendTo('#list-of-periods')})});c.post('plugin_status','initialization_available',[],async=!1,use_loading_indicator=!0);return{init:function init(){a(document).on('click','[data-toggle="ases-pill"]',function(){var j=a(this),k=j.parent();k.find('li').removeClass('ases-active'),j.addClass('ases-active');var l=j.data('tab'),m=a(l),n=m.parent().find('.ases-tab-pane');n.removeClass('ases-tab-active'),n.removeClass('ases-fade'),n.removeClass('ases-in'),m.addClass('ases-fade'),m.addClass('ases-in'),m.addClass('ases-tab-active')})}}});