define(["jquery","block_ases/_general_modal_manager","block_ases/loading_indicator","block_ases/sweetalert"],function(i,a,n,o){var e={};return{set_user:(i,a,n)=>e={id:i,email:a,phone:n},p:()=>console.log(e),init:function(){n.show(),i(".link_inscripcion_monitoria").click(function(o){if(o.preventDefault(),!e.phone)return void swal({title:"Por favor, ingresa tu teléfono",text:'Antes de inscribirte a una monitoría requerimos que ingreses tu número de telefono celular. Puedes hacerlo en la sección "Tus datos de contacto".',icon:"warning"});n.show();const r=o.target.id;i.when(i.ajax({type:"POST",data:JSON.stringify({function:"get_proxima_sesion_de_monitoria",params:r}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",error:function(a){i("#debug").html(a)}})).done(t=>{let s=i("#content-modal-inscripcion").html();a.generate_modal("modal_fomulario_inscripcion","Inscribirse a monitoría",s,null,function(){n.hide(),a.show_modal(".modal_fomulario_inscripcion"),i(".modal_fomulario_inscripcion").find(".general_modal_content").addClass("w-50"),i(".modal_fomulario_inscripcion").find("#monitoria").val(o.target.innerHTML),i(".modal_fomulario_inscripcion").find("#fecha-monitoria").val(t.message.fecha_legible),i(".modal_fomulario_inscripcion").find("#asignatura").change(a=>{"-1"==a.target.value?(i(".modal_fomulario_inscripcion").find("#nombre-asignatura").val(""),i(".modal_fomulario_inscripcion").find("#profesor-asignatura").val(""),i(".modal_fomulario_inscripcion").find("#campos-otro").show()):i(".modal_fomulario_inscripcion").find("#campos-otro").hide()}),i(".modal_fomulario_inscripcion").find("#cancelar-inscripcion-btn").click(()=>{i(".general_modal_close").first().click()}),i(".modal_fomulario_inscripcion").find("#form-inscripcion").submit(function(a){a.preventDefault(),n.show();let o=t.message.id,s=e.id,c=i(".modal_fomulario_inscripcion").find("#asignatura").val(),l=i(".modal_fomulario_inscripcion").find("#tematica").val(),d="-1"==c?i(".modal_fomulario_inscripcion").find("#nombre-asignatura").val():"",m="-1"==c?i(".modal_fomulario_inscripcion").find("#profesor-asignatura").val():"",u=i(".modal_fomulario_inscripcion").find("#seguir-inscribiendo").prop("checked");i.ajax({type:"POST",data:JSON.stringify({function:"anadir_asistente_a_sesion_de_monitoria",params:[o,s,c,d,m,l,u,r]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function(a){n.hide(),i(".general_modal_close").first().click(),0==a.status_code?swal({title:"Inscripción correcta!",text:"Gracias por inscribirte. Serás contactado por el monitor encargado el día de la monitoría para concretar los detalles.",icon:"success"},function(i){location.reload()}):(swal("Error!","Oops!: "+a.data_response,"error"),console.log(a))},error:function(a){console.log("Error de inscripción a monitoria en BD"),i("#debug").html(a.responseText)}})})})})}),i(".eliminar-inscripcion").click(function(a){let n=i(a.target).parent().parent().find("td");swal({title:"Cancelar asistencia",text:"¿Deseas desinscribirte de la monitoría de "+n[3].innerHTML+" programada el "+n[0].innerHTML+" "+n[1].innerHTML+" "+n[2].innerHTML+"?",type:"warning",allowOutsideClick:!0,confirmButtonText:"Cancelar asistencia"},function(n){n&&i.ajax({type:"POST",data:JSON.stringify({function:"eliminar_asistencia",params:a.target.getAttribute("val")}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",success:function(i){location.reload()},error:function(i){swal("Error!",i,"error"),console.log(i)}})})}),i(".confirmar-asistencia").click(function(a){let n=i(a.target).parent().parent().find("td");console.log(a.target.getAttribute("val")),swal({title:"¿Confirmar asistencia?",text:"Se registrará tu asistencia a la monitoría de "+n[3].innerHTML,type:"info",allowOutsideClick:!0,confirmButtonText:"Registrar tu asistencia"},function(n){n&&i.ajax({type:"POST",data:JSON.stringify({function:"registrar_asistencia_a_asistente",params:a.target.getAttribute("val")}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",error:function(a){console.log("Error edicion BD asistentes monitorias academicas"),i("#debug").html(a.responseText)},success:i=>location.reload()})})});{function o(a){i("#edicion-celular").hide(),i("#mostrar-celular").show()}i("#editar-celular").click(function(a){i("#mostrar-celular").hide(),i("#edicion-celular").attr("style","display: inline"),i("#campo-celular").attr("placeholder",i("#celular").html())}),i("#cancelar-editar-celular").click(o),i("#guardar-editar-celular").click(function(a){i.when(i.ajax({type:"POST",data:JSON.stringify({function:"modificar_celular_de_usuario",params:[e.id,i("#campo-celular").val()]}),url:"../managers/asistencia_monitorias/asistencia_monitorias_api.php",dataType:"json",error:function(a){i("#debug").html(a)},success:function(a){e.phone=i("#campo-celular").val()}})).done(o),i("#celular").html(i("#campo-celular").val())})}n.hide()}}});