'use strict';define(['jquery','block_ases/Chart','block_ases/loading_indicator','block_ases/jquery.dataTables'],function(a,b,c){return{init:function init(e){function f(A,B){var C=[],D;for(D=0;D<B.length;D++)A.includes(B[D])&&C.push(D);return C}function g(A,B,C){a('#tableActiveSemesters tfoot th').html(''),a('#tableActiveSemesters tfoot th')[0].textContent=s+' '+C,B.forEach(function(D){a('#tableActiveSemesters tfoot th.'+D).html(A[D])})}function h(A,B){return A.filter(function(C){return-1!==B.indexOf(C)}).length===B.length}function k(){var A=document.getElementById('active_semesters_chart').toDataURL();a('#download_percentage_desertion').click(function(){a(this).attr('href',A)})}function l(A,B,C){var D=[];A.forEach(function(H){D.push(B[H])});var F=document.getElementById('active_semesters_chart'),G=F.getContext('2d');window.myLine=new b(G,{type:'line',data:{labels:A,datasets:[{label:'Porcentaje de estudiantes inactivos durante el periodo',backgroundColor:'red',borderColor:'red',data:D,fill:!1}]},options:{animation:{onComplete:function onComplete(){C()}},responsive:!0,title:{display:!0,text:'Reporte deserci\xF3n'},tooltips:{mode:'index',intersect:!1},hover:{mode:'nearest',intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:'Periodo'}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:'Porcentaje'}}]}}})}function m(A){c.show();a.ajax({method:'POST',url:'../managers/report_active_semesters/report_active_semesters_api.php/'+n,data:{function:'data_table',params:{instance_id:n,cohort_id:A}},dataType:'json'}).done(function(D){c.hide();var E=D.dataTable;a('#download_percentage_desertion').css('display','inline'),u=D.semesters;var F=E.columns.map(function(H){return H.name}),G=E.data.length;x=new w(u,G),x.init_from_data(E.data,u),y=new v(x,u),l(u,y,k),E.rowCallback=function(H,I){a(u).each(function(K,L){'SI'===I[L]&&a('td.'+L,H).addClass('active_semester')})},E.initComplete=function(){var H=E.columns.map(function(J){return J.name?J.name:null}),I=f(u,H);this.api().columns(I).every(function(){var J=this,K=a('<select><option value=""></option></select>').appendTo(a(J.header())).on('change',function(){var L=a.fn.dataTable.util.escapeRegex(a(this).val());J.search(L?'^'+L+'$':'',!0,!1).draw()});J.data().unique().sort().each(function(L){K.append('<option value="'+L+'">'+L+'</option>')})})},a.fn.dataTable.isDataTable('#tableActiveSemesters')&&(a('#div_table_report').html(''),a('#div_table_report').fadeIn(1e3).append('<table id="tableActiveSemesters" class="table" cellspacing="0" width="100%"></table>')),o=a('#tableActiveSemesters').DataTable(E),a('#tableActiveSemesters').append(a('<tfoot/>').append(a('#tableActiveSemesters thead tr').clone())),g(x,u,A),h(F,t)||console.error(' Las columnas dadas no coinciden con las columnas conocidas.','columnas daads:',F,'columnas conocidas: ',t)}).fail(function(){c.hide()})}var n=e.instance_id,o=null,s='Total activos',t=['codigo','nombre','num_doc'];a(document).on('click','#tableActiveSemesters tbody tr td',function(){var B=a('#tableActiveSemesters').DataTable(),C=B.cell(this).index().column;if(0<=C&&2>=C){var D='student_profile.php'+location.search+'&student_code='+B.cell(B.row(this).index(),0).data(),E=window.open(D,'_blank');E.focus()}});var u=[],v=function(){return function(B,C){var E=this,D=B.total_students;C.forEach(function(F){var G=D-B[F];E[F]=100*G/D})}}(),w=function(){function A(B,C){var D=this;this.total_students=C?C:0,B.forEach(function(E){D[E]=0})}return A.prototype.init_from_data=function(C,D){var E=this;C.forEach(function(F){D.forEach(function(G){'SI'===F[G]&&E[G]++})})},A}(),x=null,y=null;a('#cohorts').change(function(){var A=a('#cohorts option:selected').val();a('#tableActiveSemesters tfoot th')[0].textContent=s+' '+A,m(A)});var z=a('#cohorts option:selected').val();m(z)}}});