'use strict';define(['jquery','core/notification','block_ases/global_grade_book','core/templates','block_ases/jquery.dataTables'],function(a){return{init:function init(f){function g(y,z){var A=[],B;for(B=0;B<z.length;B++)y.includes(z[B])&&A.push(B);return A}function h(y,z,A){a('#tableActiveSemesters tfoot th')[0].textContent=r+' '+A,a('#tableActiveSemesters tfoot th.'+p).html(''),a('#tableActiveSemesters tfoot th.'+q).html(''),z.forEach(function(B){a('#tableActiveSemesters tfoot th.'+B).html(y[B])})}function k(y,z){return y.filter(function(A){return-1!==z.indexOf(A)}).length===z.length}function l(y,z){a.ajax({method:'POST',url:'../managers/report_active_semesters/report_active_semesters_api.php/'+m,data:{function:'data_table',params:{instance_id:m,cohort_id:y}},dataType:'json'}).done(function(C){var D=C.dataTable;t=C.semesters;var E=D.columns.map(function(F){return F.name});v=new u(t),v.init_from_data(D.data,t),console.log(v['2015A']),D.rowCallback=function(F,G){a(t).each(function(I,J){'SI'===G[J]&&a('td.'+J,F).addClass('active_semester')})},D.initComplete=function(){var F=D.columns.map(function(H){return H.name?H.name:null}),G=g(t,F);this.api().columns(G).every(function(){var H=this,I=a('<select><option value=""></option></select>').appendTo(a(H.header())).on('change',function(){var J=a.fn.dataTable.util.escapeRegex(a(this).val());H.search(J?'^'+J+'$':'',!0,!1).draw()});H.data().unique().sort().each(function(J){I.append('<option value="'+J+'">'+J+'</option>')})})},a.fn.dataTable.isDataTable('#tableActiveSemesters')&&(a('#div_table_report').html(''),a('#div_table_report').fadeIn(1e3).append('<table id="tableActiveSemesters" class="table" cellspacing="0" width="100%"></table>')),n=a('#tableActiveSemesters').DataTable(D),a('#tableActiveSemesters').append(a('<tfoot/>').append(a('#tableActiveSemesters thead tr').clone())),h(v,t,z),k(E,s)||console.error(' Las columnas dadas no coinciden con las columnas conocidas.','columnas daads:',E,'columnas conocidas: ',s)}).fail(function(){})}var m=f.instance_id,n=null,p='nombre',q='num_doc',r='Total activos SRA',s=['codigo',p,q];a(document).on('click','#tableActiveSemesters tbody tr td',function(){var z=a('#tableActiveSemesters').DataTable(),A=z.cell(this).index().column;if(0<=A&&2>=A){var B='student_profile.php'+location.search+'&student_code='+z.cell(z.row(this).index(),0).data(),C=window.open(B,'_blank');C.focus()}});var t=[],u=function(){function y(z){var A=this;z.forEach(function(B){A[B]=0})}return y.prototype.init_from_data=function(A,B){var C=this;A.forEach(function(D){B.forEach(function(E){'SI'===D[E]&&C[E]++})})},y}(),v=null;a('#cohorts').change(function(){var y=a('#cohorts option:selected').val(),z=a('#cohorts option:selected').text();a('#tableActiveSemesters tfoot th')[0].textContent=r+' '+z,l(y,z)});var w=a('#cohorts option:selected').val(),x=a('#cohorts option:selected').text();l(w,x)}}});