define ("block_ases/report_active_semesters",["jquery","block_ases/Chart","block_ases/loading_indicator","block_ases/jquery.dataTables","block_ases/dataTables.autoFill","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print"],function(a,b,c){return{init:function init(d){var k=d.instance_id,l="Total activos",m=["codigo","nombre","num_doc"];a(document).on("click","#tableActiveSemesters tbody tr td",function(){var b=a("#tableActiveSemesters").DataTable(),c=b.cell(this).index().column;if(0<=c&&2>=c){var d="student_profile.php"+location.search+"&student_code="+b.cell(b.row(this).index(),0).data(),e=window.open(d,"_blank");e.focus()}});var n=[],o=function(){function a(a,b){var c=this,d=a.total_students;b.forEach(function(b){var e=d-(a.semesters[b][0]+a.semesters[b][1]);c[b]=100*e/d})}return a}(),p=function(){function a(a,b){var c=this,d=a.total_students;b.forEach(function(b){var e=a.semesters[b][1];c[b]=100*e/d})}return a}(),q=function(){function a(a,b){var c=this,d=a.total_students;b.forEach(function(b){var e=a.semesters[b][0];c[b]=100*e/d})}return a}(),r=function(){function a(a,b){this.total_students=b?b:0;this.semesters=[];for(var c=a.length,d=0;d<c;d++){this.semesters[a[d]]=[0,0,0,0]}}a.prototype.init_from_data=function(a,b){var c=this;a.forEach(function(a){var d="";b.forEach(function(b){if(!(a[b].includes("NO")||a[b].includes("EGRESADO"))){if(!a[b].includes(d)&&""!==d){c.semesters[b][2]++}d=a[b]}if(a[b].includes("SI")){c.semesters[b][0]++}else if(a[b].includes("EGRESADO")){c.semesters[b][1]++}})});var d=0;b.forEach(function(a){d=d+c.semesters[a][2];c.semesters[a][2]=d})};return a}();function e(a,b){var c=[],d;for(d=0;d<b.length;d++){if(a.includes(b[d])){c.push(d)}}return c}function f(b,c,d){a("#tableActiveSemesters tfoot th").html("");a("#tableActiveSemesters tfoot tr.total_students th")[1].textContent="Total Estudiantes"+" "+d;a("#tableActiveSemesters tfoot tr.total_nochange th")[1].textContent="Activos sin cambio de carrera"+" "+d;a("#tableActiveSemesters tfoot tr.total_change th")[1].textContent="Activos con cambio de carrera"+" "+d;a("#tableActiveSemesters tfoot tr.total_active th")[1].textContent=l+" "+d;a("#tableActiveSemesters tfoot tr.total_inactive th")[1].textContent="inactivos"+" "+d;a("#tableActiveSemesters tfoot tr.total_grads th")[1].textContent="Egresados"+" "+d;c.forEach(function(c){a("#tableActiveSemesters tfoot tr.total_students th."+c).html(b.total_students);a("#tableActiveSemesters tfoot tr.total_nochange th."+c).html(b.semesters[c][0]-b.semesters[c][2]);a("#tableActiveSemesters tfoot tr.total_change th."+c).html(b.semesters[c][2]);a("#tableActiveSemesters tfoot tr.total_active th."+c).html(b.semesters[c][0]);a("#tableActiveSemesters tfoot tr.total_inactive th."+c).html(b.total_students-(b.semesters[c][0]+b.semesters[c][1]));a("#tableActiveSemesters tfoot tr.total_grads th."+c).html(b.semesters[c][1])})}var s=null,t=null,u=null,v=null;function g(a,b){return a.filter(function(a){return-1!==b.indexOf(a)}).length===b.length}function h(){var b=document.getElementById("active_semesters_chart").toDataURL();a("#download_percentage_desertion").click(function(){a(this).attr("href",b)})}function i(a,c,d,e,f){var g=[],h=[],i=[];a.forEach(function(a){g.push(c[a]);h.push(d[a]);i.push(e[a])});var j=document.getElementById("active_semesters_chart"),k=j.getContext("2d");window.myLine=new b(k,{type:"line",data:{labels:a,datasets:[{label:"Porcentaje de estudiantes activos durante el periodo",backgroundColor:"green",borderColor:"green",data:i,fill:!1},{label:"Porcentaje de estudiantes inactivos durante el periodo",backgroundColor:"red",borderColor:"red",data:g,fill:!1},{label:"Porcentaje de estudiantes graduados durante el periodo",backgroundColor:"blue",borderColor:"blue",data:h,fill:!1}]},options:{animation:{onComplete:function onComplete(){f()}},responsive:!0,title:{display:!0,text:"Reporte deserci\xF3n"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Periodo"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Porcentaje"}}]}}})}function j(b){c.show();a.ajax({method:"POST",url:"../managers/report_active_semesters/report_active_semesters_api.php/"+k,data:{function:"data_table",params:{instance_id:k,cohort_id:b}},dataType:"json"}).done(function(d){c.hide();var j=d.dataTable;a("#download_percentage_desertion").css("display","inline");n=Object.values(d.semesters);var k=j.columns,l=k.map(function(a){return a.name}),w=j.data.length;s=new r(n,w);s.init_from_data(j.data,n);t=new o(s,n);u=new p(s,n);v=new q(s,n);i(n,t,u,v,h);j.rowCallback=function(b,c){a(n).each(function(d,e){if(c[e].includes("SI")){a("td."+e,b).addClass("active_semester")}else if(c[e].includes("EGRESADO")){a("td."+e,b).addClass("graduated_student")}})};j.initComplete=function(){a("th:contains('20')").each(function(){a(this).addClass("Semestre")});var b=j.columns.map(function(a){return a.name?a.name:null}),c=n;c.push("num_carreras");var d=e(c,b);this.api().columns(d).every(function(){var b=this,c=a("<select><option value=\"\"></option></select>").on("change",function(){var c=a.fn.dataTable.util.escapeRegex(a(this).val());b.search(c?"^"+c+"$":"",!0,!1).draw()});b.data().unique().sort().each(function(a){c.append("<option value=\""+a+"\">"+a+"</option>")})})};if(a.fn.dataTable.isDataTable("#tableActiveSemesters")){a("#div_table_report").html("");a("#div_table_report").fadeIn(1e3).append("<table id=\"tableActiveSemesters\" class=\"table\" cellspacing=\"0\" width=\"100%\"></table>")}a("#tableActiveSemesters").DataTable(j);a("#tableActiveSemesters").append(a("<tfoot/>").append(a("#tableActiveSemesters thead tr").clone().addClass("total_students")));a("#tableActiveSemesters").append(a("<tfoot/>").append(a("#tableActiveSemesters thead tr").clone().addClass("total_nochange")));a("#tableActiveSemesters").append(a("<tfoot/>").append(a("#tableActiveSemesters thead tr").clone().addClass("total_change")));a("#tableActiveSemesters").append(a("<tfoot/>").append(a("#tableActiveSemesters thead tr").clone().addClass("total_active")));a("#tableActiveSemesters").append(a("<tfoot/>").append(a("#tableActiveSemesters thead tr").clone().addClass("total_inactive")));a("#tableActiveSemesters").append(a("<tfoot/>").append(a("#tableActiveSemesters thead tr").clone().addClass("total_grads")));f(s,n,b);if(!g(l,m)){console.error(" Las columnas dadas no coinciden con las columnas conocidas.","columnas daads:",l,"columnas conocidas: ",m)}}).fail(function(){c.hide()})}a("#cohorts").change(function(){var b=a("#cohorts option:selected").val();a("#tableActiveSemesters tfoot th")[0].textContent=l+" "+b;j(b)});var w=a("#cohorts option:selected").val();j(w)}}});
//# sourceMappingURL=report_active_semesters.min.js.map
