define(["jquery","block_ases/bootstrap","block_ases/tagging","block_ases/smart_wizard","block_ases/mustache","block_ases/sweetalert"],function(e,t,a,i,n){return{init:function(){e(document).ready(function(){var t,a,i="",n="",o="",s=!1,r=!1;function l(){_(e("#select_programa"),"get_programas_academicos")}function c(){t?e("#step-1 :input").prop("disabled",!1):(e("#nombre").prop("disabled",!0),e("#apellido").prop("disabled",!0),e("#emailinstitucional").prop("disabled",!0)),e("#edad").prop("disabled",!0)}e("#step-1 :input").prop("disabled",!0),e("#codigo_estudiantil").prop("disabled",!1),e("#validar_codigo").prop("disabled",!1),e("#pruebas").on("click",function(){e(":input").val(""),e("#smartwizard").smartWizard("reset")}),e("#mostrar").on("click",function(){_(e("#id_ciudad_ini"),"get_ciudades"),_(e("#acompanamientos"),"get_otros_acompañamientos"),_(e("#id_cond_excepcion"),"get_cond_excepcion"),_(e("#id_estado_civil"),"get_estados_civiles"),_(e("#sexo"),"get_sex_options"),_(e("#id_identidad_gen"),"get_generos"),_(e("#id_act_simultanea"),"get_act_simultaneas"),_(e("#id_etnia"),"get_etnias"),_(e("#tipo_doc"),"get_document_types"),_(e("#s_discapacidad"),"get_discapacities"),_(e("#id_pais"),"get_paises"),_(e("#barrio_res"),"get_barrios"),_(e("#id_ciudad_res"),"get_ciudades"),l(),_(e("#id_pais_res"),"get_paises"),_(e("#barrio_ini"),"get_barrios"),_(e("#tipo_doc_ini"),"get_document_types"),_(e("#select_sede"),"get_sedes"),_(e("#s_programa_1"),"get_programas_academicos"),_(e("#s_programa_2"),"get_programas_academicos"),_(e("#s_programa_3"),"get_programas_academicos"),_(e("#s_programa_4"),"get_programas_academicos"),g("permanencia","solvencia_econo"),g("set-desplazamiento","ayuda_transporte"),g("set-certificado-discapacidad","discapacidad"),g("set-apoyo","apoyo_partic"),g("set-participacion","participacion"),g("set-salud","option"),g("set-orientacion","orientacion_sexual"),g("set-sexo","sexo"),g("set-identidad-gen","identidad_genero"),g("set-beca","beca"),new Tagging(e("#deportes_tag"),e("#tags_deportes"),1,3).createTag(),new Tagging(e("#tiempo_libre"),e("#tags_tiempo_libre")).createTag(),e("#modalExample").show()}),e(".closer").on("click",function(){e("#modalExample").hide()}),e("#smartwizard").smartWizard({selected:0,theme:"dots",autoAdjustHeight:!0,showStepURLhash:!1,lang:{next:"Siguiente",previous:"Anterior"}}),e("#validar_codigo").on("click",function(){var a=e("#codigo_estudiantil").val();""===a||" "===a?(e("#nombre").val(""),e("#apellido").val(""),e("#emailinstitucional").val(""),e("#step-1 :input").prop("disabled",!0),e("#codigo_estudiantil").prop("disabled",!1),e("#validar_codigo").prop("disabled",!1),l()):e.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_user",params:a}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){!function(a){0!=a?(e("#step-1 :input").prop("disabled",!0),e("#codigo_estudiantil").prop("disabled",!1),e("#validar_codigo").prop("disabled",!1),e("#tipo_doc_ini").prop("disabled",!1),e("#num_doc_ini").prop("disabled",!1),e("#select_sede").prop("disabled",!1),e("#select_programa").prop("disabled",!1),function(t){e("#nombre").val(t.firstname),e("#apellido").val(t.lastname),e("#emailinstitucional").val(t.email),c(),programs=t.username.slice(t.username.indexOf("-")+1),e("#select_programa").empty(),_(e("#select_programa"),"get_programas_academicos_est",programs)}(a),!1,t=!1):swal({title:"Warning",text:"Estudiante inexistente en la base de datos, ¿Esta seguro de registrar este usuario?.",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(a){a?(swal("Confirmado","","success"),t=!0,!1,c()):(swal("Cancelado","Ingresa nuevamente el codigo del estudiante","error"),e("#codigo_estudiantil").val(""))})}(JSON.parse(a))},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}),e("#fecha_nac").blur(function(){var t=e("#fecha_nac").val(),a=new Date,i=new Date(t),n=a.getFullYear()-i.getFullYear(),o=a.getMonth()-i.getMonth();(o<0||0===o&&a.getDate()<i.getDate())&&n--,e("#edad").val(n)}),e(document).on("click",".remove_fila",function(){e(this).parent().parent().remove()}),e(document).on("click",".remove_fila_ing",function(){d--,e(this).parent().parent().remove()}),e("#add_person_r").on("click",function(){!function(e){let t="";t+='<tr><td> <input  class="input_fields_general_tab"  type="text"/></td>',t+='<td> <input  class="input_fields_general_tab"  type="text" /></td>',t+='<td> <button class="btn btn-danger remove_fila" type="button" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> X </button></td></tr>',e.find("tbody").append('<tr><td> <input  class="input_fields_general_tab"  type="text"/></td><td> <input  class="input_fields_general_tab"  type="text" /></td><td> <button class="btn btn-danger remove_fila" type="button" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> X </button></td></tr>')}(e("#table_familia"))}),e("#add_ingreso").on("click",function(){d++,function(t){let a="";a+='<tr><td> <input id="anio_'+d+'" class="input_fields_general_tab ingresos_u step3" name="anio_'+d+'"  type="text"/></td>',a+='<td> <select id="s_programa_'+d+'" class="custom-select select-academics-data step3"></select> <input  id="id_programa_'+d+'" name="id_programa_'+d+'" class="ingresos_u" type="number" hidden></td>',a+='<td><select class="custom-select select-academics-data step3"> <option value="1">Bajos académicos</option> <option value="2">Condición de salud</option> <option value="3">Fallecimiento</option> <option value="4">Condición económica</option> <option value="5">Condición de programa académico</option> <option value="6">Cambio de institución educativa</option> <option value="7">Cambio de ciudad</option> <option value="8">Retiro voluntario</option> <option value="9">Prefiero no decirlo</option> </select> <input  id="motivo_'+d+'" name="motivo_'+d+'" class="ingresos_u" type="number" hidden> </td>',a+='<td> <button class="btn btn-danger remove_fila_ing" type="button" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> X </button></td></tr>',t.find("tbody").append(a),_(e("#s_programa_"+d),"get_programas_academicos")}(e("#table_ingresos"))}),e(document).on("click","#guardar_info",function(){a?r&&(r=!1):(!function(){var t=(a=[],i=[],v("regimen_salud",i),m("regimen_salud",i,a),v("data_sisben",i=[]),u("observ_sisben",i),v("serv_adicionales",i),v("conclusion_jornada",i),u("conclusion",i),v("json_detalle",i),m("datos_salud_adicionales",i,a),v("serv_usuario",i=[]),m("servicios_usados",i,a),i=[],a);var a,i;p(e("#num_doc_ini").val());var o=e("#EPS").val();e.ajax({type:"POST",data:JSON.stringify({function:"insert_health_service",params:[t,o,n]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){var t=e;isNaN(t)||swal("Registro completado exitosamente!","","success")},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(),a=!0,r=!1,e(":input").val(""),e("#smartwizard").smartWizard("reset"))});var d=0;function p(t,a){e.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_ases_user_id",params:t}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){var t=JSON.parse(e);null==a?function(e){n=e}(t.id):1==a&&function(e){o=e}(t)},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function _(t,a,i){var n="1";null!=i&&(n=i),e.ajax({type:"POST",data:JSON.stringify({function:a,params:n}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){var a=JSON.parse(e);for(var i in a)t.append("<option value='"+a[i].id+"'>"+Object.values(a[i])[1]+"</option>")},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function u(t,a){json_insert={},e("#"+t).val().length>=3&&(json_insert.key_input_text=e("#"+t).attr("id"),json_insert.val_input_text=e("#"+t).val(),a.push(json_insert),json_insert={})}function m(e,t,a){json_insert={},json_insert.key_input=e,json_insert.val_input=t,a.push(json_insert),json_insert={}}function v(t,a){e("#"+t).find("input").each(function(){switch(json_object={},e(this).attr("type")){case"text":if(e(this).hasClass("otros")||""==e(this).val())break;json_object.key_input_text=e(this).attr("id"),json_object.val_input_text=e(this).val(),a.push(json_object);break;case"number":if(e(this).hasClass("otros")||""==e(this).val())break;json_object.key_input_number=e(this).attr("id"),json_object.val_input_number=e(this).val(),a.push(json_object);break;case"date":if(e(this).hasClass("otros")||""==e(this).val())break;json_object.key_input_date=e(this).attr("id"),json_object.val_input_date=e(this).val(),a.push(json_object);break;case"radio":if(""===(t=b(e(this))).id)break;""!=t.id1?(json_object.key_input=e(this).attr("name"),json_object.val_input=e(this).val(),"text"==t.type&&(json_object.key_input_text=t.id,json_object.val_input_text=t.val,json_object.key_input_number=t.id1,json_object.val_input_number=t.val1),a.push(json_object)):(json_object.key_input=e(this).attr("name"),json_object.val_input=e(this).val(),"text"==t.type?(json_object.key_input_text=t.id,json_object.val_input_text=t.val):"number"==t.type&&(json_object.key_input_number=t.id,json_object.val_input_number=t.val),a.push(json_object));break;case"checkbox":var t;if(""===(t=b(e(this))).id)break;json_object.key_input=e(this).attr("id"),json_object.val_input=e(this).val(),"text"==t.type?(json_object.key_input_text=t.id,json_object.val_input_text=t.val):"number"==t.type&&(json_object.key_input_number=t.id,json_object.val_input_number=t.val),a.push(json_object);break;default:json_object.key_input=0,json_object.val_input=0}})}function b(e){var t={};if(e.is(":checked")){if(e.hasClass("otro")){var a=e.parent().next().find("input"),i=e.parent().next().children("input:last");return t.id=a.attr("id"),t.val=a.val(),t.type=a.attr("type"),i.attr("id")!=t.id&&(t.id1=i.attr("id"),t.val1=i.val(),t.type1=i.attr("type")),t}return t.id=e.attr("name"),t.val=e.val(),t}return t.id="",t.val="",t}function g(t,a){e("#"+t).find("[name="+a+"]").on("click",function(){var a=e("#"+t+" .otro").parent().next();e(this).hasClass("otro")?(a.attr("hidden",!1),a.removeClass("otros")):(a.attr("hidden",!0),a.addClass("otros"))})}e("#num_doc_ini").blur(function(){var t;p(e("#num_doc_ini").val()),e("#step-1 :input").prop("disabled",!1),null!=n?(t=e("#codigo_estudiantil").val(),e.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_user",params:t}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){var t,a=JSON.parse(e);t=a.id,i=t},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}}),function(t,a){e.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_exist_user_extended",params:[t,a]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){s=JSON.parse(e)},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(n,i),s?(c(),!0,p(e("#num_doc_ini").val(),1),function(t){for(var a in t)e("#"+a).val(t[a])}(o)):(c(),console.log("no esta en user extended"))):(console.log("No existe"),e("#step-1 :input").prop("disabled",!1),c())}),e(".step1").each(function(){var t=e(this);t.data("oldVal",t.val()),t.bind("propertychange change input paste",function(e){t.data("oldVal")!=t.val()&&(t.data("oldVal",t.val()),!0)})}),e(".step2").each(function(){var t=e(this);t.data("oldVal",t.val()),t.bind("propertychange change input paste",function(e){t.data("oldVal")!=t.val()&&(t.data("oldVal",t.val()),!0)})}),e(".step3").each(function(){var t=e(this);t.data("oldVal",t.val()),t.bind("propertychange change input paste",function(e){t.data("oldVal")!=t.val()&&(t.data("oldVal",t.val()),!0)})}),e('input[type="radio"]').on("change",function(){e(this).hasClass("step1")?!0:e(this).hasClass("step2")?!0:e(this).hasClass("step3")?!0:e(this).hasClass("step4")?(!0,console.log("cambio s4")):e(this).hasClass("step5")?(!0,console.log("cambio s5")):e(this).hasClass("step6")&&(r=!0,console.log("cambio s6"))})})}}});