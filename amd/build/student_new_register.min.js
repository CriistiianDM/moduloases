define(["jquery","block_ases/bootstrap","block_ases/tagging","block_ases/smart_wizard","block_ases/mustache","block_ases/sweetalert"],function(a,e,t,i,o){return{init:function(){a(document).ready(function(){var e,t,i,o,n,r,s,c,l,d,p,u,_="",v="",m="",f="",g="",b=!1,h=!1,y=!1,j=!1;function x(){N(a("#select_programa"),"get_programas_academicos")}function k(){i?a("#step-1 :input").prop("disabled",!1):(a("#nombre").prop("disabled",!0),a("#apellido").prop("disabled",!0),a("#emailinstitucional").prop("disabled",!0)),a("#edad").prop("disabled",!0)}a("#step-1 :input").prop("disabled",!0),a("#codigo_estudiantil").prop("disabled",!1),a("#validar_codigo").prop("disabled",!1),a("#pruebas").on("click",function(){a(":input").val(""),a("#smartwizard").smartWizard("reset")}),a("#mostrar").on("click",function(){N(a("#id_ciudad_ini"),"get_ciudades"),N(a("#acompanamientos"),"get_otros_acompañamientos"),N(a("#id_cond_excepcion"),"get_cond_excepcion"),N(a("#id_estado_civil"),"get_estados_civiles"),N(a("#sexo"),"get_sex_options"),N(a("#id_identidad_gen"),"get_generos"),N(a("#id_act_simultanea"),"get_act_simultaneas"),N(a("#id_etnia"),"get_etnias"),N(a("#tipo_doc"),"get_document_types"),N(a("#s_discapacidad"),"get_discapacities"),N(a("#id_pais"),"get_paises"),N(a("#barrio_res"),"get_barrios"),N(a("#id_ciudad_res"),"get_ciudades"),x(),N(a("#id_pais_res"),"get_paises"),N(a("#barrio_ini"),"get_barrios"),N(a("#tipo_doc_ini"),"get_document_types"),N(a("#select_sede"),"get_sedes"),N(a("#s_programa_1"),"get_programas_academicos"),N(a("#s_programa_2"),"get_programas_academicos"),N(a("#s_programa_3"),"get_programas_academicos"),N(a("#s_programa_4"),"get_programas_academicos"),A("permanencia","solvencia_econo"),A("set-desplazamiento","ayuda_transporte"),A("set-certificado-discapacidad","discapacidad"),A("set-apoyo","apoyo_partic"),A("set-participacion","participacion"),A("set-salud","option"),A("set-orientacion","orientacion_sexual"),A("set-sexo","sexo"),A("set-identidad-gen","identidad_genero"),A("set-beca","beca"),(e=new Tagging(a("#deportes_tag"),a("#tags_deportes"),1,3)).createTag(),(t=new Tagging(a("#tiempo_libre"),a("#tags_tiempo_libre"))).createTag(),a("#modalExample").show()}),a(".closer").on("click",function(){a("#modalExample").hide()}),a("#smartwizard").smartWizard({selected:0,theme:"dots",autoAdjustHeight:!0,showStepURLhash:!1,lang:{next:"Siguiente",previous:"Anterior"}}),a("#validar_codigo").on("click",function(){var e=a("#codigo_estudiantil").val();""===e||" "===e?(a("#nombre").val(""),a("#apellido").val(""),a("#emailinstitucional").val(""),a("#step-1 :input").prop("disabled",!0),a("#codigo_estudiantil").prop("disabled",!1),a("#validar_codigo").prop("disabled",!1),x()):a.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_user",params:e}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){!function(e){0!=e?(a("#step-1 :input").prop("disabled",!0),a("#codigo_estudiantil").prop("disabled",!1),a("#validar_codigo").prop("disabled",!1),a("#tipo_doc_ini").prop("disabled",!1),a("#num_doc_ini").prop("disabled",!1),a("#select_sede").prop("disabled",!1),a("#select_programa").prop("disabled",!1),function(e){a("#nombre").val(e.firstname),a("#apellido").val(e.lastname),a("#emailinstitucional").val(e.email),k(),programs=e.username.slice(e.username.indexOf("-")+1),a("#select_programa").empty(),N(a("#select_programa"),"get_programas_academicos_est",programs)}(e),o=!1,i=!1):swal({title:"Warning",text:"Estudiante inexistente en la base de datos, ¿Esta seguro de registrar este usuario?.",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?(swal("Confirmado","","success"),i=!0,o=!1,k()):(swal("Cancelado","Ingresa nuevamente el codigo del estudiante","error"),a("#codigo_estudiantil").val(""))})}(JSON.parse(e))},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}),a("#fecha_nac").blur(function(){var e=a("#fecha_nac").val(),t=new Date,i=new Date(e),o=t.getFullYear()-i.getFullYear(),n=t.getMonth()-i.getMonth();(n<0||0===n&&t.getDate()<i.getDate())&&o--,a("#edad").val(o)}),a(document).on("click",".remove_fila",function(){a(this).parent().parent().remove()}),a(document).on("click",".remove_fila_ing",function(){w--,a(this).parent().parent().remove()}),a("#add_person_r").on("click",function(){!function(a){let e="";e+='<tr><td> <input  class="input_fields_general_tab"  type="text"/></td>',e+='<td> <input  class="input_fields_general_tab"  type="text" /></td>',e+='<td> <button class="btn btn-danger remove_fila" type="button" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> X </button></td></tr>',a.find("tbody").append('<tr><td> <input  class="input_fields_general_tab"  type="text"/></td><td> <input  class="input_fields_general_tab"  type="text" /></td><td> <button class="btn btn-danger remove_fila" type="button" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> X </button></td></tr>')}(a("#table_familia"))}),a("#add_ingreso").on("click",function(){w++,function(e){let t="";t+='<tr><td> <input id="anio_'+w+'" class="input_fields_general_tab ingresos_u step3" name="anio_'+w+'"  type="text"/></td>',t+='<td> <select id="s_programa_'+w+'" class="custom-select select-academics-data step3"></select> <input  id="id_programa_'+w+'" name="id_programa_'+w+'" class="ingresos_u" type="number" hidden></td>',t+='<td><select class="custom-select select-academics-data step3"> <option value="1">Bajos académicos</option> <option value="2">Condición de salud</option> <option value="3">Fallecimiento</option> <option value="4">Condición económica</option> <option value="5">Condición de programa académico</option> <option value="6">Cambio de institución educativa</option> <option value="7">Cambio de ciudad</option> <option value="8">Retiro voluntario</option> <option value="9">Prefiero no decirlo</option> </select> <input  id="motivo_'+w+'" name="motivo_'+w+'" class="ingresos_u" type="number" hidden> </td>',t+='<td> <button class="btn btn-danger remove_fila_ing" type="button" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> X </button></td></tr>',e.find("tbody").append(t),N(a("#s_programa_"+w),"get_programas_academicos")}(a("#table_ingresos"))}),a(document).on("click","#guardar_info",function(){s?j&&(j=!1):(!function(){var e=(t=[],i=[],T("regimen_salud",i),z("regimen_salud",i,t),T("data_sisben",i=[]),J("observ_sisben",i),T("serv_adicionales",i),T("conclusion_jornada",i),J("conclusion",i),T("json_detalle",i),z("datos_salud_adicionales",i,t),T("serv_usuario",i=[]),z("servicios_usados",i,t),i=[],t);var t,i;S(a("#num_doc_ini").val());var o=a("#EPS").val();a.ajax({type:"POST",data:JSON.stringify({function:"insert_health_service",params:[e,o,v]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){var e=a;isNaN(e)||swal("Registro completado exitosamente!","","success")},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(),s=!0,j=!1,a(":input").val(""),a("#smartwizard").smartWizard("reset"))});var w=0;function O(e){for(var t=[],i=e.find("tbody input").map(function(){return a(this).val()}).get(),o=0;o<i.length;o+=2){var n={nombre:i[o],rol:i[o+1]};t.push(n)}return t}function S(e,t){a.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_ases_user_id",params:e}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){var e=JSON.parse(a);null==t?function(a){v=a}(e.id):1==t&&function(a){m=a}(e)},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function E(e){a.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_user",params:e}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){var e,t=JSON.parse(a);e=t.id,_=e},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function C(e){a.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_program",params:e}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){var e,t=JSON.parse(a);e=t.cod_univalle,g=e},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function N(e,t,i){var o="1";null!=i&&(o=i),a.ajax({type:"POST",data:JSON.stringify({function:t,params:o}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){var t=JSON.parse(a);for(var i in t)e.append("<option value='"+t[i].id+"'>"+Object.values(t[i])[1]+"</option>")},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function J(e,t){json_insert={},a("#"+e).val().length>=3&&(json_insert.key_input_text=a("#"+e).attr("id"),json_insert.val_input_text=a("#"+e).val(),t.push(json_insert),json_insert={})}function z(a,e,t){json_insert={},json_insert.key_input=a,json_insert.val_input=e,t.push(json_insert),json_insert={}}function T(e,t){a("#"+e).find("input").each(function(){switch(json_object={},a(this).attr("type")){case"text":if(a(this).hasClass("otros")||""==a(this).val())break;json_object.key_input_text=a(this).attr("id"),json_object.val_input_text=a(this).val(),t.push(json_object);break;case"number":if(a(this).hasClass("otros")||""==a(this).val())break;json_object.key_input_number=a(this).attr("id"),json_object.val_input_number=a(this).val(),t.push(json_object);break;case"date":if(a(this).hasClass("otros")||""==a(this).val())break;json_object.key_input_date=a(this).attr("id"),json_object.val_input_date=a(this).val(),t.push(json_object);break;case"radio":if(""===(e=P(a(this))).id)break;""!=e.id1?(json_object.key_input=a(this).attr("name"),json_object.val_input=a(this).val(),"text"==e.type&&(json_object.key_input_text=e.id,json_object.val_input_text=e.val,json_object.key_input_number=e.id1,json_object.val_input_number=e.val1),t.push(json_object)):(json_object.key_input=a(this).attr("name"),json_object.val_input=a(this).val(),"text"==e.type?(json_object.key_input_text=e.id,json_object.val_input_text=e.val):"number"==e.type&&(json_object.key_input_number=e.id,json_object.val_input_number=e.val),t.push(json_object));break;case"checkbox":var e;if(""===(e=P(a(this))).id)break;json_object.key_input=a(this).attr("id"),json_object.val_input=a(this).val(),"text"==e.type?(json_object.key_input_text=e.id,json_object.val_input_text=e.val):"number"==e.type&&(json_object.key_input_number=e.id,json_object.val_input_number=e.val),t.push(json_object);break;default:json_object.key_input=0,json_object.val_input=0}})}function P(a){var e={};if(a.is(":checked")){if(a.hasClass("otro")){var t=a.parent().next().find("input"),i=a.parent().next().children("input:last");return e.id=t.attr("id"),e.val=t.val(),e.type=t.attr("type"),i.attr("id")!=e.id&&(e.id1=i.attr("id"),e.val1=i.val(),e.type1=i.attr("type")),e}return e.id=a.attr("name"),e.val=a.val(),e}return e.id="",e.val="",e}function A(e,t){a("#"+e).find("[name="+t+"]").on("click",function(){var t=a("#"+e+" .otro").parent().next();a(this).hasClass("otro")?(t.attr("hidden",!1),t.removeClass("otros")):(t.attr("hidden",!0),t.addClass("otros"))})}function V(e){var t=!1;return a("."+e+"[required]").each(function(){var e=a(this);if("radio"==e.attr("type")){var i=e.attr("name");a('input:radio[name="'+i+'"]').is(":checked")||(t=!0)}else""==e.val()&&(t=!0)}),t}a("#num_doc_ini").blur(function(){S(a("#num_doc_ini").val()),a("#step-1 :input").prop("disabled",!1),null!=v?(E(a("#codigo_estudiantil").val()),function(e,t){a.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_exist_user_extended",params:[e,t]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){b=JSON.parse(a)},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(v,_),b?(k(),o=!0,S(a("#num_doc_ini").val(),1),function(e){for(var t in e)a("#"+t).val(e[t])}(m)):(k(),console.log("no esta en user extended"))):(console.log("No existe"),a("#step-1 :input").prop("disabled",!1),k())}),a(".step1").each(function(){var e=a(this);e.data("oldVal",e.val()),e.bind("propertychange change input paste",function(a){e.data("oldVal")!=e.val()&&(e.data("oldVal",e.val()),c=!0)})}),a(".step2").each(function(){var e=a(this);e.data("oldVal",e.val()),e.bind("propertychange change input paste",function(a){e.data("oldVal")!=e.val()&&(e.data("oldVal",e.val()),l=!0)})}),a(".step3").each(function(){var e=a(this);e.data("oldVal",e.val()),e.bind("propertychange change input paste",function(a){e.data("oldVal")!=e.val()&&(e.data("oldVal",e.val()),d=!0)})}),a('input[type="radio"]').on("change",function(){a(this).hasClass("step1")?c=!0:a(this).hasClass("step2")?l=!0:a(this).hasClass("step3")?d=!0:a(this).hasClass("step4")?(p=!0,console.log("cambio s4")):a(this).hasClass("step5")?(u=!0,console.log("cambio s5")):a(this).hasClass("step6")&&(j=!0,console.log("cambio s6"))}),a("#smartwizard").on("leaveStep",function(s,m,b,j,x){if("forward"===j)switch(function(){a("#tipo_doc").val(a("#tipo_doc_ini option:selected").val());for(var e=a(".select-registro").map(function(){return a(this).attr("id")}).get(),t=a(".select-registro").map(function(){return a(this).next().attr("id")}).get(),i=0;i<t.length;i++)a("#"+t[i]).val(a("#"+e[i]+" option:selected").val())}(),b){case 0:if(U=!1,a("."+"step1"+"[required]:visible").each(function(){""==a(this).val()&&(U=!0)}),U)return swal("Oops!","Rellena todos los campos necesarios para poder avanzar","warning"),!1;i&&(C(a("#programa").val()),D=a("#codigo_estudiantil").val(),W=a("#nombre").val(),q=a("#apellido").val(),F=a("#emailinstitucional").val(),X=D+"-"+g,M=(M=W.charAt(0)+D+q.charAt(0)).toUpperCase(),a.ajax({type:"POST",data:JSON.stringify({function:"save_mdl_user",params:[X,W,q,F,M]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){_=a},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}}),i=!1),o?c&&(console.log("Actualizo"),c=!1):(E(a("#codigo_estudiantil").val()),function(){a("#num_doc").val(a("#num_doc_ini").val());var i=[];i.push({name:"deportes",value:e.getArr()}),i.push({name:"actividades",value:t.getArr()}),i=JSON.stringify(i);var o=a(".talentospilos_usuario").serializeArray(),n=a("#div_tipo_institucion ").find("[name=estamento]:checked").val();o.push({name:"estamento",value:n}),o.push({name:"id_ciudad_nac",value:a("#id_ciudad_ini").val()});var r=O(a("#table_familia")),s=a("#programa").val(),c=[];T("otra_identidad",c),T("otra_orientacion",c),T("contacto_2",c),T("otros_acomp",c),c=JSON.stringify(c),a.ajax({type:"POST",data:JSON.stringify({function:"save_data",params:[o,i,r,s,_,c]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(),o=!0,c=!1);break;case 1:if(V("step2"))return swal("Oops!","Rellena todos los campos necesarios para poder avanzar","warning"),!1;n?l&&(console.log("Actualizo economics data"),l=!1):(!function(){var e=O(a("#table_familia"));T("set-vive",e);var t=JSON.stringify(e),i=a("#hijos").val(),o=a("#estrato").val();S(a("#num_doc_ini").val()),a.ajax({type:"POST",data:JSON.stringify({function:"save_data_user_step2",params:[v,o,i,t]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(),function(){var e=(i=[],o=[],n=[],r=[],s=[],c=[],l=[],d={},p={},u={},_={},T("set-sostenimiento",l),T("otro_ingreso",l),z("datos_economicos_adicionales",l,i),T("set-permanencia",i),T("set-beca",i),T("set-materiales",o),T("set-valor-materiales",o),i.push(o),T("set-desplazamiento",o=[]),T("set-valor-desplazamiento",o),i.push(o),T("row_madre_academic",n),T("row_padre_academic",n),T("row_otro_academic",n),T("row_madre_ocupacion",r),T("row_padre_ocupacion",r),T("row_otro_ocupacion",r),T("row_madre_laboral",s),T("row_padre_laboral",s),T("row_otro_laboral",s),J("motivo_ingreso",c),J("expecativas_carrera",c),J("expectativas_graduarse",c),d.key_input="expectativas_laborales",d.val_input=c,u.key_input="ocupacion_padres",u.val_input=r,p.key_input="nivel_educ_padres",p.val_input=n,_.key_input="situa_laboral_padres",_.val_input=s,i.push(p),i.push(u),i.push(_),i.push(d),i),t=a("#estrato").val();var i,o,n,r,s,c,l,d,p,u,_;a.ajax({type:"POST",data:JSON.stringify({function:"insert_economics_data",params:[e,t,v]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){f=a},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(),n=!0,l=!1);break;case 2:if(V("step3"))return swal("Oops!","Rellena todos los campos necesarios para poder avanzar","warning"),!1;h?d&&(console.log("Actualizo academics data"),d=!1):(A=a("#icfes").val(),R=a("#anio_ingreso").val(),B=a("#colegio").val(),S(a("#num_doc_ini").val()),a.ajax({type:"POST",data:JSON.stringify({function:"save_data_user_step3",params:[v,A,R,B,f]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}}),function(){var e=function(){for(var e={},t=a(".select-academics-data").map(function(){return a(this).attr("id")}).get(),i=a(".select-academics-data").map(function(){return a(this).next().attr("id")}).get(),o=0;o<i.length;o++)a("#"+i[o]).val(a("#"+t[o]+" option:selected").val());var n=[],r=[],s=[];T("dif_educ_media",s),T("dif_educ_superior",s),T("dif_educ_paralelo",s),e.key_input="dificultades",e.val_input=s,(s=[]).push(e),e={};var c=[],l=a(".ingresos_u").serializeArray();return T("jornada",l),T("p_ingreso",l),T("sede",l),z("datos_academicos_adicionales",l,c),T("div_tipo_institucion",r),T("div_tipo_institucion_superior",r),T("div_tipo_institucion_paralelo",r),e.key_input="otras_instituciones",e.val_input=r,(r=[]).push(e),e={},n.push(c),n.push(r),n.push(s),n}();S(a("#num_doc_ini").val());var t=a("#programa").val(),i=a("#titulo_1").val(),o=a("#observaciones").val();a.ajax({type:"POST",data:JSON.stringify({function:"insert_academics_data",params:[e,t,i,o,v]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(),h=!0,d=!1);break;case 3:y?p&&(p=!1):(P=a("#id_discapacidad").val(),S(a("#num_doc_ini").val()),a.ajax({type:"POST",data:JSON.stringify({function:"save_data_user_step4",params:[v,P]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}}),y=!0,p=!1);break;case 4:r?u&&(u=!1):(w=[],T("percepcion_discapacidad",N=[]),J("desc_discap",N),z("percepcion_disca",N,w),T("diagnosticos",N=[]),z("diagnosticos",N,w),T("condicion_salud",N=[]),J("rel_cond_salud",N),z("condicion_salud",N,w),T("medicamentos",N=[]),z("medicamentos",N,w),T("cambio_tratamiento",N=[]),J("obs_cambio",N),z("cambios_tratamiento",N,w),T("disca_por_municipio",N=[]),J("doc_localizacion",N),z("discapacidad_municipio",N,w),T("certificado_disca",N=[]),J("certi_disca",N),z("certificado_discapacidad",N,w),T("datos_invalidez",N=[]),z("certificado_invalidez",N,w),T("cond_org_sist",N=[]),z("condicion_organos",N,w),T("dif_permanente",N=[]),z("dificultad_permanente",N,w),T("set-participacion",N=[]),J("text_participacion",N),T("set-apoyo",N),J("text_apoyo_partic",N),z("participacion_estudiantil",N,w),T("asoc_disca",N=[]),z("organizacion_disca",N,w),T("apoyo_recibido",N=[]),z("apoyo_dicapacidad",N,w),N=[],k=w,S(a("#num_doc_ini").val()),a.ajax({type:"POST",data:JSON.stringify({function:"insert_disapacity_data",params:[k,v]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){},error:function(a){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}}),r=!0,u=!1)}var k,w,N,P,A,R,B,D,W,q,F,X,M,U})})}}});