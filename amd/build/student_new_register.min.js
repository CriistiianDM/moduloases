define(["jquery","block_ases/bootstrap","block_ases/tagging","block_ases/smart_wizard","block_ases/mustache","block_ases/sweetalert"],function(e,t,a,n,o){return{init:function(){e(document).ready(function(){var t,a,n,o="",i="",r=!1;function s(t){for(var a=[],n=t.find("tbody input").map(function(){return e(this).val()}).get(),o=0;o<n.length;o+=2){var i={nombre:n[o],rol:n[o+1]};a.push(i)}return a}function c(t){e.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_ases_user_id",params:t}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){var t,a=JSON.parse(e);t=a.id,i=t},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function l(t){e.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_user",params:t}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){var t,a=JSON.parse(e);t=a.id,o=t},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function u(t,a){e.ajax({type:"POST",data:JSON.stringify({function:a,params:"1"}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){var a=JSON.parse(e);for(var n in a)t.append("<option value='"+a[n].id+"'>"+Object.values(a[n])[1]+"</option>")},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function d(t,a){e("#"+t).find("input").each(function(){switch(json_object={},e(this).attr("type")){case"text":if(e(this).is(":hidden")||""==e(this).val())break;json_object.key_input_text=e(this).attr("id"),json_object.val_input_text=e(this).val(),a.push(json_object);break;case"number":if(e(this).is(":hidden")||""==e(this).val())break;json_object.key_input_number=e(this).attr("id"),json_object.val_input_number=e(this).val(),a.push(json_object);break;case"radio":var t=function(e){var t={};if(e.is(":checked")){if(e.hasClass("otro")){var a=e.parent().next().find("input");return t.id=a.attr("id"),t.val=a.val(),t.type=a.attr("type"),t}return t.id=e.attr("id"),t.val=e.val(),t}return t.id="",t.val="",t}(e(this));if(""===t.id)break;"text"==t.type?(json_object.key_input_text=t.id,json_object.val_input_text=t.val):"number"==t.type?(json_object.key_input_number=t.id,json_object.val_input_number=t.val):(json_object.key_input=t.id,json_object.val_input=t.val),a.push(json_object);break;default:json_object.key_input=0,json_object.val_input=0}})}function p(t,a){e("#"+t).find("[name="+a+"]").on("click",function(){var a=e("#"+t+" .otro").parent().next();e(this).hasClass("otro")?a.attr("hidden",!1):a.attr("hidden",!0)})}function _(){for(var t=e(".select-registro").map(function(){return e(this).attr("id")}).get(),a=e(".select-registro").map(function(){return e(this).next().attr("id")}).get(),n=0;n<a.length;n++)e("#"+a[n]).val(e("#"+t[n]+" option:selected").val())}function m(){_();var t=e("#codigo_estudiantil").val(),a=e("#programa").val(),n=e("#nombre").val(),i=e("#apellido").val(),r=e("#emailinstitucional").val(),s="code"+t+"-program"+a,c=n.charAt(0)+t+i.charAt(0);c=c.toUpperCase(),e.ajax({type:"POST",data:JSON.stringify({function:"save_mdl_user",params:[s,n,i,r,c]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){o=e},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}function v(){var a=t.getArr(),n=e(".talentospilos_usuario").serializeArray(),i=e("#div_tipo_institucion ").find("[name=estamento]:checked").val();n.push({name:"estamento",value:i}),n.push({name:"id_ciudad_nac",value:e("#id_ciudad_ini").val()});var r=s(e("#table_familia")),c=e("#programa").val();e.ajax({type:"POST",data:JSON.stringify({function:"save_data",params:[n,a,r,c,o]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){console.log(e)},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}e("#pruebas").on("click",function(){m()}),e("#mostrar").on("click",function(){u(e("#select_ciudad_nacimiento"),"get_ciudades"),u(e("#select_acompañamientos"),"get_otros_acompañamientos"),u(e("#s_excepcion"),"get_cond_excepcion"),u(e("#select_estado_civil"),"get_estados_civiles"),u(e("#select_sexo"),"get_sex_options"),u(e("#select_genero"),"get_generos"),u(e("#s_act_simultanea"),"get_act_simultaneas"),u(e("#select_etnia"),"get_etnias"),u(e("#s_tipo_documento"),"get_document_types"),u(e("#s_discapacidad"),"get_discapacities"),u(e("#select_pais_nacimiento"),"get_paises"),u(e("#select_barrio"),"get_barrios"),u(e("#select_ciudad"),"get_ciudades"),u(e("#select_programa"),"get_programas_academicos"),u(e("#select_pais_res"),"get_paises"),u(e("#select_barrio_procedencia"),"get_barrios"),u(e("#select_ciudad_procedencia"),"get_ciudades"),u(e("#s_tipo_documento_ingreso"),"get_document_types"),u(e("#select_sede"),"get_sedes"),u(e("#s_programa_1"),"get_programas_academicos"),u(e("#s_programa_2"),"get_programas_academicos"),u(e("#s_programa_3"),"get_programas_academicos"),u(e("#s_programa_4"),"get_programas_academicos"),p("set-permanencia","option"),p("set-desplazamiento","option"),p("set-certificado-discapacidad","option"),p("set-apoyo","option"),p("set-participacion","option"),p("set-salud","option"),p("set-orientacion","orientacion_sexual"),p("set-sexo","sexo"),p("set-identidad-gen","identidad_genero"),p("set-beca","beca"),(t=new Tagging(e("#deportes_tag"),e("#tags_deportes"),1,3)).createTag(),new Tagging(e("#tiempo_libre"),e("#tags_tiempo_libre")).createTag(),e("#modalExample").show()}),e(".closer").on("click",function(){e("#modalExample").hide()}),e("#smartwizard").smartWizard({selected:0,theme:"dots",autoAdjustHeight:!0,showStepURLhash:!1,lang:{next:"Siguiente",previous:"Anterior"}}),e("#codigo_estudiantil").blur(function(){var t=e("#codigo_estudiantil").val();""===t||" "===t?(e("#nombre").val(""),e("#apellido").val(""),e("#emailinstitucional").val(""),e("#nombre").prop("disabled",!1),e("#apellido").prop("disabled",!1),e("#emailinstitucional").prop("disabled",!1)):e.ajax({async:!1,type:"POST",data:JSON.stringify({function:"get_full_user_by_code",params:"code"+t}),url:"../managers/student_profile/studentprofile_api.php",success:function(t){var o=JSON.parse(t);0!=o?(!function(t){e("#nombre").val(t.firstname),e("#apellido").val(t.lastname),e("#emailinstitucional").val(t.email),e("#nombre").prop("disabled",!0),e("#apellido").prop("disabled",!0),e("#emailinstitucional").prop("disabled",!0)}(o),n=!1):swal({title:"Warning",text:"Estudiante inexistente en la base de datos, ¿Esta seguro de registrar este usuario?.",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(t){t?(swal("Confirmado","","success"),a=!0,n=!1):(swal("Cancelado","Ingresa nuevamente el codigo del estudiante","error"),e("#codigo_estudiantil").val(""))})},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}),e("#fecha_nac").blur(function(){var t=e("#fecha_nac").val(),a=new Date,n=new Date(t),o=a.getFullYear()-n.getFullYear(),i=a.getMonth()-n.getMonth();(i<0||0===i&&a.getDate()<n.getDate())&&o--,e("#edad").val(o)}),e(document).on("click",".remove_fila",function(){e(this).parent().parent().remove()}),e("#add_person_r").on("click",function(){!function(e){let t="";t+='<tr><td> <input  class="input_fields_general_tab"  type="text"/></td>',t+='<td> <input  class="input_fields_general_tab"  type="text" /></td>',t+='<td> <button class="btn btn-danger remove_fila" type="button" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> X </button></td></tr>',e.find("tbody").append('<tr><td> <input  class="input_fields_general_tab"  type="text"/></td><td> <input  class="input_fields_general_tab"  type="text" /></td><td> <button class="btn btn-danger remove_fila" type="button" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> X </button></td></tr>')}(e("#table_familia"))}),e(document).on("click","#guardar_info",function(){var t,a,n,o,i,r,s;_(),l("code"+e("#codigo_estudiantil").val()),t=[],a=[],n=[],o=[],i=[],r=e("#estrato").val(),s={},d("set-permanencia",t),d("set-beca",t),d("row_materiales",t),d("set-vive",t),d("row_madre_academic",a),d("row_padre_academic",n),d("row_otro_academic",o),s.key_input_text=e("#motivo_ingreso").attr("id"),s.val_input_text=e("#motivo_ingreso").val(),i.push(s),(s={}).key_input_text=e("#expecativas_carrera").attr("id"),s.val_input_text=e("#expecativas_carrera").val(),i.push(s),(s={}).key_input_text=e("#expectativas_graduarse").attr("id"),s.val_input_text=e("#expectativas_graduarse").val(),i.push(s),t.push(r),t.push(a),t.push(n),t.push(o),t.push(i),v()}),e(".talentospilos_usuario").each(function(){var t=e(this);t.data("oldVal",t.val()),t.bind("propertychange change input paste",function(e){t.data("oldVal")!=t.val()&&(t.data("oldVal",t.val()),r=!0,console.log("cambio"))})}),e("#smartwizard").on("leaveStep",function(t,o,u,d,p){if("forward"===d)switch(u){case 0:a?(m(),a=!1):console.log("No creo en mdl_user "),n?r&&(console.log("Actualizo"),r=!1):(_(),l("code"+e("#codigo_estudiantil").val()),v(),console.log("Creo en talentos pilos"),n=!0,r=!1);break;case 1:!function(){s(e("#table_familia"));var t=e("#hijos").val(),a=e("#estrato").val();c(e("#num_doc").val()),e.ajax({type:"POST",data:JSON.stringify({function:"save_data_user_step2",params:[i,a,t]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){console.log(e)},error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})}(),console.log("te vas del step  "+u+"?");break;case 2:console.log("te vas del step  "+u+"?")}})})}}});