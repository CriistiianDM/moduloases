{"version":3,"sources":["../src/uploaddata_main.js"],"names":["define","$","init","document","ready","mostrarArchivos","form","getElementById","on","subir_archivos","archivo","parents","eq","find","text","trim","eliminarArchivos","setTimeout","status_bar","children","span","goback_button","response_div","response_span","innerHTML","setAttribute","classList","remove","request","XMLHttpRequest","upload","addEventListener","event","percent","Math","round","loaded","total","style","width","response","add","removeAttribute","open","send","FormData","abort","ajax","url","type","timeout","data","error","mostrarRespuesta","success","respuesta","dataType","html","i","length","mensaje","ok","removeClass","addClass","btn_continue","appendTo"],"mappings":"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","sourcesContent":[" /**\n * Management - Upload, delete and display files\n * @module amd/src/uploaddata_main\n * @author Iader E. García Gómez\n * @copyright 2018 Iader E. García <iadergg@gmail.com>\n * @license  http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'block_ases/bootstrap', 'block_ases/sweetalert', 'block_ases/validator'], function ($, bootstrap, sweetalert, validator) {\n\n    return {\n        init: function () {\n\n            $(document).ready(function () {\n                mostrarArchivos();\n                var form = document.getElementById('upload_data_form');\n                $(\"#load_button\").on('click', function () {\n                    subir_archivos(form);\n                });\n                $(\"#archivos_subidos\").on('click', '.eliminar_archivo', function () {\n                    var archivo = $(this).parents('.row').eq(0).find('span').text();\n                    archivo = $.trim(archivo);\n                    eliminarArchivos(archivo);\n                });\n                $(\"#respuesta\").on('click', '.continue', function () {\n                    setTimeout('document.location.reload()', 500);\n                });\n            });\n\n           \n            /**\n             * @method subir_archivos\n             * @desc Upload files given a form to obtain the data\n             * @param {DOM element} form \n             * @return {void}\n             */\n            function subir_archivos(form) {\n\n                var status_bar = form.children[2].children[0].children[0];\n                var span = status_bar.children[0];\n                var goback_button = form.children[4].children[1];\n\n                response_div = document.getElementById('response_div');\n                response_span = document.getElementById('response_span');\n\n                response_span.innerHTML = \"\";\n                response_div.setAttribute('hidden', 'hidden');\n\n                status_bar.classList.remove('green_bar', 'red_bar');\n\n                //Ajax request\n                var request = new XMLHttpRequest();\n\n                // Progress bar\n\n                request.upload.addEventListener(\"progress\", (event) => {\n                    let percent = Math.round((event.loaded / event.total) * 100);\n\n                    status_bar.style.width = percent + '%';\n                    span.innerHTML = percent + '%';\n\n                });\n\n                request.addEventListener(\"load\", () => {\n                    if (request.response == '1') {\n                        status_bar.classList.add('green_bar');\n                        span.innerHTML = \"Éxito\";\n                        response_div.removeAttribute('hidden');\n                        response_span.classList.add('response_success');\n                        response_span.innerHTML += 'El contenido del archivo ha sido cargado con éxito en la base de datos.';\n                    }\n                    else {\n                        status_bar.classList.add('red_bar');\n                        span.innerHTML = \"Error\";\n                        response_div.removeAttribute('hidden');\n                        response_span.classList.add('response_error');\n                        response_span.innerHTML = request.response;\n                    }\n\n                });\n\n                //Upload files processing file at subir_archivo.php\n\n                request.open('post', '../managers/upload_files_form/subir_archivo.php');\n\n                request.send(new FormData(form));\n\n                goback_button.addEventListener('click', () => {\n                    request.abort();\n                    status_bar.classList.remove('green_bar');\n                    status_bar.classList.add('red_bar');\n                    span.innerHTML = \"Proceso cancelado\";\n                });\n            }\n\n            /**\n             * @method eliminarArchivos\n             * @desc Deletes a specific file through an ajax call\n             * @param {file} archivo file to delete\n             */\n            function eliminarArchivos(archivo) {\n                //Ajax call using processing at eliminar_archivo.php\n                $.ajax({\n                    url: '../managers/upload_files_form/eliminar_archivo.php',\n                    type: 'POST',\n                    timeout: 10000,\n                    data: {\n                        archivo: archivo\n                    },\n                    error: function () {\n                        //In case something were missing\n                        mostrarRespuesta('Error al intentar eliminar el archivo.', false);\n                    },\n                    success: function (respuesta) {\n                        if (respuesta == 1) {\n                            //File deleted\n                            mostrarRespuesta('El archivo ha sido eliminado.', true);\n                        }\n                        else {\n                            //Error during deleting\n                            mostrarRespuesta('Error al intentar eliminar el archivo.', false);\n                        }\n                        mostrarArchivos();\n                    }\n                });\n            }\n\n            /**\n             * @method mostrar_archivos\n             * @desc Displays all files through an ajax call\n             * @return {void}\n             */\n            function mostrarArchivos() {\n                //Ajax call using processing at mostrar_archivos.php\n                $.ajax({\n                    url: '../managers/upload_files_form/mostrar_archivos.php',\n                    dataType: 'JSON',\n                    success: function (respuesta) {\n                        if (respuesta) {\n                            var html = '';\n                            for (var i = 0; i < respuesta.length; i++) {\n                                if (respuesta[i] != undefined) {\n                                    html += '<div class=\"row\"> <span class=\"col-md-3\"> ' + respuesta[i] + ' </span> <div class=\"col-md-2\"> <a class=\"eliminar_archivo btn btn-danger \" id=\"btn_eliminar\" name=\"elim\" href=\"javascript:void(0);\"> Eliminar </a> </div> </div> <hr />';\n                                }\n                            }\n                            $(\"#archivos_subidos\").html(html);\n                        }\n                    }\n                });\n            }\n\n            /**\n             * @method mostrarRespuesta\n             * @desc Displays a given message according an 'ok' flag\n             * @param {string} mensaje message to show\n             * @param {boolean} ok boolean flasg that indicates if it's  a success or danger alert (message) \n             */\n            function mostrarRespuesta(mensaje, ok) {\n                $(\"#respuesta\").removeClass('alert-success').removeClass('alert-danger').html(mensaje);\n                if (ok) {\n                    $(\"#respuesta\").addClass('alert-success');\n                    setTimeout('document.location.reload()', 500);\n                }\n                else {\n                    $(\"#respuesta\").addClass('alert-danger');\n                    var btn_continue = $('<br> <div class=\"row\"><div class=\"col-md-2 col-md-offset-5\"><a class=\"continue btn btn-danger\" href=\"javascript:void(0);\"> Continuar </a></div></div>');\n                    btn_continue.appendTo($(\"#respuesta\"));\n\n                }\n            }\n\n\n\n        }\n    };\n});\n"],"file":"uploaddata_main.min.js"}