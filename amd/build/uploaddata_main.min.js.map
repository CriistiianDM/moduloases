{"version":3,"sources":["../src/uploaddata_main.js"],"names":["define","$","init","document","ready","mostrarArchivos","form","getElementById","on","subir_archivos","archivo","parents","eq","find","text","trim","eliminarArchivos","setTimeout","status_bar","children","span","goback_button","response_div","response_span","innerHTML","setAttribute","classList","remove","request","XMLHttpRequest","upload","addEventListener","event","percent","Math","round","loaded","total","style","width","response","add","removeAttribute","open","send","FormData","abort","ajax","url","type","timeout","data","error","mostrarRespuesta","success","respuesta","dataType","html","i","length","mensaje","ok","removeClass","addClass","btn_continue","appendTo"],"mappings":"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","sourcesContent":[" /**\r\n * Management - Upload, delete and display files\r\n * @module amd/src/uploaddata_main\r\n * @author Iader E. García Gómez\r\n * @copyright 2018 Iader E. García <iadergg@gmail.com>\r\n * @license  http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'block_ases/bootstrap', 'block_ases/sweetalert', 'block_ases/validator'], function ($, bootstrap, sweetalert, validator) {\r\n\r\n    return {\r\n        init: function () {\r\n\r\n            $(document).ready(function () {\r\n                mostrarArchivos();\r\n                var form = document.getElementById('upload_data_form');\r\n                $(\"#load_button\").on('click', function () {\r\n                    subir_archivos(form);\r\n                });\r\n                $(\"#archivos_subidos\").on('click', '.eliminar_archivo', function () {\r\n                    var archivo = $(this).parents('.row').eq(0).find('span').text();\r\n                    archivo = $.trim(archivo);\r\n                    eliminarArchivos(archivo);\r\n                });\r\n                $(\"#respuesta\").on('click', '.continue', function () {\r\n                    setTimeout('document.location.reload()', 500);\r\n                });\r\n            });\r\n\r\n           \r\n            /**\r\n             * @method subir_archivos\r\n             * @desc Upload files given a form to obtain the data\r\n             * @param {DOM element} form \r\n             * @return {void}\r\n             */\r\n            function subir_archivos(form) {\r\n\r\n                var status_bar = form.children[2].children[0].children[0];\r\n                var span = status_bar.children[0];\r\n                var goback_button = form.children[4].children[1];\r\n\r\n                response_div = document.getElementById('response_div');\r\n                response_span = document.getElementById('response_span');\r\n\r\n                response_span.innerHTML = \"\";\r\n                response_div.setAttribute('hidden', 'hidden');\r\n\r\n                status_bar.classList.remove('green_bar', 'red_bar');\r\n\r\n                //Ajax request\r\n                var request = new XMLHttpRequest();\r\n\r\n                // Progress bar\r\n\r\n                request.upload.addEventListener(\"progress\", (event) => {\r\n                    let percent = Math.round((event.loaded / event.total) * 100);\r\n\r\n                    status_bar.style.width = percent + '%';\r\n                    span.innerHTML = percent + '%';\r\n\r\n                });\r\n\r\n                request.addEventListener(\"load\", () => {\r\n                    if (request.response == '1') {\r\n                        status_bar.classList.add('green_bar');\r\n                        span.innerHTML = \"Éxito\";\r\n                        response_div.removeAttribute('hidden');\r\n                        response_span.classList.add('response_success');\r\n                        response_span.innerHTML += 'El contenido del archivo ha sido cargado con éxito en la base de datos.';\r\n                    }\r\n                    else {\r\n                        status_bar.classList.add('red_bar');\r\n                        span.innerHTML = \"Error\";\r\n                        response_div.removeAttribute('hidden');\r\n                        response_span.classList.add('response_error');\r\n                        response_span.innerHTML = request.response;\r\n                    }\r\n\r\n                });\r\n\r\n                //Upload files processing file at subir_archivo.php\r\n\r\n                request.open('post', '../managers/upload_files_form/subir_archivo.php');\r\n\r\n                request.send(new FormData(form));\r\n\r\n                goback_button.addEventListener('click', () => {\r\n                    request.abort();\r\n                    status_bar.classList.remove('green_bar');\r\n                    status_bar.classList.add('red_bar');\r\n                    span.innerHTML = \"Proceso cancelado\";\r\n                });\r\n            }\r\n\r\n            /**\r\n             * @method eliminarArchivos\r\n             * @desc Deletes a specific file through an ajax call\r\n             * @param {file} archivo file to delete\r\n             */\r\n            function eliminarArchivos(archivo) {\r\n                //Ajax call using processing at eliminar_archivo.php\r\n                $.ajax({\r\n                    url: '../managers/upload_files_form/eliminar_archivo.php',\r\n                    type: 'POST',\r\n                    timeout: 10000,\r\n                    data: {\r\n                        archivo: archivo\r\n                    },\r\n                    error: function () {\r\n                        //In case something were missing\r\n                        mostrarRespuesta('Error al intentar eliminar el archivo.', false);\r\n                    },\r\n                    success: function (respuesta) {\r\n                        if (respuesta == 1) {\r\n                            //File deleted\r\n                            mostrarRespuesta('El archivo ha sido eliminado.', true);\r\n                        }\r\n                        else {\r\n                            //Error during deleting\r\n                            mostrarRespuesta('Error al intentar eliminar el archivo.', false);\r\n                        }\r\n                        mostrarArchivos();\r\n                    }\r\n                });\r\n            }\r\n\r\n            /**\r\n             * @method mostrar_archivos\r\n             * @desc Displays all files through an ajax call\r\n             * @return {void}\r\n             */\r\n            function mostrarArchivos() {\r\n                //Ajax call using processing at mostrar_archivos.php\r\n                $.ajax({\r\n                    url: '../managers/upload_files_form/mostrar_archivos.php',\r\n                    dataType: 'JSON',\r\n                    success: function (respuesta) {\r\n                        if (respuesta) {\r\n                            var html = '';\r\n                            for (var i = 0; i < respuesta.length; i++) {\r\n                                if (respuesta[i] != undefined) {\r\n                                    html += '<div class=\"row\"> <span class=\"col-md-3\"> ' + respuesta[i] + ' </span> <div class=\"col-md-2\"> <a class=\"eliminar_archivo btn btn-danger \" id=\"btn_eliminar\" name=\"elim\" href=\"javascript:void(0);\"> Eliminar </a> </div> </div> <hr />';\r\n                                }\r\n                            }\r\n                            $(\"#archivos_subidos\").html(html);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            /**\r\n             * @method mostrarRespuesta\r\n             * @desc Displays a given message according an 'ok' flag\r\n             * @param {string} mensaje message to show\r\n             * @param {boolean} ok boolean flasg that indicates if it's  a success or danger alert (message) \r\n             */\r\n            function mostrarRespuesta(mensaje, ok) {\r\n                $(\"#respuesta\").removeClass('alert-success').removeClass('alert-danger').html(mensaje);\r\n                if (ok) {\r\n                    $(\"#respuesta\").addClass('alert-success');\r\n                    setTimeout('document.location.reload()', 500);\r\n                }\r\n                else {\r\n                    $(\"#respuesta\").addClass('alert-danger');\r\n                    var btn_continue = $('<br> <div class=\"row\"><div class=\"col-md-2 col-md-offset-5\"><a class=\"continue btn btn-danger\" href=\"javascript:void(0);\"> Continuar </a></div></div>');\r\n                    btn_continue.appendTo($(\"#respuesta\"));\r\n\r\n                }\r\n            }\r\n\r\n\r\n\r\n        }\r\n    };\r\n});\r\n"],"file":"uploaddata_main.min.js"}