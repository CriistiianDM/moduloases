{"version":3,"sources":["../src/massive_upload.js"],"names":["define","$","notification","templates","ases_jquery_datatable","CFG","swal","load_indicator","instance_id","CONTINUE_BUTTON_ID","get_cohort_id","val","get_endpoint_name","remove_alert_errors","remove","string_replace_all","string","search","replacement","replace","RegExp","_non_valid_for_js_name__regex","go_to_top_of_the_page","animate","scrollTop","add_cell_style_and_errors","row","data","error","addClass","errors","Object","keys","forEach","property_name","console","log","error_names","map","error_message","error_names_concat","join","prop","show_datatable","jquery_datatable","destroy","autoWidth","table","fn","dataTable","isDataTable","DataTable","get_api_url","_continue","wwwroot","reinit_datatable","reinit_mesasges_area","html","errors_object_to_erros","object_errors","key","concat","enable_selects","ApiData","object_warnings","success_logs_events","initial_object_properties","prototype","get_messages","messages","_i","length","constructor","Array","push","MessagesObject","get_from_response","response","response_","JSON","parse","success_log_events","load_preview_on_error","data_table","dom","data_response","object_properties","file_headers","correct_column_names","given_column_names","missing_columns","filter","element","indexOf","extra_columns","column","css","attr","get_send_file_button","get_data_form","FormData","get","send_data","api_url","data_form","show","ajax","url","cache","contentType","dataType","processData","type","then","hide","catch","title","text","closeOnConfirm","confirmButtonText","remove_continue_button","add_continue_button","send_file_button","clone","off","appendTo","send_file_and_save","closeOnCancel","showCancelButton","isConfirm","send_file","add_nothing_to_save_button","api_data","render","js","appendNodeContents","position","index","columns","unshift","rowCallback","initComplete","add_column_filters","click","error_object","responseText","datatable_preview","generic_errors","error_messages","addNotification","message","send_file_wait_for_approval","warnings","success_logs","move_notifications_area_under_ases_menu","prependTo","init","change"],"mappings":"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","sourcesContent":["/**\r\n * Massive data upload generic javascript\r\n * @module amd/src/course_and_techar_report\r\n * @author Luis Gerardo Manrique Cardona\r\n * @copyright 2018 Luis Gerardo Manrique Cardona <luis.manrique@correounivalle.edu.co>\r\n * @license  http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine([\r\n    'jquery',\r\n    'core/notification',\r\n    'core/templates',\r\n    'block_ases/ases_jquery_datatable',\r\n    'core/config',\r\n    'block_ases/sweetalert',\r\n    'block_ases/loading_indicator',\r\n    'block_ases/jquery.dataTables',\r\n    'block_ases/dataTables.buttons',\r\n    'block_ases/buttons.html5',\r\n    'block_ases/buttons.flash',\r\n    'block_ases/buttons.print',\r\n\r\n    ], function($, notification, templates, ases_jquery_datatable, CFG, swal, load_indicator, dataTables, autoFill, buttons, html5, flash, print) {\r\n    var instance_id = 0;\r\n    var CONTINUE_BUTTON_ID = 'continue-button';\r\n    var CONTINUE_BUTTON_SELECTOR = \"#\" + CONTINUE_BUTTON_ID;\r\n    function get_datatable_column_index(table, name) {\r\n        var column = table.column(name);\r\n        return column.name;\r\n    }\r\n    var get_cohort_id = function () {\r\n        return $(\"#cohorts\").val();\r\n    };\r\n    var get_endpoint_name = function () {\r\n        return $(\"#endpoints\").val();\r\n    };\r\n    var remove_alert_errors = function()  {\r\n        $('#user-notifications .alert-error').remove();\r\n    };\r\n    var string_replace_all = function(string, search, replacement) {\r\n        return string.replace(new RegExp(search, 'g'), replacement);\r\n    };\r\n    var _non_valid_for_js_name__regex = /[ -() \\[\\].]/;\r\n    var some_string_to_js_valid_name = function (string) {\r\n        return string_replace_all(string, _non_valid_for_js_name__regex, '_');\r\n    };\r\n    var go_to_top_of_the_page = function() {\r\n        $('body,html').animate({scrollTop : 0}, 500);\r\n    };\r\n    var add_cell_style_and_errors = function (row, data) {\r\n        if (data.error === \"SI\") {\r\n            $(row).addClass('error');\r\n            if (data.errors) {\r\n                Object.keys(data.errors).forEach(property_name => {\r\n                    /**\r\n                     * Cada celda que tenga un error debe tener la clase error\r\n                     * @see https://datatables.net/reference/option/rowCallback\r\n                     */\r\n                    $('td.' + property_name, row).addClass('error');\r\n                    console.log( data.errors);\r\n                    var error_names = data.errors[property_name].map(error => error.error_message);\r\n                    var error_names_concat = error_names.join('; ');\r\n                    /* Se añaden los mensajes de los errores al title de el campo en la tabla*/\r\n                    $('td.' + property_name, row).prop('title', error_names_concat);\r\n                });\r\n            }\r\n        }\r\n    };\r\n    var show_datatable = function(jquery_datatable) {\r\n        jquery_datatable.destroy = true;\r\n        jquery_datatable.autoWidth = false;\r\n        var table = $('#example');\r\n\r\n        if( $.fn.dataTable.isDataTable('#example')) {\r\n            table.DataTable().destroy();\r\n\r\n        }\r\n        table.DataTable(jquery_datatable);\r\n    };\r\n    var get_api_url = function(_continue) {\r\n\r\n        return CFG.wwwroot + '/blocks/ases/managers/mass_management/mass_upload_api.php/'+ get_endpoint_name() + '/'+get_cohort_id() + '/' + instance_id+ '/' + _continue;\r\n    };\r\n\r\n\r\n        var reinit_datatable = () => {\r\n            if($.fn.DataTable.isDataTable(\"#example\")) {\r\n            $('#example').DataTable().destroy();\r\n        }\r\n        };\r\n    /**\r\n     * Actually, jquery datatables data function returns an object with more\r\n     * than is neccesary for get real data, this function extract the real data\r\n     * from datatables data whitout unnecesary info\r\n     * @param table Jquery Datatable\r\n     * @param initial_object_properties array Array of property names\r\n     * @return array of data\r\n     * @see https://datatables.net/reference/api/rows().data()\r\n     */\r\n    function getTableData(table, initial_object_properties) {\r\n        var table_data = table.rows().data();\r\n        var data_ = [];\r\n        var data = [];\r\n        for (var i = 0; i < table_data.length; i++) {\r\n            data_.push(table_data[i]);\r\n        }\r\n        /* Get only the initial object properties (exclude indexes or aditional values added for jquery datatable suport*/\r\n        data_.forEach(element => {\r\n            var pure_element = {};\r\n            initial_object_properties.forEach(property => {\r\n                pure_element[property] = element[property];\r\n            });\r\n            data.push(pure_element);\r\n        });\r\n        return data;\r\n    }\r\n    var reinit_mesasges_area =  function() {\r\n        $('#messages_area').html('');\r\n    };\r\n    var errors_object_to_erros =  (object_errors) => {\r\n        var errors = [];\r\n        Object.keys(object_errors).forEach( key => {\r\n            errors = errors.concat(object_errors[key]);\r\n        });\r\n\r\n        return errors;\r\n    };\r\n    var enable_selects = function() {\r\n        $('select').prop('disabled', false);\r\n    };\r\n    /**\r\n     * Returned API data structure\r\n     *\r\n     * @property data array Array of objects returned based in the CSV registries\r\n     * @property object_errors array Array with the same length than data, if object_errors in position\r\n     *  0 is an object, the data[0] item have the errors contained in object_errors[0]\r\n     *  in data array, if object_errors\r\n     * @property warnings string[] Indexed as the same of object_errors\r\n     * @property success_logs string[] Indexed as the same of object_errors\r\n     * @property jquery_datatable Data table with all the info needed for show the CSV info in a datatable\r\n     * @property error boolean Var than say if all operation has error or not\r\n     * @property initial_object_properties string[] Array of all the property names of the objects\r\n     *  generated from CSV data\r\n     * @type {ApiData}\r\n     */\r\n    var ApiData /* @class */ = (function   () {\r\n\r\n\r\n        function ApiData(data,\r\n                        object_errors,\r\n                        object_warnings,\r\n                        success_logs_events,\r\n                        jquery_datatable,\r\n                        error,\r\n                        initial_object_properties\r\n        ) {\r\n            this.data = data;\r\n            this.object_errors = object_errors? object_errors: [];\r\n            this.object_warnings = object_warnings ? object_warnings : [];\r\n            this.jquery_datatable = jquery_datatable? jquery_datatable: {};\r\n            this.success_logs_events = success_logs_events ? success_logs_events : [];\r\n            this.error = error;\r\n            this.initial_object_properties = initial_object_properties? initial_object_properties: [];\r\n        }\r\n        ApiData.prototype.get_messages = function() {\r\n            console.log(this);\r\n            var messages = [];\r\n            for(var _i = 0; _i < this.data.length; _i++) {\r\n                if (\r\n                    (\r\n                        this.object_errors[_i] && typeof this.object_errors[_i] === 'object' &&\r\n                        this.object_errors[_i].constructor !== Array) ||\r\n                    (this.object_warnings[_i] && this.object_warnings[_i].length > 0) ||\r\n                    (this.success_logs_events[_i] && this.success_logs_events[_i].length > 0)\r\n                ) {\r\n                    messages.push(new MessagesObject(\r\n                        _i + 1,\r\n                        this.object_errors[_i],\r\n                        this.object_warnings[_i],\r\n                        this.success_logs_events[_i])\r\n                    );\r\n                }\r\n            }\r\n            return messages;\r\n        };\r\n        ApiData.get_from_response = function (response) {\r\n            var response_ = JSON.parse(response);\r\n            return new ApiData(\r\n                response_.data,\r\n                response_.object_errors,\r\n                response_.object_warnings,\r\n                response_.success_log_events,\r\n                response_.jquery_datatable,\r\n                response_.error,\r\n                response_.initial_object_properties\r\n                );\r\n        };\r\n        return ApiData;\r\n\r\n\r\n    }());\r\n    /**\r\n     * Load preview datatable\r\n     * En caso de que el csv tenga mas o menos propiedades de las esperadas\r\n     * se debe mostrar una previsualización de los datos dados y cuales son las\r\n     * columnas que sobran o las que faltan\r\n     * @param data_table Datatable con la estructura inicial, sin datos, de como\r\n     * debe ir el csv, con sus headers almenos\r\n     * @param error Primer error encontrado\r\n     */\r\n    var load_preview_on_error = function (data_table, error) {\r\n        data_table.dom =  'Bfrtip';\r\n        show_datatable(data_table);\r\n\r\n        if (error.data_response && error.data_response.object_properties && error.data_response.file_headers) {\r\n\r\n            var correct_column_names = error.data_response.object_properties;\r\n            var given_column_names = error.data_response.file_headers;\r\n\r\n            var missing_columns = [];\r\n            missing_columns = missing_columns.concat(correct_column_names.filter(element => given_column_names.indexOf(element) < 0));\r\n            var extra_columns = [];\r\n            extra_columns = extra_columns.concat(given_column_names.filter(element => {\r\n                return correct_column_names.indexOf(element) <= -1;\r\n            }));\r\n\r\n            if( missing_columns.length > 0 ) {\r\n                missing_columns.forEach(column => {\r\n\r\n                    $('.' + column)\r\n                        .css('background-color', '#cccccc')\r\n                        .attr('title', 'Columna faltante');\r\n                    console.log(column);\r\n                });\r\n            }\r\n\r\n            if( extra_columns.length > 0 ) {\r\n                extra_columns.forEach(column => {\r\n                    console.log(column);\r\n                    $('.' + column)\r\n                        .css('background-color', 'red')\r\n                        .attr('title', 'Columna sobrante');\r\n\r\n                });\r\n            }\r\n\r\n        }\r\n\r\n    };\r\n\r\n    var get_send_file_button = function() {\r\n        return $('#send-file');\r\n    };\r\n\r\n\r\n    var get_data_form = () => {\r\n        return new FormData($('#form-send-file').get(0));\r\n    };\r\n    var send_data = function (_continue ) {\r\n\r\n        var api_url = get_api_url(_continue);\r\n        var data_form = get_data_form();\r\n        load_indicator.show();\r\n        return $.ajax({\r\n            url: api_url,\r\n            data: data_form,\r\n            cache: false,\r\n            contentType: false,\r\n            dataType: \"html\",\r\n            processData: false,\r\n            type: 'POST'\r\n        }).then( response => {\r\n            load_indicator.hide();\r\n            return response;\r\n        }).catch(response => {\r\n            load_indicator.hide();\r\n            go_to_top_of_the_page();\r\n            swal({\r\n                title: 'Ocurrio un error',\r\n                text: \"En la sección de notificaciones se muestra la lista de errores, adicionalmente en la consola\" +\r\n                    \"se muestra información detallada de los errores y su contexto\",\r\n                type: 'error',\r\n                closeOnConfirm: true,\r\n                confirmButtonText: 'Aceptar'\r\n            });\r\n            return response;\r\n        });\r\n\r\n    };\r\n    var remove_continue_button = function () {\r\n      $(CONTINUE_BUTTON_SELECTOR).remove();\r\n    };\r\n    var add_continue_button = function() {\r\n        var send_file_button = get_send_file_button();\r\n        return send_file_button\r\n            .clone(true)\r\n            .off() //importante para no compartir eventos\r\n            .attr(\"id\", CONTINUE_BUTTON_ID)\r\n            .html('Almacenar información')\r\n            .attr('title', 'Guardar información de forma persistente en la base de datos')\r\n            .appendTo('#buttons-section');\r\n\r\n    };\r\n    var send_file_and_save = () =>  {\r\n        swal({\r\n            title: 'Confirmación de guardado',\r\n            text: \"Una vez acepte almacenar la información, todo lo que se ha mostrado que se guardara\" +\r\n                \"va a ser almacenado en la base de datos y no habrá forma de volver a un estado anterior.\" +\r\n                \"Si da click en cancelar la base de datos no sufrira ningun cambio.\",\r\n            type: 'warning',\r\n            closeOnConfirm: true,\r\n            closeOnCancel: true,\r\n            showCancelButton: true,\r\n            confirmButtonText: 'Almacenar información?'\r\n        }, function (isConfirm) {\r\n            if (isConfirm) {\r\n                remove_continue_button();\r\n                send_file(true)\r\n                    .then( () => {\r\n                        swal({\r\n                            title: 'La información se ha guardado correctamente',\r\n                            text: \"\",\r\n                            type: 'success',\r\n                            closeOnConfirm: true,\r\n                            closeOnCancel: true,\r\n                            showCancelButton: false,\r\n                            confirmButtonText: 'Vale'\r\n                        });\r\n                        enable_selects();\r\n                    });\r\n\r\n            }\r\n        });\r\n\r\n\r\n    };\r\n    var add_nothing_to_save_button = function () {\r\n        add_continue_button()\r\n            .html('Nada para guardar')\r\n            .attr('disabled', true);\r\n    }\r\n    var send_file = (_continue) => {\r\n        reinit_datatable();\r\n\r\n        return send_data(_continue)\r\n            .then(response => {\r\n\r\n                console.log(response, 'response');\r\n                remove_alert_errors();\r\n                reinit_datatable();\r\n                reinit_mesasges_area();\r\n                /**\r\n                 * Se guardan las propiedades iniciales de los objetos cuando llegan de el servidor\r\n                 * Estas son importantes ya que para gestion de la información en la tabla, los datos\r\n                 * sufren modificaciones estructurales, donde son añadidas algunas propiedades.\r\n                 */\r\n                var api_data = ApiData.get_from_response(response);\r\n                var errors = api_data.object_errors;\r\n                var jquery_datatable = api_data.jquery_datatable;\r\n\r\n                var messages = api_data.get_messages();\r\n                /* Se muestran los mensajes */\r\n                templates.render('block_ases/massive_upload_messages', {data: messages} )\r\n                    .then((html, js) => {\r\n                        templates.appendNodeContents('#messages_area', html, js);\r\n                    });\r\n                /**\r\n                 * Se añade el error de cada objeto a si mismo. Estos errores vienen en  response.object_errors,\r\n                 * este objeto es un diccionario donde las llaves son las posiciones que un objeto ocupa en\r\n                 * datatable.data\r\n                 */\r\n                Object.keys(errors).forEach((position, index) => {\r\n                    jquery_datatable.data[position].errors = errors[position];\r\n                });\r\n                /* Cada elemento data de la tabla debe tener una propiedad llamada index para que la columna\r\n                * de indices para las filas pueda existir*/\r\n                jquery_datatable.data.forEach((element, index) => {\r\n                    element.index = index + 1;\r\n                });\r\n                /**\r\n                 * Se añade la propiedad que indicara si el objeto tine o no errores, para que la columna\r\n                 * 'Errores' pueda existir. Esta información sera eliminada al momento de requerir los datos\r\n                 */\r\n                jquery_datatable.data.forEach((element, index) => {\r\n                    if (errors[index] && (errors[index].length > 0 || errors[index].constructor === Object ))  {\r\n                        element.error = 'SI';\r\n                    } else {\r\n                        element.error = 'NO';\r\n                    }\r\n                });\r\n                /*Se añade la columna que llevara los indices de las filas en orden (1,2,3,4,5...)*/\r\n                jquery_datatable.columns.unshift({\r\n                    \"name\": 'index',\r\n                    \"data\": 'index',\r\n                    \"title\": 'Linea'\r\n                });\r\n                /**\r\n                 * Se añade la columna que llevara el echo de si el\r\n                 * dato tiene error o no, puede tomar los valores 'SI' o 'NO'\r\n                 */\r\n                jquery_datatable.columns.push({\r\n                    \"name\": 'error',\r\n                    \"title\": 'Error',\r\n                    \"data\": 'error'\r\n                });\r\n                /* Se añade la función que modificara la vista de cada fila a la tabla, si esta tiene errores*/\r\n                jquery_datatable.rowCallback = add_cell_style_and_errors;\r\n                /*Se añade el filtro de opciones en la columna error*/\r\n                jquery_datatable.initComplete = ases_jquery_datatable.add_column_filters(['error:name']);\r\n\r\n                show_datatable(jquery_datatable);\r\n                console.log(_continue, 'continue antes de añadir el boton continue');\r\n                if(!api_data.error && !_continue) {\r\n                    if(api_data.success_logs_events.length === 0) {\r\n                        add_nothing_to_save_button();\r\n                    } else {\r\n                        add_continue_button()\r\n                            .click(send_file_and_save);\r\n                    }\r\n                }\r\n\r\n        }).catch(\r\n            response  => {\r\n                //console.log(response, 'response');\r\n                remove_alert_errors();\r\n                reinit_datatable();\r\n                reinit_mesasges_area();\r\n               // console.log(response);\r\n                var error_object = JSON.parse(response.responseText);\r\n                console.log(error_object, \"error object at catch send file\");\r\n                var datatable_preview = error_object.datatable_preview;\r\n                if( error_object.object_errors && error_object.object_errors.generic_errors ) {\r\n                    var error_messages = error_object.object_errors.generic_errors.map(error => error.error_message);\r\n\r\n                    load_preview_on_error(datatable_preview, error_object.object_errors.generic_errors[0]);\r\n\r\n                    error_messages.forEach((error_message) => {console.log(error_message);\r\n                        notification.addNotification({\r\n                            message: error_message,\r\n                            type: 'error'\r\n                        });\r\n                    });\r\n                }\r\n\r\n            }\r\n        );\r\n    };\r\n    var disable_selects = function() {\r\n        $('select').prop('disabled', true);\r\n    };\r\n\r\n    var send_file_wait_for_approval = function(){\r\n        return send_file(false);\r\n    };\r\n\r\n    /**\r\n     * Message object than contain the warnigns , success logs and errors for a messages table\r\n     *\r\n     * @property index int From 1 if posible\r\n     * @property errors errors object of AsesError[]\r\n     * @property warnings string[]\r\n     * @property success_logs string[]\r\n     * @type {MessagesObject}\r\n     */\r\n    var MessagesObject /* @class */ = (function   () {\r\n\r\n\r\n        function MessagesObject(index,\r\n                                errors,\r\n                                warnings,\r\n                                success_logs) {\r\n            this.index = index;\r\n\r\n            this.errors = errors ? errors_object_to_erros(errors) : [];\r\n            this.warnings = warnings ? warnings : [];\r\n            this.success_logs = success_logs ? success_logs : [];\r\n        }\r\n        return MessagesObject;\r\n\r\n\r\n    }());\r\n    var move_notifications_area_under_ases_menu = function () {\r\n        $(\"#user-notifications\").prependTo($(\".massive_upload\"));\r\n    };\r\n\r\n    return {\r\n        /**\r\n         * @param data contiene el id de la instancia\r\n         */\r\n        init: function (data) {\r\n            $('select').change(()=> {\r\n                remove_continue_button();\r\n            });\r\n            instance_id = data.instance_id;\r\n            $('#send-file').click(()=>{\r\n                remove_continue_button();\r\n                send_file_wait_for_approval()\r\n                    .catch(()=> {\r\n                        enable_selects();\r\n                    });\r\n            });\r\n            move_notifications_area_under_ases_menu();\r\n        }\r\n        };\r\n    }\r\n);\r\n\r\n\r\n\r\n"],"file":"massive_upload.min.js"}