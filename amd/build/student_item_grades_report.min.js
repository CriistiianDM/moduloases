define(["jquery","block_ases/ases_jquery_datatable","core/notification","core/templates","block_ases/jquery.dataTables"],function(t,e,a,n){return{init:function(){t(document).ready(function(){})},load_report:function(a){var o=function(){function t(t,e,a){this.est_items_perdidos=t||0,this.cantidad_estudiantes=a||0,this.est_mas_items_perdidos_que_ganados=e||0}return t.return_total_report=function(e){var a=new t;a.cantidad_estudiantes=e.length;for(var n=0,o=e;n<o.length;n++)e[n].cantidad_items_perdidos>=1&&a.est_items_perdidos++,e[n].cantidad_items_perdidos>e[n].cantidad_items_ganados&&a.est_mas_items_perdidos_que_ganados++;return a},t}();t(document).on("click","#tableStudentItemGradesReport tbody tr td",function(){var e=t("#tableStudentItemGradesReport").DataTable(),a=e.cell(this).index().column;if(a>=1&&a<=4){var n="student_profile.php"+location.search+"&student_code="+e.cell(e.row(this).index(),0).data().codigo;window.open(n,"_blank").focus()}});var i="#tableStudentItemGradesReport";t(i).html('<img class="icon-loading" src="../icon/loading.gif"/>');var r=null,s=a.instance_id,d=null;function l(a,n){var o=a.data().mdl_user_id,i="../managers/student_grades/student_item_grades_report_api.php/student_grades/item_summary/"+o;t.ajax({method:"get",url:i}).done(function(n){var i=function(t){return{data:t,bsort:0,paging:!1,columns:[{title:"CÃ³digo",name:"codigo_asignatura",data:"codigo_asignatura",description:"Identificador de la asignatura en formato Sede-Codigo-Grupo"},{title:"Nombre Asignatura",name:"nombre_asignatura",data:"nombre_asignatura",description:"Nombre completo de la asignatura"},{title:"Profesor",name:"nombre_profesor",data:"nombre_profesor",description:"Nombre completo de el profesor"},{title:"Notas",name:"notas",data:"notas",description:"Identificador de la asignatura en formato Sede-Codigo-Grupo"},{title:"Nota Final",name:"nota_final",data:"nota_final",description:"Nota final de la asignatura calculada con las categorias de notas terminadas"}],searching:!1,language:e.common_lang_config(),order:0}}(n);a.child('<table align="center" id="student_item_grades_explicit'+o+'"></table>').show(),t("#student_item_grades_explicit"+o).DataTable(i)}).fail(function(t){n.removeClass("shown"),console.log(t)})}t.ajax({method:"GET",url:"../managers/student_grades/student_item_grades_report_api.php/"+s,dataType:"json"}).done(function(e){t(i).html("");var a,s=o.return_total_report(e.data);n.render("block_ases/student_item_grades_report_summary",{resume_report:s}).then(function(t,e){n.appendNodeContents(".student_item_grades_report .summary",t,e)}).fail(function(t){}),console.log(s),d=t(i).DataTable({data:e.data,bsort:e.bsort,columns:e.columns,language:e.language,order:e.order,initComplete:function(){if(r&&0!=r.length){var a=e.columns.map(t=>t.name?t.name:null),n=function(t,e){var a,n=[];for(a=0;a<e.length;a++)t.includes(e[a])&&n.push(a);return n}(r,a);this.api().columns(n).every(function(){var e=this,a=t('<select><option value=""></option></select>').appendTo(t(e.header())).on("change",function(){var a=t.fn.dataTable.util.escapeRegex(t(this).val());e.search(a?"^"+a+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(t,e){a.append('<option value="'+t+'">'+t+"</option>")})})}}}),a=e.columns,t(i+" th").each(function(e){t(this).attr("title",a[e].description)}),t(i+" tbody").on("click","td.details-control",function(){var e=t(this).closest("tr"),a=d.row(e);a.child.isShown()?(a.child.hide(),e.removeClass("shown")):(a.child('<img class="icon-loading" src="../icon/loading.gif"/>').show(),callback=((t,e)=>{e.child(t).show()}),l(a,e),e.addClass("shown"))})}).fail(function(t){console.log(t)})}}});