define(["amd/src/jquery","block_ases/jszip","block_ases/pdfmake","block_ases/jquery.dataTables","block_ases/dataTables.autoFill","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print","block_ases/bootstrap","block_ases/sweetalert2","block_ases/jqueryui","block_ases/select2","block_ases/Chart","block_ases/loading_indicator","block_ases/chartjs_plugin_datalabels"],function($, jszip, pdfmake, dataTables, autoFill, buttons, html5, flash, print, bootstrap, sweetalert, jqueryui, select2, Chart, loading_indicator, chartjs_plugin_datalabels){return{init:function(){window.JSZip=jszip;window.graficas={};const secciones=["programa","facultad","sexo","edad","condExcepcion","riesgos"];for(i=0;i<secciones.length;i++){$("#list-students-"+secciones[i]+"-panel").on("click",function(event){var id_button=String(event.currentTarget.id);var id=id_button.split("-")[2];getDataGraphicTable(id);});$("#save_btn_"+secciones[i]).on("click",function(event){var id_button=String(event.target.id);var id=id_button.split("_")[2];document.getElementById("download_"+id).click();});}$("#status_fields").on("change",function(){for(i=0;i<secciones.length;i++){if($("#"+secciones[i]).length>0){getDataGraphicTable(secciones[i]);}}});$("#conditions").on("change",function(){for(i=0;i<secciones.length;i++){if($("#"+secciones[i]).length>0){getDataGraphicTable(secciones[i]);}}});}};function getDataGraphicTable(type){var ases_status=$("#ases_status").is(":checked")?1:0;var icetex_status=$("#icetex_status").is(":checked")?1:0;var program_status=$("#academic_program_status").is(":checked")?1:0;$.ajax({type:"POST",data:{type:type,cohort:$("#conditions").val(),ases_status:ases_status,icetex_status:icetex_status,program_status:program_status,instance_id:getIdinstancia()},url:"../managers/ases_report/asesreport_graphics_processing.php",success:function(msg){createTable(type,msg);switch(type){case"programa":createBarGraphic(type,msg.data,"horizontalBar");break;case"edad":createBarGraphic(type,msg.data,"bar");break;case"facultad":createPieDoughnutGraphic(type,msg.data,"doughnut");break;case"sexo":createPieDoughnutGraphic(type,msg.data,"pie");break;case"condExcepcion":createPieDoughnutGraphic(type,msg.data,"doughnut");break;case"riesgos":createRisksGraphic(msg.data);break;}},dataType:"json",cache:false,async:true,failure:function(msg){}});}function createTable(type,data){$("#div_table_"+type).empty();$("#div_table_"+type).append('<table id="t_'+type+'" class="table" cellspacing="0" width="100%"><thead> </thead></table>');$("#t_"+type).DataTable(data);}function createBarGraphic(type,data,type_chart){var atributos=Object.keys(data[0]);var label=atributos[0];var labelCantidad=atributos[1];var labelsGrafica=[],cantidades=[];for(var x in data){nombre=data[x][label];cantidad=data[x][labelCantidad];nombre=nombre.replace("LICENCIATURA","LIC.");nombre=nombre.replace(/EDUCACIÓN/g,"EDU.");labelsGrafica.push(nombre);cantidades.push(cantidad);}$(".horizontal-bar-chart-container").css("height","1300px");$(".horizontal-bar-chart-container").css("width","100%");$(".bar-chart-container").css("height","800px");$(".bar-chart-container").css("width","100%");var backgroundColors=[];var borderColors=[];for(var i=0;i<labelsGrafica.length;i++){if(i%2==0){backgroundColors.push("rgba(255, 99, 132, 0.2)");borderColors.push("rgba(255, 99, 132, 1)");}else{backgroundColors.push("rgba(130, 130, 130, 0.2)");borderColors.push("rgba(130, 130, 130, 1)");}}var ctx=document.getElementById("grafica_"+type).getContext("2d");var data={labels:labelsGrafica,datasets:[{label:"Cantidad de Estudiantes",data:cantidades,backgroundColor:backgroundColors,borderColor:borderColors,borderWidth:3}]};if(!window.graficas["chart_"+type]){var texto=type;if(type==="condExcepcion"){texto="Condición de Excepción";}Chart.plugins.register({beforeDraw:function(c){var ctx=c.chart.ctx;ctx.fillStyle="white";ctx.fillRect(0,0,c.chart.width,c.chart.height);}});window.graficas["chart_"+type]=new Chart(ctx,{type:type_chart,data:data,options:{elements:{rectangle:{borderWidth:2,}},backgroundColor:"white",responsive:true,legend:{position:"top",display:false},title:{display:true,text:"Cantidad de Estudiantes por "+texto,fontSize:30},scales:{yAxes:[{ticks:{display:true},categoryPercentage:1,barPercentage:1}],xAxes:[{ticks:{beginAtZero:true}}]},maintainAspectRatio:false,plugins:{datalabels:{display:true,align:"center",anchor:"center"}},animation:{duration:0,onProgress:function(animation){},onComplete:function(animation){var imagen=document.getElementById("grafica_"+type).toDataURL("image/jpeg");$("#download_"+type).attr("href",imagen);$("#download_"+type).attr("download","reporte_"+type+".jpg");}}}});}else{window.graficas["chart_"+type]["data"]=data;window.graficas["chart_"+type].update();}}function createPieDoughnutGraphic(type,data,type_graphic){var labelsGrafica=[],cantidades=[];for(var x in data){nombre=data[x]["nombre"];cantidad=data[x]["cantidad"];labelsGrafica.push(nombre);cantidades.push(cantidad);}var ctx=document.getElementById("grafica_"+type).getContext("2d");var data={labels:labelsGrafica,datasets:[{label:"Cantidad de Estudiantes",data:cantidades,backgroundColor:["#F56476","#BFD1E5","#FFEECF","#C9A690","#DF928E","#CECCCC","#9191E9","#99E1D9","#FFA552","#BFC8AD","#0BAA6B","#EDD892"],borderColor:["#F56476","#BFD1E5","#FFEECF","#C9A690","#DF928E","#CECCCC","#9191E9","#99E1D9","#FFA552","#BFC8AD","#0BAA6B","#EDD892"],borderWidth:1}]};if(!window.graficas["chart_"+type]){var texto=type;if(type==="condExcepcion"){texto="Condición de Excepción";}Chart.plugins.register({beforeDraw:function(c){var ctx=c.chart.ctx;ctx.fillStyle="white";ctx.fillRect(0,0,c.chart.width,c.chart.height);}});var chart_options={title:{display:true,text:"Cantidad de estudiantes por "+texto,fontSize:30},legend:{display:true},starAngle:0,showTooltips:true,showPercentages:true,animation:{animateRotate:true,animateScale:true,duration:0,onProgress:function(animation){},onComplete:function(animation){var imagen=document.getElementById("grafica_"+type).toDataURL("image/jpeg");$("#download_"+type).attr("href",imagen);$("#download_"+type).attr("download","reporte_"+type+".jpg");}}};Chart.defaults.polarArea.animation.animateScale=false;window.graficas["chart_"+type]=new Chart(ctx,{type:type_graphic,data:data,options:chart_options});}else{window.graficas["chart_"+type]["data"]=data;window.graficas["chart_"+type].update();}}function createRisksGraphic(data){var nombres_riesgos=[];var riesgos_bajos=[];var riesgos_medios=[];var riesgos_altos=[];var sin_registro=[];for(riesgo in data){nombres_riesgos.push(data[riesgo]["riesgo"]);riesgos_bajos.push(data[riesgo]["bajo"]);riesgos_medios.push(data[riesgo]["medio"]);riesgos_altos.push(data[riesgo]["alto"]);sin_registro.push(data[riesgo]["no_registra"]);}$(".risk-chart-container").css("width","100%");var ctx=document.getElementById("grafica_riesgos").getContext("2d");var data={labels:nombres_riesgos,datasets:[{label:"Riesgos bajos",data:riesgos_bajos,backgroundColor:"rgba(0, 179, 136, 0.4)",borderColor:"rgba(0, 179, 136, 1)",borderWidth:2},{label:"Riesgos Medios",data:riesgos_medios,backgroundColor:"rgba(255, 136, 17, 0.4)",borderColor:"rgba(255, 136, 17, 1)",borderWidth:2},{label:"Riesgos Altos",data:riesgos_altos,backgroundColor:"rgba(255, 86, 102, 0.4)",borderColor:"rgba(255, 86, 102, 1)",borderWidth:2},{label:"N.R.",data:sin_registro,backgroundColor:"rgba(132, 133, 134, 0.4)",borderColor:"rgba(132, 133, 134, 1)",borderWidth:2}]};if(!window.graficas.chart_riesgos){Chart.plugins.register({beforeDraw:function(c){var ctx=c.chart.ctx;ctx.fillStyle="white";ctx.fillRect(0,0,c.chart.width,c.chart.height);}});var chart_options={title:{display:true,text:"Cantidad de registros por riesgos",fontSize:25},legend:{display:true,labels:{fontSize:15,fontStyle:"bold"}},starAngle:0,scales:{xAxes:[{ticks:{fontSize:15,fontStyle:"bold"}}]},showTooltips:true,showPercentages:true,animation:{animateRotate:true,animateScale:true,duration:0,onProgress:function(animation){},onComplete:function(animation){var imagen=document.getElementById("grafica_riesgos").toDataURL("image/jpeg");$("#download_riesgos").attr("href",imagen);$("#download_riesgos").attr("download","reporte_riesgos.jpg");}}};Chart.defaults.polarArea.animation.animateScale=false;window.graficas.chart_riesgos=new Chart(ctx,{type:"bar",data:data,options:chart_options});}else{window.graficas.chart_riesgos["data"]=data;window.graficas.chart_riesgos.update();}}function getIdinstancia(){var urlParameters=location.search.split("&");for(x in urlParameters){if(urlParameters[x].indexOf("instanceid")>=0){var intanceparameter=urlParameters[x].split("=");return intanceparameter[1];}}return 0;}});