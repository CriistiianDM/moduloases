define(["jquery","block_ases/jszip","block_ases/pdfmake","block_ases/jquery.dataTables","block_ases/dataTables.autoFill","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print","block_ases/bootstrap","block_ases/sweetalert2","block_ases/jqueryui","block_ases/select2","block_ases/Chart","block_ases/loading_indicator","block_ases/chartjs_plugin_datalabels"],function($,jszip,pdfmake,dataTables,autoFill,buttons,html5,flash,print,bootstrap,sweetalert,jqueryui,select2,Chart,loading_indicator,chartjs_plugin_datalabels){return{init:function(){window.JSZip=jszip,window.graficas={};const secciones=["programa","facultad","sexo","edad","condExcepcion"];$("#list-students-programa-panel").on("click",function(){getDataGraphicTable("programa")}),$("#list-students-facultad-panel").on("click",function(){getDataGraphicTable("facultad")}),$("#list-students-sexo-panel").on("click",function(){getDataGraphicTable("sexo")}),$("#list-students-edad-panel").on("click",function(){getDataGraphicTable("edad")}),$("#list-students-condExcepcion-panel").on("click",function(){getDataGraphicTable("condExcepcion")}),$("#status_fields").on("change",function(){for(i=0;i<secciones.length;i++)$("#"+secciones[i]).length>0&&getDataGraphicTable(secciones[i])}),$("#conditions").on("change",function(){for(i=0;i<secciones.length;i++)$("#"+secciones[i]).length>0&&getDataGraphicTable(secciones[i])})},get_id_instance:function(){var urlParameters=location.search.split("&");for(x in urlParameters){var intanceparameter;if(urlParameters[x].indexOf("instanceid")>=0)return urlParameters[x].split("=")[1]}return 0}};function getDataGraphicTable(type){var ases_status=$("#ases_status").is(":checked")?1:0,icetex_status=$("#icetex_status").is(":checked")?1:0,program_status=$("#academic_program_status").is(":checked")?1:0;$.ajax({type:"POST",data:{type:type,cohort:$("#conditions").val(),ases_status:ases_status,icetex_status:icetex_status,program_status:program_status,instance_id:getIdinstancia()},url:"../managers/ases_report/asesreport_graphics_processing.php",success:function(msg){switch(createTable(type,msg),type){case"programa":createBarGraphic(type,msg.data,"horizontalBar");break;case"edad":createBarGraphic(type,msg.data,"bar");break;case"facultad":createPieDoughnutGraphic(type,msg.data,"doughnut");break;case"sexo":createPieDoughnutGraphic(type,msg.data,"pie");break;case"condExcepcion":createPieDoughnutGraphic(type,msg.data,"doughnut")}},dataType:"json",cache:!1,async:!0,failure:function(msg){}})}function createTable(type,msg){$("#div_table_"+type).empty(),$("#div_table_"+type).append('<table id="t_'+type+'" class="table" cellspacing="0" width="100%"><thead> </thead></table>'),$("#t_"+type).DataTable(msg)}function createBarGraphic(type,data,type_chart){var atributos=Object.keys(data[0]),label=atributos[0],labelCantidad=atributos[1],labelsGrafica=[],cantidades=[];for(var x in data)nombre=data[x][label],cantidad=data[x][labelCantidad],"LICENCIATURA EN EDUCACIÓN BÁSICA CON ÉNFASIS EN CIENCIAS NATURALES Y EDUCACIÓN AMBIENTAL"===nombre&&(nombre="LIC. EN EDU. BÁSICA ÉNFASIS EN CIENCIAS NATURALES Y EDU. AMBIENTAL"),"LICENCIATURA EN EDUCACIÓN BÁSICA CON ÉNFASIS EN CIENCIAS SOCIALES"===nombre&&(nombre="LIC. EN EDU. BÁSICA CON ÉNFASIS EN CIENCIAS SOCIALES"),labelsGrafica.push(nombre),cantidades.push(cantidad);$(".horizontal-bar-chart-container").css("height","1300px"),$(".horizontal-bar-chart-container").css("width","100%"),$(".bar-chart-container").css("height","800px"),$(".bar-chart-container").css("width","100%");for(var backgroundColors=[],borderColors=[],i=0;i<labelsGrafica.length;i++)i%2==0?(backgroundColors.push("rgba(255, 99, 132, 0.2)"),borderColors.push("rgba(255, 99, 132, 1)")):(backgroundColors.push("rgba(130, 130, 130, 0.2)"),borderColors.push("rgba(130, 130, 130, 1)"));var ctx=document.getElementById("grafica_"+type).getContext("2d"),data={labels:labelsGrafica,datasets:[{label:"Cantidad de Estudiantes",data:cantidades,backgroundColor:backgroundColors,borderColor:borderColors,borderWidth:3}]};if(window.graficas["chart_"+type])window.graficas["chart_"+type].data=data,window.graficas["chart_"+type].update();else{var texto=type;"condExcepcion"===type&&(texto="Condición de Excepción"),window.graficas["chart_"+type]=new Chart(ctx,{type:type_chart,data:data,options:{elements:{rectangle:{borderWidth:2}},responsive:!0,legend:{position:"top",display:!1},title:{display:!0,text:"Cantidad de Estudiantes por "+texto,fontSize:30},scales:{yAxes:[{ticks:{display:!0},categoryPercentage:1,barPercentage:1}]},maintainAspectRatio:!1,plugins:{datalabels:{display:!0,align:"center",anchor:"center"}}}})}}function createPieDoughnutGraphic(type,data,type_graphic){var labelsGrafica=[],cantidades=[];for(var x in data)nombre=data[x].nombre,cantidad=data[x].cantidad,labelsGrafica.push(nombre),cantidades.push(cantidad);var ctx=document.getElementById("grafica_"+type).getContext("2d"),data={labels:labelsGrafica,datasets:[{label:"Cantidad de Estudiantes",data:cantidades,backgroundColor:["#F56476","#BFD1E5","#FFEECF","#C9A690","#DF928E","#CECCCC","#9191E9","#99E1D9","#FFA552","#BFC8AD","#0BAA6B","#EDD892"],borderColor:["#F56476","#BFD1E5","#FFEECF","#C9A690","#DF928E","#CECCCC","#9191E9","#99E1D9","#FFA552","#BFC8AD","#0BAA6B","#EDD892"],borderWidth:1}]};if(window.graficas["chart_"+type])window.graficas["chart_"+type].data=data,window.graficas["chart_"+type].update();else{var texto=type;"condExcepcion"===type&&(texto="Condición de Excepción");var chart_options={title:{display:!0,text:"Cantidad de estudiantes por "+texto,fontSize:30},legend:{display:!0},starAngle:0,animation:{animateRotate:!0,animateScale:!0},showTooltips:!0,showPercentages:!0};Chart.defaults.polarArea.animation.animateScale=!1,window.graficas["chart_"+type]=new Chart(ctx,{type:type_graphic,data:data,options:chart_options})}}function getIdinstancia(){var urlParameters=location.search.split("&");for(x in urlParameters){var intanceparameter;if(urlParameters[x].indexOf("instanceid")>=0)return urlParameters[x].split("=")[1]}return 0}});