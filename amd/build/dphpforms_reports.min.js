define(["jquery","block_ases/jszip","block_ases/jquery.dataTables","block_ases/dataTables.autoFill","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2"],function(e,s,a,t,n,r,o,i,c,d,l,p){return{init:function(){/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)||(e("#container-control").find("*").prop("disabled",!0),e("#container-msg-chrome").fadeIn(300)),window.JSZip=s;var a=null;function t(s,t){if("seguimiento_pares"==t){for(var n=s.length,r=0;r<n;r++){for(var o=null,i=null,c=0;c<Object.keys(s[r]).length;c++)"-#$%-"==s[r][c].respuesta&&(s[r][c].respuesta=""),"puntuacion_riesgo_individual"!=s[r][c].local_alias&&"puntuacion_riesgo_familiar"!=s[r][c].local_alias&&"puntuacion_riesgo_academico"!=s[r][c].local_alias&&"puntuacion_riesgo_economico"!=s[r][c].local_alias&&"puntuacion_vida_uni"!=s[r][c].local_alias||("1"==s[r][c].respuesta?s[r][c].respuesta="bajo":"2"==s[r][c].respuesta?s[r][c].respuesta="medio":"3"==s[r][c].respuesta&&(s[r][c].respuesta="alto")),"revisado_profesional"==s[r][c].local_alias&&("0"==s[r][c].respuesta?s[r][c].respuesta="marcado":"-1"==s[r][c].respuesta&&(s[r][c].respuesta="no_marcado")),"revisado_practicante"==s[r][c].local_alias&&("0"==s[r][c].respuesta?s[r][c].respuesta="marcado":"-1"==s[r][c].respuesta&&(s[r][c].respuesta="no_marcado")),o&&i||("id_estudiante"==s[r][c].local_alias&&(o=s[r][c].respuesta),"id_creado_por"==s[r][c].local_alias&&(i=s[r][c].respuesta));var d=parseInt(e("#dphpforms-instance-id").data("instance-id"));e.ajax({type:"POST",url:"../managers/user_management/user_management_api.php",data:JSON.stringify({function:"get_crea_stud_mon_prac_prof",params:[o,i,d,a]}),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){s[r][Object.keys(s[r]).length]={enunciado:"monitor_name",id:"00",local_alias:"monitor_name",respuesta:String(e.data_response.monitor.firstname)+" "+String(e.data_response.monitor.lastname)},s[r][Object.keys(s[r]).length]={enunciado:"practicing_name",id:"00",local_alias:"practicing_name",respuesta:String(e.data_response.practicing.firstname)+" "+String(e.data_response.practicing.lastname)},s[r][Object.keys(s[r]).length]={enunciado:"professional_name",id:"00",local_alias:"professional_name",respuesta:String(e.data_response.professional.firstname)+" "+String(e.data_response.professional.lastname)},s[r][Object.keys(s[r]).length]={enunciado:"created_by",id:"00",local_alias:"created_by",respuesta:String(e.data_response.created_by.firstname)+" "+String(e.data_response.created_by.lastname)};var a=e.data_response.student_username;a=a?e.data_response.student_username.split("-")[0]:"null",s[r][Object.keys(s[r]).length]={enunciado:"student_code",id:"00",local_alias:"student_code",respuesta:a},s[r][Object.keys(s[r]).length]={enunciado:"student_firstname",id:"00",local_alias:"student_firstname",respuesta:String(e.data_response.student.firstname)},s[r][Object.keys(s[r]).length]={enunciado:"student_lastname",id:"00",local_alias:"student_lastname",respuesta:String(e.data_response.student.lastname)}},failure:function(e){console.log(e)}});for(var l=Object.keys(s[r]).length-1;l>=0;l--)s[r][l+3]=e.extend(!0,{},s[r][l]);s[r][0]=e.extend(!0,{},s[r][Object.keys(s[r]).length-3]),s[r][1]=e.extend(!0,{},s[r][Object.keys(s[r]).length-2]),s[r][2]=e.extend(!0,{},s[r][Object.keys(s[r]).length-1]),delete s[r][Object.keys(s[r]).length-1],delete s[r][Object.keys(s[r]).length-1],delete s[r][Object.keys(s[r]).length-1],e("#progress-custom").find("div").width((100/n*(r+1)).toFixed(0)+"%"),e("#progress-custom").find("div").html((100/n*(r+1)).toFixed(0)+"%"),e("#progress-custom").find("div").attr("aria-valuenow",(100/n*(r+1)).toFixed(0))}return e("#progress-custom").find("div").addClass("progress-bar-success"),e("#message").removeClass("alert alert-info"),e("#message").addClass("alert alert-success"),e("#message").html("<strong>Info!</strong>  Reporte generado."),s}return e("#progress-custom").find("div").addClass("progress-bar-success"),e("#message").removeClass("alert alert-info"),e("#message").addClass("alert alert-success"),e("#message").html("<strong>Info!</strong>  Reporte generado."),s}function n(e){var s,a=function(e){var s,a,t,n,r,o;if(null==(o=e.data||null)||!o.length)return null;n=e.columnDelimiter||",",r=e.lineDelimiter||"\n",t=Object.keys(o[0]);for(var i=[],c=0;c<Object.keys(o[0]).length;c++)try{i.push(o[0][c].local_alias)}catch(e){console.log("ERROR"),console.log(o[0])}return s="",s+=i.join(n),s+=r,o.forEach(function(e){a=0,t.forEach(function(t){a>0&&(s+=n);try{s+='"'+e[t].respuesta.replace(/"/g,"'")+'"'}catch(e){}a++}),s+=r}),s}({data:e});if(null!=a&&("reporte.csv",csvData=new Blob([a],{type:"text/csv"}),void 0!==(s=document.createElement("a")).download)){var t=URL.createObjectURL(csvData);s.setAttribute("href",t),s.setAttribute("download","reporte.csv"),s.style="visibility:hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}e("#base_fields_check").on("change",function(){e("#base_fields_check").prop("checked")?e("#base_fields input[type='checkbox']").prop("checked",!0):e("#base_fields input[type='checkbox']").prop("checked",!1)}),e("#dimensions_fields_check").on("change",function(){e("#dimensions_fields_check").prop("checked")?e("#dimensions_fields input[type='checkbox']").prop("checked",!0):e("#dimensions_fields input[type='checkbox']").prop("checked",!1)}),e("#comments_fields_check").on("change",function(){e("#comments_fields_check").prop("checked")?e("#comments_fields input[type='checkbox']").prop("checked",!0):e("#comments_fields input[type='checkbox']").prop("checked",!1)}),e("#risks_fields_check").on("change",function(){e("#risks_fields_check").prop("checked")?e("#risks_fields input[type='checkbox']").prop("checked",!0):e("#risks_fields input[type='checkbox']").prop("checked",!1)}),e("#themes_fields_check").on("change",function(){e("#themes_fields_check").prop("checked")?e("#themes_fields input[type='checkbox']").prop("checked",!0):e("#themes_fields input[type='checkbox']").prop("checked",!1)}),e("#btn-generar-reporte").click(function(){var s=e("#start_date").val(),r=e("#end_date").val();if(s>=r)swal({title:"Información",text:"Intervalo de fechas inválido",type:"warning"},function(){});else{let i=e("#dphpforms-instance-id").data("instance-id");if(e.ajax({type:"POST",url:"../managers/periods_management/periods_api.php",data:JSON.stringify({function:"core_periods_get_period_by_date",params:[s,r,i]}),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){a=e.data_response},failure:function(e){}}),a){var o=JSON.parse(e("#dphpforms-reports-preguntas").html());let a=e("#dphpforms-instance-id").data("instance-id");e(".progress-bar").removeClass("progress-bar-success"),e(".progress-bar").removeClass("progress-bar-success"),e(".progress-bar").width("0%"),e(".progress-bar").html("0%"),e(".progress-bar").attr("aria-valuenow","0"),e("#progress_group").css("display","block"),e("#progress_group").removeClass("hidden"),e("#message").removeClass("alert alert-success"),e("#message").addClass("alert alert-info"),e("#message").html("<strong>Info!</strong> Se está generando el reporte, esto puede tardar un par de minutos dependiendo de su conexión a internet, capacidad del ordenador, intervalo de tiempo seleccionado y rapidez del campus virtual."),e.ajax({type:"POST",url:"../managers/dphpforms/v2/dphpforms_api.php",data:JSON.stringify({function:"find_records",params:[{form:"seguimiento_pares",filterFields:[["fecha",[[s,">="],[r,"<="]],!1],["id_instancia",[[a,"LIKE"]],!1]],orderFields:[],orderByDatabaseRecordDate:!1,recordStatus:["!deleted"],selectedFields:[],asFields:[]}]}),contentType:"aplication/json",dataType:"json",cache:"false",success:function(s){let a=Object.keys(s.data_response).length,r=[],i=0;for(var c=0;c<a;c++)e.get("../managers/dphpforms/dphpforms_get_record.php?record_id="+s.data_response[c].id_registro,function(s){if(Object.keys(s.record).length>0){for(var c=e.extend(!0,{},o),d=0;d<Object.keys(s.record.campos).length;d++)for(var l=0;l<Object.keys(c).length;l++)c[l].id==parseInt(s.record.campos[d].id_pregunta)&&(c[l].respuesta=s.record.campos[d].respuesta);r.push(c)}i++,e("#progress-download").find("div").width((100/a*i).toFixed(0)+"%"),e("#progress-download").find("div").html((100/a*i).toFixed(0)+"%"),e("#progress-download").find("div").attr("aria-valuenow",(100/a*i).toFixed(0)),i==a&&(e("#progress-download").find("div").addClass("progress-bar-success"),setTimeout(function(){n(t(r,"seguimiento_pares"))},10))}).fail(function(e){console.log(e)}),e("#progress").text(Math.round(i));0==a&&(e("#progress").text(100),e("#message").removeClass("alert alert-info"),e("#message").addClass("alert alert-success"),e("#message").html("<strong>Info!</strong>  Reporte generado."),e("#progress_group").addClass("hidden"))},error:function(e){}})}else swal({title:"Información",text:"Las fechas deben estar en el lapso de tiempo que comprende un periodo académico. ",type:"error"},function(){})}})}}});