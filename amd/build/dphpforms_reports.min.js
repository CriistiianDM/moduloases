define(["jquery","block_ases/jszip","block_ases/jquery.dataTables","block_ases/dataTables.autoFill","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2"],function(e,s,a,t,r,o,n,i,d,c,l,p){return{init:function(){/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)||(e("#container-control").find("*").prop("disabled",!0),e("#container-msg-chrome").fadeIn(300)),window.JSZip=s;var a=null;function t(s,t){if("seguimiento_pares"==t){for(var r=s.length,o=0;o<r;o++){for(var n=null,i=null,d=0;d<Object.keys(s[o]).length;d++)"-#$%-"==s[o][d].respuesta&&(s[o][d].respuesta=""),"puntuacion_riesgo_individual"!=s[o][d].local_alias&&"puntuacion_riesgo_familiar"!=s[o][d].local_alias&&"puntuacion_riesgo_academico"!=s[o][d].local_alias&&"puntuacion_riesgo_economico"!=s[o][d].local_alias&&"puntuacion_vida_uni"!=s[o][d].local_alias||("1"==s[o][d].respuesta?s[o][d].respuesta="bajo":"2"==s[o][d].respuesta?s[o][d].respuesta="medio":"3"==s[o][d].respuesta&&(s[o][d].respuesta="alto")),"revisado_profesional"==s[o][d].local_alias&&("0"==s[o][d].respuesta?s[o][d].respuesta="marcado":"-1"==s[o][d].respuesta&&(s[o][d].respuesta="no_marcado")),"revisado_practicante"==s[o][d].local_alias&&("0"==s[o][d].respuesta?s[o][d].respuesta="marcado":"-1"==s[o][d].respuesta&&(s[o][d].respuesta="no_marcado")),n&&i||("id_estudiante"==s[o][d].local_alias&&(n=s[o][d].respuesta),"id_creado_por"==s[o][d].local_alias&&(i=s[o][d].respuesta));var c=parseInt(e("#dphpforms-instance-id").data("instance-id"));e.ajax({type:"POST",url:"../managers/user_management/user_management_api.php",data:JSON.stringify({function:"get_crea_stud_mon_prac_prof",params:[n,i,c,a]}),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){s[o][Object.keys(s[o]).length]={enunciado:"monitor_name",id:"00",local_alias:"monitor_name",respuesta:String(e.data_response.monitor.firstname)+" "+String(e.data_response.monitor.lastname)},s[o][Object.keys(s[o]).length]={enunciado:"practicing_name",id:"00",local_alias:"practicing_name",respuesta:String(e.data_response.practicing.firstname)+" "+String(e.data_response.practicing.lastname)},s[o][Object.keys(s[o]).length]={enunciado:"professional_name",id:"00",local_alias:"professional_name",respuesta:String(e.data_response.professional.firstname)+" "+String(e.data_response.professional.lastname)},s[o][Object.keys(s[o]).length]={enunciado:"created_by",id:"00",local_alias:"created_by",respuesta:String(e.data_response.created_by.firstname)+" "+String(e.data_response.created_by.lastname)};var a=e.data_response.student_username;a=a?e.data_response.student_username.split("-")[0]:"null",s[o][Object.keys(s[o]).length]={enunciado:"student_code",id:"00",local_alias:"student_code",respuesta:a},s[o][Object.keys(s[o]).length]={enunciado:"student_firstname",id:"00",local_alias:"student_firstname",respuesta:String(e.data_response.student.firstname)},s[o][Object.keys(s[o]).length]={enunciado:"student_lastname",id:"00",local_alias:"student_lastname",respuesta:String(e.data_response.student.lastname)}},failure:function(e){console.log(e)}});for(var l=Object.keys(s[o]).length-1;l>=0;l--)s[o][l+3]=e.extend(!0,{},s[o][l]);s[o][0]=e.extend(!0,{},s[o][Object.keys(s[o]).length-3]),s[o][1]=e.extend(!0,{},s[o][Object.keys(s[o]).length-2]),s[o][2]=e.extend(!0,{},s[o][Object.keys(s[o]).length-1]),delete s[o][Object.keys(s[o]).length-1],delete s[o][Object.keys(s[o]).length-1],delete s[o][Object.keys(s[o]).length-1],e("#progress-custom").find("div").width((100/r*(o+1)).toFixed(0)+"%"),e("#progress-custom").find("div").html((100/r*(o+1)).toFixed(0)+"%"),e("#progress-custom").find("div").attr("aria-valuenow",(100/r*(o+1)).toFixed(0))}return e("#progress-custom").find("div").addClass("progress-bar-success"),e("#message").removeClass("alert alert-info"),e("#message").addClass("alert alert-success"),e("#message").html("<strong>Info!</strong>  Reporte generado."),s}return e("#progress-custom").find("div").addClass("progress-bar-success"),e("#message").removeClass("alert alert-info"),e("#message").addClass("alert alert-success"),e("#message").html("<strong>Info!</strong>  Reporte generado."),s}function r(e){var s,a=function(e){var s,a,t,r,o,n;if(null==(n=e.data||null)||!n.length)return null;r=e.columnDelimiter||",",o=e.lineDelimiter||"\n",t=Object.keys(n[0]);for(var i=[],d=0;d<Object.keys(n[0]).length;d++)try{i.push(n[0][d].local_alias)}catch(e){console.log("ERROR"),console.log(n[0])}return s="",s+=i.join(r),s+=o,n.forEach(function(e){a=0,t.forEach(function(t){a>0&&(s+=r);try{s+='"'+e[t].respuesta.replace(/"/g,"'")+'"'}catch(e){}a++}),s+=o}),s}({data:e});if(null!=a&&("reporte.csv",csvData=new Blob([a],{type:"text/csv"}),void 0!==(s=document.createElement("a")).download)){var t=URL.createObjectURL(csvData);s.setAttribute("href",t),s.setAttribute("download","reporte.csv"),s.style="visibility:hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}e("#base_fields_check").on("change",function(){e("#base_fields_check").prop("checked")?e("#base_fields input[type='checkbox']").prop("checked",!0):e("#base_fields input[type='checkbox']").prop("checked",!1)}),e("#dimensions_fields_check").on("change",function(){e("#dimensions_fields_check").prop("checked")?e("#dimensions_fields input[type='checkbox']").prop("checked",!0):e("#dimensions_fields input[type='checkbox']").prop("checked",!1)}),e("#comments_fields_check").on("change",function(){e("#comments_fields_check").prop("checked")?e("#comments_fields input[type='checkbox']").prop("checked",!0):e("#comments_fields input[type='checkbox']").prop("checked",!1)}),e("#risks_fields_check").on("change",function(){e("#risks_fields_check").prop("checked")?e("#risks_fields input[type='checkbox']").prop("checked",!0):e("#risks_fields input[type='checkbox']").prop("checked",!1)}),e("#themes_fields_check").on("change",function(){e("#themes_fields_check").prop("checked")?e("#themes_fields input[type='checkbox']").prop("checked",!0):e("#themes_fields input[type='checkbox']").prop("checked",!1)}),e("#btn-generar-reporte").click(function(){var s=e("#start_date").val(),o=e("#end_date").val(),n=e("#code_student_dphpforms").val();if(s>=o)swal({title:"Información",text:"Intervalo de fechas inválido",type:"warning"},function(){});else if(n&&12!=n.length)swal({title:"Información",text:"Corroborar el código suministrado",type:"warning"},function(){});else{let d=e("#dphpforms-instance-id").data("instance-id");if(e.ajax({type:"POST",url:"../managers/periods_management/periods_api.php",data:JSON.stringify({function:"core_periods_get_period_by_date",params:[s,o,d]}),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){a=e.data_response},failure:function(e){}}),a&&!n){var i=JSON.parse(e("#dphpforms-reports-preguntas").html());let a=e("#dphpforms-instance-id").data("instance-id");e(".progress-bar").removeClass("progress-bar-success"),e(".progress-bar").removeClass("progress-bar-success"),e(".progress-bar").width("0%"),e(".progress-bar").html("0%"),e(".progress-bar").attr("aria-valuenow","0"),e("#progress_group").css("display","block"),e("#progress_group").removeClass("hidden"),e("#message").removeClass("alert alert-success"),e("#message").addClass("alert alert-info"),e("#message").html("<strong>Info!</strong> Se está generando el reporte, esto puede tardar un par de minutos dependiendo de su conexión a internet, capacidad del ordenador, intervalo de tiempo seleccionado y rapidez del campus virtual."),e.ajax({type:"POST",url:"../managers/dphpforms/v2/dphpforms_api.php",data:JSON.stringify({function:"find_records",params:[{form:"seguimiento_pares",filterFields:[["fecha",[[s,">="],[o,"<="]],!1],["id_instancia",[[a,"LIKE"]],!1]],orderFields:[],orderByDatabaseRecordDate:!1,recordStatus:["!deleted"],selectedFields:[],asFields:[]}]}),contentType:"aplication/json",dataType:"json",cache:"false",success:function(s){let a=Object.keys(s.data_response).length,o=[],n=0;for(var d=0;d<a;d++)e.get("../managers/dphpforms/dphpforms_get_record.php?record_id="+s.data_response[d].id_registro,function(s){if(Object.keys(s.record).length>0){for(var d=e.extend(!0,{},i),c=0;c<Object.keys(s.record.campos).length;c++)for(var l=0;l<Object.keys(d).length;l++)d[l].id==parseInt(s.record.campos[c].id_pregunta)&&(d[l].respuesta=s.record.campos[c].respuesta);o.push(d)}n++,e("#progress-download").find("div").width((100/a*n).toFixed(0)+"%"),e("#progress-download").find("div").html((100/a*n).toFixed(0)+"%"),e("#progress-download").find("div").attr("aria-valuenow",(100/a*n).toFixed(0)),n==a&&(e("#progress-download").find("div").addClass("progress-bar-success"),setTimeout(function(){r(t(o,"seguimiento_pares"))},10))}).fail(function(e){console.log(e)}),e("#progress").text(Math.round(n));0==a&&(e("#progress").text(100),e("#message").removeClass("alert alert-info"),e("#message").addClass("alert alert-success"),e("#message").html("<strong>Info!</strong>  Reporte generado."),e("#progress_group").addClass("hidden"))},error:function(e){}})}else if(a&&n){i=JSON.parse(e("#dphpforms-reports-preguntas").html());let a=e("#dphpforms-instance-id").data("instance-id");e(".progress-bar").removeClass("progress-bar-success"),e(".progress-bar").removeClass("progress-bar-success"),e(".progress-bar").width("0%"),e(".progress-bar").html("0%"),e(".progress-bar").attr("aria-valuenow","0"),e("#progress_group").css("display","block"),e("#progress_group").removeClass("hidden"),e("#message").removeClass("alert alert-success"),e("#message").addClass("alert alert-info"),e("#message").html("<strong>Info!</strong> Se está generando el reporte, esto puede tardar un par de minutos dependiendo de su conexión a internet, capacidad del ordenador, intervalo de tiempo seleccionado y rapidez del campus virtual."),e.ajax({type:"POST",url:"../managers/dphpforms/v2/dphpforms_api.php",data:JSON.stringify({function:"find_records",params:[{form:"seguimiento_pares",filterFields:[["fecha",[[s,">="],[o,"<="]],!1],["id_instancia",[[a,"LIKE"]],!1],["username",[[n,"LIKE"]],!1]],orderFields:[],orderByDatabaseRecordDate:!1,recordStatus:["!deleted"],selectedFields:[],asFields:[]}]}),contentType:"aplication/json",dataType:"json",cache:"false",success:function(s){let a=Object.keys(s.data_response).length,o=[],n=0;for(var d=0;d<a;d++)e.get("../managers/dphpforms/dphpforms_get_record.php?record_id="+s.data_response[d].id_registro,function(s){if(Object.keys(s.record).length>0){for(var d=e.extend(!0,{},i),c=0;c<Object.keys(s.record.campos).length;c++)for(var l=0;l<Object.keys(d).length;l++)d[l].id==parseInt(s.record.campos[c].id_pregunta)&&(d[l].respuesta=s.record.campos[c].respuesta);o.push(d)}n++,e("#progress-download").find("div").width((100/a*n).toFixed(0)+"%"),e("#progress-download").find("div").html((100/a*n).toFixed(0)+"%"),e("#progress-download").find("div").attr("aria-valuenow",(100/a*n).toFixed(0)),n==a&&(e("#progress-download").find("div").addClass("progress-bar-success"),setTimeout(function(){r(t(o,"seguimiento_pares"))},10))}).fail(function(e){console.log(e)}),e("#progress").text(Math.round(n));0==a&&(e("#progress").text(100),e("#message").removeClass("alert alert-info"),e("#message").addClass("alert alert-success"),e("#message").html("<strong>Info!</strong>  Reporte generado."),e("#progress_group").addClass("hidden"))},error:function(e){}})}else swal({title:"Información",text:"Las fechas deben estar en el lapso de tiempo que comprende un periodo académico. ",type:"error"},function(){})}})}}});