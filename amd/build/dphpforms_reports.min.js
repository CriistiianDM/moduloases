define ("block_ases/dphpforms_reports",["jquery","block_ases/jszip","block_ases/jquery.dataTables","block_ases/dataTables.autoFill","block_ases/dataTables.buttons","block_ases/buttons.html5","block_ases/buttons.flash","block_ases/buttons.print","block_ases/bootstrap","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2"],function(a,b){return{init:function init(){var f=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if(!f){a("#container-control").find("*").prop("disabled",!0);a("#container-msg-chrome").fadeIn(300)}window.JSZip=b;var g=null;a("#base_fields_check").on("change",function(){if(a("#base_fields_check").prop("checked")){a("#base_fields input[type='checkbox']").prop("checked",!0)}else{a("#base_fields input[type='checkbox']").prop("checked",!1)}});a("#dimensions_fields_check").on("change",function(){if(a("#dimensions_fields_check").prop("checked")){a("#dimensions_fields input[type='checkbox']").prop("checked",!0)}else{a("#dimensions_fields input[type='checkbox']").prop("checked",!1)}});a("#comments_fields_check").on("change",function(){if(a("#comments_fields_check").prop("checked")){a("#comments_fields input[type='checkbox']").prop("checked",!0)}else{a("#comments_fields input[type='checkbox']").prop("checked",!1)}});a("#risks_fields_check").on("change",function(){if(a("#risks_fields_check").prop("checked")){a("#risks_fields input[type='checkbox']").prop("checked",!0)}else{a("#risks_fields input[type='checkbox']").prop("checked",!1)}});a("#themes_fields_check").on("change",function(){if(a("#themes_fields_check").prop("checked")){a("#themes_fields input[type='checkbox']").prop("checked",!0)}else{a("#themes_fields input[type='checkbox']").prop("checked",!1)}});function c(b,c){if("seguimiento_pares"==c){for(var d=b.length,e=0;e<d;e++){for(var f=null,h=null,i=0;i<Object.keys(b[e]).length;i++){if("-#$%-"==b[e][i].respuesta){b[e][i].respuesta=""}if("puntuacion_riesgo_individual"==b[e][i].local_alias||"puntuacion_riesgo_familiar"==b[e][i].local_alias||"puntuacion_riesgo_academico"==b[e][i].local_alias||"puntuacion_riesgo_economico"==b[e][i].local_alias||"puntuacion_vida_uni"==b[e][i].local_alias){if("1"==b[e][i].respuesta){b[e][i].respuesta="bajo"}else if("2"==b[e][i].respuesta){b[e][i].respuesta="medio"}else if("3"==b[e][i].respuesta){b[e][i].respuesta="alto"}}if("revisado_profesional"==b[e][i].local_alias){if("0"==b[e][i].respuesta){b[e][i].respuesta="marcado"}else if("-1"==b[e][i].respuesta){b[e][i].respuesta="no_marcado"}}if("revisado_practicante"==b[e][i].local_alias){if("0"==b[e][i].respuesta){b[e][i].respuesta="marcado"}else if("-1"==b[e][i].respuesta){b[e][i].respuesta="no_marcado"}}if(!f||!h){if("id_estudiante"==b[e][i].local_alias){f=b[e][i].respuesta}if("id_creado_por"==b[e][i].local_alias){h=b[e][i].respuesta}}}var j=parseInt(a("#dphpforms-instance-id").data("instance-id"));a.ajax({type:"POST",url:"../managers/user_management/user_management_api.php",data:JSON.stringify({function:"get_crea_stud_mon_prac_prof",params:[f,h,j,g]}),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function success(a){b[e][Object.keys(b[e]).length]={enunciado:"monitor_name",id:"00",local_alias:"monitor_name",respuesta:a.data_response.monitor.firstname+""+" "+(a.data_response.monitor.lastname+"")};b[e][Object.keys(b[e]).length]={enunciado:"practicing_name",id:"00",local_alias:"practicing_name",respuesta:a.data_response.practicing.firstname+""+" "+(a.data_response.practicing.lastname+"")};b[e][Object.keys(b[e]).length]={enunciado:"professional_name",id:"00",local_alias:"professional_name",respuesta:a.data_response.professional.firstname+""+" "+(a.data_response.professional.lastname+"")};b[e][Object.keys(b[e]).length]={enunciado:"created_by",id:"00",local_alias:"created_by",respuesta:a.data_response.created_by.firstname+""+" "+(a.data_response.created_by.lastname+"")};var c=a.data_response.student_username;if(c){c=a.data_response.student_username.split("-")[0]}else{c="null"}b[e][Object.keys(b[e]).length]={enunciado:"student_code",id:"00",local_alias:"student_code",respuesta:c};b[e][Object.keys(b[e]).length]={enunciado:"student_firstname",id:"00",local_alias:"student_firstname",respuesta:a.data_response.student.firstname+""};b[e][Object.keys(b[e]).length]={enunciado:"student_lastname",id:"00",local_alias:"student_lastname",respuesta:a.data_response.student.lastname+""}},failure:function failure(a){console.log(a)}});for(var l=Object.keys(b[e]).length-1;0<=l;l--){b[e][l+3]=a.extend(!0,{},b[e][l])}b[e][0]=a.extend(!0,{},b[e][Object.keys(b[e]).length-3]);b[e][1]=a.extend(!0,{},b[e][Object.keys(b[e]).length-2]);b[e][2]=a.extend(!0,{},b[e][Object.keys(b[e]).length-1]);delete b[e][Object.keys(b[e]).length-1];delete b[e][Object.keys(b[e]).length-1];delete b[e][Object.keys(b[e]).length-1];a("#progress-custom").find("div").width((100/d*(e+1)).toFixed(0)+"%");a("#progress-custom").find("div").html((100/d*(e+1)).toFixed(0)+"%");a("#progress-custom").find("div").attr("aria-valuenow",(100/d*(e+1)).toFixed(0))}a("#progress-custom").find("div").addClass("progress-bar-success");a("#message").removeClass("alert alert-info");a("#message").addClass("alert alert-success");a("#message").html("<strong>Info!</strong>  Reporte generado.");return b}else{a("#progress-custom").find("div").addClass("progress-bar-success");a("#message").removeClass("alert alert-info");a("#message").addClass("alert alert-success");a("#message").html("<strong>Info!</strong>  Reporte generado.");return b}}function d(a){var b,c,d,e,f,g;g=a.data||null;if(null==g||!g.length){return null}e=a.columnDelimiter||",";f=a.lineDelimiter||"\n";d=Object.keys(g[0]);for(var h=[],i=0;i<Object.keys(g[0]).length;i++){try{h.push(g[0][i].local_alias)}catch(a){console.log("ERROR");console.log(g[0])}}b="";b+=h.join(e);b+=f;g.forEach(function(a){c=0;d.forEach(function(d){if(0<c)b+=e;try{b+="\""+a[d].respuesta.replace(/"/g,"'")+"\""}catch(a){}c++});b+=f});return b}function e(a){var b,c,e=d({data:a});if(null==e){return}b="reporte.csv";csvData=new Blob([e],{type:"text/csv"});var c=document.createElement("a");if(c.download!==void 0){var f=URL.createObjectURL(csvData);c.setAttribute("href",f);c.setAttribute("download",b);c.style="visibility:hidden";document.body.appendChild(c);c.click();document.body.removeChild(c)}}a("#btn-generar-reporte").click(function(){var b=a("#start_date").val(),d=a("#end_date").val();if(b>=d){swal({title:"Informaci\xF3n",text:"Intervalo de fechas inv\xE1lido",type:"warning"},function(){})}else{a.ajax({type:"POST",url:"../managers/periods_management/periods_api.php",data:JSON.stringify({function:"core_periods_get_period_by_date",params:[b,d]}),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function success(a){g=a.data_response},failure:function failure(){}});if(g){var f=JSON.parse(a("#dphpforms-reports-preguntas").html()),h=a("#dphpforms-instance-id").data("instance-id");a(".progress-bar").removeClass("progress-bar-success");a(".progress-bar").removeClass("progress-bar-success");a(".progress-bar").width("0%");a(".progress-bar").html("0%");a(".progress-bar").attr("aria-valuenow","0");a("#progress_group").css("display","block");a("#progress_group").removeClass("hidden");a("#message").removeClass("alert alert-success");a("#message").addClass("alert alert-info");a("#message").html("<strong>Info!</strong> Se est\xE1 generando el reporte, esto puede tardar un par de minutos dependiendo de su conexi\xF3n a internet, capacidad del ordenador, intervalo de tiempo seleccionado y rapidez del campus virtual.");a.ajax({type:"POST",url:"../managers/dphpforms/v2/dphpforms_api.php",data:JSON.stringify({function:"find_records",params:[{form:"seguimiento_pares",filterFields:[["fecha",[[b,">="],[d,"<="]],!1],["id_instancia",[[h,"LIKE"]],!1]],orderFields:[],orderByDatabaseRecordDate:!1,recordStatus:["!deleted"],selectedFields:[],asFields:[]}]}),contentType:"aplication/json",dataType:"json",cache:"false",success:function success(b){for(var d=Object.keys(b.data_response).length,g=[],h=0,i=0;i<d;i++){a.get("../managers/dphpforms/dphpforms_get_record.php?record_id="+b.data_response[i].id_registro,function(b){if(0<Object.keys(b.record).length){for(var i=a.extend(!0,{},f),j=0;j<Object.keys(b.record.campos).length;j++){for(var l=0;l<Object.keys(i).length;l++){if(i[l].id==parseInt(b.record.campos[j].id_pregunta)){i[l].respuesta=b.record.campos[j].respuesta}}}g.push(i)}h++;a("#progress-download").find("div").width((100/d*h).toFixed(0)+"%");a("#progress-download").find("div").html((100/d*h).toFixed(0)+"%");a("#progress-download").find("div").attr("aria-valuenow",(100/d*h).toFixed(0));if(h==d){a("#progress-download").find("div").addClass("progress-bar-success");setTimeout(function(){var a=c(g,"seguimiento_pares");e(a)},10)}}).fail(function(a){console.log(a)});a("#progress").text(Math.round(h))}if(0==d){a("#progress").text(100);a("#message").removeClass("alert alert-info");a("#message").addClass("alert alert-success");a("#message").html("<strong>Info!</strong>  Reporte generado.");a("#progress_group").addClass("hidden")}},error:function error(){}})}else{swal({title:"Informaci\xF3n",text:"Las fechas deben estar en el lapso de tiempo que comprende un periodo acad\xE9mico. ",type:"error"},function(){})}}})}}});
//# sourceMappingURL=dphpforms_reports.min.js.map
