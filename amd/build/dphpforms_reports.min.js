'use strict';define(['jquery','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a){return{init:function init(){function f(j,k){for(var l=0;l<j.length;l++)if(j[l]==k)return!0;return!1}function g(j){var k,l,m,n,o,p;return(p=j.data||null,null==p||!p.length)?null:(n=j.columnDelimiter||',',o=j.lineDelimiter||'\n',m=Object.keys(p[0]),k='',k+=m.join(n),k+=o,p.forEach(function(q){l=0,m.forEach(function(r){0<l&&(k+=n),k+='"'+q[r].respuesta+'"',l++}),k+=o}),k)}function h(j){var k,l,m=g({data:j});if(null!=m){k='reporte.csv',csvData=new Blob([m],{type:'text/csv'});var l=document.createElement('a');if(void 0!==l.download){var n=URL.createObjectURL(csvData);l.setAttribute('href',n),l.setAttribute('download',k),l.style='visibility:hidden',document.body.appendChild(l),l.click(),document.body.removeChild(l)}}}a('#btn-generar-reporte').click(function(){var j=a('#start_date').val(),k=a('#end_date').val();j>=k?swal({title:'Informaci\xF3n',text:'Intervalo de fechas inv\xE1lido',type:'warning'},function(){}):(a('#progress_group').css('display','block'),a('#progress').text('Espere, esto puede tardar un par de minutos dependiendo de su red y ordenador...'),a.get('../managers/dphpforms/dphpforms_reverse_filter.php?id_pregunta=seguimiento_pares_fecha&cast=date&criterio={"criteria":[{"operator":">=","value":"'+j+'"},{"operator":"<=","value":"'+k+'"}]}',function(l){for(var m=Object.keys(l.results).length,n=[],o=0,p=[],q=0;q<m;q++)a.get('../managers/dphpforms/dphpforms_reverse_finder.php?respuesta_id='+l.results[q].id,function(r){a.get('../managers/dphpforms/dphpforms_get_record.php?record_id='+r.result.id_registro,function(s){var t=[];if(0<Object.keys(s.record).length){for(var u=0;u<Object.keys(s.record.campos).length;u++)t[parseInt(s.record.campos[u].id_pregunta)]={enunciado:s.record.campos[u].enunciado,respuesta:s.record.campos[u].respuesta},f(p,parseInt(s.record.campos[u].id_pregunta))||p.push(parseInt(s.record.campos[u].id_pregunta));n.push(t)}o++,a('#progress').text((100/m*o).toFixed(2)+'%'),o==m&&h(n)}).fail(function(s){console.log(s)})}),a('#progress').text(Math.round(o));0==m&&a('#progress').text(100)}))})}}});
