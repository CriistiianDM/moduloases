'use strict';define(['jquery','block_ases/jszip','block_ases/jquery.dataTables','block_ases/dataTables.autoFill','block_ases/dataTables.buttons','block_ases/buttons.html5','block_ases/buttons.flash','block_ases/buttons.print','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a,b){return{init:function init(){function p(u,v){if('seguimiento_pares'==v){for(var w=u.length,z=0;z<w;z++){for(var C=null,D=null,F=0;F<Object.keys(u[z]).length;F++)'-#$%-'==u[z][F].respuesta&&(u[z][F].respuesta=''),('puntuacion_riesgo_individual'==u[z][F].local_alias||'puntuacion_riesgo_familiar'==u[z][F].local_alias||'puntuacion_riesgo_academico'==u[z][F].local_alias||'puntuacion_riesgo_economico'==u[z][F].local_alias||'puntuacion_vida_uni'==u[z][F].local_alias)&&('1'==u[z][F].respuesta?u[z][F].respuesta='bajo':'2'==u[z][F].respuesta?u[z][F].respuesta='medio':'3'==u[z][F].respuesta&&(u[z][F].respuesta='alto')),'revisado_profesional'==u[z][F].local_alias&&('0'==u[z][F].respuesta?u[z][F].respuesta='marcado':'-1'==u[z][F].respuesta&&(u[z][F].respuesta='no_marcado')),'revisado_practicante'==u[z][F].local_alias&&('0'==u[z][F].respuesta?u[z][F].respuesta='marcado':'-1'==u[z][F].respuesta&&(u[z][F].respuesta='no_marcado')),C&&D||('id_estudiante'==u[z][F].local_alias&&(C=u[z][F].respuesta),'id_creado_por'==u[z][F].local_alias&&(D=u[z][F].respuesta));var G=parseInt(a('#dphpforms-instance-id').data('instance-id'));a.ajax({type:'POST',url:'../managers/user_management/user_management_api.php',data:JSON.stringify({'function':'get_crea_stud_mon_prac_prof',params:[C,D,G,s]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(J){u[z][Object.keys(u[z]).length]={enunciado:'monitor_name',id:'00',local_alias:'monitor_name',respuesta:J.data_response.monitor.firstname+' '+(J.data_response.monitor.lastname+'')},u[z][Object.keys(u[z]).length]={enunciado:'practicing_name',id:'00',local_alias:'practicing_name',respuesta:J.data_response.practicing.firstname+' '+(J.data_response.practicing.lastname+'')},u[z][Object.keys(u[z]).length]={enunciado:'professional_name',id:'00',local_alias:'professional_name',respuesta:J.data_response.professional.firstname+' '+(J.data_response.professional.lastname+'')},u[z][Object.keys(u[z]).length]={enunciado:'created_by',id:'00',local_alias:'created_by',respuesta:J.data_response.created_by.firstname+' '+(J.data_response.created_by.lastname+'')};var K=J.data_response.student_username;K=K?J.data_response.student_username.split('-')[0]:'null',u[z][Object.keys(u[z]).length]={enunciado:'student_code',id:'00',local_alias:'student_code',respuesta:K},u[z][Object.keys(u[z]).length]={enunciado:'student_firstname',id:'00',local_alias:'student_firstname',respuesta:J.data_response.student.firstname+''},u[z][Object.keys(u[z]).length]={enunciado:'student_lastname',id:'00',local_alias:'student_lastname',respuesta:J.data_response.student.lastname+''}},failure:function failure(J){console.log(J)}});for(var I=Object.keys(u[z]).length-1;0<=I;I--)u[z][I+3]=a.extend(!0,{},u[z][I]);u[z][0]=a.extend(!0,{},u[z][Object.keys(u[z]).length-3]),u[z][1]=a.extend(!0,{},u[z][Object.keys(u[z]).length-2]),u[z][2]=a.extend(!0,{},u[z][Object.keys(u[z]).length-1]),delete u[z][Object.keys(u[z]).length-1],delete u[z][Object.keys(u[z]).length-1],delete u[z][Object.keys(u[z]).length-1],a('#progress-custom').find('div').width((100/w*(z+1)).toFixed(0)+'%'),a('#progress-custom').find('div').html((100/w*(z+1)).toFixed(0)+'%'),a('#progress-custom').find('div').attr('aria-valuenow',(100/w*(z+1)).toFixed(0))}return a('#progress-custom').find('div').addClass('progress-bar-success'),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),u}return a('#progress-custom').find('div').addClass('progress-bar-success'),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),u}function q(u){var v,w,z,A,B,C;if(C=u.data||null,null==C||!C.length)return null;A=u.columnDelimiter||',',B=u.lineDelimiter||'\n',z=Object.keys(C[0]);for(var D=[],E=0;E<Object.keys(C[0]).length;E++)try{D.push(C[0][E].local_alias)}catch(F){console.log('ERROR'),console.log(C[0])}return v='',v+=D.join(A),v+=B,C.forEach(function(F){w=0,z.forEach(function(G){0<w&&(v+=A);try{v+='"'+F[G].respuesta.replace(/"/g,'\'')+'"'}catch(H){}w++}),v+=B}),v}function r(u){var v,w,z=q({data:u});if(null!=z){v='reporte.csv',csvData=new Blob([z],{type:'text/csv'});var w=document.createElement('a');if(void 0!==w.download){var A=URL.createObjectURL(csvData);w.setAttribute('href',A),w.setAttribute('download',v),w.style='visibility:hidden',document.body.appendChild(w),w.click(),document.body.removeChild(w)}}}window.JSZip=b;var s=null;a('#btn-generar-reporte').click(function(){var u=a('#start_date').val(),v=a('#end_date').val();if(u>=v)swal({title:'Informaci\xF3n',text:'Intervalo de fechas inv\xE1lido',type:'warning'},function(){});else if(a.ajax({type:'POST',url:'../managers/periods_management/periods_api.php',data:JSON.stringify({'function':'get_current_semester_by_apprx_interval',params:[u,v]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(z){s=z.data_response},failure:function failure(){}}),s){var w=JSON.parse(a('#dphpforms-reports-preguntas').html());a('.progress-bar').removeClass('progress-bar-success'),a('.progress-bar').removeClass('progress-bar-success'),a('.progress-bar').width('0%'),a('.progress-bar').html('0%'),a('.progress-bar').attr('aria-valuenow','0'),a('#progress_group').css('display','block'),a('#message').removeClass('alert alert-success'),a('#message').addClass('alert alert-info'),a('#message').html('<strong>Info!</strong> Se est\xE1 generando el reporte, esto puede tardar un par de minutos dependiendo de su conexi\xF3n a internet, capacidad del ordenador y rapidez del campus virtual.'),a.get('../managers/dphpforms/dphpforms_reverse_filter.php?id_pregunta=seguimiento_pares_fecha&cast=date&criterio={"criteria":[{"operator":">=","value":"'+u+'"},{"operator":"<=","value":"'+v+'"}]}',function(z){for(var A=Object.keys(z.results).length,B=[],D=0,E=0;E<A;E++)a.get('../managers/dphpforms/dphpforms_reverse_finder.php?respuesta_id='+z.results[E].id,function(F){a.get('../managers/dphpforms/dphpforms_get_record.php?record_id='+F.result.id_registro,function(G){if(0<Object.keys(G.record).length){for(var H=a.extend(!0,{},w),I=0;I<Object.keys(G.record.campos).length;I++)for(var J=0;J<Object.keys(H).length;J++)H[J].id==parseInt(G.record.campos[I].id_pregunta)&&(H[J].respuesta=G.record.campos[I].respuesta);B.push(H)}if(D++,a('#progress-download').find('div').width((100/A*D).toFixed(0)+'%'),a('#progress-download').find('div').html((100/A*D).toFixed(0)+'%'),a('#progress-download').find('div').attr('aria-valuenow',(100/A*D).toFixed(0)),D==A){a('#progress-download').find('div').addClass('progress-bar-success');var K=p(B,'seguimiento_pares');r(K)}}).fail(function(G){console.log(G)})}),a('#progress').text(Math.round(D));0==A&&(a('#progress').text(100),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'))})}else swal({title:'Informaci\xF3n',text:'Las fechas deben estar en el lapso de tiempo que comprende un periodo acad\xE9mico. ',type:'error'},function(){})})}}});