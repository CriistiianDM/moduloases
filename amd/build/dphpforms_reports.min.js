'use strict';define(['jquery','block_ases/jszip','block_ases/jquery.dataTables','block_ases/dataTables.autoFill','block_ases/dataTables.buttons','block_ases/buttons.html5','block_ases/buttons.flash','block_ases/buttons.print','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a,b){return{init:function init(){function p(v,w){if('seguimiento_pares'==w){for(var z=v.length,A=0;A<z;A++){for(var D=null,E=null,G=0;G<Object.keys(v[A]).length;G++)'-#$%-'==v[A][G].respuesta&&(v[A][G].respuesta=''),('puntuacion_riesgo_individual'==v[A][G].local_alias||'puntuacion_riesgo_familiar'==v[A][G].local_alias||'puntuacion_riesgo_academico'==v[A][G].local_alias||'puntuacion_riesgo_economico'==v[A][G].local_alias||'puntuacion_vida_uni'==v[A][G].local_alias)&&('1'==v[A][G].respuesta?v[A][G].respuesta='bajo':'2'==v[A][G].respuesta?v[A][G].respuesta='medio':'3'==v[A][G].respuesta&&(v[A][G].respuesta='alto')),'revisado_profesional'==v[A][G].local_alias&&('0'==v[A][G].respuesta?v[A][G].respuesta='marcado':'-1'==v[A][G].respuesta&&(v[A][G].respuesta='no_marcado')),'revisado_practicante'==v[A][G].local_alias&&('0'==v[A][G].respuesta?v[A][G].respuesta='marcado':'-1'==v[A][G].respuesta&&(v[A][G].respuesta='no_marcado')),D&&E||('id_estudiante'==v[A][G].local_alias&&(D=v[A][G].respuesta),'id_creado_por'==v[A][G].local_alias&&(E=v[A][G].respuesta));var H=parseInt(a('#dphpforms-instance-id').data('instance-id'));a.ajax({type:'POST',url:'../managers/user_management/user_management_api.php',data:JSON.stringify({'function':'get_crea_stud_mon_prac_prof',params:[D,E,H,u]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(K){v[A][Object.keys(v[A]).length]={enunciado:'monitor_name',id:'00',local_alias:'monitor_name',respuesta:K.data_response.monitor.firstname+' '+(K.data_response.monitor.lastname+'')},v[A][Object.keys(v[A]).length]={enunciado:'practicing_name',id:'00',local_alias:'practicing_name',respuesta:K.data_response.practicing.firstname+' '+(K.data_response.practicing.lastname+'')},v[A][Object.keys(v[A]).length]={enunciado:'professional_name',id:'00',local_alias:'professional_name',respuesta:K.data_response.professional.firstname+' '+(K.data_response.professional.lastname+'')},v[A][Object.keys(v[A]).length]={enunciado:'created_by',id:'00',local_alias:'created_by',respuesta:K.data_response.created_by.firstname+' '+(K.data_response.created_by.lastname+'')};var L=K.data_response.student_username;L=L?K.data_response.student_username.split('-')[0]:'null',v[A][Object.keys(v[A]).length]={enunciado:'student_code',id:'00',local_alias:'student_code',respuesta:L},v[A][Object.keys(v[A]).length]={enunciado:'student_firstname',id:'00',local_alias:'student_firstname',respuesta:K.data_response.student.firstname+''},v[A][Object.keys(v[A]).length]={enunciado:'student_lastname',id:'00',local_alias:'student_lastname',respuesta:K.data_response.student.lastname+''}},failure:function failure(K){console.log(K)}});for(var J=Object.keys(v[A]).length-1;0<=J;J--)v[A][J+3]=a.extend(!0,{},v[A][J]);v[A][0]=a.extend(!0,{},v[A][Object.keys(v[A]).length-3]),v[A][1]=a.extend(!0,{},v[A][Object.keys(v[A]).length-2]),v[A][2]=a.extend(!0,{},v[A][Object.keys(v[A]).length-1]),delete v[A][Object.keys(v[A]).length-1],delete v[A][Object.keys(v[A]).length-1],delete v[A][Object.keys(v[A]).length-1],a('#progress-custom').find('div').width((100/z*(A+1)).toFixed(0)+'%'),a('#progress-custom').find('div').html((100/z*(A+1)).toFixed(0)+'%'),a('#progress-custom').find('div').attr('aria-valuenow',(100/z*(A+1)).toFixed(0))}return a('#progress-custom').find('div').addClass('progress-bar-success'),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),v}return a('#progress-custom').find('div').addClass('progress-bar-success'),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),v}function q(v){var w,z,A,B,C,D;if(D=v.data||null,null==D||!D.length)return null;B=v.columnDelimiter||',',C=v.lineDelimiter||'\n',A=Object.keys(D[0]);for(var E=[],F=0;F<Object.keys(D[0]).length;F++)try{E.push(D[0][F].local_alias)}catch(G){console.log('ERROR'),console.log(D[0])}return w='',w+=E.join(B),w+=C,D.forEach(function(G){z=0,A.forEach(function(H){0<z&&(w+=B);try{w+='"'+G[H].respuesta.replace(/"/g,'\'')+'"'}catch(I){}z++}),w+=C}),w}function r(v){var w,z,A=q({data:v});if(null!=A){w='reporte.csv',csvData=new Blob([A],{type:'text/csv'});var z=document.createElement('a');if(void 0!==z.download){var B=URL.createObjectURL(csvData);z.setAttribute('href',B),z.setAttribute('download',w),z.style='visibility:hidden',document.body.appendChild(z),z.click(),document.body.removeChild(z)}}}var s=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);s||(a('#container-control').find('*').prop('disabled',!0),a('#container-msg-chrome').fadeIn(300)),window.JSZip=b;var u=null;a('#base_fields_check').on('change',function(){a('#base_fields_check').prop('checked')?a('#base_fields input[type=\'checkbox\']').prop('checked',!0):a('#base_fields input[type=\'checkbox\']').prop('checked',!1)}),a('#dimensions_fields_check').on('change',function(){a('#dimensions_fields_check').prop('checked')?a('#dimensions_fields input[type=\'checkbox\']').prop('checked',!0):a('#dimensions_fields input[type=\'checkbox\']').prop('checked',!1)}),a('#comments_fields_check').on('change',function(){a('#comments_fields_check').prop('checked')?a('#comments_fields input[type=\'checkbox\']').prop('checked',!0):a('#comments_fields input[type=\'checkbox\']').prop('checked',!1)}),a('#risks_fields_check').on('change',function(){a('#risks_fields_check').prop('checked')?a('#risks_fields input[type=\'checkbox\']').prop('checked',!0):a('#risks_fields input[type=\'checkbox\']').prop('checked',!1)}),a('#themes_fields_check').on('change',function(){a('#themes_fields_check').prop('checked')?a('#themes_fields input[type=\'checkbox\']').prop('checked',!0):a('#themes_fields input[type=\'checkbox\']').prop('checked',!1)});a('#btn-generar-reporte').click(function(){var v=a('#start_date').val(),w=a('#end_date').val();if(v>=w)swal({title:'Informaci\xF3n',text:'Intervalo de fechas inv\xE1lido',type:'warning'},function(){});else if(a.ajax({type:'POST',url:'../managers/periods_management/periods_api.php',data:JSON.stringify({'function':'get_current_semester_by_apprx_interval',params:[v,w]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(B){u=B.data_response},failure:function failure(){}}),u){var z=JSON.parse(a('#dphpforms-reports-preguntas').html()),A=a('#dphpforms-instance-id').data('instance-id');a('.progress-bar').removeClass('progress-bar-success'),a('.progress-bar').removeClass('progress-bar-success'),a('.progress-bar').width('0%'),a('.progress-bar').html('0%'),a('.progress-bar').attr('aria-valuenow','0'),a('#progress_group').css('display','block'),a('#progress_group').removeClass('hidden'),a('#message').removeClass('alert alert-success'),a('#message').addClass('alert alert-info'),a('#message').html('<strong>Info!</strong> Se est\xE1 generando el reporte, esto puede tardar un par de minutos dependiendo de su conexi\xF3n a internet, capacidad del ordenador, intervalo de tiempo seleccionado y rapidez del campus virtual.'),a.ajax({type:'POST',url:'../managers/dphpforms/v2/dphpforms_api.php',data:JSON.stringify({'function':'find_records',params:[{form:'seguimiento_pares',filterFields:[['fecha',[[v,'>='],[w,'<=']],!1],['id_instancia',[[A,'LIKE']],!1]],orderFields:[],orderByDatabaseRecordDate:!1,recordStatus:['!deleted'],selectedFields:[],asFields:[]}]}),contentType:'aplication/json',dataType:'json',cache:'false',success:function success(B){for(var D=Object.keys(B.data_response).length,E=[],G=0,C=0;C<D;C++)a.get('../managers/dphpforms/dphpforms_get_record.php?record_id='+B.data_response[C].id_registro,function(H){if(0<Object.keys(H.record).length){for(var I=a.extend(!0,{},z),J=0;J<Object.keys(H.record.campos).length;J++)for(var K=0;K<Object.keys(I).length;K++)I[K].id==parseInt(H.record.campos[J].id_pregunta)&&(I[K].respuesta=H.record.campos[J].respuesta);E.push(I)}G++,a('#progress-download').find('div').width((100/D*G).toFixed(0)+'%'),a('#progress-download').find('div').html((100/D*G).toFixed(0)+'%'),a('#progress-download').find('div').attr('aria-valuenow',(100/D*G).toFixed(0)),G==D&&(a('#progress-download').find('div').addClass('progress-bar-success'),setTimeout(function(){var L=p(E,'seguimiento_pares');r(L)},10))}).fail(function(H){console.log(H)}),a('#progress').text(Math.round(G));0==D&&(a('#progress').text(100),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),a('#progress_group').addClass('hidden'))},error:function error(){}})}else swal({title:'Informaci\xF3n',text:'Las fechas deben estar en el lapso de tiempo que comprende un periodo acad\xE9mico. ',type:'error'},function(){})})}}});