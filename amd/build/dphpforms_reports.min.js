define(['jquery','block_ases/jszip','block_ases/jquery.dataTables','block_ases/dataTables.autoFill','block_ases/dataTables.buttons','block_ases/buttons.html5','block_ases/buttons.flash','block_ases/buttons.print','block_ases/bootstrap','block_ases/sweetalert','block_ases/jqueryui','block_ases/select2'],function(a,b){return{init:function init(){function n(u){var v=o(u),z=[{title:'C\xF3digo estudiante',name:'student_code',data:'student_code'},{title:'Nombre(s)',name:'student_firstname',data:'student_firstname'},{title:'Apellido(s)',name:'student_lastname',data:'student_lastname'},{title:'Fecha',name:'fecha',data:'fecha'},{title:'Lugar',name:'lugar',data:'lugar'},{title:'Hora Inicio',name:'hora_inicio',data:'hora_inicio'},{title:'Hora Finalizacion',name:'hora_finalizacion',data:'hora_finalizacion'},{title:'Tema',name:'tema',data:'tema'},{'class':'big-col',title:'Objetivos',name:'objetivos',data:'objetivos'},{'class':'big-col',title:'Comentario individual',name:'comentarios_individual',data:'comentarios_individual'},{title:'Punt. riesgo individual',name:'puntuacion_riesgo_individual',data:'puntuacion_riesgo_individual'},{title:'Tem\xE1ticas individuales',name:'tematicas_individual',data:'tematicas_individual'},{'class':'big-col',title:'Comentario familiar',name:'comentarios_familiar',data:'comentarios_familiar'},{title:'Punt. riesgo familiar',name:'puntuacion_riesgo_familiar',data:'puntuacion_riesgo_familiar'},{title:'Tem\xE1ticas familiar',name:'tematicas_familiar',data:'tematicas_familiar'},{'class':'big-col',title:'Comentario acad\xE9mico',name:'comentarios_academico',data:'comentarios_academico'},{title:'Punt. riesgo acad\xE9mico',name:'puntuacion_riesgo_academico',data:'puntuacion_riesgo_academico'},{title:'Tem\xE1ticas acad\xE9mico',name:'tematicas_academico',data:'tematicas_academico'},{'class':'big-col',title:'Comentario Econ\xF3mico',name:'comentarios_economico',data:'comentarios_economico'},{title:'Punt. riesgo Econ\xF3mico',name:'puntuacion_riesgo_economico',data:'puntuacion_riesgo_economico'},{title:'Tem\xE1ticas Econ\xF3mico',name:'tematicas_economico',data:'tematicas_economico'},{'class':'big-col',title:'Comentario Vida Universitaria',name:'comentarios_vida_uni',data:'comentarios_vida_uni'},{title:'Punt. Vida Universitaria',name:'puntuacion_vida_uni',data:'puntuacion_vida_uni'},{'class':'big-col',title:'Observaciones seguimientos',name:'observaciones_seguimientos',data:'observaciones_seguimientos'},{title:'Revisado Profesional',name:'revisado_profesional',data:'revisado_profesional'},{title:'Revisado Practicante',name:'revisado_practicante',data:'revisado_practicante'},{title:'ID Estudiante',name:'id_estudiante',data:'id_estudiante'},{title:'ID Instancia',name:'id_instancia',data:'id_instancia'},{title:'Nombre Monitor',name:'monitor_name',data:'monitor_name'},{title:'Nombre Practicante',name:'practicing_name',data:'practicing_name'},{title:'Nombre Profesional',name:'professional_name',data:'professional_name'},{title:'ID creado por',name:'id_creado_por',data:'id_creado_por'},{title:'Creado por',name:'created_by',data:'created_by'}].map(function(B){return a('#'+B.name).prop('checked')||(B.visible=!1),B});a.fn.dataTable.isDataTable('#dphpform_datatable')&&(a('#dphpform_datatable').DataTable().destroy(),a('#dphpform_datatable tbody').empty());var A=a('#dphpform_datatable').DataTable({retrieve:!0,bsort:!1,data:v,columns:z,dom:'lifrtpB',buttons:[{extend:'print',text:'Imprimir'},{extend:'csv',text:'CSV'},{extend:'excel',text:'Excel',className:'buttons-excel',filename:'Export excel',extension:'.xls'}]});A.draw()}function o(u){var v=[];return u.map(function(w){var z={};Object.values(w).map(function(A){z[A.local_alias]=void 0===A.respuesta?'N.R.':A.respuesta}),v.push(z)}),v}function p(u,v){if('seguimiento_pares'==v){for(var w=u.length,z=0;z<w;z++){for(var C=null,D=null,F=0;F<Object.keys(u[z]).length;F++)'-#$%-'==u[z][F].respuesta&&(u[z][F].respuesta=''),('puntuacion_riesgo_individual'==u[z][F].local_alias||'puntuacion_riesgo_familiar'==u[z][F].local_alias||'puntuacion_riesgo_academico'==u[z][F].local_alias||'puntuacion_riesgo_economico'==u[z][F].local_alias||'puntuacion_vida_uni'==u[z][F].local_alias)&&('1'==u[z][F].respuesta?u[z][F].respuesta='bajo':'2'==u[z][F].respuesta?u[z][F].respuesta='medio':'3'==u[z][F].respuesta&&(u[z][F].respuesta='alto')),'revisado_profesional'==u[z][F].local_alias&&('0'==u[z][F].respuesta?u[z][F].respuesta='marcado':'-1'==u[z][F].respuesta&&(u[z][F].respuesta='no_marcado')),'revisado_practicante'==u[z][F].local_alias&&('0'==u[z][F].respuesta?u[z][F].respuesta='marcado':'-1'==u[z][F].respuesta&&(u[z][F].respuesta='no_marcado')),C&&D||('id_estudiante'==u[z][F].local_alias&&(C=u[z][F].respuesta),'id_creado_por'==u[z][F].local_alias&&(D=u[z][F].respuesta));var G=parseInt(a('#dphpforms-instance-id').data('instance-id'));a.ajax({type:'POST',url:'../managers/user_management/user_management_api.php',data:JSON.stringify({'function':'get_crea_stud_mon_prac_prof',params:[C,D,G,s]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(J){u[z][Object.keys(u[z]).length]={enunciado:'monitor_name',id:'00',local_alias:'monitor_name',respuesta:J.data_response.monitor.firstname+' '+(J.data_response.monitor.lastname+'')},u[z][Object.keys(u[z]).length]={enunciado:'practicing_name',id:'00',local_alias:'practicing_name',respuesta:J.data_response.practicing.firstname+' '+(J.data_response.practicing.lastname+'')},u[z][Object.keys(u[z]).length]={enunciado:'professional_name',id:'00',local_alias:'professional_name',respuesta:J.data_response.professional.firstname+' '+(J.data_response.professional.lastname+'')},u[z][Object.keys(u[z]).length]={enunciado:'created_by',id:'00',local_alias:'created_by',respuesta:J.data_response.created_by.firstname+' '+(J.data_response.created_by.lastname+'')};var K=J.data_response.student_username;K=K?J.data_response.student_username.split('-')[0]:'null',u[z][Object.keys(u[z]).length]={enunciado:'student_code',id:'00',local_alias:'student_code',respuesta:K},u[z][Object.keys(u[z]).length]={enunciado:'student_firstname',id:'00',local_alias:'student_firstname',respuesta:J.data_response.student.firstname+''},u[z][Object.keys(u[z]).length]={enunciado:'student_lastname',id:'00',local_alias:'student_lastname',respuesta:J.data_response.student.lastname+''}},failure:function failure(J){console.log(J)}});for(var I=Object.keys(u[z]).length-1;0<=I;I--)u[z][I+3]=a.extend(!0,{},u[z][I]);u[z][0]=a.extend(!0,{},u[z][Object.keys(u[z]).length-3]),u[z][1]=a.extend(!0,{},u[z][Object.keys(u[z]).length-2]),u[z][2]=a.extend(!0,{},u[z][Object.keys(u[z]).length-1]),delete u[z][Object.keys(u[z]).length-1],delete u[z][Object.keys(u[z]).length-1],delete u[z][Object.keys(u[z]).length-1],a('#progress-custom').find('div').width((100/w*(z+1)).toFixed(0)+'%'),a('#progress-custom').find('div').html((100/w*(z+1)).toFixed(0)+'%'),a('#progress-custom').find('div').attr('aria-valuenow',(100/w*(z+1)).toFixed(0))}return a('#progress-custom').find('div').addClass('progress-bar-success'),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),a('#progress_group').addClass('hidden'),u}return a('#progress-custom').find('div').addClass('progress-bar-success'),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),a('#progress_group').addClass('hidden'),u}window.JSZip=b;var s=null;a('#base_fields_check').on('change',function(){a('#base_fields_check').prop('checked')?a('#base_fields input[type=\'checkbox\']').prop('checked',!0):a('#base_fields input[type=\'checkbox\']').prop('checked',!1)}),a('#dimensions_fields_check').on('change',function(){a('#dimensions_fields_check').prop('checked')?a('#dimensions_fields input[type=\'checkbox\']').prop('checked',!0):a('#dimensions_fields input[type=\'checkbox\']').prop('checked',!1)}),a('#comments_fields_check').on('change',function(){a('#comments_fields_check').prop('checked')?a('#comments_fields input[type=\'checkbox\']').prop('checked',!0):a('#comments_fields input[type=\'checkbox\']').prop('checked',!1)}),a('#risks_fields_check').on('change',function(){a('#risks_fields_check').prop('checked')?a('#risks_fields input[type=\'checkbox\']').prop('checked',!0):a('#risks_fields input[type=\'checkbox\']').prop('checked',!1)}),a('#themes_fields_check').on('change',function(){a('#themes_fields_check').prop('checked')?a('#themes_fields input[type=\'checkbox\']').prop('checked',!0):a('#themes_fields input[type=\'checkbox\']').prop('checked',!1)});a('#btn-generar-reporte').click(function(){var u=a('#start_date').val(),v=a('#end_date').val();if(u>=v)swal({title:'Informaci\xF3n',text:'Intervalo de fechas inv\xE1lido',type:'warning'},function(){});else if(a.ajax({type:'POST',url:'../managers/periods_management/periods_api.php',data:JSON.stringify({'function':'get_current_semester_by_apprx_interval',params:[u,v]}),contentType:'application/json; charset=utf-8',dataType:'json',async:!1,success:function success(z){s=z.data_response},failure:function failure(){}}),s){var w=JSON.parse(a('#dphpforms-reports-preguntas').html());a('.progress-bar').removeClass('progress-bar-success'),a('.progress-bar').removeClass('progress-bar-success'),a('.progress-bar').width('0%'),a('.progress-bar').html('0%'),a('.progress-bar').attr('aria-valuenow','0'),a('#progress_group').css('display','block'),a('#progress_group').removeClass('hidden'),a('#message').removeClass('alert alert-success'),a('#message').addClass('alert alert-info'),a('#message').html('<strong>Info!</strong> Se est\xE1 generando el reporte, esto puede tardar un par de minutos dependiendo de su conexi\xF3n a internet, capacidad del ordenador y rapidez del campus virtual.'),a.get('../managers/dphpforms/dphpforms_reverse_filter.php?id_pregunta=seguimiento_pares_fecha&cast=date&criterio={"criteria":[{"operator":">=","value":"'+u+'"},{"operator":"<=","value":"'+v+'"}]}',function(z){for(var A=Object.keys(z.results).length,B=[],D=0,E=0;E<A;E++)a.get('../managers/dphpforms/dphpforms_reverse_finder.php?respuesta_id='+z.results[E].id,function(F){a.get('../managers/dphpforms/dphpforms_get_record.php?record_id='+F.result.id_registro,function(G){if(0<Object.keys(G.record).length){for(var H=a.extend(!0,{},w),I=0;I<Object.keys(G.record.campos).length;I++)for(var J=0;J<Object.keys(H).length;J++)H[J].id==parseInt(G.record.campos[I].id_pregunta)&&(H[J].respuesta=G.record.campos[I].respuesta);B.push(H)}if(D++,a('#progress-download').find('div').width((100/A*D).toFixed(0)+'%'),a('#progress-download').find('div').html((100/A*D).toFixed(0)+'%'),a('#progress-download').find('div').attr('aria-valuenow',(100/A*D).toFixed(0)),D==A){a('#progress-download').find('div').addClass('progress-bar-success');var K=p(B,'seguimiento_pares');n(K)}}).fail(function(G){console.log(G)})}),a('#progress').text(Math.round(D));0==A&&(a('#progress').text(100),a('#message').removeClass('alert alert-info'),a('#message').addClass('alert alert-success'),a('#message').html('<strong>Info!</strong>  Reporte generado.'),a('#progress_group').addClass('hidden'))})}else swal({title:'Informaci\xF3n',text:'Las fechas deben estar en el lapso de tiempo que comprende un periodo acad\xE9mico. ',type:'error'},function(){})})}}});