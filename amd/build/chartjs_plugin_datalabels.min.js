function _typeof(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=b(require("block_ases/Chart")):"function"==typeof define&&define.amd?define ("block_ases/chartjs_plugin_datalabels",["block_ases/Chart"],b):a.ChartDataLabels=b(a.Chart)})(this,function(a){'use strict';a=a&&a.hasOwnProperty("default")?a["default"]:a;var y=a.helpers,z=function(){if("undefined"!=typeof window){if(window.devicePixelRatio){return window.devicePixelRatio}var a=window.screen;if(a){return(a.deviceXDPI||1)/(a.logicalXDPI||1)}}return 1}(),A={toTextLines:function toTextLines(a){var b=[],c;a=[].concat(a);while(a.length){c=a.pop();if("string"==typeof c){b.unshift.apply(b,c.split("\n"))}else if(Array.isArray(c)){a.push.apply(a,c)}else if(!y.isNullOrUndef(a)){b.unshift(""+c)}}return b},toFontString:function toFontString(a){if(!a||y.isNullOrUndef(a.size)||y.isNullOrUndef(a.family)){return null}return(a.style?a.style+" ":"")+(a.weight?a.weight+" ":"")+a.size+"px "+a.family},textSize:function textSize(a,b,c){var d=[].concat(b),e=d.length,f=a.font,g=0,h;a.font=c.string;for(h=0;h<e;++h){g=Math.max(a.measureText(d[h]).width,g)}a.font=f;return{height:e*c.lineHeight,width:g}},parseFont:function parseFont(b){var c=a.defaults.global,d=y.valueOrDefault(b.size,c.defaultFontSize),e={family:y.valueOrDefault(b.family,c.defaultFontFamily),lineHeight:y.options.toLineHeight(b.lineHeight,d),size:d,style:y.valueOrDefault(b.style,c.defaultFontStyle),weight:y.valueOrDefault(b.weight,null),string:""};e.string=A.toFontString(e);return e},bound:function bound(a,b,c){return Math.max(a,Math.min(b,c))},arrayDiff:function arrayDiff(a,b){var c=a.slice(),d=[],e,f,g,h;for(e=0,g=b.length;e<g;++e){h=b[e];f=c.indexOf(h);if(-1===f){d.push([h,1])}else{c.splice(f,1)}}for(e=0,g=c.length;e<g;++e){d.push([c[e],-1])}return d},rasterize:function(a){return Math.round(a*z)/z}};function b(a,b){var c=b.x,d=b.y;if(null===c){return{x:0,y:-1}}if(null===d){return{x:1,y:0}}var e=a.x-c,f=a.y-d,g=Math.sqrt(e*e+f*f);return{x:g?e/g:0,y:g?f/g:-1}}function c(a,b,c,d,e){switch(e){case"center":c=d=0;break;case"bottom":c=0;d=1;break;case"right":c=1;d=0;break;case"left":c=-1;d=0;break;case"top":c=0;d=-1;break;case"start":c=-c;d=-d;break;case"end":break;default:e*=Math.PI/180;c=Math.cos(e);d=Math.sin(e);break;}return{x:a,y:b,vx:c,vy:d}}var B=1,C=2,D=4,E=8;function d(a,b,c){var d=0;if(a<c.left){d|=B}else if(a>c.right){d|=C}if(b<c.top){d|=E}else if(b>c.bottom){d|=D}return d}function e(a,b){var c=a.x0,e=a.y0,f=a.x1,g=a.y1,h=d(c,e,b),i=d(f,g,b),j,k,l;while(!0){if(!(h|i)||h&i){break}j=h||i;if(j&E){k=c+(f-c)*(b.top-e)/(g-e);l=b.top}else if(j&D){k=c+(f-c)*(b.bottom-e)/(g-e);l=b.bottom}else if(j&C){l=e+(g-e)*(b.right-c)/(f-c);k=b.right}else if(j&B){l=e+(g-e)*(b.left-c)/(f-c);k=b.left}if(j===h){c=k;e=l;h=d(c,e,b)}else{f=k;g=l;i=d(f,g,b)}}return{x0:c,x1:f,y0:e,y1:g}}function f(a,b){var d=b.anchor,f=a,g,h;if(b.clamp){f=e(f,b.area)}if("start"===d){g=f.x0;h=f.y0}else if("end"===d){g=f.x1;h=f.y1}else{g=(f.x0+f.x1)/2;h=(f.y0+f.y1)/2}return c(g,h,a.vx,a.vy,b.align)}var F={arc:function arc(a,b){var c=(a.startAngle+a.endAngle)/2,d=Math.cos(c),e=Math.sin(c),g=a.innerRadius,h=a.outerRadius;return f({x0:a.x+d*g,y0:a.y+e*g,x1:a.x+d*h,y1:a.y+e*h,vx:d,vy:e},b)},point:function point(a,c){var d=b(a,c.origin),e=d.x*a.radius,g=d.y*a.radius;return f({x0:a.x-e,y0:a.y-g,x1:a.x+e,y1:a.y+g,vx:d.x,vy:d.y},c)},rect:function rect(a,c){var d=b(a,c.origin),e=a.x,g=a.y,h=0,i=0;if(a.horizontal){e=Math.min(a.x,a.base);h=Math.abs(a.base-a.x)}else{g=Math.min(a.y,a.base);i=Math.abs(a.base-a.y)}return f({x0:e,y0:g+i,x1:e+h,y1:g,vx:d.x,vy:d.y},c)},fallback:function fallback(a,c){var d=b(a,c.origin);return f({x0:a.x,y0:a.y,x1:a.x,y1:a.y,vx:d.x,vy:d.y},c)}},G=a.helpers,H=A.rasterize;function g(a){var b=a.borderWidth||0,c=a.padding,d=a.size.height,e=a.size.width,f=-e/2,g=-d/2;return{frame:{x:f-c.left-b,y:g-c.top-b,w:e+c.width+2*b,h:d+c.height+2*b},text:{x:f,y:g,w:e,h:d}}}function h(a){var b=a._model.horizontal,c=a._scale||b&&a._xScale||a._yScale;if(!c){return null}if(c.xCenter!==void 0&&c.yCenter!==void 0){return{x:c.xCenter,y:c.yCenter}}var d=c.getBasePixel();return b?{x:d,y:null}:{x:null,y:d}}function i(b){if(b instanceof a.elements.Arc){return F.arc}if(b instanceof a.elements.Point){return F.point}if(b instanceof a.elements.Rectangle){return F.rect}return F.fallback}function j(a,b,c){var d=c.backgroundColor,e=c.borderColor,f=c.borderWidth;if(!d&&(!e||!f)){return}a.beginPath();G.canvas.roundedRect(a,H(b.x)+f/2,H(b.y)+f/2,H(b.w)-f,H(b.h)-f,c.borderRadius);a.closePath();if(d){a.fillStyle=d;a.fill()}if(e&&f){a.strokeStyle=e;a.lineWidth=f;a.lineJoin="miter";a.stroke()}}function k(a,b,c){var d=c.lineHeight,e=a.w,f=a.x,g=a.y+d/2;if("center"===b){f+=e/2}else if("end"===b||"right"===b){f+=e}return{h:d,w:e,x:f,y:g}}function l(a,b,c){var d=a.shadowBlur,e=c.stroked,f=H(c.x),g=H(c.y),h=H(c.w);if(e){a.strokeText(b,f,g,h)}if(c.filled){if(d&&e){a.shadowBlur=0}a.fillText(b,f,g,h);if(d&&e){a.shadowBlur=d}}}function m(a,b,c,d){var e=d.textAlign,f=d.color,g=!!f,h=d.font,j=b.length,m=d.textStrokeColor,n=d.textStrokeWidth,o=m&&n,p;if(!j||!g&&!o){return}c=k(c,e,h);a.font=h.string;a.textAlign=e;a.textBaseline="middle";a.shadowBlur=d.textShadowBlur;a.shadowColor=d.textShadowColor;if(g){a.fillStyle=f}if(o){a.lineJoin="round";a.lineWidth=n;a.strokeStyle=m}for(p=0,j=b.length;p<j;++p){l(a,b[p],{stroked:o,filled:g,w:c.w,x:c.x,y:c.y+c.h*p})}}var I=function(a,b,c,d){var e=this;e._config=a;e._index=d;e._model=null;e._rects=null;e._ctx=b;e._el=c};G.extend(I.prototype,{_modelize:function _modelize(b,c,d,e){var f=this,g=f._index,j=G.options.resolve,k=A.parseFont(j([d.font,{}],e,g)),l=j([d.color,a.defaults.global.defaultFontColor],e,g);return{align:j([d.align,"center"],e,g),anchor:j([d.anchor,"center"],e,g),area:e.chart.chartArea,backgroundColor:j([d.backgroundColor,null],e,g),borderColor:j([d.borderColor,null],e,g),borderRadius:j([d.borderRadius,0],e,g),borderWidth:j([d.borderWidth,0],e,g),clamp:j([d.clamp,!1],e,g),clip:j([d.clip,!1],e,g),color:l,display:b,font:k,lines:c,offset:j([d.offset,0],e,g),opacity:j([d.opacity,1],e,g),origin:h(f._el),padding:G.options.toPadding(j([d.padding,0],e,g)),positioner:i(f._el),rotation:j([d.rotation,0],e,g)*(Math.PI/180),size:A.textSize(f._ctx,c,k),textAlign:j([d.textAlign,"start"],e,g),textShadowBlur:j([d.textShadowBlur,0],e,g),textShadowColor:j([d.textShadowColor,l],e,g),textStrokeColor:j([d.textStrokeColor,l],e,g),textStrokeWidth:j([d.textStrokeWidth,0],e,g)}},update:function update(a){var b=this,c=null,d=null,e=b._index,f=b._config,h,i,j,k=G.options.resolve([f.display,!0],a,e);if(k){h=a.dataset.data[e];i=G.valueOrDefault(G.callback(f.formatter,[h,a]),h);j=G.isNullOrUndef(i)?[]:A.toTextLines(i);if(j.length){c=b._modelize(k,j,f,a);d=g(c)}}b._model=c;b._rects=d},geometry:function geometry(){return this._rects?this._rects.frame:{}},rotation:function rotation(){return this._model?this._model.rotation:0},visible:function visible(){return this._model&&this._model.opacity},model:function model(){return this._model},draw:function draw(a,b){var c=this,d=a.ctx,e=c._model,f=c._rects,g;if(!this.visible()){return}d.save();if(e.clip){g=e.area;d.beginPath();d.rect(g.left,g.top,g.right-g.left,g.bottom-g.top);d.clip()}d.globalAlpha=A.bound(0,e.opacity,1);d.translate(H(b.x),H(b.y));d.rotate(e.rotation);j(d,f.frame,e);m(d,e.lines,f.text,e);d.restore()}});var J=a.helpers,K=Number.MIN_SAFE_INTEGER||-9007199254740991,L=Number.MAX_SAFE_INTEGER||9007199254740991;function n(a,b,c){var d=Math.cos(c),e=Math.sin(c),f=b.x,g=b.y;return{x:f+d*(a.x-f)-e*(a.y-g),y:g+e*(a.x-f)+d*(a.y-g)}}function o(a,b){var c=L,d=K,e=b.origin,f,g,h,j,k;for(f=0;f<a.length;++f){g=a[f];h=g.x-e.x;j=g.y-e.y;k=b.vx*h+b.vy*j;c=Math.min(c,k);d=Math.max(d,k)}return{min:c,max:d}}function p(a,b){var c=b.x-a.x,d=b.y-a.y,e=Math.sqrt(c*c+d*d);return{vx:(b.x-a.x)/e,vy:(b.y-a.y)/e,origin:a,ln:e}}var M=function(){this._rotation=0;this._rect={x:0,y:0,w:0,h:0}};J.extend(M.prototype,{center:function center(){var a=this._rect;return{x:a.x+a.w/2,y:a.y+a.h/2}},update:function update(a,b,c){this._rotation=c;this._rect={x:b.x+a.x,y:b.y+a.y,w:b.w,h:b.h}},contains:function contains(a){var b=this,c=1,d=b._rect;a=n(a,b.center(),-b._rotation);return!(a.x<d.x-c||a.y<d.y-c||a.x>d.x+d.w+2*c||a.y>d.y+d.h+2*c)},intersects:function intersects(a){var b=this._points(),c=a._points(),d=[p(b[0],b[1]),p(b[0],b[3])],e,f,g;if(this._rotation!==a._rotation){d.push(p(c[0],c[1]),p(c[0],c[3]))}for(e=0;e<d.length;++e){f=o(b,d[e]);g=o(c,d[e]);if(f.max<g.min||g.max<f.min){return!1}}return!0},_points:function _points(){var a=this,b=a._rect,c=a._rotation,d=a.center();return[n({x:b.x,y:b.y},d,c),n({x:b.x+b.w,y:b.y},d,c),n({x:b.x+b.w,y:b.y+b.h},d,c),n({x:b.x,y:b.y+b.h},d,c)]}});function q(a,b,c){var d=b.positioner(a,b),e=d.vx,f=d.vy;if(!e&&!f){return{x:d.x,y:d.y}}var g=c.w,i=c.h,h=b.rotation,j=Math.abs(g/2*Math.cos(h))+Math.abs(i/2*Math.sin(h)),k=Math.abs(g/2*Math.sin(h))+Math.abs(i/2*Math.cos(h)),l=1/Math.max(Math.abs(e),Math.abs(f));j*=e*l;k*=f*l;j+=b.offset*e;k+=b.offset*f;return{x:d.x+j,y:d.y+k}}function r(a,b){var c,d,e,f;for(c=a.length-1;0<=c;--c){e=a[c].$layout;for(d=c-1;0<=d&&e._visible;--d){f=a[d].$layout;if(f._visible&&e._box.intersects(f._box)){b(e,f)}}}return a}function s(a){var b,c,d,e,f,g;for(b=0,c=a.length;b<c;++b){d=a[b];e=d.$layout;if(e._visible){f=d.geometry();g=q(d._el._model,d.model(),f);e._box.update(g,f,d.rotation())}}return r(a,function(a,b){var c=a._hidable,d=b._hidable;if(c&&d||d){b._visible=!1}else if(c){a._visible=!1}})}var N={prepare:function prepare(a){var b=[],c,d,e,f,g;for(c=0,e=a.length;c<e;++c){for(d=0,f=a[c].length;d<f;++d){g=a[c][d];b.push(g);g.$layout={_box:new M,_hidable:!1,_visible:!0,_set:c,_idx:d}}}b.sort(function(c,a){var b=c.$layout,d=a.$layout;return b._idx===d._idx?b._set-d._set:d._idx-b._idx});this.update(b);return b},update:function update(a){var b=!1,c,d,e,f,g;for(c=0,d=a.length;c<d;++c){e=a[c];f=e.model();g=e.$layout;g._hidable=f&&"auto"===f.display;g._visible=e.visible();b|=g._hidable}if(b){s(a)}},lookup:function lookup(a,b){var c,d;for(c=a.length-1;0<=c;--c){d=a[c].$layout;if(d&&d._visible&&d._box.contains(b)){return{dataset:d._set,label:a[c]}}}return null},draw:function draw(a,b){var c,d,e,f,g,h;for(c=0,d=b.length;c<d;++c){e=b[c];f=e.$layout;if(f._visible){g=e.geometry();h=q(e._el._view,e.model(),g);f._box.update(h,g,e.rotation());e.draw(a,h)}}}},O=a.helpers,P={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:function formatter(a){if(O.isNullOrUndef(a)){return null}var b=a,c,d,e;if(O.isObject(a)){if(!O.isNullOrUndef(a.label)){b=a.label}else if(!O.isNullOrUndef(a.r)){b=a.r}else{b="";c=Object.keys(a);for(e=0,d=c.length;e<d;++e){b+=(0!==e?", ":"")+c[e]+": "+a[c[e]]}}}return""+b},listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},Q=a.helpers,R="$datalabels";a.defaults.global.plugins.datalabels=P;function t(a,b){var c=a.datalabels;if(!1===c){return null}if(!0===c){c={}}return Q.merge({},[b,c])}function u(a,b,c){var d=b&&b[c.dataset];if(!d){return}var e=c.label,f=e.$context;if(!0===Q.callback(d,[f])){a[R]._dirty=!0;e.update(f)}}function v(a,b,c,d){var e,f;if(!c&&!d){return}if(!c){e=!0}else if(!d){f=!0}else if(c.label!==d.label){f=e=!0}if(f){u(a,b.leave,c)}if(e){u(a,b.enter,d)}}function w(a,b){var c=a[R],d=c._listeners,e,f;if(!d.enter&&!d.leave){return}if("mousemove"===b.type){f=N.lookup(c._labels,b)}else if("mouseout"!==b.type){return}e=c._hovered;c._hovered=f;v(a,d,e,f)}function x(a,b){var c=a[R],d=c._listeners.click,e=d&&N.lookup(c._labels,b);if(e){u(a,d,e)}}a.defaults.global.plugins.datalabels=P;var S={id:"datalabels",beforeInit:function beforeInit(a){a[R]={_actives:[]}},beforeUpdate:function beforeUpdate(a){var b=a[R];b._listened=!1;b._listeners={};b._datasets=[];b._labels=[]},afterDatasetUpdate:function afterDatasetUpdate(a,b,c){var d=b.index,e=a[R],f=e._datasets[d]=[],g=a.isDatasetVisible(d),h=a.data.datasets[d],j=t(h,c),k=b.meta.data||[],l=k.length,m=a.ctx,n,o,p;m.save();for(n=0;n<l;++n){o=k[n];if(g&&o&&!o.hidden&&!o._model.skip){f.push(p=new I(j,m,o,n));p.update(p.$context={active:!1,chart:a,dataIndex:n,dataset:h,datasetIndex:d})}else{p=null}o[R]=p}m.restore();Q.merge(e._listeners,j.listeners||{},{merger:function merger(a,c,d){c[a]=c[a]||{};c[a][b.index]=d[a];e._listened=!0}})},afterUpdate:function afterUpdate(a,b){a[R]._labels=N.prepare(a[R]._datasets,b)},afterDatasetsDraw:function afterDatasetsDraw(a){N.draw(a,a[R]._labels)},beforeEvent:function beforeEvent(a,b){if(a[R]._listened){switch(b.type){case"mousemove":case"mouseout":w(a,b);break;case"click":x(a,b);break;default:}}},afterEvent:function afterEvent(a){var b=a[R],c=b._actives,d=b._actives=a.lastActive||[],e=A.arrayDiff(c,d),f,g,h,j;for(f=0,g=e.length;f<g;++f){h=e[f];if(h[1]){j=h[0][R];if(j){j.$context.active=1===h[1];j.update(j.$context)}}}if(b._dirty||e.length){N.update(b._labels);if(!a.animating){a.render()}}delete b._dirty}};a.plugins.register(S);return S});
//# sourceMappingURL=chartjs_plugin_datalabels.min.js.map
