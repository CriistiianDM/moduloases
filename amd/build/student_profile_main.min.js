define(["jquery","block_ases/bootstrap","block_ases/d3","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2","block_ases/Chart","block_ases/mustache","block_ases/loading_indicator","block_ases/academic_profile_main","block_ases/socioed_profile_main","block_ases/geographic_main"],function(e,a,t,o,r,n,s,l,c,d,u,p){return{init:function(a){var t=this,i=e("#municipio_act").val(),o=e("#latitude").val(),r=e("#longitude").val();document.getElementById("mapa").innerHTML="CALI"==i?"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+o+","+r+"&destination=3.3759493,-76.5355789&mode=transit'></iframe>":"<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+o+","+r+"&destination=3.3759493,-76.5355789&mode=driving'></iframe>",e("#socioed_li").one("click",{tab_name:"socioed"},_),e("#academic_li").one("click",{tab_name:"academic"},_),e("#geographic_li").one("click",{tab_name:"geographic"},_),e("#geographic_li").on("click",function(){e("#mapa").appendTo("#geographic_map")}),e("#general_li").click(function(){e("#mapa").appendTo("#movableMap")}),e(document).on("click","#table_vive_con tbody tr td button",function(){e(this).parent().parent().remove()}),e("#cohorts_table tbody").find("td").each(function(){if(-1!=e(this).text().indexOf("Condición de Excepción")){var a=e("#cond_excepcion_alias").text().trim(),t=e("#cond_excepcion_name").text().trim();e(this).append("-"),e(this).append(a),e(this).attr("title",t)}}),e("#input_button_add_person").click(function(){let a="";a+='<tr><td> <input name="name_person" class="input_fields_general_tab"  type="text"/></td>',a+='<td> <input name="parentesco_person" class="input_fields_general_tab"  type="text" /></td>',a+='<td> <button type ="button" id="bt_delete_person" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> </button></td> </tr>',e("#table_vive_con").find("tbody").append('<tr><td> <input name="name_person" class="input_fields_general_tab"  type="text"/></td><td> <input name="parentesco_person" class="input_fields_general_tab"  type="text" /></td><td> <button type ="button" id="bt_delete_person" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> </button></td> </tr>')}),e('[data-toggle="tooltip"]').tooltip();var n=y(document.location.search),s=e(".panel-collapse.collapse.in");e("#asignados").select2({width:"resolve",height:"resolve",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),e("#asignados").on("change",function(){var a,t=e("#asignados").val().split(" ")[0];a=t,e.ajax({type:"POST",data:JSON.stringify({func:"is_student",params:[a]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){var t=JSON.parse(e);if(1==t){var i=y(document.location.search),o=String(document.location),r=o.split("?"),n=r[0]+"?courseid="+i.courseid+"&instanceid="+i.instanceid+"&student_code="+a;location.href=n}else swal("Error","No se encuentra un estudiante asociado al código ingresado","error")},dataType:"text",cache:"false",error:function(e){swal("Error","Error al comunicarse con el servidor, por favor inténtelo nuevamente.","error")}})});for(var l=0,d=a.length;l<d;l++)e("#select-"+a[l].academic_program_id+" option[value="+a[l].program_status+"]").attr("selected",!0),"1"==a[l].program_status&&e("#tr-"+a[l].id_moodle_user).addClass("is-active"),"1"==a[l].tracking_status&&e("#div_flags_"+a[l].academic_program_id).prop("checked",!0);var u="",p=e("#div_cohorts").height();e("#div-icon-edit").height(p),this.edit_profile(t),e("div.slider.round").click(function(e){u=e.target.parentElement.children[0].checked}),e(".input-tracking").on("change",{current_tracking_status:u},function(){t.update_tracking_status(u,e(this),a,t)});var g="";switch(e(".select_statuses_program").on("focus",function(e){g=e.target.value}),e(".select_statuses_program").on("change",{current_status:g},function(){t.update_status_program(g,e(this))}),e("#icetex_status").on("click",{previous_status:e("#icetex_status option:selected").text()},b),e("#icon-tracking").on("click",function(){"seguimiento"==e("#input_status_ases").val()&&t.update_status_ases(n)}),n.tab){case"socioed_tab":e("#general_li").removeClass("active"),e("#socioed_li").addClass("active"),e("#general_tab").removeClass("active"),e("#socioed_tab").addClass("active"),s.removeClass("in"),e("#collapseOne").addClass("in");break;default:s.removeClass("in")}var v,h,x=e("#modal_peer_tracking");v=e("#modal_dropout"),h=e(".mymodal-close"),e("#goback_backdrop").on("click",function(){v.hide()}),h.on("click",function(){v.hide()}),function(){var a=e("#modal_peer_tracking"),t=e(".mymodal-close");e("#cancel_peer_tracking").on("click",function(){a.hide()}),t.on("click",function(){a.hide()}),e(".panel-heading.heading_semester_tracking").on("click",function(){"collapsed"==e(this).parent().attr("class")?(e("h4>span",this).removeClass("glyphicon-chevron-left"),e("h4>span",this).addClass("glyphicon-chevron-down")):(e("h4>span",this).removeClass("glyphicon-chevron-down"),e("h4>span",this).addClass("glyphicon-chevron-left"))})}(),function(){var a=e("#modal_risk_span"),t=e("#modal_risk_close");a.on("click",function(){e("#modal_risk_graph").hide()}),t.on("click",function(){e("#modal_risk_graph").hide()})}(),e("#button_add_track").on("click",function(){e("#save_seg").removeClass("hide"),e("#div_created").addClass("hide"),e("#upd_seg").addClass("hide"),e("#myModalLabel").attr("name","PARES"),x.show(),k()}),e("#view_form_update_profile_image").on("click",function(){e("#profile_image_update").show()}),e("#send-profile-image").on("click",function(){c.show();var a=e("#id_moodle").val(),t=document.getElementById("profile-image-input").files[0];e.ajax({url:"../managers/student_profile/studentprofile_api.php",data:JSON.stringify({func:"update_user_image",params:[a,t]}),cache:!1,contentType:!1,processData:!1,method:"POST",type:"POST",success:function(e){c.hide(),alert(e)},error:function(e){c.hide(),console.log(e)}})}),e("#save_tracking_btn").on("click",function(){!function(){var a=e("#tracking_peer_form"),t=e("#modal_peer_tracking"),i=a.serializeArray(),o=y(document.location.search),r=function(e){var a=/^\d{4}\-(0?[1-9]|1[012])\-(0?[1-9]|[12][0-9]|3[01])$/.exec(e[1].value);return""==e[1].value?"Debe introducir la fecha en la cual se realizó el seguimiento":null===a?"La fecha no sigue el patrón yyyy-mm-dd. Ejemplo 2017-10-13":""==e[2].value?"Debe introducir el lugar donde se realizó el seguimiento":""==e[7].value?"El campo tema se encuentra vacio":""==e[8].value?"El campo objetivos se encuentra vacio":parseInt(e[5].value)<parseInt(e[3].value)?"La hora de finalización debe ser mayor a la hora inicial":parseInt(e[3].value)==parseInt(e[5].value)&&parseInt(e[6].value)<=parseInt(e[4].value)?"La hora de finalización debe ser mayor a la hora inicial":""!=e[9].value&&0==e[10].value?"El riesgo asociado al campo Actividad Invidual no está marcado. Si usted escribió información en el campo Actividad Individual debe marcar un nivel de riesgo.":""!=e[11].value&&0==e[12].value?"El riesgo asociado al campo Actividad Familiar no está marcado. Si usted escribió información en el campo Actividad Familiar debe marcar un nivel de riesgo.":""!=e[13].value&&0==e[14].value?"El riesgo asociado al campo Actividad Académico no está marcado. Si usted escribió información en el campo Actividad Académico debe marcar un nivel de riesgo.":""!=e[15].value&&0==e[16].value?"El riesgo asociado al campo Actividad Económico no está marcado. Si usted escribió información en el campo Actividad Económico debe marcar un nivel de riesgo.":""!=e[17].value&&0==e[18].value?"El riesgo asociado al campo Actividad Vida Universitaria no está marcado. Si usted escribió información en el campo Actividad Vida Universitaria debe marcar un nivel de riesgo.":""==e[9].value&&0!=e[10].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Individual, debe digitar información en el campo Actividad Individual. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":""==e[11].value&&0!=e[12].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Familiar, debe digitar información en el campo Actividad Familiar. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":""==e[13].value&&0!=e[14].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Académico, debe digitar información en el campo Actividad Académico. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":""==e[15].value&&0!=e[16].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Económico, debe digitar información en el campo Actividad Económico. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":""==e[17].value&&0!=e[18].value?"Usted ha marcado el nivel de riesgo asociado a la actividad Vida Universitaria, debe digitar información en el campo Actividad Vida Universitaria. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.":"success"}(i);if("success"!=r)swal({title:"Advertencia",text:r,type:"warning",html:!0});else{i.push({name:"func",value:"save_tracking_peer"});var n=e("#id_ases").val();i.push({name:"id_ases",value:n}),i.push({name:"id_instance",value:o.instanceid}),e.ajax({type:"POST",data:i,url:"../../ases/managers/student_profile/studentprofile_serverproc.php",success:function(e){swal({title:e.title,text:e.msg,type:e.type},function(){t.hide();var e=y(document.location.search);e.tab?location.reload():location.href=location.search+"&tab=socioed_tab"})},dataType:"json",cache:"false",error:function(e){console.log(e)}})}}()}),e("fieldset").removeClass("hidden"),e("#clean_individual_risk").on("click",function(){e("#no_value_individual").prop("checked",!0)}),e("#clean_familiar_risk").on("click",function(){e("#no_value_familiar").prop("checked",!0)}),e("#clean_academic_risk").on("click",function(){e("#no_value_academic").prop("checked",!0)}),e("#clean_economic_risk").on("click",function(){e("#no_value_economic").prop("checked",!0)}),e("#clean_life_risk").on("click",function(){e("#no_value_life").prop("checked",!0)}),e(".btn-primary.edit_peer_tracking").on("click",function(){!function(a){k();var t=new Date(e("#"+a+" .date_tracking_peer").text()),i=e("#"+a+" .place_tracking_peer").text(),o=e("#"+a+" .init_time_tracking_peer").text(),r=e("#"+a+" .ending_time_tracking_peer").text(),n=e("#"+a+" .topic_tracking_peer").text(),s=e("#"+a+" .objectives_tracking_peer").text(),l=e("#"+a+" .individual_tracking_peer").text(),c=e("#"+a+" .ind_risk_tracking_peer").text(),d=e("#"+a+" .familiar_tracking_peer").text(),u=e("#"+a+" .fam_risk_tracking_peer").text(),p=e("#"+a+" .academico_tracking_peer").text(),_=e("#"+a+" .aca_risk_tracking_peer").text(),m=e("#"+a+" .economico_tracking_peer").text(),f=e("#"+a+" .econ_risk_tracking_peer").text(),g=e("#"+a+" .lifeu_tracking_peer").text(),v=e("#"+a+" .lifeu_risk_tracking_peer").text(),h=e("#"+a+" .observations_tracking_peer").text(),b=new Object;b.bajo=1,b.medio=2,b.alto=3;var y=t.getFullYear(),x=t.getMonth()+1;t.getMonth()<10?y+="-0"+x:y+="-"+x;t.getDate()<10?y+="-0"+t.getDate():y+="-"+t.getDate();var w=o.substring(0,2),E=o.substring(3,5),C=r.substring(0,2),S=r.substring(3,5);e('#h_ini option[value="'+w+'"]').attr("selected",!0),e('#m_ini option[value="'+E+'"]').attr("selected",!0),e('#h_fin option[value="'+C+'"]').attr("selected",!0),e('#m_fin option[value="'+S+'"]').attr("selected",!0);var T=b[c.toLowerCase()],O=b[u.toLowerCase()],B=b[f.toLowerCase()],A=b[_.toLowerCase()],j=b[v.toLowerCase()];""!=c?e("input[name='riesgo_ind'][value='"+T+"']").prop("checked",!0):e("input[name='riesgo_ind'][value='0']").prop("checked",!0);""!=u?e("input[name='riesgo_familiar'][value='"+O+"']").prop("checked",!0):e("input[name='riesgo_familiar'][value='0']").prop("checked",!0);""!=f?e("input[name='riesgo_econom'][value='"+B+"']").prop("checked",!0):e("input[name='riesgo_econom'][value='0']").prop("checked",!0);""!=_?e("input[name='riesgo_aca'][value='"+A+"']").prop("checked",!0):e("input[name='riesgo_aca'][value='0']").prop("checked",!0);""!=v?e("input[name='riesgo_uni'][value='"+j+"']").prop("checked",!0):e("input[name='riesgo_uni'][value='0']").prop("checked",!0);e("#date").val(y),e("#place").val(i),e("#topic_textarea").val(n),e("#objetivos").val(s),e("#individual").val(l),e("#familiar").val(d),e("#academico").val(p),e("#economico").val(m),e("#vida_uni").val(g),e("#observaciones").val(h),e("#id_tracking_peer").val(a),e("#modal_peer_tracking").show()}(e(this).attr("id").substring(14))}),e(".btn-danger.delete_peer_tracking").on("click",function(){var a=e(this).attr("id").substring(21);swal({title:"Advertencia",text:"¿Está seguro(a) que desea borrar este seguimiento?",type:"warning",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!1},function(t){t&&function(a){e.ajax({type:"POST",data:{func:"delete_tracking_peer",id_tracking:a},url:"../managers/student_profile/studentprofile_serverproc.php",success:function(e){swal(e.title,e.msg,e.status);var a=y(document.location.search);a.tab?location.reload():location.href=location.search+"&tab=socioed_tab"},dataType:"json",cache:"false",error:function(e){swal(e.title,e.msg,e.status)}})}(a)})}),e("#view_graph_radial_button").on("click",function(){t.graph_radial()}),e("#view_graphic_risk_button").off("click",f),e("#view_graphic_risk_button").one("click",m),e("#mymodal-riesgo-close").click(function(){e("#modal_riesgos").fadeOut(200)})},equalize:function(){e(document).ready(function(){0==document.getElementById("genero").value&&(e("#lb_otro").show(),e("#div_otro_genero").show()),0==document.getElementById("act_simultanea").value&&(e("#lb_otro_act").show(),e("#div_otro_act").show());var a=e(".equalize").map(function(){return e(this).height()}).get(),t=Math.max.apply(null,a);e(".equalize").height(t),e("#birthdate").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0})})},update_status_program:function(a,t){var i=t.parent().parent().attr("id").split("-")[1],o=t.attr("id").split("-")[1],r=t.val();swal({title:"Advertencia",text:"¿Está seguro que desea cambiar el estado del programa?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!1},function(t){t?(c.show(),e.ajax({type:"POST",data:JSON.stringify({func:"update_status_program",params:[i,o,r]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){c.hide(),0==a.status_code?("ACTIVO"==e("#select-"+o).val()?e("#tr-"+i).addClass("is-active"):e("#tr-"+i).removeClass("is-active"),swal(a.title,a.message,a.type)):console.log(a)},dataType:"json",cache:"false",error:function(e){c.hide(),swal(e.title,e.msg,e.type)}})):e("#select-"+data.program_id).val(a)})},update_status_ases:function(a){swal({title:"Advertencia",text:"¿Está seguro de que desea cambiar el estado de seguimiento del estudiante en esta instancia? El estado pasará de 'seguimiento' a 'sin seguimiento'",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si",cancelButtonText:"No"},function(t){t&&(modal_dropout=e("#modal_dropout"),modal_dropout.show(),e("#save_changes_dropout").on("click",function(){c.show();var t=e("#id_ases").val(),i=e("#reasons_select").val(),o=e("#description_dropout").val();e.ajax({type:"POST",data:JSON.stringify({func:"update_ases_status",params:[t,a.instanceid,a.student_code,i,o]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){c.hide(),0==a.status_code?(e("#input_status_ases").val("sinseguimiento"),e("#tip_ases_status").html("No se realiza seguimiento en esta instancia"),e("#icon-tracking").removeClass("i-tracking-t"),e("#icon-tracking").addClass("i-tracking"),modal_dropout.hide(),swal(a.title,a.message,a.type)):-7==a.status_code||-8==a.status_code?swal(a.title,a.error_message,a.type):console.log(a)},dataType:"json",cache:"false",error:function(e){c.hide(),modal_dropout.hide(),swal(e.title,e.message,e.type)}})}))})},update_tracking_status:function(a,t,i,o){has_tracking_status=!1,0==a?(has_tracking_status=o.validate_tracking_statuses(i),has_tracking_status.tracking_status&&swal({title:"¿Está seguro/a de cambiar el estado?",text:"Se alternará el perfil de Moodle asociado al estudiante al cual se el realiza seguimiento",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(i){if(i){c.show(),e(".input-tracking").prop("checked",!1),t.prop("checked",!0);var o=e("#id_ases").val(),r=t[0].id;r=r.split("_")[2],e.ajax({type:"POST",data:JSON.stringify({func:"update_tracking_status",params:[o,r]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){c.hide(),setTimeout(function(){0==e.status_code||-9==e.status_code?swal(e.title,e.message,e.type):console.log(e)},100)},dataType:"json",cache:"false",error:function(e){c.hide(),setTimeout(function(){swal(e.title,e.msg,e.status)},100)}})}else a?t.prop("checked",!0):t.prop("checked",!1)})):t.prop("checked",!0)},validate_tracking_statuses:function(e){for(has_tracking_status=!1,i=0;i<e.length;i++)if(1==e[i].tracking_status){has_tracking_status=!0;break}return e[i]},get_url_parameters:function(e){for(var a=[],t=document.location.search.substring(1).split("&"),i=0;i<t.length;i++){var o=t[i].split("=");a[o[0]]=o[1]}return a},graph_radial:function(){var a,t,i,o,r,n=document.getElementById("canvas_radial_graph").getContext("2d");a=0==e("#individual_risk").attr("data-risk-level")?4:e("#individual_risk").attr("data-risk-level"),t=0==e("#familiar_risk").attr("data-risk-level")?4:e("#familiar_risk").attr("data-risk-level"),i=0==e("#academic_risk").attr("data-risk-level")?4:e("#academic_risk").attr("data-risk-level"),o=0==e("#economic_risk").attr("data-risk-level")?4:e("#economic_risk").attr("data-risk-level"),r=0==e("#life_risk").attr("data-risk-level")?4:e("#life_risk").attr("data-risk-level"),e("#modal_radial_graph").fadeIn(200);new s(n,{type:"radar",data:{labels:["Individual","Familiar","Académico","Económico","Vida universitaria"],datasets:[{data:[4-a,4-t,4-i,4-o,4-r],backgroundColor:"rgba(255, 99, 132, 0.4)",borderColor:["rgba(255,99,132,1)"],borderWidth:2,fontsize:12}]},options:{scale:{ticks:{beginAtZero:!0,min:0,max:3,stepSize:1,display:!1},pointLabels:{fontSize:12},scaleLabel:{fontsize:10}},legend:{display:!1}}})},edit_profile:function(a){var t=e("#ficha_estudiante").serializeArray(),i=document.getElementById("otro_genero").value,o=document.getElementById("otro_act_simultanea").value;e("#span-icon-edit").on("click",function(){e(this).hide(),e("#tip-edit").hide(),e("#span-icon-save-profile").show(),e("#tip-save").show(),e("#span-icon-cancel-edit").show(),e("#tip-cancel").show(),e("#tipo_doc").prop("disabled",!1),e("#num_doc").prop("readonly",!1),e("#email").prop("readonly",!1),e("#icetex_status").prop("disabled",!1),e("#pais").prop("disabled",!1),e("#genero").prop("disabled",!1),e("#sexo").prop("disabled",!1),e("#cond_excepcion").prop("disabled",!1),e("#act_simultanea").prop("disabled",!1),e("#etnia").prop("disabled",!1),e("#otro_act_simultanea").prop("disabled",!1),e("#otro_genero").prop("disabled",!1),e("#otro_genero").prop("required",!1),e("#otro_act_simultanea").prop("required",!1),e("#estado_civil").prop("disabled",!1),e("#observacion").prop("readonly",!1),e(".select_statuses_program").prop("disabled",!1),e(".input_fields_general_tab").prop("readonly",!1),e(".bt_delete_person").css("visibility","visible"),e(".input-tracking").prop("disabled",!1),e("#div_add_persona_vive").show(),e("#edit_person_vive").show(),e("#age").hide(),e("#birthdate").show(),e("#genero").on("click",function(){0==document.getElementById("genero").value?(e("#div_otro_genero").show(),e("#lb_otro").show(),e("#otro_genero").prop("required",!0)):(e("#div_otro_genero").hide(),e("#lb_otro").hide(),e("#otro_genero").prop("required",!1))}),e("#act_simultanea").on("click",function(){0==document.getElementById("act_simultanea").value?(e("#div_otro_act").show(),e("#lb_otro_act").show(),e("#otro_act_simultanea").prop("required",!0)):(e("#div_otro_act").hide(),e("#lb_otro_act").hide(),e("#otro_act_simultanea").prop("required",!1))})}),e("#span-icon-cancel-edit").on("click",{form:t},function(e){swal({title:"¿Desea cancelar la edición?",text:"Los cambios no guardados se perderán",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(t){t&&(a.cancel_edition(),a.revert_changes(e.data.form))})}),e("#span-icon-save-profile").on("click",function(){var t=e("#ficha_estudiante").serializeArray(),r=a.validate_form(t);if("error"==r.status)swal(r.title,r.msg,r.status);else{var n,s=[],l=[],c=[];e(".table_vive_con td").find(":input").each(function(){"name_person"==e(this).attr("name")&&l.push(e(this).val()),"parentesco_person"==e(this).attr("name")&&c.push(e(this).val())});for(var d=0;d<l.length;d++)n={name:l[d],parentesco:c[d]},s.push(n);s=JSON.stringify(s),a.save_form_edit_profile(t,a,i,o,s),e("#otro_genero").prop("disabled",!0),e("#otro_act_simultanea").prop("disabled",!0),e("#otro_genero").prop("required",!1),e("#otro_act_simultanea").prop("required",!1)}})},validate_form:function(a){for(field in a){var t=new Object;switch(t.title="Éxito",t.msg="El formulario fue validado con éxito",t.status="success",a[field].name){case"email":let i=/((?:[a-z]+\.)*[a-z]+(?:@correounivalle\.edu\.co))/.exec(a[field].value);if(null===i)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no cumple con el formato institucional.",t;if(i[0]!==a[field].value)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no cumple con el formato institucional.",t;break;case"fecha_nac":let o=/^((19[5-9][0-9]|20[0-5][0-9])-(1[012]|0?[1-9])-([12][0-9]|3[01]|0?[1-9]))$/,r=/^((19[5-9][0-9]|20[0-5][0-9])-(1[012]|0?[1-9])-([12][0-9]|3[01]|0?[1-9]) 00:00:00)$/.exec(a[field].value),n=o.exec(a[field].value);if(null==r){if(null==n)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no cumple con el formato de fecha aceptado (yyyy-mm-dd).",t;a[field].value+=" 00:00:00"}break;case"estrato":if(a[field].value<0)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe ser negativo",t;if(a[field].value>6)return t.title="Error",t.status="error",t.msg="El campo año de "+a[field].name+" no debe ser mayor al permitido",t;if(g(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener letras",t;break;case"ingreso":if(a[field].value<0)return t.title="Error",t.status="error",t.msg="El campo año de "+a[field].name+" no debe ser negativo",t;let s=(new Date).getFullYear();if(a[field].value>s)return t.title="Error",t.status="error",t.msg="El campo año de "+a[field].name+" no debe ser mayor al actual",t;if(g(a[field].value))return t.title="Error",t.status="error",t.msg="El campo año de "+a[field].name+" no debe contener letras",t;break;case"puntaje_icfes":if(a[field].value<0)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe ser negativo",t;if(a[field].value>500)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe ser mayor al permitido",t;if(g(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener letras",t;break;case"hijos":if(""==a[field].value)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" es obligatorio",t;if(a[field].value<0)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe ser negativo",t;if(g(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener letras",t;break;case"name_person":if(""==a[field].value)return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" es obligatorio",t;if(v(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener números",t;break;case"otro_genero":if(""==document.getElementById("otro_genero").value&&e("#otro_genero").attr("required"))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" es obligatorio",t;if(v(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener números",t;break;case"otro_act_simultanea":if(""==document.getElementById("otro_act_simultanea").value&&e("#otro_act_simultanea").attr("required"))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" es obligatorio",t;if(v(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no debe contener números",t;break;case"num_doc":case"tel_res":case"celular":case"tel_acudiente":if(g(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" solo debe contener números",t;break;case"emailpilos":if(!h(a[field].value))return t.title="Error",t.status="error",t.msg="El campo "+a[field].name+" no tiene el formato de un correo electrónico",t}}return t},save_form_edit_profile:function(a,t,i,o,r){c.show(),e.ajax({type:"POST",data:JSON.stringify({func:"save_profile",params:[a,i,o,r]}),url:"../managers/student_profile/studentprofile_api.php",success:function(e){c.hide(),0==e.status_code&&swal(e.title,e.message,e.type)},dataType:"json",cache:"false",error:function(e){c.hide(),swal(e.title,e.msg,e.type)}}),t.cancel_edition()},cancel_edition:function(){e("#span-icon-cancel-edit").hide(),e("#tip-cancel").hide(),e("#span-icon-save-profile").hide(),e("#tip-save").hide(),e("#span-icon-edit").show(),e("#tip-edit").show(),e("#tipo_doc").prop("disabled",!0),e("#num_doc").prop("readonly",!0),e("#email").prop("readonly",!0),e("#icetex_status").prop("disabled",!0),e("#genero").prop("disabled",!0),e("#sexo").prop("disabled",!0),e("#cond_excepcion").prop("disabled",!0),e("#act_simultanea").prop("disabled",!0),e("#etnia").prop("disabled",!0),e("#estado_civil").prop("disabled",!0),e("#pais").prop("disabled",!0),e("#observacion").prop("readonly",!0),e(".select_statuses_program").prop("disabled",!0),e(".input_fields_general_tab").prop("readonly",!0),e(".input-tracking").prop("disabled",!0),e(".bt_delete_person").css("visibility","hidden"),e("#age").show(),e("#birthdate").hide()},revert_changes:function(a){for(field in a)e("#"+a[field].name).val(a[field].value);location.reload(!0)}};function _(a){c.show();var t=e("#id_ases").val(),i=a.data.tab_name,o=document.querySelector("#dphpforms_block_instance").dataset.info;e(".active").removeClass("active"),e("#"+i+"_li").addClass("active"),e.ajax({type:"POST",data:JSON.stringify({func:"load_tabs",params:[t,i,o]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){0==a.status_code?e.ajax({url:"../templates/view_"+i+"_tab_sp.mustache",data:null,dataType:"text",async:!1,success:function(t){c.hide();let o=e(l.render(t,a.data_response));switch(e(".tab-content").append(o),i){case"socioed":u.init();break;case"academic":d.init();break;case"geographic":p.init(),e("#mapa").appendTo("#geographic_map")}e("#"+i+"_tab").addClass("active")},error:function(){c.hide(),console.log("../templates/view_"+i+"_tab_sp.mustache cannot be reached.")}}):(c.hide(),console.log(a))},dataType:"json",cache:"false",error:function(e){c.hide(),console.log(e)}})}function m(){c.show();var a=e("#id_ases").val(),t=document.querySelector("#peer_tracking_info"),i=JSON.parse(t?t.dataset.info:null);e.ajax({type:"POST",data:JSON.stringify({func:"load_risk_info",params:[a,i]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){(c.hide(),0==a.status_code)?(!function(a){for(var t=[],i=["individual","familiar","academico","economico","vida_universitaria"],o=0;o<Object.keys(a).length;o++){for(var r=[],n=[],s=[],l=[],c=i[o],d=a[c][0].datos,u=0;"false"==d.end;)n.push(d.fecha),s.push(d.color),l.push(d.riesgo),u+=1,d=a[c][u].datos;r.push(c),r.push(n),r.push(s),r.push(l),t.push(r)}e("#risk_graphic_info").attr("data-info",JSON.stringify(t))}(a.data_response),e("#modal_riesgos").fadeIn(200),x(),e("#view_graphic_risk_button").on("click",f)):console.log(a)},dataType:"json",cache:"false",error:function(e){c.hide(),console.log(e)}})}function f(){e("#modal_riesgos").fadeIn(200),x()}function g(e){for(e=e.toLowerCase(),i=0;i<e.length;i++)if(-1!="abcdefghyjklmnñopqrstuvwxyz".indexOf(e.charAt(i),0))return 1;return 0}function v(e){for(i=0;i<e.length;i++)if(-1!="0123456789".indexOf(e.charAt(i),0))return 1;return 0}function h(e){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e)?1:0}function b(a){var t=a.data.previous_status;e("#icetex_status").change(function(){var a=e("#icetex_status option:selected").text();swal({title:"¿Está seguro/a de realizar este cambio?",text:"El estado Icetex del estudiante pasará de "+t+" a "+a,type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(a){a?function(){c.show();var a=e("#id_ases").val(),t=e("#icetex_status").val();e.ajax({type:"POST",data:JSON.stringify({func:"save_icetex_status",params:[a,t]}),dataType:"json",cache:"false",url:"../../ases/managers/student_profile/studentprofile_api.php",success:function(e){c.hide(),0==e.status_code?swal({title:e.title,text:e.message,type:e.type}):console.log(e)},error:function(e){c.hide(),swal("Error","No se puede contactar con el servidor.","error")}})}():e("#icetex_status").val(t)})})}function k(){e("#date").datepicker({dateFormat:"yy-mm-dd"});for(var a=new Date,t=(a.getDate(),a.getMonth(),a.getFullYear(),a.getMinutes()),i=a.getHours(),o="",r=0;r<24;r++)r==i?(i<10&&(i="0"+i),o+='<option value="'+i+'" selected>'+i+"</option>"):o+=r<10?'<option value="0'+r+'">0'+r+"</option>":'<option value="'+r+'">'+r+"</option>";var n="";for(r=0;r<60;r++)r==t?(t<10&&(t="0"+t),n+='<option value="'+t+'" selected>'+t+"</option>"):n+=r<10?'<option value="0'+r+'">0'+r+"</option>":'<option value="'+r+'">'+r+"</option>";e("#h_ini").append(o),e("#m_ini").append(n),e("#h_fin").append(o),e("#m_fin").append(n),e("#infomonitor").addClass("hide"),e("#seguimiento").find("input:text, textarea").val(""),e("#seguimiento").find("input:radio,input:checkbox").prop("checked",!1),e("#upd_seg").attr("disabled",!1),e("#upd_seg").attr("title",""),e("#seguimiento").find("select, textarea, input").attr("disabled",!1),e("#no_value_individual").hide(),e("#no_value_familiar").hide(),e("#no_value_academic").hide(),e("#no_value_economic").hide(),e("#no_value_life").hide(),e("#id_tracking_peer").val(""),e("#place").val(""),e("#topic_textarea").val(""),e("#objetivos").val(""),e("#individual").val(""),e("#familiar").val(""),e("#academico").val(""),e("#economico").val(""),e("#vida_uni").val(""),e("#observaciones").val(""),e("#no_value_individual").prop("checked",!0),e("#no_value_familiar").prop("checked",!0),e("#no_value_academic").prop("checked",!0),e("#no_value_economic").prop("checked",!0),e("#no_value_life").prop("checked",!0)}function y(e){for(var a=[],t=document.location.search.substring(1).split("&"),i=0;i<t.length;i++){var o=t[i].split("=");a[o[0]]=o[1]}return a}function x(){var e=JSON.parse(document.querySelector("#risk_graphic_info").dataset.info);w(e[0],ctx_individual),w(e[1],ctx_familiar),w(e[2],ctx_academico),w(e[3],ctx_economico),w(e[4],ctx_vida_universitaria)}function w(e,a,t){return new s(a,{type:"line",data:{labels:e[1],datasets:[{label:"Nivel de riesgo",fill:!1,lineTension:0,pointBackgroundColor:e[2],data:e[3],backgroundColor:"black",borderColor:"black",borderWidth:3,pointRadius:5,pointHoverRadius:7}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0,stepSize:1,max:3,min:0}}]}}})}});