// Standard license block omitted.
/*
 * @package    block_ases
 * @copyright  ASES
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ /**
 * @module block_ases/student_profile_main
 */ define(["jquery","block_ases/bootstrap","block_ases/d3","block_ases/sweetalert","block_ases/jqueryui","block_ases/select2","block_ases/Chart","block_ases/mustache","block_ases/loading_indicator","block_ases/academic_profile_main","block_ases/socioed_profile_main","block_ases/geographic_main","block_ases/discapacity_tracking_main","core/templates"],function($,a,b,c,d,e,f,g,h,i,j,k,l,m){return{init:function(b){var i=this,j=$("#municipio_act").val(),d=$("#latitude").val(),e=$("#longitude").val();let k=new google.maps.LatLng(3.3741569,-76.5355235),l=new google.maps.LatLng(3.431626,-76.546822);var f=document.querySelector("#cod_programa_activo").dataset.info[1],c="6"===f||"8"===f?l:k;"CALI"==j?document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+d+","+e+"&destination="+c.lat()+","+c.lng()+"&mode=transit'></iframe>":document.getElementById("mapa").innerHTML="<iframe class='col-xs-12 col-sm-12 col-md-12 col-lg-12' height='396' frameborder='0' style='border:0' src='https://www.google.com/maps/embed/v1/directions?key=AIzaSyAoE-aPVfruphY4V4BbE8Gdwi93x-5tBTM&origin="+d+","+e+"&destination="+c.lat()+","+c.lng()+"&mode=driving'></iframe>",$("#field_doc_dtddp").hide(),$("#socioed_li").one("click",{tab_name:"socioed"},n),$("#academic_li").one("click",{tab_name:"academic"},n),$("#geographic_li").one("click",{tab_name:"geographic"},n),$("#discapacity_tracking_li").one("click",{tab_name:"discapacity_tracking"},n),$("#geographic_li").on("click",function(){$("#mapa").appendTo("#geographic_map")}),$("#general_li").click(function(){$("#mapa").appendTo("#movableMap")}),$(document).on("click","#table_vive_con tbody tr td button",function(){$(this).parent().parent().remove()}),$("#cohorts_table tbody").find("td").each(function(){if(-1!=$(this).text().indexOf("Condici\xf3n de Excepci\xf3n")){var a=$("#cond_excepcion_alias").text().trim(),b=$("#cond_excepcion_name").text().trim();$(this).append("-"),$(this).append(a),$(this).attr("title",b)}}),$("#input_button_add_person").click(function(){let a="";a+='<tr><td> <input name="name_person" class="input_fields_general_tab"  type="text"/></td>',a+='<td> <input name="parentesco_person" class="input_fields_general_tab"  type="text" /></td>',a+='<td> <button type ="button" id="bt_delete_person" title="Eliminar persona" name="btn_delete_person" style="visibility:visible;"> </button></td> </tr>',$("#table_vive_con").find("tbody").append(a)}),$('[data-toggle="tooltip"]').tooltip();var m=C(document.location.search),g=$(".panel-collapse.collapse.in");$("#asignados").select2({width:"resolve",height:"resolve",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."}}}),$("#asignados").on("change",function(){var a=$("#asignados").val().split(" ")[0];F(a)});for(var a=0,q=b.length;a<q;a++)$("#select-"+b[a].academic_program_id+" option[value="+b[a].program_status+"]").attr("selected",!0),"1"==b[a].program_status&&$("#tr-"+b[a].id_moodle_user).addClass("is-active"),"1"==b[a].tracking_status&&$("#div_flags_"+b[a].academic_program_id).prop("checked",!0);var r="",s=$("#div_cohorts").height();$("#div-icon-edit").height(s),this.edit_profile(i),$("div.slider.round").click(function(a){r=a.target.parentElement.children[0].checked}),$(".input-tracking").on("change",{current_tracking_status:r},function(){i.update_tracking_status(r,$(this),b,i)});var t="";($(".select_statuses_program").on("focus",function(a){t=a.target.value}),$(".select_statuses_program").on("change",{current_status:t},function(){i.update_status_program(t,$(this))}),$("#icetex_status").on("click",{previous_status:$("#icetex_status option:selected").text()},u),$("#icon-tracking").on("click",function(){"seguimiento"==$("#input_status_ases").val()&&i.update_status_ases(m)}),"socioed_tab"===m.tab)?($("#general_li").removeClass("active"),$("#socioed_li").addClass("active"),$("#general_tab").removeClass("active"),$("#socioed_tab").addClass("active"),g.removeClass("in"),$("#collapseOne").addClass("in")):g.removeClass("in");var v=$("#modal_peer_tracking");w(),x(),y(),$("#button_add_track").on("click",function(){$("#save_seg").removeClass("hide"),$("#div_created").addClass("hide"),$("#upd_seg").addClass("hide"),$("#myModalLabel").attr("name","PARES"),v.show(),z()}),$("#view_form_update_profile_image").on("click",function(){$("#profile_image_update").show()}),$("#send-profile-image").on("click",function(){h.show();var a=$("#id_moodle").val(),b=document.getElementById("profile-image-input").files[0];$.ajax({url:"../managers/student_profile/studentprofile_api.php",data:JSON.stringify({function:"update_user_image",params:[a,b]}),cache:!1,contentType:!1,processData:!1,method:"POST",type:"POST",success:function(a){h.hide(),alert(a)},error:function(a){h.hide(),console.log(a)}})}),$("#save_tracking_btn").on("click",function(){A()}),$("fieldset").removeClass("hidden"),$("#clean_individual_risk").on("click",function(){$("#no_value_individual").prop("checked",!0)}),$("#clean_familiar_risk").on("click",function(){$("#no_value_familiar").prop("checked",!0)}),$("#clean_academic_risk").on("click",function(){$("#no_value_academic").prop("checked",!0)}),$("#clean_economic_risk").on("click",function(){$("#no_value_economic").prop("checked",!0)}),$("#clean_life_risk").on("click",function(){$("#no_value_life").prop("checked",!0)}),$(".btn-primary.edit_peer_tracking").on("click",function(){var a=$(this).attr("id").substring(14);D(a)}),$(".btn-danger.delete_peer_tracking").on("click",function(){var a=$(this).attr("id").substring(21);swal({title:"Advertencia",text:"\xbfEst\xe1 seguro(a) que desea borrar este seguimiento?",type:"warning",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!1},function(b){b&&E(a)})}),$("#view_graph_radial_button").on("click",function(){i.graph_radial()}),$("#view_graphic_risk_button").off("click",p),$("#view_graphic_risk_button").one("click",o),$("#mymodal-riesgo-close").click(function(){$("#modal_riesgos").fadeOut(200)})},equalize:function(){$(document).ready(function(){0==document.getElementById("genero").value&&($("#lb_otro").show(),$("#div_otro_genero").show()),0==document.getElementById("act_simultanea").value&&($("#lb_otro_act").show(),$("#div_otro_act").show());var a=$(".equalize").map(function(){return $(this).height()}).get(),b=Math.max.apply(null,a);$(".equalize").height(b),$("#birthdate").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0})})},update_status_program:function(b,a){var c=a.parent().parent().attr("id").split("-")[1],d=a.attr("id").split("-")[1],e=a.val();swal({title:"Advertencia",text:"\xbfEst\xe1 seguro que desea cambiar el estado del programa?",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!1},function(a){a?(h.show(),$.ajax({type:"POST",data:JSON.stringify({function:"update_status_program",params:[c,d,e]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){0==a.status_code?("ACTIVO"==$("#select-"+d).val()?$("#tr-"+c).addClass("is-active"):$("#tr-"+c).removeClass("is-active"),swal(a.title,a.message,a.type)):console.log(a)},dataType:"json",cache:"false",error:function(a){swal(a.title,a.msg,a.type)}}),h.hide()):$("#select-"+data.program_id).val(b)})},update_status_ases:function(a){swal({title:"Advertencia",text:"\xbfEst\xe1 seguro de que desea cambiar el estado de seguimiento del estudiante en esta instancia? El estado pasar\xe1 de 'seguimiento' a 'sin seguimiento'",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Si",cancelButtonText:"No"},function(b){b&&((modal_dropout=$("#modal_dropout")).show(),$("#save_changes_dropout").on("click",function(){h.show();var b=$("#id_ases").val(),c=$("#reasons_select").val(),d=$("#description_dropout").val();$.ajax({type:"POST",data:JSON.stringify({function:"update_ases_status",params:[b,a.instanceid,a.student_code,c,d]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){h.hide(),0==a.status_code?($("#input_status_ases").val("sinseguimiento"),$("#tip_ases_status").html("No se realiza seguimiento en esta instancia"),$("#icon-tracking").removeClass("i-tracking-t"),$("#icon-tracking").addClass("i-tracking"),modal_dropout.hide(),swal(a.title,a.message,a.type)):-7==a.status_code|| -8==a.status_code?swal(a.title,a.error_message,a.type):console.log(a)},dataType:"json",cache:"false",error:function(a){h.hide(),modal_dropout.hide(),swal(a.title,a.message,a.type)}})}))})},update_tracking_status:function(a,b,c,d){has_tracking_status=!1,!1==a?(has_tracking_status=d.validate_tracking_statuses(c)).tracking_status&&swal({title:"\xbfEst\xe1 seguro/a de cambiar el estado?",text:"Se alternar\xe1 el perfil de Moodle asociado al estudiante al cual se el realiza seguimiento",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(d){if(d){h.show(),$(".input-tracking").prop("checked",!1),b.prop("checked",!0);var e=$("#id_ases").val(),c=b[0].id;c=c.split("_")[2],$.ajax({type:"POST",data:JSON.stringify({function:"update_tracking_status",params:[e,c]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){h.hide(),setTimeout(function(){0==a.status_code|| -9==a.status_code?swal(a.title,a.message,a.type):console.log(a)},100)},dataType:"json",cache:"false",error:function(a){h.hide(),setTimeout(function(){swal(a.title,a.msg,a.status)},100)}})}else a?b.prop("checked",!0):b.prop("checked",!1)}):b.prop("checked",!0)},validate_tracking_statuses:function(a){for(i=0,has_tracking_status=!1;i<a.length;i++)if(1==a[i].tracking_status){has_tracking_status=!0;break}return a[i]},get_url_parameters:function(e){for(var b=[],c=document.location.search.substring(1).split("&"),a=0;a<c.length;a++){var d=c[a].split("=");b[d[0]]=d[1]}return b},graph_radial:function(){var a,b,c,d,e,g=document.getElementById("canvas_radial_graph").getContext("2d");a=0==$("#individual_risk").attr("data-risk-level")?4:$("#individual_risk").attr("data-risk-level"),b=0==$("#familiar_risk").attr("data-risk-level")?4:$("#familiar_risk").attr("data-risk-level"),c=0==$("#academic_risk").attr("data-risk-level")?4:$("#academic_risk").attr("data-risk-level"),d=0==$("#economic_risk").attr("data-risk-level")?4:$("#economic_risk").attr("data-risk-level"),e=0==$("#life_risk").attr("data-risk-level")?4:$("#life_risk").attr("data-risk-level"),$("#modal_radial_graph").fadeIn(200),new f(g,{type:"radar",data:{labels:["Individual","Familiar","Acad\xe9mico","Econ\xf3mico","Vida universitaria"],datasets:[{data:[4-a,4-b,4-c,4-d,4-e],backgroundColor:"rgba(255, 99, 132, 0.4)",borderColor:["rgba(255,99,132,1)"],borderWidth:2,fontsize:12}]},options:{scale:{ticks:{beginAtZero:!0,min:0,max:3,stepSize:1,display:!1},pointLabels:{fontSize:12},scaleLabel:{fontsize:10}},legend:{display:!1}}})},edit_profile:function(b){var a=$("#ficha_estudiante").serializeArray(),c=document.getElementById("otro_genero").value,d=document.getElementById("otro_act_simultanea").value;$("#span-icon-edit").on("click",function(){$(this).hide(),$("#tip-edit").hide(),$("#span-icon-save-profile").show(),$("#tip-save").show(),$("#span-icon-cancel-edit").show(),$("#tip-cancel").show(),$("#i_tipo_doc").prop("disabled",!1),$("#num_doc").prop("readonly",!1),$("#email").prop("readonly",!1),$("#icetex_status").prop("disabled",!1),$("#pais").prop("disabled",!1),$("#genero").prop("disabled",!1),$("#s_sexo").prop("disabled",!1),$("#cond_excepcion").prop("disabled",!1),$("#act_simultanea").prop("disabled",!1),$("#etnia").prop("disabled",!1),$("#otro_act_simultanea").prop("disabled",!1),$("#otro_genero").prop("disabled",!1),$("#otro_genero").prop("required",!1),$("#otro_act_simultanea").prop("required",!1),$("#s_estado_civil").prop("disabled",!1),$("#observacion").prop("readonly",!1),$(".select_statuses_program").prop("disabled",!1),$("#field_doc_dtddp").show(),$(".input_fields_general_tab").prop("readonly",!1),$(".bt_delete_person").css("visibility","visible"),$(".input-tracking").prop("disabled",!1),$("#div_add_persona_vive").show(),$("#edit_person_vive").show(),$("#age").hide(),$("#birthdate").show(),$("#link_doc_dtddp").bind("click",function(a){a.preventDefault()}),$("#link_doc_dtddp").css("color","black").css("text-decoration","none"),$("#genero").on("click",function(){0==document.getElementById("genero").value?($("#div_otro_genero").show(),$("#lb_otro").show(),$("#otro_genero").prop("required",!0)):($("#div_otro_genero").hide(),$("#lb_otro").hide(),$("#otro_genero").prop("required",!1))}),$("#act_simultanea").on("click",function(){0==document.getElementById("act_simultanea").value?($("#div_otro_act").show(),$("#lb_otro_act").show(),$("#otro_act_simultanea").prop("required",!0)):($("#div_otro_act").hide(),$("#lb_otro_act").hide(),$("#otro_act_simultanea").prop("required",!1))})}),$("#span-icon-cancel-edit").on("click",{form:a},function(a){swal({title:"\xbfDesea cancelar la edici\xf3n?",text:"Los cambios no guardados se perder\xe1n",type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(c){c&&(b.cancel_edition(),b.revert_changes(a.data.form))})}),$("#span-icon-save-profile").on("click",function(){var g=$("#ficha_estudiante").serializeArray(),a=b.validate_form(g);if("error"==a.status)swal(a.title,a.msg,a.status);else{var h,e=[],i=[],j=[];$(".table_vive_con td").find(":input").each(function(){"name_person"==$(this).attr("name")&&i.push($(this).val()),"parentesco_person"==$(this).attr("name")&&j.push($(this).val())});for(var f=0;f<i.length;f++)h={name:i[f],parentesco:j[f]},e.push(h);e=JSON.stringify(e),b.save_form_edit_profile(g,b,c,d,e),$("#otro_genero").prop("disabled",!0),$("#otro_act_simultanea").prop("disabled",!0),$("#otro_genero").prop("required",!1),$("#otro_act_simultanea").prop("required",!1)}})},validate_form:function(c){for(b in c){var a=new Object,b=c[b];switch(a.title="\xc9xito",a.msg="El formulario fue validado con \xe9xito",a.status="success",b.name){case"email":let d=/((?:[a-z]+\.)*[a-z]+(?:@correounivalle\.edu\.co))/.exec(b.value);if(null===d||d[0]!==b.value)return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no cumple con el formato institucional. Si no cuenta con el "+b.name+" institucional del estudiante, ingrese `temporal@correounivalle.edu.co', y el "+b.name+" alternativo en el campo correspondiente de la informaci\xf3n del estudiante.",a;break;case"fecha_nac":if(null==/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/.exec(b.value))return a.title="Error",a.status="error",a.msg="El campo 'fecha de nacimiento' no cumple con el formato de fecha aceptado (yyyy-mm-dd).",a;b.value+=" 00:00:00";break;case"estrato":if(b.value<0)return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe ser negativo",a;if(b.value>6)return a.title="Error",a.status="error",a.msg="El campo a\xf1o de "+b.name+" no debe ser mayor al permitido",a;if(q(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener letras",a;if(s(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener s\xedmbolos",a;break;case"ingreso":if(b.value<0)return a.title="Error",a.status="error",a.msg="El campo a\xf1o de "+b.name+" no debe ser negativo",a;let e=new Date().getFullYear();if(b.value>e)return a.title="Error",a.status="error",a.msg="El campo a\xf1o de "+b.name+" no debe ser mayor al actual",a;if(q(b.value))return a.title="Error",a.status="error",a.msg="El campo a\xf1o de "+b.name+" no debe contener letras",a;break;case"puntaje_icfes":if(b.value<0)return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe ser negativo",a;if(b.value>500)return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe ser mayor al permitido",a;if(q(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener letras",a;break;case"hijos":if(""==b.value)return a.title="Error",a.status="error",a.msg="El campo "+b.name+" es obligatorio",a;if(b.value<0)return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe ser negativo",a;if(q(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener letras",a;break;case"name_person":if(""==b.value)return a.title="Error",a.status="error",a.msg="El campo "+b.name+" es obligatorio",a;if(r(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener n\xfameros",a;break;case"otro_genero":if(""==document.getElementById("otro_genero").value&&$("#otro_genero").attr("required"))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" es obligatorio",a;if(r(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener n\xfameros",a;break;case"otro_act_simultanea":if(""==document.getElementById("otro_act_simultanea").value&&$("#otro_act_simultanea").attr("required"))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" es obligatorio",a;if(r(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener n\xfameros",a;break;case"num_doc":case"tel_res":case"celular":case"tel_acudiente":if(q(b.value)||s(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" solo debe contener n\xfameros",a;break;case"acudiente":if(s(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener s\xedmbolos",a;if(r(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no debe contener n\xfameros",a;break;case"emailpilos":if(!t(b.value))return a.title="Error",a.status="error",a.msg="El campo "+b.name+" no tiene el formato de un correo electr\xf3nico",a}}return a},save_form_edit_profile:function(a,b,c,d,e){h.show(),$.ajax({type:"POST",data:JSON.stringify({function:"save_profile",params:[a,c,d,e]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){h.hide(),$("#link_doc_dtddp").attr("href",$("#field_doc_dtddp").prop("value")),0==a.status_code&&swal(a.title,a.message,a.type)},dataType:"json",cache:"false",error:function(a){h.hide(),swal(a.title,a.msg,a.type)}}),b.cancel_edition()},cancel_edition:function(){$("#span-icon-cancel-edit").hide(),$("#tip-cancel").hide(),$("#span-icon-save-profile").hide(),$("#tip-save").hide(),$("#span-icon-edit").show(),$("#tip-edit").show(),$("#i_tipo_doc").prop("disabled",!0),$("#num_doc").prop("readonly",!0),$("#email").prop("readonly",!0),$("#icetex_status").prop("disabled",!0),$("#genero").prop("disabled",!0),$("#s_sexo").prop("disabled",!0),$("#cond_excepcion").prop("disabled",!0),$("#act_simultanea").prop("disabled",!0),$("#etnia").prop("disabled",!0),$("#s_estado_civil").prop("disabled",!0),$("#pais").prop("disabled",!0),$("#observacion").prop("readonly",!0),$(".select_statuses_program").prop("disabled",!0),$("#field_doc_dtddp").hide(),$(".input_fields_general_tab").prop("readonly",!0),$(".input-tracking").prop("disabled",!0),$(".bt_delete_person").css("visibility","hidden"),$("#age").show(),$("#birthdate").hide(),$("#link_doc_dtddp").css("color","").css("text-decoration",""),$("#link_doc_dtddp").unbind("click")},revert_changes:function(a){for(field in a)$("#"+a[field].name).val(a[field].value);location.reload(!0)}};function n(b){h.show();var c=$("#id_ases").val(),a=b.data.tab_name,d=document.querySelector("#dphpforms_block_instance").dataset.info;$(".active").removeClass("active"),$("#"+a+"_li").addClass("active"),$.ajax({type:"POST",data:JSON.stringify({function:"load_tabs",params:[c,a,d]}),url:"../managers/student_profile/studentprofile_api.php",success:function(b){0==b.status_code?m.renderForPromise("block_ases/view_"+a+"_tab_sp",b.data_response,"moove").then(({html:b,js:c})=>{switch(m.appendNodeContents(".tab-content",b,c),$("#"+a+"_tab").addClass("active"),h.hide(),a){case"socioed":j.init();break;case"academic":i.init();break;case"geographic":k.init(),$("#mapa").appendTo("#geographic_map");break;case"tracing_others":break;case"discapacity_tracking":l.init()}}).catch(a=>console.error(a)):console.log(b)},dataType:"json",cache:"false",error:function(a){console.log(a)}}),h.hide()}function o(){h.show();var b=$("#id_ases").val(),a=document.querySelector("#peer_tracking_info"),c=JSON.parse(a?a.dataset.info:null);$.ajax({type:"POST",data:JSON.stringify({function:"load_risk_info",params:[b,c]}),url:"../managers/student_profile/studentprofile_api.php",success:function(a){0==a.status_code?(G(a.data_response),$("#modal_riesgos").fadeIn(200),H(),$("#view_graphic_risk_button").on("click",p)):console.log(a)},dataType:"json",cache:"false",error:function(a){console.log(a)}}),h.hide()}function p(){$("#modal_riesgos").fadeIn(200),H()}function q(a){for(i=0,a=a.toLowerCase();i<a.length;i++)if(-1!="abcdefghyjklmn\xf1opqrstuvwxyz".indexOf(a.charAt(i),0))return 1;return 0}function r(a){for(i=0;i<a.length;i++)if(-1!="0123456789".indexOf(a.charAt(i),0))return 1;return 0}function s(a){for(i=0;i<a.length;i++)if(-1!="|\xb0!\xa1'@#$%&/()=\xbf?+{}[]-+*.,<>;:_^~".indexOf(a.charAt(i),0))return 1;return 0}function t(a){return/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(a)?1:0}function u(a){var b=a.data.previous_status;$("#icetex_status").change(function(){var a=$("#icetex_status option:selected").text();swal({title:"\xbfEst\xe1 seguro/a de realizar este cambio?",text:"El estado Icetex del estudiante pasar\xe1 de "+b+" a "+a,type:"warning",showCancelButton:!0,confirmButtonColor:"#d51b23",confirmButtonText:"Si",cancelButtonText:"No",closeOnConfirm:!0,allowEscapeKey:!1},function(a){a?v():$("#icetex_status").val(b)})})}function v(){h.show();var a=$("#id_ases").val(),b=$("#icetex_status").val();$.ajax({type:"POST",data:JSON.stringify({function:"save_icetex_status",params:[a,b]}),dataType:"json",cache:"false",url:"../../ases/managers/student_profile/studentprofile_api.php",success:function(a){0==a.status_code?swal({title:a.title,text:a.message,type:a.type}):console.log(a)},error:function(a){swal("Error","No se puede contactar con el servidor.","error")}}),h.hide()}function w(){var c=$("#modal_dropout"),a=$(".mymodal-close"),b=$("#goback_backdrop");b.on("click",function(){c.hide()}),a.on("click",function(){c.hide()})}function x(){var d=$("#modal_peer_tracking"),a=$(".mymodal-close"),b=$("#cancel_peer_tracking");b.on("click",function(){d.hide()}),a.on("click",function(){d.hide()});var c=$(".panel-heading.heading_semester_tracking");c.on("click",function(){"collapsed"==$(this).parent().attr("class")?($("h4>span",this).removeClass("glyphicon-chevron-left"),$("h4>span",this).addClass("glyphicon-chevron-down")):($("h4>span",this).removeClass("glyphicon-chevron-down"),$("h4>span",this).addClass("glyphicon-chevron-left"))})}function y(){var a=$("#modal_risk_span"),b=$("#modal_risk_close");a.on("click",function(){$("#modal_risk_graph").hide()}),b.on("click",function(){$("#modal_risk_graph").hide()})}function z(){$("#date").datepicker({dateFormat:"yy-mm-dd"});var d=new Date;d.getDate(),d.getMonth(),d.getFullYear();for(var b=d.getMinutes(),c=d.getHours(),e="",a=0;a<24;a++)a==c?(c<10&&(c="0"+c),e+='<option value="'+c+'" selected>'+c+"</option>"):a<10?e+='<option value="0'+a+'">0'+a+"</option>":e+='<option value="'+a+'">'+a+"</option>";for(var f="",a=0;a<60;a++)a==b?(b<10&&(b="0"+b),f+='<option value="'+b+'" selected>'+b+"</option>"):a<10?f+='<option value="0'+a+'">0'+a+"</option>":f+='<option value="'+a+'">'+a+"</option>";$("#h_ini").append(e),$("#m_ini").append(f),$("#h_fin").append(e),$("#m_fin").append(f),$("#infomonitor").addClass("hide"),$("#seguimiento").find("input:text, textarea").val(""),$("#seguimiento").find("input:radio,input:checkbox").prop("checked",!1),$("#upd_seg").attr("disabled",!1),$("#upd_seg").attr("title",""),$("#seguimiento").find("select, textarea, input").attr("disabled",!1),$("#no_value_individual").hide(),$("#no_value_familiar").hide(),$("#no_value_academic").hide(),$("#no_value_economic").hide(),$("#no_value_life").hide(),$("#id_tracking_peer").val(""),$("#place").val(""),$("#topic_textarea").val(""),$("#objetivos").val(""),$("#individual").val(""),$("#familiar").val(""),$("#academico").val(""),$("#economico").val(""),$("#vida_uni").val(""),$("#observaciones").val(""),$("#no_value_individual").prop("checked",!0),$("#no_value_familiar").prop("checked",!0),$("#no_value_academic").prop("checked",!0),$("#no_value_economic").prop("checked",!0),$("#no_value_life").prop("checked",!0)}function A(){var c=$("#tracking_peer_form"),f=$("#modal_peer_tracking"),a=c.serializeArray(),d=C(document.location.search),b=B(a);if("success"!=b)swal({title:"Advertencia",text:b,type:"warning",html:!0});else{a.push({name:"func",value:"save_tracking_peer"});var e=$("#id_ases").val();a.push({name:"id_ases",value:e}),a.push({name:"id_instance",value:d.instanceid}),$.ajax({type:"POST",data:a,url:"../../ases/managers/student_profile/studentprofile_serverproc.php",success:function(a){swal({title:a.title,text:a.msg,type:a.type},function(){f.hide(),C(document.location.search).tab?location.reload():location.href=location.search+"&tab=socioed_tab"})},dataType:"json",cache:"false",error:function(a){console.log(a)}})}}function B(a){var b=/^\d{4}\-(0?[1-9]|1[012])\-(0?[1-9]|[12][0-9]|3[01])$/.exec(a[1].value);if(""==a[1].value)return"Debe introducir la fecha en la cual se realiz\xf3 el seguimiento";if(null===b)return"La fecha no sigue el patr\xf3n yyyy-mm-dd. Ejemplo 2017-10-13";if(""==a[2].value)return"Debe introducir el lugar donde se realiz\xf3 el seguimiento";if(""==a[7].value)return"El campo tema se encuentra vacio";if(""==a[8].value)return"El campo objetivos se encuentra vacio";if(parseInt(a[5].value)<parseInt(a[3].value))return"La hora de finalizaci\xf3n debe ser mayor a la hora inicial";if(parseInt(a[3].value)==parseInt(a[5].value)&&parseInt(a[6].value)<=parseInt(a[4].value))return"La hora de finalizaci\xf3n debe ser mayor a la hora inicial";else if(""!=a[9].value&&0==a[10].value)return"El riesgo asociado al campo Actividad Invidual no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Individual debe marcar un nivel de riesgo.";else if(""!=a[11].value&&0==a[12].value)return"El riesgo asociado al campo Actividad Familiar no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Familiar debe marcar un nivel de riesgo.";else if(""!=a[13].value&&0==a[14].value)return"El riesgo asociado al campo Actividad Acad\xe9mico no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Acad\xe9mico debe marcar un nivel de riesgo.";else if(""!=a[15].value&&0==a[16].value)return"El riesgo asociado al campo Actividad Econ\xf3mico no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Econ\xf3mico debe marcar un nivel de riesgo.";else if(""!=a[17].value&&0==a[18].value)return"El riesgo asociado al campo Actividad Vida Universitaria no est\xe1 marcado. Si usted escribi\xf3 informaci\xf3n en el campo Actividad Vida Universitaria debe marcar un nivel de riesgo.";else if(""==a[9].value&&0!=a[10].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Individual, debe digitar informaci\xf3n en el campo Actividad Individual. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else if(""==a[11].value&&0!=a[12].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Familiar, debe digitar informaci\xf3n en el campo Actividad Familiar. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else if(""==a[13].value&&0!=a[14].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Acad\xe9mico, debe digitar informaci\xf3n en el campo Actividad Acad\xe9mico. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else if(""==a[15].value&&0!=a[16].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Econ\xf3mico, debe digitar informaci\xf3n en el campo Actividad Econ\xf3mico. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else if(""==a[17].value&&0!=a[18].value)return"Usted ha marcado el nivel de riesgo asociado a la actividad Vida Universitaria, debe digitar informaci\xf3n en el campo Actividad Vida Universitaria. O puede utilizar el icono (<span style='color:gray;' class='glyphicon glyphicon-erase'></span>) de limpiar riesgo.";else return"success"}function C(e){for(var b=[],c=document.location.search.substring(1).split("&"),a=0;a<c.length;a++){var d=c[a].split("=");b[d[0]]=d[1]}return b}function D(a){z();var c=new Date($("#"+a+" .date_tracking_peer").text()),m=$("#"+a+" .place_tracking_peer").text(),e=$("#"+a+" .init_time_tracking_peer").text(),f=$("#"+a+" .ending_time_tracking_peer").text(),n=$("#"+a+" .topic_tracking_peer").text(),o=$("#"+a+" .objectives_tracking_peer").text(),p=$("#"+a+" .individual_tracking_peer").text(),g=$("#"+a+" .ind_risk_tracking_peer").text(),q=$("#"+a+" .familiar_tracking_peer").text(),h=$("#"+a+" .fam_risk_tracking_peer").text(),r=$("#"+a+" .academico_tracking_peer").text(),i=$("#"+a+" .aca_risk_tracking_peer").text(),s=$("#"+a+" .economico_tracking_peer").text(),j=$("#"+a+" .econ_risk_tracking_peer").text(),t=$("#"+a+" .lifeu_tracking_peer").text(),k=$("#"+a+" .lifeu_risk_tracking_peer").text(),u=$("#"+a+" .observations_tracking_peer").text(),b=new Object;b.bajo=1,b.medio=2,b.alto=3;var d=c.getFullYear(),l=c.getMonth()+1;10>c.getMonth()?d+="-0"+l:d+="-"+l,10>c.getDate()?d+="-0"+c.getDate():d+="-"+c.getDate();var v=e.substring(0,2),w=e.substring(3,5),x=f.substring(0,2),y=f.substring(3,5);$('#h_ini option[value="'+v+'"]').attr("selected",!0),$('#m_ini option[value="'+w+'"]').attr("selected",!0),$('#h_fin option[value="'+x+'"]').attr("selected",!0),$('#m_fin option[value="'+y+'"]').attr("selected",!0);var A=b[g.toLowerCase()],B=b[h.toLowerCase()],C=b[j.toLowerCase()],D=b[i.toLowerCase()],E=b[k.toLowerCase()];""!=g?$("input[name='riesgo_ind'][value='"+A+"']").prop("checked",!0):$("input[name='riesgo_ind'][value='0']").prop("checked",!0),""!=h?$("input[name='riesgo_familiar'][value='"+B+"']").prop("checked",!0):$("input[name='riesgo_familiar'][value='0']").prop("checked",!0),""!=j?$("input[name='riesgo_econom'][value='"+C+"']").prop("checked",!0):$("input[name='riesgo_econom'][value='0']").prop("checked",!0),""!=i?$("input[name='riesgo_aca'][value='"+D+"']").prop("checked",!0):$("input[name='riesgo_aca'][value='0']").prop("checked",!0),""!=k?$("input[name='riesgo_uni'][value='"+E+"']").prop("checked",!0):$("input[name='riesgo_uni'][value='0']").prop("checked",!0),$("#date").val(d),$("#place").val(m),$("#topic_textarea").val(n),$("#objetivos").val(o),$("#individual").val(p),$("#familiar").val(q),$("#academico").val(r),$("#economico").val(s),$("#vida_uni").val(t),$("#observaciones").val(u),$("#id_tracking_peer").val(a);var F=$("#modal_peer_tracking");F.show()}function E(a){$.ajax({type:"POST",data:{func:"delete_tracking_peer",id_tracking:a},url:"../managers/student_profile/studentprofile_serverproc.php",success:function(a){swal(a.title,a.msg,a.status),C(document.location.search).tab?location.reload():location.href=location.search+"&tab=socioed_tab"},dataType:"json",cache:"false",error:function(a){swal(a.title,a.msg,a.status)}})}function F(a){$.ajax({type:"POST",data:JSON.stringify({function:"is_student",params:[a]}),url:"../managers/student_profile/studentprofile_api.php",success:function(c){if(1==JSON.parse(c)){var b=C(document.location.search),d=String(document.location).split("?")[0]+"?courseid="+b.courseid+"&instanceid="+b.instanceid+"&student_code="+a;location.href=d}else swal("Error","No se encuentra un estudiante asociado al c\xf3digo ingresado","error")},dataType:"text",cache:"false",error:function(a){swal("Error","Error al comunicarse con el servidor, por favor int\xe9ntelo nuevamente.","error")}})}function G(c){for(var f=[],k=["individual","familiar","academico","economico","vida_universitaria"],d=0;d<Object.keys(c).length;d++){for(var a=[],g=[],h=[],i=[],e=k[d],b=c[e][0].datos,j=0;"false"==b.end;)g.push(b.fecha),h.push(b.color),i.push(b.riesgo),j+=1,b=c[e][j].datos;a.push(e),a.push(g),a.push(h),a.push(i),f.push(a)}$("#risk_graphic_info").attr("data-info",JSON.stringify(f))}function H(){var a=JSON.parse(document.querySelector("#risk_graphic_info").dataset.info);I(a[0],ctx_individual),I(a[1],ctx_familiar),I(a[2],ctx_academico),I(a[3],ctx_economico),I(a[4],ctx_vida_universitaria)}function I(a,b,c){return new f(b,{type:"line",data:{labels:a[1],datasets:[{label:"Nivel de riesgo",fill:!1,lineTension:0,pointBackgroundColor:a[2],data:a[3],backgroundColor:"black",borderColor:"black",borderWidth:3,pointRadius:5,pointHoverRadius:7}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0,stepSize:1,max:3,min:0}}]}}})}})