define(["jquery","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert"],function(a,n,t,s){return{init:function(){var n=this,t=n.get_id_instance();n.load_cohorts_assigned();a("#input_idnumber").val(),a("#input_description").val();a(document).on("click","span.unassigned_cohort",n.unassign_cohort),a("#button_assign_cohort").on("click",{object_function:n},n.assign_cohort_instance),a("#button_update_instance").on("click",function(){var s=a("#input_idnumber").val(),e=a("#input_description").val();n.update_info_instance(t,s,e)})},get_cohorts_without_assignment:function(n){if(null==n)n=this.get_id_instance();a.ajax({type:"POST",data:{function:"load_cohorts_without_assignment",instance:n},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(n){if(0==n.status)s("Error",n.msg,"error");else if(1==n.status){var t="",e=n.msg;0==e.length?t+="<option>No hay cohortes disponibles para asignar</option>":a.each(e,function(a){t+="<option value='"+e[a].id+"'>",t+=e[a].idnumber+" "+e[a].name+"</option>"}),a("#select_cohorts").html(t)}else{"Si el problema persiste contacte al área de sistemas.",s("Error","Error al cargar las cohortes no asignadas. Por favor recargue la página.Si el problema persiste contacte al área de sistemas.","error")}},dataType:"json",cache:!1,async:!1,error:function(){s("Error","Error al cargar las cohortes sin asignación","error")}})},load_cohorts_assigned:function(n){if(null==n)n=this.get_id_instance();a.ajax({type:"POST",data:{function:"load_cohorts",instance:n},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(n){if(0==n.status)a("#div_cohorts_table").html("<center><span>La instancia no tiene cohortes asignadas</span></center>");else{"<h4>Cohortes asignadas a la instancia</h4><hr/>","<table id='cohorts_table' class='col-sm-12' style='width:100%'></table>",a("#div_cohorts_table").html("<h4>Cohortes asignadas a la instancia</h4><hr/><table id='cohorts_table' class='col-sm-12' style='width:100%'></table>"),a("#cohorts_table").DataTable(n.msg)}},dataType:"json",cache:!1,async:!1,error:function(){s("Error","Error al cargar las cohortes asignadas","error")}})},unassign_cohort:function(n){var t=a(this).parent().siblings()[0].innerHTML,e=a("#instance-id").data("instance-id");a.ajax({type:"POST",data:{function:"unassign_cohort",instance_id:e,idnumber_cohort:t},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(a){1==a.status?s("Éxito",a.msg+" La lista de cohortes se actualizarán en la siguiente recarga del sitio.","success"):s("Error",a.msg,"error")},error:function(a){s("Error","Error al conctarse con el servidor.","error")},dataType:"json",cache:!1,async:!1})},get_id_instance:function(){var a=location.search.split("&");for(var n in a){if(a[n].indexOf("instanceid")>=0)return a[n].split("=")[1]}return 0},assign_cohort_instance:function(n){var t=a("#select_cohorts").val(),e=n.data.object_function.get_id_instance();a.ajax({type:"POST",data:{function:"insert_cohort",cohort:t,instance:e},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(t){if(0==t.status)var e="Error",r="error";else e="Éxito",r="success";s(e,t.msg,r),n.data.object_function.get_cohorts_without_assignment(),n.data.object_function.load_cohorts_assigned(),a("span.unassigned_cohort").on("click",{object_function:n.data.object_function},n.data.object_function.unassign_cohort)},dataType:"json",cache:!1,async:!1,error:function(){s("Error","Error al comunicarse con el servidor.","error")}})},update_info_instance:function(n,t,e){data={function:"update_info_instance",instance_id:n,idnumber:t,description:e},a.ajax({type:"POST",data:data,url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(a){a?s("Éxito",a.msg,"success"):s("Error",a.msg,"error")},dataType:"json",cache:!1,async:!1,error:function(){s("Error","Error al actualizar la instancia","error")}})}}});