'use strict';define(['jquery','block_ases/bootstrap','block_ases/jquery.dataTables','block_ases/sweetalert'],function(a,b,c,d){return{init:function init(){var e=this,f=e.get_id_instance();e.load_cohorts_assigned();var g=a('#input_idnumber').val(),h=a('#input_description').val();a(document).on('click','span.unassigned_cohort',e.unassign_cohort),a('#button_assign_cohort').on('click',{object_function:e},e.assign_cohort_instance),a('#button_update_instance').on('click',function(){var i=a('#input_idnumber').val(),j=a('#input_description').val();e.update_info_instance(f,i,j)})},get_cohorts_without_assignment:function get_cohorts_without_assignment(e){if(e==void 0)var e=this.get_id_instance();a.ajax({type:'POST',data:{function:'load_cohorts_without_assignment',instance:e},url:'../managers/instance_management/instance_configuration_serverproc.php',success:function success(f){if(0==f.status)d('Error',f.msg,'error');else if(1==f.status){var g='',h=f.msg;0==h.length?g+='<option>No hay cohortes disponibles para asignar</option>':a.each(h,function(j){g+='<option value=\''+h[j].id+'\'>',g+=h[j].idnumber+' '+h[j].name+'</option>'}),a('#select_cohorts').html(g)}else{var i='Error al cargar las cohortes no asignadas. Por favor recargue la p\xE1gina.';i+='Si el problema persiste contacte al \xE1rea de sistemas.',d('Error',i,'error')}},dataType:'json',cache:!1,async:!1,error:function error(){d('Error','Error al cargar las cohortes sin asignaci\xF3n','error')}})},load_cohorts_assigned:function load_cohorts_assigned(e){if(e==void 0)var e=this.get_id_instance();a.ajax({type:'POST',data:{function:'load_cohorts',instance:e},url:'../managers/instance_management/instance_configuration_serverproc.php',success:function success(f){if(0==f.status)a('#div_cohorts_table').html('<center><span>La instancia no tiene cohortes asignadas</span></center>');else{var g='';g+='<h4>Cohortes asignadas a la instancia</h4><hr/>',g+='<table id=\'cohorts_table\' class=\'col-sm-12\' style=\'width:100%\'></table>',a('#div_cohorts_table').html(g),a('#cohorts_table').DataTable(f.msg)}},dataType:'json',cache:!1,async:!1,error:function error(){d('Error','Error al cargar las cohortes asignadas','error')}})},unassign_cohort:function unassign_cohort(){var f=a(this).parent().siblings()[0].innerHTML,g=a('#instance-id').data('instance-id');a.ajax({type:'POST',data:{function:'unassign_cohort',instance_id:g,idnumber_cohort:f},url:'../managers/instance_management/instance_configuration_serverproc.php',success:function success(h){1==h.status?d('\xC9xito',h.msg+' La lista de cohortes se actualizar\xE1n en la siguiente recarga del sitio.','success'):d('Error',h.msg,'error')},error:function error(){d('Error','Error al conctarse con el servidor.','error')},dataType:'json',cache:!1,async:!1})},get_id_instance:function get_id_instance(){var e=location.search.split('&');for(var f in e)if(0<=e[f].indexOf('instanceid')){var g=e[f].split('=');return g[1]}return 0},assign_cohort_instance:function assign_cohort_instance(e){var f=a('#select_cohorts').val(),g=e.data.object_function.get_id_instance();a.ajax({type:'POST',data:{function:'insert_cohort',cohort:f,instance:g},url:'../managers/instance_management/instance_configuration_serverproc.php',success:function success(h){if(0==h.status)var i='Error',j='error';else var i='\xC9xito',j='success';d(i,h.msg,j),e.data.object_function.get_cohorts_without_assignment(),e.data.object_function.load_cohorts_assigned(),a('span.unassigned_cohort').on('click',{object_function:e.data.object_function},e.data.object_function.unassign_cohort)},dataType:'json',cache:!1,async:!1,error:function error(){d('Error','Error al comunicarse con el servidor.','error')}})},update_info_instance:function update_info_instance(e,f,g){data={function:'update_info_instance',instance_id:e,idnumber:f,description:g},a.ajax({type:'POST',data:data,url:'../managers/instance_management/instance_configuration_serverproc.php',success:function success(h){h?d('\xC9xito',h.msg,'success'):d('Error',h.msg,'error')},dataType:'json',cache:!1,async:!1,error:function error(){d('Error','Error al actualizar la instancia','error')}})}}});