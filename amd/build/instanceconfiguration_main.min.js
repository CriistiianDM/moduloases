define(["jquery","block_ases/bootstrap","block_ases/datatables","block_ases/sweetalert"],function(a,b,c,d){return{init:function(){var b=this;b.get_id_instance();b.load_cohorts_assigned(),a("span.unassigned_cohort").on("click",b.unassign_cohort),a("#button_assign_cohort").on("click",{object_function:b},b.assign_cohort_instance)},get_cohorts_without_assignment:function(){a.ajax({type:"POST",data:{"function":"load_cohorts_without_assignment",instance:instance_id},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(b){if(0==b.status)d("Error",b.msg,"error");else if(1==b.status){var c="",e=b.msg;0==e.length?c+="<option>No hay cohortes disponibles para asignar</option>":a.each(e,function(a){c+="<option value='"+e[a].id+"'>",c+=e[a].idnumber+" "+e[a].name+"</option>"}),a("#select_cohorts").html(c)}else{var f="Error al cargar las cohortes no asignadas. Por favor recargue la página.";f+="Si el problema persiste contacte al área de sistemas.",d("Error",f,"error")}},dataType:"json",cache:!1,async:!1,error:function(){d("Error","Error al cargar las cohortes sin asignación","error")}})},load_cohorts_assigned:function(){var b=this.get_id_instance();a.ajax({type:"POST",data:{"function":"load_cohorts",instance:b},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(b){if(0==b.status)a("#div_cohorts_table").html("<center><span>La instancia no tiene cohortes asignadas</span></center>");else{var c="";c+="<h4>Cohortes asignadas a la instancia</h4><hr/>",c+="<table id='cohorts_table' class='col-sm-12' style='width:100%'></table>",a("#div_cohorts_table").html(c),a("#cohorts_table").DataTable(b.msg)}},dataType:"json",cache:!1,async:!1,error:function(){d("Error","Error al cargar las cohortes asignadas","error")}})},unassign_cohort:function(){a(this).parent().siblings()[0].innerHTML},get_id_instance:function(){var a=location.search.split("&");for(var b in a)if(a[b].indexOf("instanceid")>=0){var c=a[b].split("=");return c[1]}return 0},assign_cohort_instance:function(b){var c=a("#select_cohorts").val(),e=b.data.object_function.get_id_instance();a.ajax({type:"POST",data:{"function":"insert_cohort",cohort:c,instance:e},url:"../managers/instance_management/instance_configuration_serverproc.php",success:function(a){if(0==a.status)var c="Error",e="error";else var c="Éxito",e="success";d(c,a.msg,e),b.data.object_function.get_cohorts_without_assignment()},dataType:"json",cache:!1,async:!1,error:function(){d("Error","Error al comunicarse con el servidor.","error")}})}}});