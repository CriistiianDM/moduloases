define(["jquery","core/notification","block_ases/global_grade_book","core/templates","block_ases/jquery.dataTables"],function(a,e,t,r){return{init:function(){a(document).ready(function(){})},load_report:function(n){a("#tableFinalgradesReport").html('<img class="icon-loading" src="../icon/loading.gif"/>');var s=function(){function a(a,e,t){this.cursos_al_un_est_ases=a||0,this.cursos_al_item_calif=e||0,this.cursos_al_un_item=t||0}return a.return_critic_and_no_critic_report=function(e){for(var t=new a,r=new a,n=(new a,0),s=e;n<s.length;n++){var o=s[n];if(o.items_con_almenos_una_nota>0)switch(o.critica){case"SI":r.cursos_al_item_calif++;break;case"NO":t.cursos_al_item_calif++}if(o.cantidad_items>0)switch(o.critica){case"SI":r.cursos_al_un_item++;break;case"NO":t.cursos_al_un_item++}if(o.cantidad_estudiantes_ases>0)switch(o.critica){case"SI":r.cursos_al_un_est_ases++;break;case"NO":t.cursos_al_un_est_ases++}}return{critic_report:r,no_critic_report:t,total_report:a.return_total_report(r,t)}},a.return_total_report=function(e,t){var r=new a;return r.cursos_al_item_calif=e.cursos_al_item_calif+t.cursos_al_item_calif,r.cursos_al_un_est_ases=e.cursos_al_un_est_ases+t.cursos_al_un_est_ases,r.cursos_al_un_item=e.cursos_al_un_item+t.cursos_al_un_item,r},a}(),o={},c=n.course_id,i=n.instance_id,_="#cccccc",l=["critica","nombre_profesor"],u=null;function d(){a("#tableFinalgradesReport tbody").on("click","td.details-control",function(){var r=a(this).closest("tr"),n=u.row(r);if(n.child.isShown())n.child.hide(),r.removeClass("shown");else{n.child('<img class="icon-loading" src="../icon/loading.gif"/>').show();!function(t,r,n){var s={function:"grade_table",params:{course_id:t.data().curso_id,course_caller_id:c,instance_id:i}};a.ajax({method:"POST",url:"../managers/grades/grades_api.php",data:s,dataType:"html"}).fail(function(a){e.alert("Error, debe informar a un programador, adjunte esta informaciÃ³n",a.responseText,"Aceptar"),n.removeClass("shown")}).done(function(a){r(t,a)})}(n,(e,r)=>{e.child(r).show(),t.read_only_view_styles(),a(".gradeparent").parent().css("background",_)},r),r.addClass("shown")}})}a.ajax({method:"GET",url:"../managers/course_and_teacher_report/course_and_teacher_report_api.php/"+i,dataType:"json"}).done(function(e){var t;a("#tableFinalgradesReport").html(""),o=s.return_critic_and_no_critic_report(e.data),r.render("block_ases/course_and_teacher_report_summary",{resume_report:o}).then(function(a,e){r.appendNodeContents(".course_and_teacher_report .summary",a,e)}).fail(function(a){}),u=a("#tableFinalgradesReport").DataTable({data:e.data,bsort:e.bsort,columns:e.columns,language:e.language,order:e.order,initComplete:function(){var t=e.columns.map(a=>a.name?a.name:null),r=function(a,e){var t,r=[];for(t=0;t<e.length;t++)a.includes(e[t])&&r.push(t);return r}(l,t);this.api().columns(r).every(function(){var e=this,t=a('<select><option value=""></option></select>').appendTo(a(e.header())).on("change",function(){var t=a.fn.dataTable.util.escapeRegex(a(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()});e.data().unique().sort().each(function(a,e){t.append('<option value="'+a+'">'+a+"</option>")})})}}),t=e.columns,a("#tableFinalgradesReport th").each(function(e){a(this).attr("title",t[e].description)}),d()}).fail(function(a){console.log(a)})}}});