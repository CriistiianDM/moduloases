{"version":3,"sources":["../src/tracking_time_control_main.js"],"names":["define","$","init","document","ready","DataTable","datepicker","dateFormat","load_hours_report","click","beginningDate","val","endingDate","result_validation","validateFields","swal","title","text","type","html","regexp","validate_begin_date","exec","validate_end_date","SumarColumna","grilla","columna","resultVal","not","each","celdaValor","find","parseFloat","replace","toFixed","toString","fin","url","window","location","href","monitorid","split","ajax","data","initial_hour","final_hour","success","msg","empty","append","css","dataType","cache","error","alert"],"mappings":"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","sourcesContent":["// Standard license block omitted.\n/*\n * @package    block_ases/tracking_time_control_main\n * @copyright  ASES\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n/**\n * @module block_ases/tracking_time_control_main\n */\ndefine(['jquery', 'block_ases/bootstrap', 'block_ases/datatables', 'block_ases/sweetalert', 'block_ases/select2', 'block_ases/jqueryui', 'block_ases/moment'], function($, bootstrap, datatablesnet, sweetalert, select2, jqueryui, moment) {\n\n\n    return {\n\n        init: function() {\n\n            $(document).ready(function() {\n                $('#table_hours').DataTable();\n                $(\".period_date\").datepicker({\n                    dateFormat: \"yy-mm-dd\"\n                });\n\n                load_hours_report();\n\n                $(\"#consult\").click(function() {\n\n                    var beginningDate = $(\"#beginning_date\").val();\n                    var endingDate = $(\"#ending_date\").val();\n\n                    var result_validation = validateFields(beginningDate, endingDate);\n                    if (result_validation != \"success\") {\n                        swal({\n                            title: \"Advertencia\",\n                            text: result_validation,\n                            type: \"warning\",\n                            html: true\n                        });\n                    } else {\n                        load_hours_report(beginningDate, endingDate);\n                    }\n                });\n            });\n\n\n            //*Perform date format validation.\n            function validateFields(beginningDate, endingDate) {\n\n                var regexp = /^\\d{4}\\-(0?[1-9]|1[012])\\-(0?[1-9]|[12][0-9]|3[01])$/;\n\n                var validate_begin_date = regexp.exec(beginningDate);\n                var validate_end_date = regexp.exec(endingDate);\n\n                if (beginningDate == \"\" && endingDate == \"\") {\n                    return \"Debe llenar todos los campos\";\n                } else if (beginningDate == \"\" || endingDate == \"\") {\n                    return \"Debe introducir la fecha de inicio y fin del período\";\n                } else if (validate_begin_date === null) {\n                    return \"La fecha de inicio no sigue el patrón yyyy-mm-dd. Ejemplo: 2017-10-20\";\n                } else if (validate_end_date === null) {\n                    return \"La fecha de fin no sigue el patrón yyyy-mm-dd. Ejemplo: 2017-10-20\";\n                } else if (beginningDate == endingDate) {\n                    return \"La fecha de inicio y de fin deben ser diferentes\";\n                } else {\n                    return \"success\";\n                }\n\n            }\n\n\n            function SumarColumna(grilla, columna) {\n\n                var resultVal = 0.0;\n                $(\"#\" + grilla + \" tbody tr\").not(':first').each(\n                    function() {\n\n                        var celdaValor = $(this).find('td:eq(' + columna + ')');\n\n                        if (celdaValor.val() != null)\n                            resultVal += parseFloat(celdaValor.html().replace(',', '.'));\n\n                    } //function\n\n                ) //each\n                $(\"#\" + grilla + \" tfoot tr\").find('td:eq(' + columna + ')').html(resultVal.toFixed(2).toString().replace('.', ','));\n\n            }\n\n            //*Create the hour report table\n            function load_hours_report(init, fin){\n\n                var url      = window.location.href;     // Returns full URL\n                var monitorid = url.split('monitorid=');\n\n\n                if(init === undefined){\n                    init = 0;\n                }\n\n                if(fin === undefined){\n                    fin = 0;\n                }\n\n\n                $.ajax({\n                    type: \"POST\",\n                    url: \"../managers/tracking_time_control/load_hours_report.php\",\n                    data: {\n                        initial_hour: init,\n                        final_hour: fin,\n                        monitorid: monitorid[1] \n                    },\n\n                    success: function(msg) {\n                        if (msg == '') {\n                            $(\"#div_hours\").empty();\n                            $(\"#div_hours\").append('<h2>No existen registros de seguimientos en el dia de hoy</h2>');\n                        } else {\n                            $(\"#div_hours\").empty();\n                            $(\"#div_hours\").append('<table id=\"tableHours\"  class=\"display\" cellspacing=\"0\" width=\"100%\" ><thead><thead><tfoot id=\"hours_foot\"></tfoot></table>');\n                            var table = $(\"#tableHours\").DataTable(msg);\n                            $(\"#hours_foot\").append(' <tr><td><strong>Total : </strong></td><td id=\"total_hour\"></td><td></td></tr>');\n                            SumarColumna('tableHours', 1);\n                            SumarColumna('tableHours', 2);\n                            $('#div_hours #show_details').css('cursor', 'pointer');\n                        }\n                    },\n                    dataType: \"json\",\n                    cache: \"false\",\n                    error: function(msg) {\n                        alert(\"Error al cargar horas trabajadas\")\n                    },\n                })\n            }\n        }\n    };\n});"],"file":"tracking_time_control_main.min.js"}