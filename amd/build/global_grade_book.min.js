define(["jquery","block_ases/bootstrap","block_ases/datatables.net","block_ases/datatables.net-buttons","block_ases/buttons.flash","block_ases/jszip","block_ases/pdfmake","block_ases/buttons.html5","block_ases/buttons.print","block_ases/sweetalert","block_ases/select2","block_ases/jqueryui"],function(e,t,r,a,o,n,i,l,c,s,d,u){return{init:function(){function t(e){var t=!1,r=e.val();return r>5||0>r?(swal({title:"Ingrese un valor valido, entre 0 y 5. \n\rUsted ingresó: "+r,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),e.val(m),t=!1):""==r&&""!=m?(e.val("0"),t=!0):t=""==r&&""==m||r==m?!1:!0,t}function r(){e(".cat").each(function(){var t=e(this).children().next(".text");t.attr("disabled",!0),t.css("font-weight","bold")}),e(".course").each(function(){var t=e(this).children().next(".text");t.attr("disabled",!0),t.css("font-weight","bold"),t.css("font-size",16)}),e(".header").children().each(function(){e(this).removeAttr("href")})}function a(t){e("#user-grades").children().children().each(function(){void 0!=e(this).attr("data-uid")&&(o(e(this).attr("data-uid"),t)?e(this).children("th").children().each(function(){e(this).removeAttr("href"),e(this).click(function(){var t=e(this).parent().parent().attr("data-uid"),r=e("#idmoodle_"+t).attr("data-code"),a="student_profile.php";a+location.search+"&student_code="+r})}):e(this).remove())})}function o(e,t){for(var r=0;r<t.length;r++)if(t[r].split("_")[1]===e)return!0;return!1}function n(){var t=new Array;return e("#students-pilos").children().each(function(){t.push(e(this).attr("id"))}),t}function i(t,r,a){e.ajax({type:"POST",data:{type_ajax:"deleteElement",id:t,courseid:r,type:a},url:"../managers/grade_categories/grader_processing.php",success:function(e){e.error?swal("Error",e.error,"error"):(swal({title:"Listo",text:e.msg,type:"success",showCancelButton:!1,showConfirmButton:!1,timer:1200}),c(r))},dataType:"json",cache:"false",error:function(e){console.log(e)}})}function l(){for(var e=window.location.search.split("&"),t=0;t<e.length;t++){var r=e[t].split("=");if("?id_course"==r[0]||"id_course"==r[0])var a=r[1]}return a}function c(t){e.ajax({type:"POST",data:{course:t,type:"loadCat"},url:"../managers/grade_categories/grader_processing.php",success:function(t){e("#mymodalbody").html(t)},dataType:"text",cache:"false",error:function(e){console.log(e)}})}function s(t,r){var a=e("#tipoItem").val(),o=l();if("CATEGORÍA"==a){if(f(t)){var n=e.trim(e("#inputNombre").val()),i=e("#inputValor").val(),s=d(e("#tipoCalificacion").prop("selectedIndex"));e.ajax({type:"POST",data:{course:o,parent:r,fullname:n,agregation:s,tipo:a,peso:i},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),c(o)):0==e&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("ÍTEM"==a){if(u(t)){var n=e.trim(e("#inputNombre").val()),i=e("#inputValor").val();e.ajax({type:"POST",data:{course:o,parent:r,fullname:n,tipo:a,peso:i},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"item añadido con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),c(o)):0==e&&swal({title:"Error al añadir el item (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir el item",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else if("PARCIAL"==a){if(p(t)){var n=e.trim(e("#inputNombre").val()),i=e("#inputValor").val();e.ajax({type:"POST",data:{course:o,parent:r,fullname:n,agregation:6,tipo:a,peso:i},url:"../managers/grade_categories/grader_processing.php",success:function(e){1==e?(swal({title:"Categoria añadida con exito",html:!0,type:"success",confirmButtonColor:"#d51b23"}),c(o)):0==e&&swal({title:"Error al añadir la categoria (server error)",html:!0,type:"error",confirmButtonColor:"#d51b23"})},cache:"false",error:function(e){swal({title:"Error al intentar añadir la categoria",html:!0,type:"error",confirmButtonColor:"#d51b23"})}})}}else swal({title:"Seleccione el tipo de elemento que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"})}function d(e){switch(e){case 1:return 0;case 2:return 10}}function u(t){var r=e.trim(e("#inputNombre").val());if(""==r)return swal({title:"Ingrese el nombre del ítem que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==t){var a=e("#inputValor").val();if(""==a)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}function p(t){var r=e.trim(e("#inputNombre").val());if(""==r)return swal({title:"Ingrese el nombre del parcial que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==t){var a=e("#inputValor").val();if(""==a)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}function f(t){if(0==e("#tipoCalificacion").prop("selectedIndex"))return swal({title:"Seleccione el tipo de calificación de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;var r=e.trim(e("#inputNombre").val());if(""==r)return swal({title:"Ingrese el nombre de la categoría que desea crear",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1;if(10==t){var a=e("#inputValor").val();if(""==a)return swal({title:"Ingrese un peso válido entre 0 y 100",html:!0,type:"warning",confirmButtonColor:"#d51b23"}),!1}return!0}var m;e(document).ready(function(){var t=n();a(t),r(),0!=e(".gradingerror").length&&(new_page=location.origin+"/moodle/grade/report/grader/index.php?id="+l(),swal({title:"Redireccionando página.",text:"Debido al proceso de actualización del campus virtual se debe realizar este paso.\nSOLO EL DOCENTE ENCARGADO DEL CURSO PUEDE \n Una vez realizado por favor cerrar la ventana y volver a seleccionar su curso en el listado",type:"warning",showCancelButton:!1,confirmButtonClass:"btn-danger",confirmButtonText:"Continuar",closeOnConfirm:!1},function(){location.href=new_page}))}),e(document).on("blur",".text",function(){if(t(e(this))){var r=e(this).attr("id").split("_"),a=r[1],o=r[2],n=e(this).val(),i=l(),c={user:a,item:o,finalgrade:n,course:i};e.ajax({type:"POST",data:c,url:"../managers/grade_categories/grader_processing.php",async:!1,success:function(e){var t=e.nota;if(1==t){if(console.log("Nota actualizada"),3>n){var r=e.monitor,a=e.practicante,o=e.profesional;1==r?console.log("mensaje al monitor enviado correctamente"):(console.log("error monitor"),swal("Error","Error al enviar correo al monitor","error")),1==a?console.log("mensaje al practicante enviado correctamente"):(console.log("error practicante"),swal("Error","Error al enviar correo al practicante","error")),1==o?console.log("mensaje al profesional enviado correctamente"):(console.log("error profesional"),swal("Error","Error al enviar correo al profesional","error"))}}else swal("Error","Error al actualizar la nota","error")},dataType:"json",cache:"false",error:function(e){console.log(e)}})}}),e(document).on("focus",".text",function(){m=e(this).val()}),e(document).on("keypress",".text",function(e){return tecla=document.all?e.keyCode:e.which,8==tecla||46==tecla?!0:(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))}),e(document).on("click",".reload",function(){location.reload()}),e(document).on("click","#wizard_button",function(){e("#modalCategories").modal({backdrop:!1}),e(".fondo").show(),id=l(),c(id)}),e(document).on("click",".mymodal-close",function(){location.reload(),e(".fondo").hide()}),e(document).on("click",".edit",function(){swal("EDICIÓN EN PROCESO DE DESARROLLO","Disculpe las molestias","warning")}),e(document).on("click",".delete",function(){var t=e(this).parent().parent().parent().attr("id").split("_"),r=l(),a=t[1],o=t[0];if("cat"===o)var n="esta categoría";else var n="este item";var c="Esta seguro que desea eliminar "+n+"?";swal({title:c,text:"Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Aceptar, Borrar "+n,cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?i(a,r,o):swal({title:"Cancelado",type:"error",showCancelButton:!1,showConfirmButton:!1,timer:1200})})}),e(document).on("click",".new",function(){var t=e(this).prev().attr("id");if(0>=t)return void swal({title:"No se pueden crear mas categorías o ítems en la categoria seleccionada.",text:"\n\r El peso de los elementos dentro de ésta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.",html:!0,type:"warning",confirmButtonColor:"#d51b23"});e(".new").prop("disabled",!0),e(".delete").prop("disabled",!0),e(".edit").prop("disabled",!0);var r=e("<div class = 'divForm'>");r.load("../templates/categories_form.html");var a=e(this).parent().parent();a.append('<hr style = "border-top: 1px solid #ddd">'),a.append(r),window.setTimeout(function(){var t=a.attr("id");10==t&&(e("#divPeso").show(),e("#inputValor").on("blur",function(){var t=e(this).val(),r=parseInt(e(this).parent().parent().parent().parent().children().next(".maxweight").attr("id"));(0>t||t>r)&&(swal({title:"El valor debe estar entre 0 y el peso máximo: "+r,text:"\n\rUsted ingresó: "+t,html:!0,type:"warning",confirmButtonColor:"#d51b23"}),e(this).val(""))}),e("#inputValor").on("keypress",function(e){return tecla=document.all?e.keyCode:e.which,8==tecla||46==tecla?!0:(patron=/[0-9]/,tecla_final=String.fromCharCode(tecla),patron.test(tecla_final))})),e("#tipoItem").on("change",function(){var t=e(this).prop("selectedIndex");1==t?e("#divTipeC").show():e("#divTipeC").hide()}),e("#save").on("click",function(){var t=e(this).parent().parent().parent().parent().attr("id"),r=e(this).parent().parent().parent().parent().parent().attr("id");r=r.split("_")[1],s(t,r)}),e("#cancel").on("click",function(){var e=l();c(e)})},400)})}}});