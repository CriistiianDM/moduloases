'use strict';define(['jquery','block_ases/datatables','block_ases/buttons.flash','block_ases/jszip','block_ases/bootstrap','block_ases/sweetalert','block_ases/buttons.html5','block_ases/buttons.print','block_ases/jqueryui'],function(a){function j(){var m=a('#form_general_report').serializeArray();m.push({name:'instance_id',value:l()}),a('#not_assigned_students').html('<img class="icon-loading" src="../icon/loading.gif"/>'),a.ajax({type:'POST',data:m,url:'../managers/ases_report/load_not_assigned_students.php',success:function success(n){a('#not_assigned_students').html(''),a('#not_assigned_students').fadeIn(1e3).append('<table id="tableAssign" class="display" cellspacing="0" width="100%"><thead> </thead></table>'),a('#tableAssign').DataTable(n)},dataType:'json',cache:'false',error:function error(){alert('Error al cargar estudiantes no asignados')}})}function k(){var m=a('#form_general_report').serializeArray();m.push({name:'instance_id',value:l()}),a('#div_table').html('<img class="icon-loading" src="../icon/loading.gif"/>'),a.ajax({type:'POST',data:m,url:'../managers/ases_report/asesreport_server_processing.php',success:function success(n){a('#div_table').html(''),a('#div_table').fadeIn(1e3).append('<table id="tableResult" class="display" cellspacing="0" width="100%"><thead> </thead></table>'),a('#tableResult').DataTable(n),a('#tableResult tr').each(function(){a.each(this.cells,function(){'Bajo'==a(this).html()?a(this).addClass('bajo'):'Medio'==a(this).html()?a(this).addClass('medio'):'Alto'==a(this).html()&&a(this).addClass('alto')})}),a('#tableResult').bind('DOMSubtreeModified',function(){a('#tableResult tr').each(function(){a.each(this.cells,function(){'bajo'==a(this).html()?a(this).addClass('bajo'):'medio'==a(this).html()?a(this).addClass('medio'):'alto'==a(this).html()&&a(this).addClass('alto')})})})},dataType:'json',cache:'false',error:function error(){alert('Error al conectar con el servidor')}})}function l(){var m=location.search.split('&');for(x in m)if(0<=m[x].indexOf('instanceid')){var n=m[x].split('=');return n[1]}return 0}return{init:function init(){a('#send_form_btn').on('click',function(){k(),j()}),a(document).on('click','#tableAssign tbody tr td #student_assign',function(){var m=a('#tableAssign').DataTable(),n=m.row(a(this).parents('tr')).data(),o=l(),p=n.username,q=a(this).closest('tr').find('#monitors').val(),r=a(this).closest('tr').find('#practicants').val(),s=!0,t='';'--'==q&&(s=!1,t+='* Debe elegir monitor a asignar \n'),'--'==r&&(s=!1,t+='*Debe elegir practicantes a asignar'),s?a.ajax({type:'POST',data:{type:'assign_student',monitor:q,practicant:r,instance:o,student:p},url:'../managers/ases_report/asesreport.php',success:function success(u){alert(u)},dataType:'text',cache:'false',error:function error(u){console.log('Error al asignar estudiantes'+u)}}):alert(t)}),a(document).on('click','#tableResult tbody tr td',function(){var n=a('#tableResult').DataTable(),o=n.cell(this).index().column;2>=o&&(a('#formulario').each(function(){this.reset}),location.href='student_profile.php'+location.search+'&student_code='+n.cell(n.row(this).index(),0).data())}),a(document).on('change','#tableResult thead tr th select',function(){var m=a('#tableResult').DataTable(),n=a(this).parent().index()+1,o=a(this).parent().find(':selected').text();m.columns(n-1).search(this.value).draw()})}}});