{"version":3,"sources":["../src/plugin_status.js"],"names":["define","$","ases_api","console","log","document","on","event","preventDefault","find","attr","addClass","removeClass","uenroll_id","each","prop","push","data","post","async","use_loading_indicator","ok_callback","alert","ucontainer","ucontainer_checkbox","filter","filter_value","parent","show","not","hide","_load_users","global_filter","groups_abbreviations","data_response","forEach","elem","groups","template","html","text","user","firstname","lastname","id","JSON","stringify","length","i","group_name","name","short_group_name","char_control","auxiliar_salt","_group_name","substring","includes","append","appendTo","element","_load_periods","nombre","fecha_inicio","fecha_fin","init","pill","pills","tab_id","selected_tab","tabs"],"mappings":"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","sourcesContent":["// Standard license block omitted.\n/*\n * @package    block_ases\n * @copyright  ASES\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @author Jeison Cardona GÃ³mez <jeison.cardona@correounivalle.edu.co>\n * @module block_ases/plugin_status\n */\n\ndefine(\n        [\n            'jquery',\n            'block_ases/_ases_api',\n            'block_ases/aaspect'\n        ],\n        ($, ases_api, aaspect) => {\n\n    console.log(\"Plugin status initialised\");\n\n    $(document).on(\"click\", \"#select-visibles\", (event) => {\n        event.preventDefault();\n        $(\".user_enrolled[data-visible='true']\").find(\".remove_check\").attr(\"checked\", true);\n        $(\".user_enrolled[data-visible='true']\").find(\".ucontainer\").addClass(\"user-selected\");\n    });\n\n    $(document).on(\"click\", \"#clear-selection\", (event) => {\n        event.preventDefault();\n        $(\".user_enrolled\").find(\".remove_check\").attr(\"checked\", false);\n        $(\".user_enrolled\").find(\".ucontainer\").removeClass(\"user-selected\");\n    });\n\n    $(document).on(\"click\", \"#remove-selected\", (event) => {\n        event.preventDefault();\n        let uenroll_id = [];\n        \n        $(\".user_enrolled[data-visible='true']\").find(\".ucontainer\").each(() => {\n            if ($(this).find(\".remove_check\").prop(\"checked\") === true) {\n                uenroll_id.push($(this).data(\"id\"));\n            }\n        });\n\n        let response = ases_api.post(\n                \"plugin_status\", \"remove_enrolled_users\", [450299, uenroll_id],\n                async = false, use_loading_indicator = true, ok_callback = () => { alert(\"Eliminado(s)\");\n        });\n    });\n\n    $(document).on(\"click\", \".ucontainer\", () => {\n        let ucontainer = $(this);\n        let ucontainer_checkbox = $(this).find(\".remove_check\");\n        if (ucontainer_checkbox.prop(\"checked\") === true) {\n            ucontainer_checkbox.attr(\"checked\", false);\n            ucontainer.removeClass(\"user-selected\");\n        } else {\n            ucontainer_checkbox.attr(\"checked\", true);\n            ucontainer.addClass(\"user-selected\");\n        };\n    });\n\n    $(document).on(\"click\", \".mfilter\", () => {\n        $(\".ucontainer\").find(\".remove_check\").attr(\"checked\", false);\n        $(\".ucontainer\").removeClass(\"user-selected\");\n        let filter = $(this);\n        $(\".mfilter\").removeClass(\"filter-selected\");\n        filter.addClass(\"filter-selected\");\n        let filter_value = filter.data(\"filter\");\n        $(\".ucontainer\").parent().show();\n        $(\".ucontainer\").parent().attr(\"data-visible\", true);\n        if (filter_value !== \"all\") {\n            $(\".ucontainer\").not('.ucontainer[data-glist=\"' + filter_value + '\"]').parent().attr(\"data-visible\", false);\n            $(\".ucontainer\").not('.ucontainer[data-glist=\"' + filter_value + '\"]').parent().hide();\n        }\n    });\n\n\n    let _load_users = (data) => {\n        let global_filter = [];\n        let groups_abbreviations = [];\n        groups_abbreviations[\"S\"] = \"Sin grupo\";\n        data.data_response.forEach((elem) => {\n\n            let groups = [];\n            let template = $($(\"#user_enrolled_template\").html());\n            template.find(\".ucontainer\").find(\".fname\").text(elem.user.firstname);\n            template.find(\".ucontainer\").find(\".lname\").text(elem.user.lastname);\n            template.find(\".ucontainer\").attr(\"data-id\", elem.user.id);\n            template.find(\".ucontainer\").attr(\"data-groups\", JSON.stringify(elem.groups));\n            template.find(\".ucontainer\").attr(\"data-groups-number\", elem.groups.length);\n\n            for (let i = 0; i < elem.groups.length; i++) {\n\n                let group_name = elem.groups[i].name;\n                let short_group_name = \"\";\n                if (!(group_name[0] in groups_abbreviations)) {\n                    groups_abbreviations[ group_name[0] ] = group_name;\n                    short_group_name = group_name[0];\n                } else {\n                    let char_control = 1;\n                    let auxiliar_salt = \"\";\n                    while (true) {\n                        let _group_name = elem.groups[i].name + auxiliar_salt;\n                        if (_group_name.substring(0, char_control) in groups_abbreviations) {\n                            if (groups_abbreviations[ _group_name.substring(0, char_control) ] === _group_name) {\n                                short_group_name = _group_name.substring(0, char_control);\n                                break;\n                            }\n                        } else {\n                            groups_abbreviations[ _group_name.substring(0, char_control) ] = _group_name;\n                            short_group_name = _group_name.substring(0, char_control);\n                            break;\n                        }\n                        char_control++;\n                        if (char_control > elem.groups[i].name.length) {\n                            auxiliar_salt += \"1\";\n                        }\n                    }\n                }\n\n                groups.push(group_name);\n                if (!global_filter.includes(group_name)) {\n                    global_filter.push(group_name);\n                }\n                template.find(\".ucontainer\").find(\".groups_container\").append('<span class=\"enrolled_group\" title=\"' + group_name + '\">' + short_group_name + '</span>');\n            }\n\n            if (elem.groups.length === 0) {\n                groups.push(\"Sin grupo\");\n                template.find(\".ucontainer\").find(\".groups_container\").append('<span class=\"enrolled_group\" title=\"Sin grupo\">S</span>');\n            }\n\n            template.find(\".ucontainer\").attr(\"data-glist\", groups);\n            template.appendTo(\"#plugin_members_container\");\n\n        });\n\n        global_filter.push(\"Sin grupo\");\n        global_filter.forEach((element) => {\n            $(\"#step_0_selector\").append('<div class=\"mfilter\" data-filter=\"' + element + '\">' + element + '</div>');\n        });\n\n        $(\"#step_0_selector\").append('<div class=\"mfilter filter-selected\" data-filter=\"all\">Sin filtro</div>');\n    };\n\n    let _load_periods = (data) => {\n        data.data_response.forEach( (elem) => {\n            let groups = [];\n            let template = $($(\"#period-template\").html());\n            template.find(\".p-name\").text(elem.nombre);\n            template.find(\".start-d\").text(elem.fecha_inicio);\n            template.find(\".end-d\").text(elem.fecha_fin);\n            template.appendTo(\"#list-of-periods\");\n        });\n    };\n\n    ases_api.post(\n            \"plugin_status\", \"get_users_data_by_instance\", [450299],\n            async = true, use_loading_indicator = true, ok_callback = _load_users\n            );\n\n    ases_api.post(\n            \"plugin_status\", \"get_all_periods\", [],\n            async = true, use_loading_indicator = true, ok_callback = _load_periods\n            );\n\n    let initialization_available = ases_api.post(\n            \"plugin_status\", \"initialization_available\", [],\n            async = false, use_loading_indicator = true\n            ).data_response;\n\n    return {\n        init: () => {\n            $(document).on('click', '[data-toggle=\"ases-pill\"]', (e) => {\n                var pill = $(this);\n                var pills = pill.parent();\n                pills.find(\"li\").removeClass(\"ases-active\");\n                pill.addClass(\"ases-active\");\n                var tab_id = pill.data(\"tab\");\n                var selected_tab = $(tab_id);\n                var tabs = selected_tab.parent().find(\".ases-tab-pane\");\n                tabs.removeClass(\"ases-tab-active\");\n                tabs.removeClass(\"ases-fade\");\n                tabs.removeClass(\"ases-in\");\n                selected_tab.addClass(\"ases-fade\");\n                selected_tab.addClass(\"ases-in\");\n                selected_tab.addClass(\"ases-tab-active\");\n            });\n        }\n    };\n    \n});"],"file":"plugin_status.min.js"}