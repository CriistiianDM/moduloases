define(["jquery","block_ases/jscookie"],function(e,n){let t=!1,i=[],o=e("title").text();function s(n){e.ajax({type:"POST",url:"../managers/incident_manager/incident_api.php",data:JSON.stringify({function:"get_ids_open_incidents",params:[]}),contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(e){"function"==typeof n&&n(e.data_response)},failure:function(e){}})}function a(n){n>0?e("title").text("("+n+") "+o):e("title").text(o)}e("html").append('<div id="notification_sound" style="display:none;"></div>');let c=e("#menu_incidents_manager").find(".menu_a");return console.log("Incident notifier initialised"),{init:function(){c.length&&(s(function(e){let n=e.length;a(n),n>0&&(t=!0,e.forEach(e=>{i.push(e.id)}),c.append(' <span id="incidents_counter" class="badge badge-secondary">'+e.length+"</span>"))}),setInterval(()=>{s(function(o){let s=!1,d=o.length;if(a(d),d>0&&!t)t=!0,s=!0,n.set("beep",s),c.append(' <span id="incidents_counter" class="badge badge-secondary">'+o.length+"</span>");else if(d>0&&t){let t=!1,a=[];o.forEach(e=>{a.push(e.id),-1===i.indexOf(e.id)&&(t=!0)}),t&&(i=a,s=!0,n.set("beep",s),e("#incidents_counter").text(o.length))}else 0===d&&e("#incidents_counter").remove();s&&(!function(){if("true"==n.get("beep")){let e="notification_sound",t='<source src="../resources/'+e+'.mp3" type="audio/mpeg">',i='<source src="../resources/'+e+'.ogg" type="audio/ogg">',o='<embed hidden="true" autostart="true" loop="false" src="../resources/'+e+'.mp3">';document.getElementById("notification_sound").innerHTML='<audio autoplay="autoplay">'+t+i+o+"</audio>",n.set("beep","false")}}(),s=!1)})},3e3))}}});