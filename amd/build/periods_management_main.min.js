define(["jquery","block_ases/bootstrap","block_ases/jquery.dataTables","block_ases/sweetalert","block_ases/select2","block_ases/jqueryui"],function(e,n,a,r,s,t){return{init:function(){e("#periods").select2({language:{noResults:function(){return"No se encontraron resultados"},searching:function(){return"Buscando..."}},dropDownAutoWidth:!0});var n=function(e){for(var n=[],a=document.location.search.substring(1).split("&"),r=0;r<a.length;r++){var s=a[r].split("=");n[s[0]]=s[1]}return n}(document.location.search);function a(e,n,a,r){var s=/^\d{4}\-(0?[1-9]|1[012])\-(0?[1-9]|[12][0-9]|3[01])$/,t=s.exec(n),i=s.exec(a);if(""==e||""==n||""==a)return"Debe llenar todos los campos";if(null===t)return"La fecha de inicio no sigue el patrón yyyy-mm-dd. Ejemplo: 2017-10-20";if(null===i)return"La fecha de fin no sigue el patrón yyyy-mm-dd. Ejemplo: 2017-10-20";if(void 0===!r)return""==r?"Se encontró un problema con el identificador del semestre, vuelva a seleccionar el semestre":"success";return new Date(n)>=new Date(a)?"La fecha de inicio de semestre debe ser menor a la de finalización":"success"}e(document).ready(function(){e(".assignment_li").css({display:"none"}),e(".period_date").datepicker({dateFormat:"yy-mm-dd"}),e("#search_button").on("click",function(){e("#search_button").prop("disabled",!0),function(n,a){var r=n;r||(r=e("#periods").val());e.ajax({type:"POST",data:{dat:r},url:"../managers/periods_management/search_period_processing.php",success:function(n){a?a(n):n.error?(swal("Error",n.error,"error"),e(".assignment_li").addClass("hidden"),e("#periods").val("").trigger("change.select2"),e("#periods").prop("disabled",!1),e("#semester_name").val(""),e("#search_button").prop("disabled",!1)):""==n.nombre?(swal("Error","El semestre no existe en la base de datos","error"),e("#periods").prop("disabled",!1)):(e(".assignment_li").removeClass("hidden"),e("#semester_name").val(n.nombre),e("#beginning_date").val(n.fecha_inicio),e("#ending_date").val(n.fecha_fin))},dataType:"json",error:function(n){swal("Error","Hay un error con la conexión","error"),e(".assignment_li").addClass("hidden"),e("#periods").val("").trigger("change.select2"),e("#periods").prop("disabled",!1),e("#semester_name").val(" "),e("#search_button").prop("disabled",!1)}})}(),e("#periods").prop("disabled",!0),e(".assignment_li").slideToggle("fast")}),e("#ok-button").on("click",function(){var n,r,s,t,i;n=e("#periods").val(),r=e("#semester_name").val(),s=e("#beginning_date").val(),t=e("#ending_date").val(),"success"!=(i=a(r,s,t,n))?swal({title:"Advertencia",text:i,type:"warning",html:!0}):e.ajax({type:"POST",data:{id:n,name:r,beginning:s,ending:t},url:"../managers/periods_management/update_period_processing.php",success:function(e){swal({title:"Información",text:e,type:"info",html:!0,confirmButtonColor:"#d51b23",confirmButtonText:"OK",closeOnConfirm:!0})},dataType:"text",cache:"false",error:function(e){swal("Error","Ha ocurrido un error","error")}}),e(".assignment_li").addClass("hidden"),e("#periods").val("").trigger("change.select2"),e("#periods").prop("disabled",!1),e("#search_button").prop("disabled",!1),e("#semester_name").val(" "),e("#beginning_date").val(" "),e("#ending_date").val(" ")}),e("#cancel-button").on("click",function(){e(".assignment_li").addClass("hidden"),e("#periods").val("").trigger("change.select2"),e("#periods").prop("disabled",!1),e("#search_button").prop("disabled",!1),e("#semester_name").val(" "),e("#beginning_date").val(" "),e("#ending_date").val(" ")}),e("#save-button").on("click",function(){var r,s,t,i,o;r=n.instanceid,s=e("#new_semester_name").val(),t=e("#new_beginning_date").val(),i=e("#new_ending_date").val(),"success"!=(o=a(s,t,i))?swal({title:"Advertencia",text:o,type:"warning",html:!0}):e.ajax({type:"POST",data:{op:"createSemester",instance:r,name:s,beginning:t,ending:i},url:"../managers/periods_management/create_period_processing.php",success:function(e){swal({title:"Información",text:e,type:"info",html:!0,confirmButtonColor:"#d51b23",confirmButtonText:"OK",closeOnConfirm:!0})},dataType:"text",cache:"false",error:function(e){swal("Error","Ha ocurrido un error","error")}}),e("#new_semester_name").val(" "),e("#new_beginning_date").val(" "),e("#new_ending_date").val(" ")}),e("#cancel-save-button").on("click",function(){e("#new_semester_name").val(" "),e("#new_beginning_date").val(" "),e("#new_ending_date").val(" ")}),e("#list-periods-panel").on("click",function(){var a;a=n.instanceid,e.ajax({type:"POST",data:{load:"loadSemester",instance:a},url:"../managers/periods_management/load_periods_processing.php",success:function(n){e("#div_periods").empty(),e("#div_periods").append('<table id="tablePeriods" class="display" cellspacing="0" width="100%"><thead><thead></table>'),e("#tablePeriods").DataTable(n),e("#div_periods").css("cursor","pointer")},dataType:"json",cache:!1,error:function(e){alert("Error al cargar períodos")}})})})}}});